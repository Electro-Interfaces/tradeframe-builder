<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #2563eb;
        }
        .log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>

    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage</h2>
        <button onclick="checkLocalStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <div id="localStorage-status"></div>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
        <button onclick="openAppAndWatch()">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–ª–µ–¥–∏—Ç—å</button>
        <button onclick="openAppFresh()">–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ</button>
        <button onclick="simulateRefresh()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
        <div id="loading-status"></div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
        <div style="margin: 10px 0;">
            <input type="email" id="test-email" placeholder="Email" value="" />
            <input type="password" id="test-password" placeholder="–ü–∞—Ä–æ–ª—å" />
            <button onclick="testLogin()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥</button>
        </div>
        <button onclick="testInvalidLogin()">–¢–µ—Å—Ç –Ω–µ–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</button>
        <button onclick="testLogout()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥</button>
    </div>

    <div class="test-section">
        <h2>4. –õ–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
        <button onclick="startLogging()">–ù–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        <div class="log" id="logs">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤...</div>
    </div>

    <script>
        let logContainer = document.getElementById('logs');
        let isLogging = false;
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        let originalConsoleWarn = console.warn;

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            const prefix = type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : 'üìù';
            logContainer.innerHTML += `<span class="${className}">[${timestamp}] ${prefix} ${message}</span>\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function startLogging() {
            if (isLogging) return;
            isLogging = true;

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console –º–µ—Ç–æ–¥—ã
            console.log = function(...args) {
                if (isLogging) addLog(args.join(' '), 'info');
                originalConsoleLog.apply(console, args);
            };

            console.error = function(...args) {
                if (isLogging) addLog(args.join(' '), 'error');
                originalConsoleError.apply(console, args);
            };

            console.warn = function(...args) {
                if (isLogging) addLog(args.join(' '), 'warning');
                originalConsoleWarn.apply(console, args);
            };

            addLog('–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∑–∞–ø—É—â–µ–Ω', 'success');
        }

        function clearLogs() {
            logContainer.innerHTML = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...\n';
        }

        function checkLocalStorage() {
            const status = document.getElementById('localStorage-status');
            const data = {
                tradeframe_user: localStorage.getItem('tradeframe_user'),
                authToken: localStorage.getItem('authToken'),
                rememberedEmail: localStorage.getItem('rememberedEmail'),
                currentUser: localStorage.getItem('currentUser'),
                auth_token: localStorage.getItem('auth_token')
            };

            let html = '<h3>–°–æ—Å—Ç–æ—è–Ω–∏–µ localStorage:</h3>';
            for (let key in data) {
                const value = data[key];
                if (value) {
                    html += `<p><strong>${key}:</strong> ${value.length > 50 ? value.substring(0, 50) + '...' : value}</p>`;
                } else {
                    html += `<p><strong>${key}:</strong> <em>–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</em></p>`;
                }
            }

            status.innerHTML = html;
            addLog('–ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', 'info');
        }

        function clearAllData() {
            localStorage.clear();
            sessionStorage.clear();
            addLog('–í—Å–µ –¥–∞–Ω–Ω—ã–µ localStorage –∏ sessionStorage –æ—á–∏—â–µ–Ω—ã', 'warning');
            checkLocalStorage();
        }

        function openAppAndWatch() {
            addLog('–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...', 'info');
            const appWindow = window.open('http://localhost:3004', '_blank');

            // –ú–æ–Ω–∏—Ç–æ—Ä–∏–º —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                if (appWindow && !appWindow.closed) {
                    addLog('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    addLog('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 'error');
                }
            }, 2000);
        }

        function openAppFresh() {
            clearAllData();
            setTimeout(() => {
                addLog('–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —á–∏—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏...', 'info');
                window.open('http://localhost:3004', '_blank');
            }, 500);
        }

        function simulateRefresh() {
            addLog('–°–∏–º—É–ª–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...', 'info');
            const appWindow = window.open('http://localhost:3004', '_blank');
            setTimeout(() => {
                if (appWindow && !appWindow.closed) {
                    appWindow.location.reload();
                    addLog('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'info');
                }
            }, 3000);
        }

        async function testLogin() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;

            if (!email || !password) {
                addLog('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            addLog(`–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥ —Å email: ${email}`, 'info');

            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
                const response = await fetch('http://localhost:3004/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    addLog('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    addLog(`–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ—É–¥–∞—á–Ω–∞: ${response.status}`, 'error');
                }
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
                addLog('–í–æ–∑–º–æ–∂–Ω–æ, API —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
            }
        }

        function testInvalidLogin() {
            addLog('–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏...', 'info');
            document.getElementById('test-email').value = 'invalid@test.com';
            document.getElementById('test-password').value = 'wrongpassword';
            testLogin();
        }

        function testLogout() {
            addLog('–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã...', 'info');
            clearAllData();
            addLog('–î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –æ—á–∏—â–µ–Ω—ã (—Å–∏–º—É–ª—è—Ü–∏—è logout)', 'success');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkLocalStorage();
            addLog('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            addLog('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'info');
        };
    </script>
</body>
</html>