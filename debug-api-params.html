<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</title>
    <style>
        body { font-family: monospace; background: #1e1e1e; color: #fff; padding: 20px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .code { background: #0d1117; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ê–ó–° 4</h1>
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
        }
        
        async function debugApiParams() {
            addLog('üß™ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê API –ü–ê–†–ê–ú–ï–¢–†–û–í<br>');
            
            const TARGET_TP_ID = '6969b08d-1cbe-45c2-ae9c-8002c7022b59'; // –ê–ó–° 4
            
            try {
                // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å—ã
                addLog('üì¶ –ò–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–æ–≤...');
                const { tradingPointsService } = await import('./src/services/tradingPointsService.js');
                const { networksService } = await import('./src/services/networksService.js');
                addLog('‚úÖ –°–µ—Ä–≤–∏—Å—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                
                // –®–ê–ì 1: –ü–æ–ª—É—á–∞–µ–º —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É
                addLog('<br>üîç –®–ê–ì 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏...');
                const tradingPoint = await tradingPointsService.getById(TARGET_TP_ID);
                
                if (!tradingPoint) {
                    addLog('‚ùå –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!', 'error');
                    return;
                }
                
                addLog('‚úÖ –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –Ω–∞–π–¥–µ–Ω–∞:', 'success');
                addLog(`<div class="code">
                    ID: ${tradingPoint.id}<br>
                    –ù–∞–∑–≤–∞–Ω–∏–µ: ${tradingPoint.name}<br>
                    Network ID: ${tradingPoint.networkId}<br>
                    External ID: ${tradingPoint.external_id}<br>
                    –ö–æ–¥ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ –¥–ª—è API: ${tradingPoint.external_id || tradingPoint.code || '–ù–ï–¢'}
                </div>`);
                
                const stationId = tradingPoint.external_id || tradingPoint.code || '';
                if (!stationId) {
                    addLog('‚ùå –£ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ –ù–ï–¢ external_id –∏–ª–∏ code!', 'error');
                    return;
                }
                
                // –®–ê–ì 2: –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ç—å
                addLog('<br>üåê –®–ê–ì 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ç–∏...');
                if (!tradingPoint.networkId) {
                    addLog('‚ùå –£ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ –ù–ï–¢ networkId!', 'error');
                    return;
                }
                
                const network = await networksService.getById(tradingPoint.networkId);
                if (!network) {
                    addLog('‚ùå –°–µ—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!', 'error');
                    return;
                }
                
                addLog('‚úÖ –°–µ—Ç—å –Ω–∞–π–¥–µ–Ω–∞:', 'success');
                addLog(`<div class="code">
                    ID: ${network.id}<br>
                    –ù–∞–∑–≤–∞–Ω–∏–µ: ${network.name}<br>
                    External ID: ${network.external_id || '–ù–ï–¢'}<br>
                    Code: ${network.code || '–ù–ï–¢'}<br>
                    Status: ${network.status}
                </div>`);
                
                const systemId = network.external_id || network.name || '';
                
                // –®–ê–ì 3: –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                addLog('<br>üìã –®–ê–ì 3: –ê–Ω–∞–ª–∏–∑ API –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤...');
                addLog(`<div class="code">
                    System ID: "${systemId}"<br>
                    Station ID: "${stationId}"<br>
                    –û–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã: ${systemId && stationId ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}
                </div>`);
                
                if (!systemId) {
                    addLog('üîç –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê: –£ —Å–µ—Ç–∏ –Ω–µ—Ç external_id!', 'warning');
                    addLog('üí° –†–ï–®–ï–ù–ò–ï: –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å external_id –≤ —Å–µ—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫–∏–µ —Å–µ—Ç–∏ –≤–æ–æ–±—â–µ –µ—Å—Ç—å
                    addLog('<br>üîç –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ —Å–µ—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–µ...');
                    const allNetworks = await networksService.getAll();
                    
                    addLog(`<div class="code">–í—Å–µ–≥–æ —Å–µ—Ç–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: ${allNetworks.length}</div>`);
                    allNetworks.forEach((net, index) => {
                        addLog(`<div class="code">
                            ${index + 1}. ${net.name}<br>
                            &nbsp;&nbsp;&nbsp;External ID: ${net.external_id || '–ù–ï–¢'}<br>
                            &nbsp;&nbsp;&nbsp;Code: ${net.code || '–ù–ï–¢'}<br>
                            &nbsp;&nbsp;&nbsp;Status: ${net.status}
                        </div>`);
                    });
                    
                } else if (!stationId) {
                    addLog('üîç –ü–†–û–ë–õ–ï–ú–ê: –£ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ –Ω–µ—Ç external_id –∏–ª–∏ code!', 'warning');
                } else {
                    addLog('‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø–æ—Ä—è–¥–∫–µ!', 'success');
                    addLog(`<div class="code">
                        API –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:<br>
                        system=${systemId}<br>
                        station=${stationId}
                    </div>`, 'success');
                }
                
            } catch (error) {
                addLog('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', 'error');
                addLog(`<div class="code">${error.message}<br><br>Stack: ${error.stack}</div>`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        debugApiParams();
    </script>
</body>
</html>