<!DOCTYPE html>
<html>
<head>
    <title>Add Test Operations Direct to API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px 0; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .log { background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; max-height: 400px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –î–æ–±–∞–≤–∏—Ç—å –¢–µ—Å—Ç–æ–≤—ã–µ –û–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API</h1>
        <p>–î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –≤ API operations –±–µ–∑ Supabase –∫–ª–∏–µ–Ω—Ç–∞.</p>
        
        <button onclick="addTestOperationsToAPI()">–î–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ POST API</button>
        <button onclick="checkAPIOperations()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –æ–ø–µ—Ä–∞—Ü–∏–∏</button>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –õ–æ–≥</button>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api/v1';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function addTestOperationsToAPI() {
            log('üöÄ –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API...', 'info');
            
            // –¢–µ—Å—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            const testOperations = [
                {
                    id: 'op-001',
                    operationType: 'sale',
                    status: 'completed',
                    startTime: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() - 2 * 60 * 60 * 1000 + 5 * 60 * 1000).toISOString(),
                    duration: 300,
                    tradingPointId: 'tp-001',
                    tradingPointName: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                    deviceId: 'pump-01',
                    transactionId: 'txn-001',
                    fuelType: '–ê–ò-95',
                    quantity: 35.50,
                    price: 52.30,
                    totalCost: 1856.65,
                    paymentMethod: 'bank_card',
                    details: '–û–±—ã—á–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ —Ç–æ–ø–ª–∏–≤–∞',
                    progress: 100,
                    operatorName: '–ò–≤–∞–Ω–æ–≤ –ê.–ü.',
                    customerId: 'cust-001',
                    vehicleNumber: '–ê123–ë–í77',
                    metadata: { receipt_number: "12345", bonus_points: 18 }
                },
                {
                    id: 'op-002',
                    operationType: 'sale',
                    status: 'completed',
                    startTime: new Date(Date.now() - 1.5 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() - 1.5 * 60 * 60 * 1000 + 5 * 60 * 1000).toISOString(),
                    duration: 300,
                    tradingPointId: 'tp-001',
                    tradingPointName: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                    deviceId: 'pump-02',
                    transactionId: 'txn-002',
                    fuelType: '–î–¢',
                    quantity: 50.00,
                    price: 54.80,
                    totalCost: 2740.00,
                    paymentMethod: 'cash',
                    details: '–ü—Ä–æ–¥–∞–∂–∞ –¥–∏–∑–µ–ª—å–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞',
                    progress: 100,
                    operatorName: '–ü–µ—Ç—Ä–æ–≤ –°.–ò.',
                    customerId: 'cust-002',
                    vehicleNumber: '–í456–ì–î99',
                    metadata: { receipt_number: "12346" }
                },
                {
                    id: 'op-003',
                    operationType: 'sale',
                    status: 'in_progress',
                    startTime: new Date(Date.now() - 5 * 60 * 1000).toISOString(),
                    endTime: null,
                    duration: null,
                    tradingPointId: 'tp-002',
                    tradingPointName: '–ê–ó–° –°–µ–≤–µ—Ä–Ω–∞—è',
                    deviceId: 'pump-03',
                    transactionId: 'txn-003',
                    fuelType: '–ê–ò-92',
                    quantity: 25.00,
                    price: 50.90,
                    totalCost: 1272.50,
                    paymentMethod: 'bank_card',
                    details: '–ó–∞–ø—Ä–∞–≤–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ',
                    progress: 75,
                    operatorName: '–°–∏–¥–æ—Ä–æ–≤ –í.–ö.',
                    customerId: 'cust-003',
                    vehicleNumber: '–ï789–ñ–ó55',
                    metadata: { estimated_time: "2 min" }
                },
                {
                    id: 'op-004',
                    operationType: 'refund',
                    status: 'completed',
                    startTime: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() - 3 * 60 * 60 * 1000 + 5 * 60 * 1000).toISOString(),
                    duration: 300,
                    tradingPointId: 'tp-001',
                    tradingPointName: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                    deviceId: 'pump-01',
                    transactionId: 'txn-004',
                    fuelType: '–ê–ò-95',
                    quantity: 15.00,
                    price: 52.30,
                    totalCost: 784.50,
                    paymentMethod: 'bank_card',
                    details: '–í–æ–∑–≤—Ä–∞—Ç –∏–∑-–∑–∞ –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞',
                    progress: 100,
                    operatorName: '–ò–≤–∞–Ω–æ–≤ –ê.–ü.',
                    customerId: 'cust-004',
                    vehicleNumber: '–ò012–ö–õ33',
                    metadata: { refund_reason: "quality_issue", original_txn: "txn-001" }
                },
                {
                    id: 'op-005',
                    operationType: 'maintenance',
                    status: 'completed',
                    startTime: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(),
                    endTime: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                    duration: 3600,
                    tradingPointId: 'tp-001',
                    tradingPointName: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                    deviceId: 'pump-02',
                    transactionId: null,
                    fuelType: null,
                    quantity: null,
                    price: null,
                    totalCost: null,
                    paymentMethod: null,
                    details: '–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û –∫–æ–ª–æ–Ω–∫–∏ ‚Ññ2',
                    progress: 100,
                    operatorName: '–¢–µ—Ö–Ω–∏–∫ –ö–æ–∑–ª–æ–≤ –î.–ê.',
                    customerId: null,
                    vehicleNumber: null,
                    metadata: { maintenance_type: "scheduled", work_performed: ["filter_change", "calibration"] }
                }
            ];

            let successCount = 0;
            let errorCount = 0;

            for (const operation of testOperations) {
                try {
                    log(`üì§ –°–æ–∑–¥–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é ${operation.id}...`, 'info');
                    
                    const response = await fetch(`${API_BASE}/operations`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(operation)
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        log(`‚úÖ ${operation.id} –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`, 'success');
                        successCount++;
                    } else {
                        log(`‚ùå ${operation.id} –æ—à–∏–±–∫–∞: ${result.error || 'Unknown error'}`, 'error');
                        if (result.details) {
                            log(`   –î–µ—Ç–∞–ª–∏: ${result.details}`, 'error');
                        }
                        errorCount++;
                    }
                } catch (error) {
                    log(`‚ùå ${operation.id} –∏—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
                    errorCount++;
                }
                
                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            log(`üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ! –£—Å–ø–µ—à–Ω–æ: ${successCount}, –û—à–∏–±–æ–∫: ${errorCount}`, successCount > errorCount ? 'success' : 'error');
        }

        async function checkAPIOperations() {
            log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/operations`);
                const result = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ API –æ—Ç–≤–µ—Ç —É—Å–ø–µ—à–µ–Ω`, 'success');
                    log(`üìä –ù–∞–π–¥–µ–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–π: ${result.data ? result.data.length : 0}`, 'info');
                    
                    if (result.pagination) {
                        log(`üìÑ –í—Å–µ–≥–æ –≤ –ë–î: ${result.pagination.total}`, 'info');
                    }
                    
                    if (result.data && result.data.length > 0) {
                        log('üìã –û–ø–µ—Ä–∞—Ü–∏–∏:', 'info');
                        result.data.forEach((op, index) => {
                            log(`${index + 1}. ${op.id} - ${op.operationType} (${op.status}) - ${op.fuelType || 'N/A'} - ${op.totalCost || 'N/A'} —Ä—É–±.`, 'info');
                        });
                    } else {
                        log('‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'info');
                    }
                } else {
                    log(`‚ùå API –æ—à–∏–±–∫–∞: ${result.error || 'Unknown error'}`, 'error');
                    if (result.details) {
                        log(`üìã –î–µ—Ç–∞–ª–∏: ${result.details}`, 'error');
                    }
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
                log('üí° –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:3001', 'info');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('üåü –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å API!', 'info');
            checkAPIOperations();
        });
    </script>
</body>
</html>