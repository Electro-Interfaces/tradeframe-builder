<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API —Å–µ—Ç–∏ 15, —Å—Ç–∞–Ω—Ü–∏–∏ 4</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a1a; 
            color: #0f0; 
            padding: 20px;
            line-height: 1.4;
        }
        .section { 
            margin: 15px 0; 
            padding: 10px; 
            border: 1px solid #0f0;
            background: #0a0a0a;
        }
        h1 { color: #0ff; }
        h2 { color: #ff0; }
        .step {
            margin: 10px 0;
            padding: 8px;
            background: #001100;
            border-left: 3px solid #0f0;
        }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .success { color: #0f0; }
        pre {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            overflow-x: auto;
            font-size: 11px;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #0a0a0a;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px;
            cursor: pointer;
            font-family: monospace;
            margin: 5px;
        }
        button:hover {
            background: #001100;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —Å–µ—Ç–∏ 15, —Å—Ç–∞–Ω—Ü–∏–∏ 4</h1>
    
    <div class="section">
        <h2>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
        <div class="step">
            <strong>URL:</strong> https://pos.autooplata.ru/tms/v1/tanks?system=15&station=4<br>
            <strong>Token:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpbiI6eyJpZCI6IkFDQ0FFNDA4LTYzMzItNDI0NS04NUIxLTI1RjkxNEYzQkQ2NCIsIm5hbWUiOiJVc2VyVGVzdCIsInJvbGUiOjB9LCJ1c2VyIjp7ImlkIjoiQUNDQUU0MDgtNjMzMi00MjQ1LTg1QjEtMjVGOTE0RjNCRDY0IiwibmFtZSI6IlVzZXJUZXN0In0sImV4cCI6MTc1NzE1NzkzN30.7fDPBwtWej80K2ePRXYKXsJH3b3pLSUqtjo2uIbyXEE
        </div>
    </div>

    <div class="section">
        <h2>–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</h2>
        <button onclick="testTanksAPI()">üöÄ –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</button>
        <div id="result"></div>
    </div>

    <script>
        const log = (msg, type = '') => {
            const div = document.createElement('div');
            div.className = `step ${type}`;
            div.innerHTML = msg;
            document.getElementById('result').appendChild(div);
        };

        const config = {
            url: 'https://pos.autooplata.ru/tms/v1/tanks?system=15&station=4',
            token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpbiI6eyJpZCI6IkFDQ0FFNDA4LTYzMzItNDI0NS04NUIxLTI1RjkxNEYzQkQ2NCIsIm5hbWUiOiJVc2VyVGVzdCIsInJvbGUiOjB9LCJ1c2VyIjp7ImlkIjoiQUNDQUU0MDgtNjMzMi00MjQ1LTg1QjEtMjVGOTE0RjNCRDY0IiwibmFtZSI6IlVzZXJUZXN0In0sImV4cCI6MTc1NzE1NzkzN30.7fDPBwtWej80K2ePRXYKXsJH3b3pLSUqtjo2uIbyXEE'
        };

        async function testTanksAPI() {
            document.getElementById('result').innerHTML = '';
            
            log('üåê –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏...', 'warning');
            log(`üì° URL: ${config.url}`);
            log(`üîë Token: ${config.token.substring(0, 50)}...`);
            
            try {
                const response = await fetch(config.url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${config.token}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                });

                log(`üìä HTTP Status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    
                    if (Array.isArray(data)) {
                        log(`üì¶ –ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${data.length}`, 'success');
                        
                        if (data.length > 0) {
                            log('<br><strong>üìã –î–ï–¢–ê–õ–ò –í–°–ï–• –†–ï–ó–ï–†–í–£–ê–†–û–í:</strong>', 'success');
                            
                            data.forEach((tank, index) => {
                                log(`<br><strong>üõ¢Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä ‚Ññ${tank.number || (index + 1)}:</strong>`);
                                
                                // –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–µ
                                const tankDetails = {
                                    number: tank.number,
                                    fuel: tank.fuel,
                                    fuel_name: tank.fuel_name,
                                    state: tank.state,
                                    // –û–±—ä–µ–º—ã
                                    volume: tank.volume,
                                    volume_begin: tank.volume_begin,
                                    volume_end: tank.volume_end,
                                    volume_max: tank.volume_max,
                                    volume_free: tank.volume_free,
                                    // –ú–∞—Å—Å—ã
                                    amount_begin: tank.amount_begin,
                                    amount_end: tank.amount_end,
                                    // –£—Ä–æ–≤–Ω–∏
                                    level: tank.level,
                                    water: tank.water,
                                    // –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                                    temperature: tank.temperature,
                                    density: tank.density,
                                    // –û—Ç–ø—É—Å–∫
                                    release: tank.release,
                                    // –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                                    dt: tank.dt
                                };
                                
                                const pre = document.createElement('pre');
                                pre.textContent = JSON.stringify(tankDetails, null, 2);
                                document.getElementById('result').appendChild(pre);
                                
                                // –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
                                const volumeMain = parseFloat(tank.volume || '0');
                                const volumeEnd = parseFloat(tank.volume_end || '0');
                                const volumeMax = parseFloat(tank.volume_max || '0');
                                const fillPercent = volumeMax > 0 ? ((volumeMain || volumeEnd) / volumeMax * 100).toFixed(1) : 0;
                                
                                log(`üìä –ê–ù–ê–õ–ò–ó —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ ‚Ññ${tank.number}:`, 'warning');
                                log(`  ‚Ä¢ –¢–æ–ø–ª–∏–≤–æ: ${tank.fuel_name} (–∫–æ–¥: ${tank.fuel})`);
                                log(`  ‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ: ${tank.state} (1=–∞–∫—Ç–∏–≤–µ–Ω, 0=–≤—ã–∫–ª—é—á–µ–Ω)`);
                                log(`  ‚Ä¢ –û–±—ä–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π: ${tank.volume}–ª`);
                                log(`  ‚Ä¢ –û–±—ä–µ–º –∫–æ–Ω–µ—á–Ω—ã–π: ${tank.volume_end}–ª`);
                                log(`  ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –µ–º–∫–æ—Å—Ç—å: ${tank.volume_max}–ª`);
                                log(`  ‚Ä¢ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ: ${fillPercent}%`);
                                log(`  ‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${tank.temperature}¬∞C`);
                                log(`  ‚Ä¢ –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: ${tank.density}`);
                                log(`  ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${tank.dt}`);
                            });
                            
                            // –°–≤–æ–¥–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–ø–ª–∏–≤–∞
                            const fuelSummary = {};
                            data.forEach(tank => {
                                if (!fuelSummary[tank.fuel_name]) {
                                    fuelSummary[tank.fuel_name] = 0;
                                }
                                fuelSummary[tank.fuel_name]++;
                            });
                            
                            log('<br><strong>üìä –°–í–û–î–ö–ê –ü–û –¢–ò–ü–ê–ú –¢–û–ü–õ–ò–í–ê:</strong>', 'success');
                            Object.entries(fuelSummary).forEach(([fuelType, count]) => {
                                log(`  ‚Ä¢ ${fuelType}: ${count} —Ä–µ–∑–µ—Ä–≤—É–∞—Ä(–æ–≤)`);
                            });
                            
                        } else {
                            log('‚ö†Ô∏è –ú–∞—Å—Å–∏–≤ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –ø—É—Å—Ç–æ–π', 'warning');
                        }
                    } else {
                        log('‚ö†Ô∏è –û—Ç–≤–µ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', 'warning');
                        const pre = document.createElement('pre');
                        pre.textContent = JSON.stringify(data, null, 2);
                        document.getElementById('result').appendChild(pre);
                    }
                    
                } else {
                    log(`‚ùå HTTP Error: ${response.status} ${response.statusText}`, 'error');
                    
                    const errorText = await response.text().catch(() => '–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏');
                    log(`üìÑ Response Body:`, 'error');
                    const pre = document.createElement('pre');
                    pre.textContent = errorText.substring(0, 1000);
                    document.getElementById('result').appendChild(pre);
                    
                    if (response.status === 500) {
                        log('üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ 500:', 'warning');
                        log('  ‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã system –∏–ª–∏ station');
                        log('  ‚Ä¢ –°—Ç–∞–Ω—Ü–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ');
                        log('  ‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ —Ç–æ–∫–µ–Ω–æ–º');
                        log('  ‚Ä¢ –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏');
                    }
                }

            } catch (error) {
                log(`‚ùå Network Error: ${error.message}`, 'error');
                
                if (error.message.includes('CORS')) {
                    log('üö´ CORS Error - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞', 'warning');
                    log('üí° API –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞', 'warning');
                } else if (error.message.includes('Failed to fetch')) {
                    log('üåê –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'warning');
                }
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            console.log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ API...');
            testTanksAPI();
        };
    </script>
</body>
</html>