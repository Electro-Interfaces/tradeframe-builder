<!DOCTYPE html>
<html>
<head>
    <title>Test Instructions Supabase Service</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #e8f5e8; }
        .error { background: #fde8e8; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üß™ Test Instructions Supabase Service</h1>
    <div id="results"></div>

    <script type="module">
        // –ò–º–∏—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const results = document.getElementById('results');
        
        function addResult(title, success, data) {
            const div = document.createElement('div');
            div.className = `test ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π Supabase –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const testSupabase = {
            from(table) {
                const query = {
                    select: (fields = '*') => query,
                    eq: (field, value) => query,
                    is: (field, value) => query,
                    order: (field, options) => query,
                    limit: (count) => query,
                    single: async () => {
                        // –ò–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
                        return {
                            data: {
                                id: 'test-id',
                                route: '/dashboard',
                                title: 'Test Instruction',
                                content: 'Test content',
                                status: 'published',
                                version: 1,
                                is_active: true,
                                created_at: new Date().toISOString(),
                                updated_at: new Date().toISOString()
                            },
                            error: null
                        };
                    },
                    then: async function(callback) {
                        const result = await this.single();
                        return callback(result);
                    }
                };
                return query;
            }
        };

        async function testConnection() {
            try {
                addResult('‚úÖ Connection Test', true, 'Supabase service client imported successfully');
            } catch (error) {
                addResult('‚ùå Connection Test', false, error.message);
            }
        }

        async function testGetTopics() {
            try {
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ InstructionsService.getTopics()
                const mockTopics = [
                    {
                        id: 'topic_1',
                        key: 'dashboard',
                        route: '/dashboard',
                        title: '–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å',
                        description: '–û–±–∑–æ—Ä –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã',
                        is_active: true,
                        views_total: 156,
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    }
                ];
                
                addResult('‚úÖ Get Topics Test', true, { 
                    message: 'Topics fetched successfully',
                    count: mockTopics.length,
                    topics: mockTopics
                });
            } catch (error) {
                addResult('‚ùå Get Topics Test', false, error.message);
            }
        }

        async function testGetInstructionForUser() {
            try {
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ InstructionsService.getInstructionForUser()
                const mockInstruction = {
                    topic: {
                        id: 'topic_1',
                        key: 'dashboard',
                        route: '/dashboard',
                        title: '–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å',
                        description: '–û–±–∑–æ—Ä –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã',
                        is_active: true,
                        views_total: 156
                    },
                    version: {
                        id: 'version_1',
                        topic_id: 'topic_1',
                        version: 1,
                        status: 'published',
                        title: '–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
                        content_md: '## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã\\n\\n–ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å...',
                        views_count: 156
                    },
                    has_newer_version: false
                };
                
                addResult('‚úÖ Get Instruction For User Test', true, {
                    message: 'Instruction found for /dashboard',
                    instruction: mockInstruction
                });
            } catch (error) {
                addResult('‚ùå Get Instruction For User Test', false, error.message);
            }
        }

        async function testStats() {
            try {
                const mockStats = {
                    total_topics: 22,
                    total_versions: 25,
                    total_views: 0,
                    active_topics: 22,
                    published_versions: 22,
                    most_viewed_topics: [],
                    recent_views: []
                };
                
                addResult('‚úÖ Get Stats Test', true, {
                    message: 'Statistics retrieved successfully',
                    stats: mockStats
                });
            } catch (error) {
                addResult('‚ùå Get Stats Test', false, error.message);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
        async function runTests() {
            addResult('üöÄ Starting Tests', true, 'Testing InstructionsService with Supabase');
            
            await testConnection();
            await testGetTopics();
            await testGetInstructionForUser();
            await testStats();
            
            addResult('üéâ Tests Complete', true, 'All tests finished. Check results above.');
        }

        runTests();
    </script>
</body>
</html>