<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–Ω–∞–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">üõ†Ô∏è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–Ω–∞–º–∏</h1>
        
        <div class="bg-red-900 border border-red-600 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-semibold mb-2">‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–∏–¥—ã —Ç–æ–ø–ª–∏–≤–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ü–µ–Ω</h2>
            <p>–í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ—à–∞–≥–æ–≤—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã...</p>
        </div>

        <div class="space-y-4 mb-6">
            <button onclick="step1_checkConsole()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
            </button>
            <button onclick="step2_checkTradingPoint()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded ml-2">
                2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É
            </button>
            <button onclick="step3_checkTanks()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded ml-2">
                3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã
            </button>
            <button onclick="step4_fixData()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded ml-2">
                4Ô∏è‚É£ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
            <button onclick="clearResults()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded ml-2">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>

        <div id="results" class="space-y-4"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://oojbhuwgdxnpcrzljzkm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vamJodXdnZHhucGNyemxqemttIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQyMjUzNzksImV4cCI6MjA0OTgwMTM3OX0.KXF1gEiAXWv-HVLCZFoHuIKVcjQIBSUPcROkfVMNHDY';

        function step1_checkConsole() {
            addResult('info', '1Ô∏è‚É£ –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞');
            addResult('info', 'üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:');
            addResult('info', '   1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/point/prices –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ');
            addResult('info', '   2. –ù–∞–∂–º–∏—Ç–µ F12 –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è DevTools');
            addResult('info', '   3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console');
            addResult('info', '   4. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ');
            addResult('info', '   5. –ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "üî• [PRICES SERVICE]"');
            
            addResult('warning', '‚ùó –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:');
            addResult('warning', '   ‚Ä¢ "üî• [PRICES SERVICE] –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–¥–æ–≤ —Ç–æ–ø–ª–∏–≤–∞ –¥–ª—è [ID]"');
            addResult('warning', '   ‚Ä¢ "üè™ [PRICES SERVICE] –ù–∞–π–¥–µ–Ω–æ X —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤"');
            addResult('warning', '   ‚Ä¢ "‚ö†Ô∏è [PRICES SERVICE] –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã" - –µ—Å–ª–∏ –µ—Å—Ç—å —ç—Ç–∞ –æ—à–∏–±–∫–∞');
            addResult('warning', '   ‚Ä¢ –õ—é–±—ã–µ –∫—Ä–∞—Å–Ω—ã–µ –æ—à–∏–±–∫–∏');
            
            addResult('info', 'üîç –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Å–æ–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —à–∞–≥—É 2');
        }

        async function step2_checkTradingPoint() {
            addResult('info', '2Ô∏è‚É£ –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫');
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/trading_points?limit=20`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const points = await response.json();
                addResult('success', `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${points.length} —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫:`);
                
                if (points.length === 0) {
                    addResult('error', '‚ùå –ü–†–û–ë–õ–ï–ú–ê: –í —Ç–∞–±–ª–∏—Ü–µ trading_points –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö!');
                    addResult('error', '   –†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–°–µ—Ç–∏" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                    return;
                }

                points.forEach((point, i) => {
                    addResult('info', `   ${i+1}. ${point.name} (ID: ${point.id}) - –°–µ—Ç—å: ${point.network_id}`);
                });

                addResult('info', '‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –Ω–∞–π–¥–µ–Ω—ã. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤...');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã –¥–ª—è –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
                if (points.length > 0) {
                    await checkTanksForPoint(points[0].id, points[0].name);
                }

            } catch (error) {
                addResult('error', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫: ${error.message}`);
            }
        }

        async function step3_checkTanks() {
            addResult('info', '3Ô∏è‚É£ –®–∞–≥ 3: –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã
                const response = await fetch(`${SUPABASE_URL}/rest/v1/equipment?system_type=eq.fuel_tank&limit=50`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const tanks = await response.json();
                addResult('success', `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${tanks.length} —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö`);

                if (tanks.length === 0) {
                    addResult('error', '‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!');
                    addResult('error', '   –ü—Ä–∏—á–∏–Ω—ã:');
                    addResult('error', '   1. –¢–∞–±–ª–∏—Ü–∞ equipment –ø—É—Å—Ç–∞');
                    addResult('error', '   2. –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å system_type="fuel_tank"');
                    addResult('error', '   3. –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏');
                    addResult('info', 'üí° –†–µ—à–µ–Ω–∏–µ: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–†–µ–∑–µ—Ä–≤—É–∞—Ä—ã" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                    return;
                }

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–æ—Ä–≥–æ–≤—ã–º —Ç–æ—á–∫–∞–º
                const groupedByTP = {};
                tanks.forEach(tank => {
                    const tpId = tank.trading_point_id;
                    if (!groupedByTP[tpId]) {
                        groupedByTP[tpId] = [];
                    }
                    groupedByTP[tpId].push(tank);
                });

                addResult('info', `üìä –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ ${Object.keys(groupedByTP).length} —Ç–æ—Ä–≥–æ–≤—ã–º —Ç–æ—á–∫–∞–º:`);

                Object.entries(groupedByTP).forEach(([tpId, tanksList]) => {
                    const validTanks = tanksList.filter(t => t.status !== 'deleted');
                    const tanksWithFuel = tanksList.filter(t => t.status !== 'deleted' && t.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']);
                    
                    const fuelTypes = [...new Set(tanksWithFuel.map(t => t.params['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']))];

                    let statusClass = 'success';
                    if (tanksWithFuel.length === 0) statusClass = 'error';
                    else if (tanksWithFuel.length < validTanks.length) statusClass = 'warning';

                    addResult(statusClass, 
                        `üè™ TP ID: ${tpId} | 
                         –í—Å–µ–≥–æ: ${tanksList.length} | 
                         –í–∞–ª–∏–¥–Ω—ã—Ö: ${validTanks.length} | 
                         –° —Ç–∏–ø–æ–º —Ç–æ–ø–ª–∏–≤–∞: ${tanksWithFuel.length} | 
                         –í–∏–¥—ã: [${fuelTypes.join(', ') || '–ù–ï–¢'}]`
                    );

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã
                    const problematicTanks = validTanks.filter(t => !t.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']);
                    if (problematicTanks.length > 0) {
                        addResult('warning', 
                            `   ‚ö†Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –±–µ–∑ —Ç–∏–ø–∞ —Ç–æ–ø–ª–∏–≤–∞: ${problematicTanks.map(t => t.name).join(', ')}`
                        );
                    }
                });

            } catch (error) {
                addResult('error', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${error.message}`);
            }
        }

        async function step4_fixData() {
            addResult('info', '4Ô∏è‚É£ –®–∞–≥ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö');
            addResult('warning', '‚ö†Ô∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–µ—à–µ–Ω–∏—è...');

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏
                const tpResponse = await fetch(`${SUPABASE_URL}/rest/v1/trading_points?limit=20`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                const tradingPoints = await tpResponse.json();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã  
                const tanksResponse = await fetch(`${SUPABASE_URL}/rest/v1/equipment?system_type=eq.fuel_tank&limit=50`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                const tanks = await tanksResponse.json();

                addResult('info', `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${tradingPoints.length} —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫, ${tanks.length} —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤`);

                if (tradingPoints.length === 0) {
                    addResult('error', '‚ùå –ü–†–û–ë–õ–ï–ú–ê 1: –ù–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫');
                    addResult('info', 'üí° –†–ï–®–ï–ù–ò–ï: –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏:');
                    addResult('info', '   1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/admin/networks');
                    addResult('info', '   2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å–µ—Ç—å');
                    addResult('info', '   3. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ —Å–µ—Ç—å');
                    return;
                }

                if (tanks.length === 0) {
                    addResult('error', '‚ùå –ü–†–û–ë–õ–ï–ú–ê 2: –ù–µ—Ç —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤');
                    addResult('info', 'üí° –†–ï–®–ï–ù–ò–ï: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã:');
                    addResult('info', '   1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/point/tanks');
                    addResult('info', '   2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É');
                    addResult('info', '   3. –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º "–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞"');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã —Å —Ç–∏–ø–æ–º —Ç–æ–ø–ª–∏–≤–∞
                const tanksWithFuel = tanks.filter(t => t.status !== 'deleted' && t.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']);
                
                if (tanksWithFuel.length === 0) {
                    addResult('error', '‚ùå –ü–†–û–ë–õ–ï–ú–ê 3: –£ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –Ω–µ —É–∫–∞–∑–∞–Ω —Ç–∏–ø —Ç–æ–ø–ª–∏–≤–∞');
                    addResult('info', 'üí° –†–ï–®–ï–ù–ò–ï: –û–±–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤:');
                    addResult('info', '   1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/point/tanks');
                    addResult('info', '   2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É');
                    addResult('info', '   3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π —Ä–µ–∑–µ—Ä–≤—É–∞—Ä');
                    addResult('info', '   4. –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä "–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞" (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê–ò-92, –ê–ò-95, –î–¢)');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    const problemTanks = tanks.filter(t => t.status !== 'deleted');
                    addResult('warning', `üìù –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã —Ç—Ä–µ–±—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (${problemTanks.length}):`);
                    problemTanks.slice(0, 5).forEach(tank => {
                        addResult('warning', `   ‚Ä¢ ${tank.name} (ID: ${tank.id}) - –¢–ü: ${tank.trading_point_id}`);
                    });
                    
                    return;
                }

                addResult('success', '‚úÖ –î–∞–Ω–Ω—ã–µ –≤ –ø–æ—Ä—è–¥–∫–µ! –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:');
                addResult('info', '   1. –í—ã–±—Ä–∞–Ω–∞ —Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –±–µ–∑ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤');
                addResult('info', '   2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ - –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É');
                addResult('info', '   3. –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞');

            } catch (error) {
                addResult('error', `‚ùå –û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: ${error.message}`);
            }
        }

        async function checkTanksForPoint(pointId, pointName) {
            addResult('info', `üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã –¥–ª—è "${pointName}" (ID: ${pointId}):`);
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/equipment?trading_point_id=eq.${pointId}&system_type=eq.fuel_tank&limit=100`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                const tanks = await response.json();
                
                if (tanks.length === 0) {
                    addResult('error', `   ‚ùå –£ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ "${pointName}" –Ω–µ—Ç —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤!`);
                    return;
                }

                const validTanks = tanks.filter(t => t.status !== 'deleted' && t.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']);
                const fuelTypes = [...new Set(validTanks.map(t => t.params['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']))];

                if (validTanks.length === 0) {
                    addResult('warning', `   ‚ö†Ô∏è –£ "${pointName}": ${tanks.length} —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤, –Ω–æ –Ω–∏ —É –æ–¥–Ω–æ–≥–æ –Ω–µ—Ç —Ç–∏–ø–∞ —Ç–æ–ø–ª–∏–≤–∞`);
                } else {
                    addResult('success', `   ‚úÖ –£ "${pointName}": ${validTanks.length} —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —Å —Ç–æ–ø–ª–∏–≤–æ–º: [${fuelTypes.join(', ')}]`);
                }

            } catch (error) {
                addResult('error', `   ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`);
            }
        }

        function addResult(type, message) {
            const results = document.getElementById('results');
            const colors = {
                'info': 'bg-blue-900 border-blue-600 text-blue-200',
                'success': 'bg-green-900 border-green-600 text-green-200',
                'warning': 'bg-yellow-900 border-yellow-600 text-yellow-200',
                'error': 'bg-red-900 border-red-600 text-red-200'
            };
            
            const div = document.createElement('div');
            div.className = `border-l-4 p-4 rounded ${colors[type] || colors.info}`;
            div.innerHTML = `
                <div class="whitespace-pre-wrap font-mono text-sm">${message}</div>
            `;
            
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        document.addEventListener('DOMContentLoaded', () => {
            addResult('info', 'üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
            setTimeout(() => {
                step2_checkTradingPoint();
            }, 1000);
        });
    </script>
</body>
</html>