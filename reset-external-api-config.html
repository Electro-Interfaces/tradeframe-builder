<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÑ –°–±—Ä–æ—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ API</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        .highlight { 
            background: #2d4a22; 
            padding: 10px; 
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.success { background: #28a745; }
    </style>
</head>
<body>
    <h1>üîÑ –°–ë–†–û–° –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –í–ù–ï–®–ù–ï–ì–û API</h1>
    <p>–ò—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: endpoints /v1/* ‚Üí /, authType bearer ‚Üí basic</p>
    
    <div>
        <button onclick="checkCurrentConfig()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
        <button onclick="resetToDefaultConfig()" class="danger">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
        <button onclick="updateSpecificSettings()" class="success">‚öôÔ∏è –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>
    
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        let tradingNetworkConfigService = null;
        let systemConfigService = null;
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        window.clearLog = function() {
            log.innerHTML = '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function initialize() {
            try {
                const configImports = await import('/src/services/tradingNetworkConfigService.ts');
                tradingNetworkConfigService = configImports.tradingNetworkConfigService;
                
                const systemImports = await import('/src/services/systemConfigService.ts');
                systemConfigService = systemImports.systemConfigService;
                
                addLog('‚úÖ –°–µ—Ä–≤–∏—Å—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        window.checkCurrentConfig = async function() {
            addLog('üîç –ü–†–û–í–ï–†–ö–ê –¢–ï–ö–£–©–ï–ô –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò', 'info');
            
            try {
                const config = await tradingNetworkConfigService.getConfig();
                
                addLog(`<div class="code">
                    –¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –í–ù–ï–®–ù–ï–ì–û API:<br>
                    ‚ûú –í–∫–ª—é—á–µ–Ω–∞: ${config.enabled ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}<br>
                    ‚ûú Base URL: ${config.baseUrl}<br>
                    ‚ûú Auth Type: ${config.authType} ${config.authType === 'basic' ? '‚úÖ' : '‚ùå –î–û–õ–ñ–ù–û –ë–´–¢–¨ basic'}<br>
                    ‚ûú Username: ${config.username}<br>
                    ‚ûú Password: ${config.password ? '***' : '–ù–ï–¢'}<br>
                    ‚ûú API Key: ${config.apiKey || '–ù–ï–¢'}<br>
                    ‚ûú Timeout: ${config.timeout}ms<br>
                    ‚ûú Endpoints:<br>
                    &nbsp;&nbsp;- Tanks: ${config.endpoints.tanks} ${config.endpoints.tanks === '/tanks' ? '‚úÖ' : '‚ùå –î–û–õ–ñ–ù–û –ë–´–¢–¨ /tanks'}<br>
                    &nbsp;&nbsp;- Transactions: ${config.endpoints.transactions} ${config.endpoints.transactions === '/transactions' ? '‚úÖ' : '‚ùå –î–û–õ–ñ–ù–û –ë–´–¢–¨ /transactions'}
                </div>`, 'info');
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—ã
                const problems = [];
                if (config.authType !== 'basic') {
                    problems.push(`AuthType: ${config.authType} ‚Üí basic`);
                }
                if (config.endpoints.tanks !== '/tanks') {
                    problems.push(`Tanks endpoint: ${config.endpoints.tanks} ‚Üí /tanks`);
                }
                if (config.endpoints.transactions !== '/transactions') {
                    problems.push(`Transactions endpoint: ${config.endpoints.transactions} ‚Üí /transactions`);
                }
                
                if (problems.length > 0) {
                    addLog(`<div class="highlight">
                        ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–´ –ü–†–û–ë–õ–ï–ú–´ –í –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò:<br>
                        ${problems.map(p => `‚Ä¢ ${p}`).join('<br>')}
                    </div>`, 'warning');
                } else {
                    addLog('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è!', 'success');
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        window.resetToDefaultConfig = async function() {
            addLog('üîÑ –°–ë–†–û–° –ö –ù–ê–°–¢–†–û–ô–ö–ê–ú –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ', 'warning');
            
            try {
                const SYSTEM_CONFIG_KEY = 'TRADING_NETWORK_CONFIG';
                
                addLog('üîÑ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º null –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è defaults...', 'info');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º null, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                await systemConfigService.setConfig(SYSTEM_CONFIG_KEY, null, 'system', '–°–±—Ä–æ—Å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                
                addLog('‚úÖ –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞', 'success');
                
                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const newConfig = await tradingNetworkConfigService.getConfig();
                
                addLog(`<div class="highlight">
                    ‚úÖ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ë–†–û–®–ï–ù–ê –ö –ó–ù–ê–ß–ï–ù–ò–Ø–ú –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ:<br>
                    ‚ûú Auth Type: ${newConfig.authType}<br>
                    ‚ûú Tanks endpoint: ${newConfig.endpoints.tanks}<br>
                    ‚ûú Transactions endpoint: ${newConfig.endpoints.transactions}<br>
                    ‚ûú Username: ${newConfig.username}<br>
                    ‚ûú Password: ${newConfig.password ? '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–ù–ï–¢'}
                </div>`, 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        window.updateSpecificSettings = async function() {
            addLog('‚öôÔ∏è –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–ù–´–• –ù–ê–°–¢–†–û–ï–ö', 'info');
            
            try {
                const currentConfig = await tradingNetworkConfigService.getConfig();
                
                // –°–æ–∑–¥–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                const fixedConfig = {
                    ...currentConfig,
                    authType: 'basic',
                    endpoints: {
                        tanks: '/tanks',
                        transactions: '/transactions'
                    },
                    username: 'UserApi',
                    password: 'PasswordApi'
                };
                
                addLog('üîß –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...', 'info');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ systemConfigService –∏—Å–ø–æ–ª—å–∑—É—è setConfig
                const SYSTEM_CONFIG_KEY = 'TRADING_NETWORK_CONFIG';
                await systemConfigService.setConfig(SYSTEM_CONFIG_KEY, fixedConfig, 'system', '–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ API');
                
                addLog(`<div class="highlight">
                    ‚úÖ –ù–ê–°–¢–†–û–ô–ö–ò –û–ë–ù–û–í–õ–ï–ù–´:<br>
                    ‚ûú Auth Type: ${fixedConfig.authType}<br>
                    ‚ûú Tanks endpoint: ${fixedConfig.endpoints.tanks}<br>
                    ‚ûú Transactions endpoint: ${fixedConfig.endpoints.transactions}<br>
                    ‚ûú Username: ${fixedConfig.username}<br>
                    ‚ûú Password: ***
                </div>`, 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                await new Promise(resolve => setTimeout(resolve, 500));
                await checkCurrentConfig();
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–±—Ä–æ—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω', 'info');
        initialize();
    </script>
</body>
</html>