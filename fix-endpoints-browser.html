<!DOCTYPE html>
<html>
<head>
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ API</title>
</head>
<body>
    <h1>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API</h1>
    <button onclick="fixEndpoints()">–ò—Å–ø—Ä–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</button>
    <div id="result"></div>

    <script>
        async function fixEndpoints() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'üîÑ –ò—Å–ø—Ä–∞–≤–ª—è—é —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã...';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                const getResponse = await fetch('/supabase-proxy/rest/v1/system_config?key=eq.trading_network_config', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5NDkwMDAsImV4cCI6MjA1MjUyNTAwMH0.Mn0fYenKB2H0fRD8u_7aTpTw_M-iqGCrVk5M5hKZkN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5NDkwMDAsImV4cCI6MjA1MjUyNTAwMH0.Mn0fYenKB2H0fRD8u_7aTpTw_M-iqGCrVk5M5hKZkN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!getResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${getResponse.status}`);
                }
                
                const data = await getResponse.json();
                console.log('üìÑ –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:', data);
                
                if (!data || data.length === 0) {
                    throw new Error('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                const config = data[0];
                const currentValue = config.value;
                
                resultDiv.innerHTML += '<br>üìÑ –¢–µ–∫—É—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: ' + JSON.stringify(currentValue.endpoints);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
                const updatedValue = {
                    ...currentValue,
                    endpoints: {
                        tanks: '/v1/tanks',
                        transactions: '/v1/transactions'
                    }
                };
                
                resultDiv.innerHTML += '<br>‚úèÔ∏è –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: ' + JSON.stringify(updatedValue.endpoints);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º
                const updateResponse = await fetch('/supabase-proxy/rest/v1/system_config?key=eq.trading_network_config', {
                    method: 'PATCH',
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5NDkwMDAsImV4cCI6MjA1MjUyNTAwMH0.Mn0fYenKB2H0fRD8u_7aTpTw_M-iqGCrVk5M5hKZkN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY5NDkwMDAsImV4cCI6MjA1MjUyNTAwMH0.Mn0fYenKB2H0fRD8u_7aTpTw_M-iqGCrVk5M5hKZkN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY',
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        value: updatedValue,
                        updated_at: new Date().toISOString()
                    })
                });
                
                if (!updateResponse.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${updateResponse.status} ${await updateResponse.text()}`);
                }
                
                const updatedData = await updateResponse.json();
                
                resultDiv.innerHTML += '<br><br>‚úÖ <strong>–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!</strong>';
                resultDiv.innerHTML += '<br>üéØ –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ' + JSON.stringify(updatedData[0].value.endpoints);
                resultDiv.innerHTML += '<br><br>üí° <strong>–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ!</strong>';
                
                console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:', updatedData);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                resultDiv.innerHTML += '<br><br>‚ùå <strong>–û—à–∏–±–∫–∞:</strong> ' + error.message;
            }
        }
    </script>
</body>
</html>