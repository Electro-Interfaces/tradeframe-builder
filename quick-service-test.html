<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quick Service Key Test</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .log { background: #111; padding: 15px; margin: 10px 0; border: 1px solid #0f0; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <h1>üîê Quick Service Key Test</h1>
    <button onclick="runQuickTest()">üöÄ RUN QUICK TEST</button>
    <div id="result" class="log"></div>

    <script>
        const SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';
        const URL = 'https://tohtryzyffcebtyvkxwh.supabase.co';

        function log(msg, type = 'info') {
            const div = document.getElementById('result');
            const time = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            div.innerHTML += `<div class="${className}">[${time}] ${msg}</div>`;
        }

        async function runQuickTest() {
            document.getElementById('result').innerHTML = '';
            log('üîê Testing Service Key (bypasses ALL security)...', 'warning');

            try {
                // Test 1: Basic connection
                const response1 = await fetch(`${URL}/rest/v1/`, {
                    headers: {
                        'apikey': SERVICE_KEY,
                        'Authorization': `Bearer ${SERVICE_KEY}`
                    }
                });
                log(`‚úÖ Connection: ${response1.status} ${response1.statusText}`, response1.ok ? 'success' : 'error');

                // Test 2: Equipment Templates
                const response2 = await fetch(`${URL}/rest/v1/equipment_templates?limit=3`, {
                    headers: {
                        'apikey': SERVICE_KEY,
                        'Authorization': `Bearer ${SERVICE_KEY}`
                    }
                });
                if (response2.ok) {
                    const data = await response2.json();
                    log(`‚úÖ Equipment Templates: ${data.length} records`, 'success');
                } else {
                    log(`‚ùå Equipment Templates: ${response2.status}`, 'error');
                }

                // Test 3: CREATE operation (the problematic one)
                const testId = 'service-quick-' + Date.now();
                const response3 = await fetch(`${URL}/rest/v1/equipment_templates`, {
                    method: 'POST',
                    headers: {
                        'apikey': SERVICE_KEY,
                        'Authorization': `Bearer ${SERVICE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify({
                        id: testId,
                        name: 'Service Key Test',
                        technical_code: 'SERVICE_' + Date.now(),
                        system_type: 'test',
                        status: true,
                        description: 'Service key bypass test'
                    })
                });
                log(`‚úÖ CREATE: ${response3.status} ${response3.statusText}`, response3.ok ? 'success' : 'error');

                // Cleanup
                if (response3.ok) {
                    setTimeout(async () => {
                        await fetch(`${URL}/rest/v1/equipment_templates?id=eq.${testId}`, {
                            method: 'DELETE',
                            headers: { 'apikey': SERVICE_KEY, 'Authorization': `Bearer ${SERVICE_KEY}` }
                        });
                        log('üßπ Test record cleaned up', 'info');
                    }, 1000);
                }

                // Test 4: Multiple APIs
                const apis = [
                    'networks', 'operations', 'nomenclature', 'users', 'fuel_types'
                ];
                
                log('\nüîç Testing multiple APIs...', 'info');
                let apiSuccess = 0;
                
                for (const api of apis) {
                    try {
                        const resp = await fetch(`${URL}/rest/v1/${api}?limit=1`, {
                            headers: { 'apikey': SERVICE_KEY, 'Authorization': `Bearer ${SERVICE_KEY}` }
                        });
                        if (resp.ok) {
                            apiSuccess++;
                            log(`‚úÖ ${api}: OK`, 'success');
                        } else {
                            log(`‚ùå ${api}: ${resp.status}`, 'error');
                        }
                    } catch (e) {
                        log(`‚ùå ${api}: ${e.message}`, 'error');
                    }
                }

                log(`\nüéØ RESULT: ${apiSuccess}/${apis.length + 3} tests passed`, apiSuccess >= 5 ? 'success' : 'warning');
                
                if (apiSuccess >= 5) {
                    log('üéâ SERVICE KEY WORKS PERFECTLY!', 'success');
                    log('üîì Full unrestricted database access!', 'success');
                    log('üí° Use this key for development/testing!', 'warning');
                }

            } catch (error) {
                log(`‚ùå Test failed: ${error.message}`, 'error');
            }
        }

        // Auto-run test
        setTimeout(runQuickTest, 1000);
    </script>
</body>
</html>