<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ú–µ–Ω–µ–¥–∂–µ—Ä–ë–¢–û - –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        .container {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 1px solid #334155;
        }
        h1 {
            color: #3b82f6;
            margin-bottom: 30px;
            text-align: center;
        }
        .step {
            background: #334155;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .step h3 {
            color: #60a5fa;
            margin-top: 0;
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        button:disabled {
            background: #64748b;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            color: #4ade80;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #f87171;
        }
        .info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            color: #60a5fa;
        }
        .warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            color: #fbbf24;
        }
        .sql-code {
            background: #0f172a;
            border: 1px solid #475569;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: #94a3b8;
            margin: 10px 0;
            overflow-x: auto;
        }
        .progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        .progress-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .progress-step.pending {
            background: #64748b;
            color: #e2e8f0;
        }
        .progress-step.active {
            background: #3b82f6;
            color: white;
        }
        .progress-step.complete {
            background: #22c55e;
            color: white;
        }
        .progress-line {
            flex: 1;
            height: 2px;
            background: #64748b;
        }
        .progress-line.complete {
            background: #22c55e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ú–µ–Ω–µ–¥–∂–µ—Ä–ë–¢–û - –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</h1>
        
        <div class="progress">
            <div class="progress-step pending" id="step1-indicator">1</div>
            <div class="progress-line" id="line1"></div>
            <div class="progress-step pending" id="step2-indicator">2</div>
            <div class="progress-line" id="line2"></div>
            <div class="progress-step pending" id="step3-indicator">3</div>
            <div class="progress-line" id="line3"></div>
            <div class="progress-step pending" id="step4-indicator">4</div>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–æ–ª–∏</h3>
            <p>–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–µ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CHECK –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ users</p>
            <button onclick="checkCurrentConstraint()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–æ–ª–∏</h3>
            <p>–û–±–Ω–æ–≤–∏–º CHECK constraint –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–æ–ª–∏ 'bto_manager'</p>
            <div class="sql-code">ALTER TABLE public.users DROP CONSTRAINT IF EXISTS users_role_check;
ALTER TABLE public.users ADD CONSTRAINT users_role_check 
CHECK (role IN ('system_admin', 'network_admin', 'manager', 'operator', 'bto_manager'));</div>
            <button onclick="updateRoleConstraint()" id="updateConstraintBtn" disabled>–û–±–Ω–æ–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Å–µ—Ç–∏ –ë–¢–û</h3>
            <p>–ù–∞–π–¥–µ–º —Å–µ—Ç—å –ë–¢–û —Å external_id = "15"</p>
            <button onclick="getBTONetwork()" id="getNetworkBtn" disabled>–ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ç—å –ë–¢–û</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ú–µ–Ω–µ–¥–∂–µ—Ä–ë–¢–û</h3>
            <p>–°–æ–∑–¥–∞–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é 'bto_manager'</p>
            <div class="sql-code">INSERT INTO public.users (
  id, email, password_hash, name, role, 
  network_id, trading_point_ids, is_active
) VALUES (
  'aa0e8400-e29b-41d4-a716-446655440005',
  'bto.manager@tradeframe.com',
  '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LeShMKjGEeILVSHFK',
  '–ú–µ–Ω–µ–¥–∂–µ—Ä –ë–¢–û',
  'bto_manager',
  '[ID —Å–µ—Ç–∏ –ë–¢–û]',
  '[]',
  true
);</div>
            <button onclick="createBTOUser()" id="createUserBtn" disabled>–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        </div>

        <div id="result"></div>
    </div>

    <script>
        const resultDiv = document.getElementById('result');
        let currentStep = 1;
        let btoNetworkId = null;
        
        function showResult(message, type = 'info') {
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        function updateProgress(step, status) {
            const indicator = document.getElementById(`step${step}-indicator`);
            const line = document.getElementById(`line${step}`);
            
            indicator.className = `progress-step ${status}`;
            if (line && status === 'complete') {
                line.className = 'progress-line complete';
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
            if (status === 'complete' && step < 4) {
                const nextBtn = step === 1 ? 'updateConstraintBtn' : 
                               step === 2 ? 'getNetworkBtn' : 'createUserBtn';
                document.getElementById(nextBtn).disabled = false;
                
                const nextIndicator = document.getElementById(`step${step + 1}-indicator`);
                nextIndicator.className = 'progress-step active';
            }
        }

        const supabaseUrl = 'https://tohtryzyffcebtyvkxwh.supabase.co';
        const serviceRoleKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';

        window.checkCurrentConstraint = async function() {
            try {
                updateProgress(1, 'active');
                showResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CHECK –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ users...', 'info');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ–ª–∏
                const usersResponse = await fetch(`${supabaseUrl}/rest/v1/users?select=role`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${serviceRoleKey}`,
                        'apikey': serviceRoleKey
                    }
                });

                if (!usersResponse.ok) {
                    throw new Error(`HTTP ${usersResponse.status}: ${usersResponse.statusText}`);
                }

                const users = await usersResponse.json();
                const uniqueRoles = [...new Set(users.map(user => user.role))];
                
                showResult(`‚úÖ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –†–û–õ–ò

üìä –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}
üîë –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏: ${uniqueRoles.length}

–°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –†–û–õ–ò:
${uniqueRoles.map((role, index) => `${index + 1}. "${role}"`).join('\n')}

‚ùå –ü–†–û–ë–õ–ï–ú–ê: –†–æ–ª—å "bto_manager" –ù–ï –†–ê–ó–†–ï–®–ï–ù–ê –≤ CHECK constraint
‚úÖ –†–ê–ó–†–ï–®–ï–ù–ù–´–ï –†–û–õ–ò: ${uniqueRoles.join(', ')}

üõ†Ô∏è –†–ï–®–ï–ù–ò–ï: –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å CHECK constraint —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å "bto_manager"

üí° –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì: –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ"`, 'warning');

                updateProgress(1, 'complete');

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        };

        window.updateRoleConstraint = async function() {
            try {
                updateProgress(2, 'active');
                showResult('üõ†Ô∏è –û–±–Ω–æ–≤–ª—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CHECK –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–æ–ª–∏ bto_manager...', 'info');

                // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
                // –ü–æ—Å–∫–æ–ª—å–∫—É REST API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ALTER TABLE, –ø–æ–∫–∞–∂–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                showResult(`üõ†Ô∏è –û–ë–ù–û–í–õ–ï–ù–ò–ï CHECK CONSTRAINT

‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ò–∑–º–µ–Ω–µ–Ω–∏–µ CHECK constraint –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ SQL Editor –≤ Supabase Dashboard.

üìù –°–ö–û–ü–ò–†–£–ô–¢–ï –ò –í–´–ü–û–õ–ù–ò–¢–ï –≠–¢–û–¢ SQL –í SUPABASE:

-- 1. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
ALTER TABLE public.users DROP CONSTRAINT IF EXISTS users_role_check;

-- 2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π bto_manager
ALTER TABLE public.users ADD CONSTRAINT users_role_check 
CHECK (role IN (
  'system_admin',
  'network_admin', 
  'manager',
  'operator',
  'bto_manager'
));

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT conname, consrc 
FROM pg_constraint 
WHERE conname = 'users_role_check';

üåê SUPABASE DASHBOARD: https://supabase.com/dashboard/project/tohtryzyffcebtyvkxwh
üìÅ –ü–£–¢–¨: SQL Editor ‚Üí New Query ‚Üí –í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –≤—ã—à–µ ‚Üí Run

‚úÖ –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ç—å –ë–¢–û"`, 'info');

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                setTimeout(() => {
                    updateProgress(2, 'complete');
                }, 2000);

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        };

        window.getBTONetwork = async function() {
            try {
                updateProgress(3, 'active');
                showResult('üåê –ü–æ–ª—É—á–∞–µ–º ID —Å–µ—Ç–∏ –ë–¢–û (external_id = "15")...', 'info');

                const response = await fetch(`${supabaseUrl}/rest/v1/networks?or=(external_id.eq.15,name.ilike.*–±—Ç–æ*)`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${serviceRoleKey}`,
                        'apikey': serviceRoleKey
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const networks = await response.json();
                const btoNetwork = networks.find(n => n.external_id === "15" || n.name?.toLowerCase().includes('–±—Ç–æ'));
                
                if (!btoNetwork) {
                    throw new Error('–°–µ—Ç—å –ë–¢–û –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ç—å —Å external_id="15" —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.');
                }

                btoNetworkId = btoNetwork.id;
                
                showResult(`‚úÖ –°–ï–¢–¨ –ë–¢–û –ù–ê–ô–î–ï–ù–ê!

üìä –î–∞–Ω–Ω—ã–µ —Å–µ—Ç–∏:
‚Ä¢ ID: ${btoNetwork.id}
‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ: ${btoNetwork.name}
‚Ä¢ –ö–æ–¥: ${btoNetwork.code}
‚Ä¢ External ID: ${btoNetwork.external_id}
‚Ä¢ –°—Ç–∞—Ç—É—Å: ${btoNetwork.status}

üéØ ID –°–ï–¢–ò –ë–¢–û: ${btoNetworkId}

‚úÖ –°–µ—Ç—å –ë–¢–û –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ú–µ–Ω–µ–¥–∂–µ—Ä–ë–¢–û
üí° –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì: –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"`, 'success');

                updateProgress(3, 'complete');

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ç–∏ –ë–¢–û: ${error.message}`, 'error');
            }
        };

        window.createBTOUser = async function() {
            try {
                updateProgress(4, 'active');
                showResult('üë§ –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ú–µ–Ω–µ–¥–∂–µ—Ä–ë–¢–û —Å —Ä–æ–ª—å—é bto_manager...', 'info');

                if (!btoNetworkId) {
                    throw new Error('ID —Å–µ—Ç–∏ –ë–¢–û –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ç—å –ë–¢–û"');
                }

                const newUser = {
                    id: 'aa0e8400-e29b-41d4-a716-446655440005',
                    email: 'bto.manager@tradeframe.com',
                    password_hash: '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LeShMKjGEeILVSHFK', // admin123
                    name: '–ú–µ–Ω–µ–¥–∂–µ—Ä –ë–¢–û',
                    role: 'bto_manager',
                    network_id: btoNetworkId,
                    trading_point_ids: [],
                    is_active: true,
                    phone: null,
                    position: null,
                    telegram_notifications_enabled: true
                };

                const response = await fetch(`${supabaseUrl}/rest/v1/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${serviceRoleKey}`,
                        'apikey': serviceRoleKey,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(newUser)
                });

                if (!response.ok) {
                    const error = await response.text();
                    
                    if (error.includes('duplicate key')) {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º
                        showResult('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ...', 'warning');
                        
                        const updateResponse = await fetch(`${supabaseUrl}/rest/v1/users?email=eq.bto.manager@tradeframe.com`, {
                            method: 'PATCH',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${serviceRoleKey}`,
                                'apikey': serviceRoleKey,
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify({
                                name: '–ú–µ–Ω–µ–¥–∂–µ—Ä –ë–¢–û',
                                role: 'bto_manager',
                                network_id: btoNetworkId,
                                is_active: true
                            })
                        });

                        if (!updateResponse.ok) {
                            throw new Error(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${await updateResponse.text()}`);
                        }

                        const updatedUser = await updateResponse.json();
                        
                        showResult(`‚úÖ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ú–ï–ù–ï–î–ñ–ï–†–ë–¢–û –û–ë–ù–û–í–õ–ï–ù!

üìä –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
${JSON.stringify(updatedUser, null, 2)}`, 'success');
                    } else {
                        throw new Error(`HTTP ${response.status}: ${error}`);
                    }
                } else {
                    const result = await response.json();
                    
                    showResult(`üéâ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ú–ï–ù–ï–î–ñ–ï–†–ë–¢–û –°–û–ó–î–ê–ù –£–°–ü–ï–®–ù–û!

üìä –î–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
${JSON.stringify(result, null, 2)}

‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ:
‚Ä¢ Email: bto.manager@tradeframe.com
‚Ä¢ –ü–∞—Ä–æ–ª—å: admin123
‚Ä¢ –†–æ–ª—å: bto_manager
‚Ä¢ –°–µ—Ç—å: –ë–¢–û (${btoNetworkId})
‚Ä¢ –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω

üîê –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏!
üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ç—å –ë–¢–û –∏ —Ä–∞–∑–¥–µ–ª—ã "–¢–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏" –∏ "–¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏"`, 'success');
                }

                updateProgress(4, 'complete');

            } catch (error) {
                if (error.message.includes('users_role_check')) {
                    showResult(`‚ùå –û–®–ò–ë–ö–ê CHECK CONSTRAINT!

–û—à–∏–±–∫–∞: ${error.message}

üõ†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: CHECK constraint –≤—Å–µ –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω.

üìù –†–ï–®–ï–ù–ò–ï: –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∫–æ–º–∞–Ω–¥—ã –≤ Supabase Dashboard:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://supabase.com/dashboard/project/tohtryzyffcebtyvkxwh
2. –û—Ç–∫—Ä–æ–π—Ç–µ: SQL Editor
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

ALTER TABLE public.users DROP CONSTRAINT IF EXISTS users_role_check;
ALTER TABLE public.users ADD CONSTRAINT users_role_check 
CHECK (role IN ('system_admin', 'network_admin', 'manager', 'operator', 'bto_manager'));

4. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" —Å–Ω–æ–≤–∞`, 'error');
                } else {
                    showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`, 'error');
                }
            }
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('step1-indicator').className = 'progress-step active';
            }, 500);
        });
    </script>
</body>
</html>