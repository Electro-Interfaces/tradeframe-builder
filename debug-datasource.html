<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug DataSource Info</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #1a1b23;
            color: white;
        }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 8px;
            background: #2a2b35;
        }
        pre { 
            background: #1e293b; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .status { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px;
            font-weight: 500;
        }
        .connected { background: #059669; color: white; }
        .disconnected { background: #dc2626; color: white; }
        button { 
            background: #3b82f6; 
            color: white; 
            padding: 8px 16px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üîç Debug DataSource Info</h1>
    
    <div class="section">
        <h2>localStorage –°–æ–¥–µ—Ä–∂–∏–º–æ–µ</h2>
        <div id="localStorage-content">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="section">
        <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–Ω–µ—à–Ω–µ–π –ë–î</h2>
        <div id="external-db-check">–ü—Ä–æ–≤–µ—Ä—è—é...</div>
    </div>

    <div class="section">
        <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Supabase</h2>
        <div id="supabase-check">–ü—Ä–æ–≤–µ—Ä—è—é...</div>
    </div>

    <div class="section">
        <h2>–î–µ–π—Å—Ç–≤–∏—è</h2>
        <button onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="clearStorage()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
        <button onclick="setTestSettings()">‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button onclick="window.close()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        function checkExternalDatabase() {
            try {
                const settings = localStorage.getItem('externalDatabase');
                if (!settings) return { connected: false, reason: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' };
                const parsed = JSON.parse(settings);
                const hasUrl = !!(parsed.url);
                const hasApiKey = !!(parsed.apiKey);
                return { 
                    connected: hasUrl && hasApiKey, 
                    reason: !hasUrl ? '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç URL' : !hasApiKey ? '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç API –∫–ª—é—á' : 'OK',
                    settings: parsed
                };
            } catch (error) {
                return { connected: false, reason: '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ' + error.message };
            }
        }

        function checkSupabaseConnection() {
            try {
                const settings = localStorage.getItem('supabaseSettings');
                if (!settings) return { connected: false, reason: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' };
                const parsed = JSON.parse(settings);
                const hasUrl = !!(parsed.url);
                const hasKey = !!(parsed.key);
                return { 
                    connected: hasUrl && hasKey, 
                    reason: !hasUrl ? '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç URL' : !hasKey ? '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª—é—á' : 'OK',
                    settings: parsed
                };
            } catch (error) {
                return { connected: false, reason: '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ' + error.message };
            }
        }

        function refreshData() {
            // localStorage —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            const storageDiv = document.getElementById('localStorage-content');
            let storageContent = '<h3>–í—Å–µ –∫–ª—é—á–∏ localStorage:</h3>';
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                storageContent += `<p><strong>${key}:</strong></p>`;
                try {
                    const parsed = JSON.parse(value);
                    storageContent += `<pre>${JSON.stringify(parsed, null, 2)}</pre>`;
                } catch {
                    storageContent += `<pre>${value}</pre>`;
                }
            }
            storageDiv.innerHTML = storageContent;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–µ–π –ë–î
            const externalDbCheck = checkExternalDatabase();
            const externalDiv = document.getElementById('external-db-check');
            externalDiv.innerHTML = `
                <p>–°—Ç–∞—Ç—É—Å: <span class="status ${externalDbCheck.connected ? 'connected' : 'disconnected'}">
                    ${externalDbCheck.connected ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'}
                </span></p>
                <p>–ü—Ä–∏—á–∏–Ω–∞: ${externalDbCheck.reason}</p>
                ${externalDbCheck.settings ? `<pre>${JSON.stringify(externalDbCheck.settings, null, 2)}</pre>` : ''}
            `;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase
            const supabaseCheck = checkSupabaseConnection();
            const supabaseDiv = document.getElementById('supabase-check');
            supabaseDiv.innerHTML = `
                <p>–°—Ç–∞—Ç—É—Å: <span class="status ${supabaseCheck.connected ? 'connected' : 'disconnected'}">
                    ${supabaseCheck.connected ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'}
                </span></p>
                <p>–ü—Ä–∏—á–∏–Ω–∞: ${supabaseCheck.reason}</p>
                ${supabaseCheck.settings ? `<pre>${JSON.stringify(supabaseCheck.settings, null, 2)}</pre>` : ''}
            `;
        }

        function clearStorage() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å localStorage?')) {
                localStorage.clear();
                refreshData();
            }
        }

        function setTestSettings() {
            const testExternalDb = {
                url: 'https://test.supabase.co',
                apiKey: 'test_api_key_12345'
            };
            localStorage.setItem('externalDatabase', JSON.stringify(testExternalDb));
            
            const testSupabase = {
                url: 'https://test.supabase.co',
                key: 'test_supabase_key_67890'
            };
            localStorage.setItem('supabaseSettings', JSON.stringify(testSupabase));
            
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
            refreshData();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        refreshData();
    </script>
</body>
</html>