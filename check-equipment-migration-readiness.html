<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        .result {
            background: white;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .success { border-left-color: #48bb78; background: #f0fff4; }
        .error { border-left-color: #f56565; background: #fff5f5; }
        .warning { border-left-color: #ed8936; background: #fffaf0; }
        .info { border-left-color: #4299e1; background: #ebf8ff; }
        pre { 
            background: #2d3748; 
            color: #e2e8f0; 
            padding: 15px; 
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.5;
            max-height: 300px;
        }
        .actions {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .primary-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .success-btn { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .danger-btn { background: linear-gradient(135deg, #f56565, #e53e3e); color: white; }
        .warning-btn { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 12px;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            word-break: break-word;
            max-width: 200px;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background: #f7fafc;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .ready { background: #c6f6d5; color: #22543d; }
        .partial { background: #fef5e7; color: #744210; }
        .not-ready { background: #fed7d7; color: #742a2a; }
        .unknown { background: #e2e8f0; color: #4a5568; }
        .section {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .section h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .migration-progress {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .progress-bar {
            background: #e2e8f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            background: linear-gradient(90deg, #48bb78, #68d391);
            height: 100%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"</h1>
        
        <div class="actions">
            <button onclick="checkSupabaseTables()" class="primary-btn">üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã Supabase</button>
            <button onclick="analyzeCurrentServices()" class="warning-btn">üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</button>
            <button onclick="checkDependencies()" class="info-btn">üîó –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</button>
            <button onclick="generateMigrationPlan()" class="success-btn">üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏</button>
            <button onclick="clearResults()" class="danger-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI'
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        let analysisResults = {
            supabaseTables: {},
            currentServices: {},
            dependencies: {},
            migrationReadiness: 0
        }
        
        function logResult(message, type = 'info', data = null) {
            const resultsDiv = document.getElementById('results')
            const resultDiv = document.createElement('div')
            resultDiv.className = `result ${type}`
            
            const timestamp = new Date().toLocaleTimeString()
            let content = `<strong>[${timestamp}] ${message}</strong>`
            
            if (data !== null) {
                if (typeof data === 'object') {
                    content += `<pre>${JSON.stringify(data, null, 2)}</pre>`
                } else {
                    content += `<pre>${data}</pre>`
                }
            }
            
            resultDiv.innerHTML = content
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild)
        }
        
        function createStatusBadge(status, text) {
            return `<span class="status ${status}">${text}</span>`
        }
        
        window.clearResults = function() {
            document.getElementById('results').innerHTML = ''
            logResult('‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã', 'info')
        }
        
        window.checkSupabaseTables = async function() {
            logResult('üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ Supabase...', 'info')
            
            const requiredTables = [
                'equipment_templates',
                'equipment',
                'equipment_components', 
                'component_templates',
                'equipment_logs',
                'equipment_commands'
            ]
            
            const tableResults = {}
            
            for (const tableName of requiredTables) {
                try {
                    const { data, error, count } = await supabase
                        .from(tableName)
                        .select('*', { count: 'exact', head: true })
                    
                    if (error) {
                        if (error.message.includes('relation') && error.message.includes('does not exist')) {
                            tableResults[tableName] = { exists: false, count: 0, status: 'missing' }
                        } else {
                            tableResults[tableName] = { exists: true, count: 0, status: 'error', error: error.message }
                        }
                    } else {
                        tableResults[tableName] = { exists: true, count: count || 0, status: 'ready' }
                    }
                } catch (err) {
                    tableResults[tableName] = { exists: false, count: 0, status: 'error', error: err.message }
                }
            }
            
            analysisResults.supabaseTables = tableResults
            
            // –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            let tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>–¢–∞–±–ª–∏—Ü–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ó–∞–ø–∏—Å–µ–π</th>
                            <th>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody>
            `
            
            let readyCount = 0
            for (const [tableName, result] of Object.entries(tableResults)) {
                const statusBadge = result.status === 'ready' ? 
                    createStatusBadge('ready', '–ì–æ—Ç–æ–≤–∞') :
                    result.status === 'missing' ? 
                    createStatusBadge('not-ready', '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç') :
                    createStatusBadge('not-ready', '–û—à–∏–±–∫–∞')
                
                if (result.status === 'ready') readyCount++
                
                tableHtml += `
                    <tr>
                        <td><strong>${tableName}</strong></td>
                        <td>${statusBadge}</td>
                        <td>${result.count}</td>
                        <td>${result.exists ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `
            }
            
            tableHtml += '</tbody></table>'
            
            const readiness = Math.round((readyCount / requiredTables.length) * 100)
            
            const resultDiv = document.createElement('div')
            resultDiv.className = 'result info'
            resultDiv.innerHTML = `
                <strong>üóÑÔ∏è –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü Supabase:</strong>
                <div class="migration-progress">
                    <p><strong>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ${readiness}%</strong></p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${readiness}%"></div>
                    </div>
                </div>
                ${tableHtml}
            `
            document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
            
            if (readiness < 100) {
                logResult(`‚ö†Ô∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –≥–æ—Ç–æ–≤–∞: ${requiredTables.length - readyCount} —Ç–∞–±–ª–∏—Ü –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`, 'warning')
            } else {
                logResult('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏!', 'success')
            }
        }
        
        window.analyzeCurrentServices = function() {
            logResult('üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è...', 'info')
            
            // –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
            const services = {
                'equipmentTypes.ts': {
                    status: 'partial',
                    description: '–ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase (equipment_templates)',
                    readyForMigration: true
                },
                'equipment.ts': {
                    status: 'not-ready', 
                    description: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç API/localStorage, —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏',
                    readyForMigration: false
                },
                'equipment_new.ts': {
                    status: 'unknown',
                    description: '–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å–µ—Ä–≤–∏—Å–∞ (—Ç—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞)',
                    readyForMigration: false
                },
                'components API': {
                    status: 'not-ready',
                    description: '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç localStorage',
                    readyForMigration: false
                }
            }
            
            analysisResults.currentServices = services
            
            let serviceHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>–°–µ—Ä–≤–∏—Å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–ì–æ—Ç–æ–≤ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏</th>
                        </tr>
                    </thead>
                    <tbody>
            `
            
            let readyServices = 0
            for (const [serviceName, info] of Object.entries(services)) {
                const statusBadge = info.status === 'partial' ? 
                    createStatusBadge('partial', '–ß–∞—Å—Ç–∏—á–Ω–æ') :
                    info.status === 'not-ready' ? 
                    createStatusBadge('not-ready', '–ù–µ –≥–æ—Ç–æ–≤') :
                    createStatusBadge('unknown', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
                
                if (info.readyForMigration) readyServices++
                
                serviceHtml += `
                    <tr>
                        <td><strong>${serviceName}</strong></td>
                        <td>${statusBadge}</td>
                        <td>${info.description}</td>
                        <td>${info.readyForMigration ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `
            }
            
            serviceHtml += '</tbody></table>'
            
            const servicesReadiness = Math.round((readyServices / Object.keys(services).length) * 100)
            
            const resultDiv = document.createElement('div')
            resultDiv.className = 'result warning'
            resultDiv.innerHTML = `
                <strong>üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:</strong>
                <div class="migration-progress">
                    <p><strong>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤: ${servicesReadiness}%</strong></p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${servicesReadiness}%"></div>
                    </div>
                </div>
                ${serviceHtml}
            `
            document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
        }
        
        window.checkDependencies = function() {
            logResult('üîó –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏...', 'info')
            
            const dependencies = {
                'SelectionContext': {
                    impact: 'high',
                    description: '–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–±–æ—Ä–∞ —Å–µ—Ç–∏/—Ç–æ—á–∫–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                    migrationNeeded: true
                },
                'Commands System': {
                    impact: 'high', 
                    description: '–°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∞–Ω–¥ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–∞ —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º',
                    migrationNeeded: true
                },
                'Components Templates': {
                    impact: 'medium',
                    description: '–®–∞–±–ª–æ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                    migrationNeeded: true
                },
                'Equipment Types': {
                    impact: 'low',
                    description: '–£–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ Supabase',
                    migrationNeeded: false
                },
                'Audit Logs': {
                    impact: 'medium',
                    description: '–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                    migrationNeeded: true
                }
            }
            
            analysisResults.dependencies = dependencies
            
            let depHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å</th>
                            <th>–í–ª–∏—è–Ω–∏–µ</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–¢—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏</th>
                        </tr>
                    </thead>
                    <tbody>
            `
            
            let criticalDependencies = 0
            for (const [depName, info] of Object.entries(dependencies)) {
                const impactBadge = info.impact === 'high' ? 
                    createStatusBadge('not-ready', '–í—ã—Å–æ–∫–æ–µ') :
                    info.impact === 'medium' ? 
                    createStatusBadge('partial', '–°—Ä–µ–¥–Ω–µ–µ') :
                    createStatusBadge('ready', '–ù–∏–∑–∫–æ–µ')
                
                if (info.impact === 'high' && info.migrationNeeded) criticalDependencies++
                
                depHtml += `
                    <tr>
                        <td><strong>${depName}</strong></td>
                        <td>${impactBadge}</td>
                        <td>${info.description}</td>
                        <td>${info.migrationNeeded ? '‚ö†Ô∏è –î–∞' : '‚úÖ –ù–µ—Ç'}</td>
                    </tr>
                `
            }
            
            depHtml += '</tbody></table>'
            
            const resultDiv = document.createElement('div')
            resultDiv.className = 'result info'
            resultDiv.innerHTML = `
                <strong>üîó –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:</strong>
                <p>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: <strong>${criticalDependencies}</strong></p>
                ${depHtml}
            `
            document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
            
            if (criticalDependencies > 0) {
                logResult(`‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${criticalDependencies} –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π`, 'warning')
            }
        }
        
        window.generateMigrationPlan = function() {
            logResult('üìã –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏...', 'info')
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
            const tablesReady = Object.values(analysisResults.supabaseTables).filter(t => t.status === 'ready').length
            const totalTables = Object.keys(analysisResults.supabaseTables).length || 6
            const dbReadiness = Math.round((tablesReady / totalTables) * 100)
            
            const servicesReady = Object.values(analysisResults.currentServices).filter(s => s.readyForMigration).length  
            const totalServices = Object.keys(analysisResults.currentServices).length || 4
            const servicesReadiness = Math.round((servicesReady / totalServices) * 100)
            
            const overallReadiness = Math.round((dbReadiness + servicesReadiness) / 2)
            analysisResults.migrationReadiness = overallReadiness
            
            const phases = [
                {
                    phase: '–§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã',
                    tasks: [
                        '–°–æ–∑–¥–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase',
                        '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', 
                        '–°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤',
                        '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ö–µ–º—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö'
                    ],
                    estimate: '2-3 –¥–Ω—è',
                    priority: '–ö—Ä–∏—Ç–∏—á–Ω–æ'
                },
                {
                    phase: '–§–∞–∑–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤',
                    tasks: [
                        '–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å equipment.ts –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase',
                        '–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã API –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ë–î',
                        '–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–º–∞–Ω–¥ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                        '–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã'
                    ],
                    estimate: '3-4 –¥–Ω—è',
                    priority: '–í—ã—Å–æ–∫–æ'
                },
                {
                    phase: '–§–∞–∑–∞ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤',
                    tasks: [
                        '–û–±–Ω–æ–≤–∏—Ç—å Equipment.tsx –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏',
                        '–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å EquipmentWizard',
                        '–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤',
                        '–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å SelectionContext'
                    ],
                    estimate: '2-3 –¥–Ω—è',
                    priority: '–°—Ä–µ–¥–Ω–µ'
                },
                {
                    phase: '–§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
                    tasks: [
                        '–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞',
                        '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤',
                        '–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö',
                        '–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π'
                    ],
                    estimate: '2 –¥–Ω—è',
                    priority: '–°—Ä–µ–¥–Ω–µ'
                }
            ]
            
            let planHtml = `
                <div class="section">
                    <h3>üìä –û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∏–≥—Ä–∞—Ü–∏–∏</h3>
                    <div class="migration-progress">
                        <p><strong>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: ${overallReadiness}%</strong></p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${overallReadiness}%"></div>
                        </div>
                        <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: ${dbReadiness}% | –°–µ—Ä–≤–∏—Å—ã: ${servicesReadiness}%</p>
                    </div>
                </div>
                
                <div class="section">
                    <h3>üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ —Ñ–∞–∑–∞–º</h3>
            `
            
            phases.forEach(phase => {
                const priorityBadge = phase.priority === '–ö—Ä–∏—Ç–∏—á–Ω–æ' ?
                    createStatusBadge('not-ready', phase.priority) :
                    phase.priority === '–í—ã—Å–æ–∫–æ' ?
                    createStatusBadge('partial', phase.priority) :
                    createStatusBadge('ready', phase.priority)
                
                planHtml += `
                    <div style="margin: 15px 0; padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px;">
                        <h4>${phase.phase} ${priorityBadge}</h4>
                        <p><strong>–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:</strong> ${phase.estimate}</p>
                        <ul>
                            ${phase.tasks.map(task => `<li>${task}</li>`).join('')}
                        </ul>
                    </div>
                `
            })
            
            planHtml += '</div>'
            
            const resultDiv = document.createElement('div')
            resultDiv.className = 'result success'
            resultDiv.innerHTML = `<strong>üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ":</strong>${planHtml}`
            document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            if (overallReadiness < 50) {
                logResult('üö® –ú–∏–≥—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å –§–∞–∑—ã 1.', 'error')
            } else if (overallReadiness < 80) {
                logResult('‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞, –Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.', 'warning') 
            } else {
                logResult('‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏! –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å.', 'success')
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
        window.addEventListener('load', async () => {
            await checkSupabaseTables()
            analyzeCurrentServices()
            checkDependencies()
            generateMigrationPlan()
        })
    </script>
</body>
</html>