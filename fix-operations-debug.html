<!DOCTYPE html>
<html>
<head>
    <title>Fix Operations Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e293b; color: #fff; }
        #results { background: #0f172a; padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; }
        .success { color: #10b981; }
        .warn { color: #f59e0b; }
        .error { color: #ef4444; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 10px 5px 0 0; }
        button:hover { background: #2563eb; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
    </style>
</head>
<body>
    <h1>üîß Fix Operations Debug</h1>
    <button onclick="clearApiConfig()">–û—á–∏—Å—Ç–∏—Ç—å API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
    <button onclick="setCorrectApiConfig()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
    <button onclick="testOperationsService()" class="success">–¢–µ—Å—Ç operationsService</button>
    <button onclick="openOperationsPage()">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–µ—Ä–∞—Ü–∏–π</button>
    <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    
    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warn' ? 'warn' : '';
            resultsDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        function clearApiConfig() {
            log('üßπ –û—á–∏—â–∞–µ–º API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ localStorage...', 'warn');
            localStorage.removeItem('api_config');
            localStorage.removeItem('tradeframe_operations');
            localStorage.removeItem('operations');
            log('‚úÖ API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—á–∏—â–µ–Ω–∞', 'success');
        }

        function setCorrectApiConfig() {
            log('üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...', 'warn');
            
            const correctConfig = {
                currentConnectionId: 'local-db',
                debugMode: true,
                lastUpdated: new Date().toISOString(),
                availableConnections: [
                    {
                        id: 'mock',
                        name: 'Mock Data (–î–µ–º–æ)',
                        url: 'localStorage',
                        type: 'mock',
                        description: '–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –≤ localStorage',
                        isActive: false,
                        isDefault: false,
                        createdAt: new Date('2024-01-01').toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'local-db',
                        name: '–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î',
                        url: 'http://localhost:3001/api/v1',
                        type: 'postgresql',
                        description: '–õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö',
                        isActive: true,
                        isDefault: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        settings: {
                            timeout: 5000,
                            retryAttempts: 3,
                            poolSize: 10,
                            ssl: false
                        }
                    }
                ]
            };
            
            localStorage.setItem('api_config', JSON.stringify(correctConfig));
            log('‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', 'success');
            log(`   - currentConnectionId: ${correctConfig.currentConnectionId}`);
            log(`   - API URL: http://localhost:3001/api/v1`);
            log(`   - Type: postgresql`);
        }

        async function testOperationsService() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ü–µ–ø–æ—á–∫—É operationsService...', 'warn');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
                log('1. –ü—Ä–æ–≤–µ—Ä—è–µ–º API —Å–µ—Ä–≤–µ—Ä...');
                const healthResponse = await fetch('http://localhost:3001/health');
                if (!healthResponse.ok) {
                    throw new Error('API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                log('   ‚úÖ API —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º endpoint –æ–ø–µ—Ä–∞—Ü–∏–π
                log('2. –ü—Ä–æ–≤–µ—Ä—è–µ–º endpoint –æ–ø–µ—Ä–∞—Ü–∏–π...');
                const operationsResponse = await fetch('http://localhost:3001/api/v1/operations?limit=5');
                if (!operationsResponse.ok) {
                    throw new Error(`Operations endpoint error: ${operationsResponse.status}`);
                }
                
                const operationsData = await operationsResponse.json();
                log(`   ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${operationsData.data?.length || 0} —à—Ç.`, 'success');
                
                // –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                log('3. –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...');
                const savedConfig = localStorage.getItem('api_config');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    const currentConn = config.availableConnections?.find(c => c.id === config.currentConnectionId);
                    log(`   - –¢–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ${currentConn?.name} (${currentConn?.type})`);
                    log(`   - URL: ${currentConn?.url}`);
                    
                    if (currentConn?.type === 'mock') {
                        log('   ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ MOCK —Ä–µ–∂–∏–º–µ!', 'error');
                        log('   –ù–∞–∂–º–∏—Ç–µ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"', 'warn');
                        return;
                    }
                } else {
                    log('   ‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é', 'warn');
                }
                
                log('‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ! –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è', 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function openOperationsPage() {
            log('üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–µ—Ä–∞—Ü–∏–π...', 'warn');
            window.open('http://localhost:3006/network/operations-transactions', '_blank');
            log('   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ', 'warn');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            testOperationsService();
        }, 500);
    </script>
</body>
</html>