<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a1a; 
            color: #0f0; 
            padding: 20px;
            line-height: 1.4;
        }
        .section { 
            margin: 15px 0; 
            padding: 10px; 
            border: 1px solid #0f0;
            background: #0a0a0a;
        }
        h1 { color: #0ff; }
        h2 { color: #ff0; }
        .step {
            margin: 10px 0;
            padding: 8px;
            background: #001100;
            border-left: 3px solid #0f0;
        }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .success { color: #0f0; }
        pre {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            overflow-x: auto;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API</h1>
    
    <div class="section">
        <h2>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h2>
        <div id="step1"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 2: –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</h2>
        <div id="step2"></div>
    </div>

    <script>
        const log = (containerId, msg, type = '') => {
            const div = document.createElement('div');
            div.className = `step ${type}`;
            div.innerHTML = msg;
            document.getElementById(containerId).appendChild(div);
        };

        async function testConfig() {
            // –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage
            log('step1', 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...', 'warning');
            
            const savedConfig = localStorage.getItem('trading_network_config');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    log('step1', '‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ localStorage:', 'success');
                    
                    const configPreview = {
                        enabled: config.enabled,
                        baseUrl: config.baseUrl,
                        authType: config.authType,
                        hasApiKey: !!config.apiKey,
                        systemId: config.systemId,
                        defaultStationId: config.defaultStationId
                    };
                    
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(configPreview, null, 2);
                    document.getElementById('step1').appendChild(pre);
                    
                } catch (e) {
                    log('step1', `‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${e.message}`, 'error');
                }
            } else {
                log('step1', '‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'warning');
                log('step1', '–ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
            }

            // –®–∞–≥ 2: –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            log('step2', 'üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π...', 'warning');
            
            const testUrl = 'https://api-demo.1c-tradeservice.ru/api/v1/stations/4/tanks';
            const testToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpbiI6eyJpZCI6IkFDQ0FFNDA4LTYzMzItNDI0NS04NUIxLTI1RjkxNEYzQkQ2NCIsIm5hbWUiOiJVc2VyVGVzdCIsInJvbGUiOjB9LCJ1c2VyIjp7ImlkIjoiQUNDQUU0MDgtNjMzMi00MjQ1LTg1QjEtMjVGOTE0RjNCRDY0IiwibmFtZSI6IlVzZXJUZXN0In0sImV4cCI6MTc1NzE1NzkzN30.7fDPBwtWej80K2ePRXYKXsJH3b3pLSUqtjo2uIbyXEE';
            
            try {
                log('step2', `üì° URL: ${testUrl}`);
                log('step2', `üîë Token: ${testToken.substring(0, 50)}...`);
                
                const response = await fetch(testUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${testToken}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                });

                log('step2', `üìä –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);

                if (response.ok) {
                    const data = await response.json();
                    log('step2', '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!', 'success');
                    
                    const tanks = data.tanks || data;
                    if (Array.isArray(tanks)) {
                        log('step2', `üì¶ –ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${tanks.length}`, 'success');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä–µ–∑–µ—Ä–≤—É–∞—Ä –∫–∞–∫ –ø—Ä–∏–º–µ—Ä
                        if (tanks.length > 0) {
                            log('step2', '<br><strong>üìã –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞:</strong>');
                            const sampleTank = tanks[0];
                            const sample = {
                                number: sampleTank.number,
                                fuel_name: sampleTank.fuel_name,
                                volume_end: sampleTank.volume_end,
                                volume_max: sampleTank.volume_max,
                                temperature: sampleTank.temperature
                            };
                            
                            const pre = document.createElement('pre');
                            pre.textContent = JSON.stringify(sample, null, 2);
                            document.getElementById('step2').appendChild(pre);
                            
                            log('step2', 'üéâ –î–∞–Ω–Ω—ã–µ –∏–∑ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
                            log('step2', '–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"');
                        }
                    }
                    
                } else {
                    log('step2', `‚ùå –û—à–∏–±–∫–∞: ${response.status} ${response.statusText}`, 'error');
                    const errorText = await response.text().catch(() => '–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏');
                    log('step2', `üìÑ –î–µ—Ç–∞–ª–∏: ${errorText.substring(0, 200)}...`);
                }

            } catch (error) {
                log('step2', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
                
                if (error.message.includes('CORS')) {
                    log('step2', 'üö´ –ü—Ä–æ–±–ª–µ–º–∞ —Å CORS - –Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'warning');
                } else if (error.message.includes('Failed to fetch')) {
                    log('step2', 'üåê –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'warning');
                }
            }

            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            log('step2', '<br><strong>üí° –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</strong>', 'warning');
            log('step2', '1. –û–±–Ω–æ–≤–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"');
            log('step2', '2. –£–∫–∞–∂–∏—Ç–µ URL: https://api-demo.1c-tradeservice.ru/api');
            log('step2', '3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: Bearer Token');
            log('step2', '4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞');
            log('step2', '5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ');
        }

        testConfig();
    </script>
</body>
</html>