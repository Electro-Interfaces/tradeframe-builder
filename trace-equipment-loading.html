<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –¢—Ä–µ–π—Å–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        .highlight { 
            background: #2d4a22; 
            padding: 10px; 
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }
        .step {
            background: #1a2332;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #17a2b8;
        }
        .param-box {
            background: #2d1810;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        select {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–†–ï–ô–°–ò–ù–ì –ó–ê–ì–†–£–ó–ö–ò –û–ë–û–†–£–î–û–í–ê–ù–ò–Ø –û–¢ –í–ù–ï–®–ù–ï–ì–û API</h1>
    <p>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç</p>
    
    <div>
        <h3>üéØ –í—ã–±–æ—Ä —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞:</h3>
        <select id="tradingPointSelect" onchange="updateSelectedTradingPoint()">
            <option value="">–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏...</option>
        </select>
        <button onclick="loadTradingPoints()">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ—á–∫–∏</button>
    </div>
    
    <div id="selectedTpInfo"></div>
    
    <div>
        <h3>üß™ –¢–µ—Å—Ç—ã —Ç—Ä–µ–π—Å–∏–Ω–≥–∞:</h3>
        <button onclick="traceFullEquipmentLoading()">üî• –ü–æ–ª–Ω—ã–π —Ç—Ä–µ–π—Å–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏</button>
        <button onclick="traceUniversalClientCall()">‚ö° –¢—Ä–µ–π—Å–∏–Ω–≥ –≤—ã–∑–æ–≤–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</button>
        <button onclick="traceTanksServiceCall()">üõ¢Ô∏è –¢—Ä–µ–π—Å–∏–Ω–≥ –≤—ã–∑–æ–≤–∞ tanksService</button>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div id="log"></div>

    <script type="module">
        let selectedTradingPoint = null;
        let httpClient = null;
        let tradingNetworkConfigService = null;
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        function addStep(stepNumber, title, details) {
            const div = document.createElement('div');
            div.className = 'step';
            div.innerHTML = `<strong>–®–ê–ì ${stepNumber}: ${title}</strong><br><div class="code">${details}</div>`;
            log.appendChild(div);
        }
        
        function addParams(title, params) {
            const div = document.createElement('div');
            div.className = 'param-box';
            div.innerHTML = `<strong>${title}</strong><br><div class="code">${params}</div>`;
            log.appendChild(div);
        }
        
        window.clearLog = function() {
            log.innerHTML = '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function initialize() {
            try {
                const imports = await import('/src/services/universalHttpClient.ts');
                httpClient = imports.httpClient;
                
                const configImports = await import('/src/services/tradingNetworkConfigService.ts');
                tradingNetworkConfigService = configImports.tradingNetworkConfigService;
                
                addLog('‚úÖ –°–µ—Ä–≤–∏—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                await loadTradingPoints();
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫
        window.loadTradingPoints = async function() {
            try {
                addLog('üìç –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞...', 'info');
                const response = await httpClient.getAllTradingPointsWithNetworks();
                
                const select = document.getElementById('tradingPointSelect');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É...</option>';
                
                if (response.success && response.data) {
                    const readyTps = response.data.filter(tp => tp.apiReady);
                    
                    readyTps.forEach(tp => {
                        const option = document.createElement('option');
                        option.value = tp.id;
                        option.textContent = `${tp.name} (${tp.networkInfo.name}) [${tp.systemId}/${tp.stationId}]`;
                        option.dataset.tpData = JSON.stringify(tp);
                        select.appendChild(option);
                    });
                    
                    addLog(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${readyTps.length} –≥–æ—Ç–æ–≤—ã—Ö –¥–ª—è API —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫`, 'success');
                    
                    // –ê–≤—Ç–æ–≤—ã–±–æ—Ä –ê–ó–° 4 –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                    const azs4 = readyTps.find(tp => tp.name.includes('–ê–ó–° 4') || tp.systemId === '15');
                    if (azs4) {
                        select.value = azs4.id;
                        updateSelectedTradingPoint();
                    }
                    
                } else {
                    addLog('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏', 'error');
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏
        window.updateSelectedTradingPoint = function() {
            const select = document.getElementById('tradingPointSelect');
            const infoDiv = document.getElementById('selectedTpInfo');
            
            if (select.value) {
                const option = select.options[select.selectedIndex];
                selectedTradingPoint = JSON.parse(option.dataset.tpData);
                
                infoDiv.innerHTML = `<div class="highlight">
                    üéØ –í–´–ë–†–ê–ù–ù–ê–Ø –¢–û–†–ì–û–í–ê–Ø –¢–û–ß–ö–ê –î–õ–Ø –¢–†–ï–ô–°–ò–ù–ì–ê:<br>
                    ‚ûú ID: ${selectedTradingPoint.id}<br>
                    ‚ûú –ù–∞–∑–≤–∞–Ω–∏–µ: ${selectedTradingPoint.name}<br>
                    ‚ûú –°–µ—Ç—å: ${selectedTradingPoint.networkInfo.name}<br>
                    ‚ûú System ID: "${selectedTradingPoint.systemId}"<br>
                    ‚ûú Station ID: "${selectedTradingPoint.stationId}"<br>
                    ‚ûú API –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: ${selectedTradingPoint.apiReady ? '‚úÖ –ì–û–¢–û–í–ê' : '‚ùå –ù–ï –ì–û–¢–û–í–ê'}
                </div>`;
            } else {
                selectedTradingPoint = null;
                infoDiv.innerHTML = '';
            }
        }
        
        // –ü–æ–ª–Ω—ã–π —Ç—Ä–µ–π—Å–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
        window.traceFullEquipmentLoading = async function() {
            if (!selectedTradingPoint) {
                addLog('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É!', 'error');
                return;
            }
            
            addLog('üî• –ü–û–õ–ù–´–ô –¢–†–ï–ô–°–ò–ù–ì –ó–ê–ì–†–£–ó–ö–ò –û–ë–û–†–£–î–û–í–ê–ù–ò–Ø –û–¢ –í–ù–ï–®–ù–ï–ì–û API', 'info');
            addLog(`üéØ –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞: ${selectedTradingPoint.name}`, 'info');
            
            try {
                // –®–ê–ì 1: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –≤—Ö–æ–¥–µ
                addStep(1, '–í–•–û–î–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´', 
                    `Trading Point ID: ${selectedTradingPoint.id}<br>` +
                    `–ù–∞–∑–≤–∞–Ω–∏–µ: "${selectedTradingPoint.name}"<br>` +
                    `System ID: "${selectedTradingPoint.systemId}"<br>` +
                    `Station ID: "${selectedTradingPoint.stationId}"`
                );
                
                // –®–ê–ì 2: –ü–æ–ª—É—á–µ–Ω–∏–µ API –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                addStep(2, '–ü–û–õ–£–ß–ï–ù–ò–ï API –ü–ê–†–ê–ú–ï–¢–†–û–í', '–í—ã–∑—ã–≤–∞–µ–º httpClient.getApiParamsForTradingPoint()...');
                const apiParams = await httpClient.getApiParamsForTradingPoint(selectedTradingPoint.id);
                
                addParams('üì• –†–ï–ó–£–õ–¨–¢–ê–¢ getApiParamsForTradingPoint:', 
                    `Success: ${apiParams.success}<br>` +
                    `System ID: "${apiParams.systemId || '–ù–ï–¢'}"<br>` +
                    `Station ID: "${apiParams.stationId || '–ù–ï–¢'}"<br>` +
                    `API Ready: ${apiParams.apiReady}<br>` +
                    `Error: ${apiParams.error || '–Ω–µ—Ç'}`
                );
                
                // –®–ê–ì 3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏
                addStep(3, '–ü–û–õ–£–ß–ï–ù–ò–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò API', '–í—ã–∑—ã–≤–∞–µ–º tradingNetworkConfigService.getConfig()...');
                const config = await tradingNetworkConfigService.getConfig();
                
                addParams('üì• –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –¢–û–†–ì–û–í–û–ô –°–ï–¢–ò:', 
                    `Enabled: ${config.enabled}<br>` +
                    `Base URL: ${config.baseUrl}<br>` +
                    `Auth Type: ${config.authType}<br>` +
                    `Username: ${config.username}<br>` +
                    `Tanks Endpoint: ${config.endpoints.tanks}<br>` +
                    `Timeout: ${config.timeout}ms`
                );
                
                // –®–ê–ì 4: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–Ω–µ—à–Ω–µ–º—É API
                addStep(4, '–§–û–†–ú–ò–†–û–í–ê–ù–ò–ï –ó–ê–ü–†–û–°–ê –ö –í–ù–ï–®–ù–ï–ú–£ API', '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∫ –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—Ä–æ—Å...');
                
                const finalUrl = `${config.baseUrl}${config.endpoints.tanks}`;
                const queryParams = {
                    system: selectedTradingPoint.systemId,
                    station: selectedTradingPoint.stationId
                };
                
                addParams('üì§ –ò–¢–û–ì–û–í–´–ô HTTP –ó–ê–ü–†–û–°:', 
                    `Method: GET<br>` +
                    `URL: ${finalUrl}<br>` +
                    `Query Params: system=${queryParams.system}&station=${queryParams.station}<br>` +
                    `Full URL: ${finalUrl}?system=${queryParams.system}&station=${queryParams.station}<br>` +
                    `Auth: Basic ${config.username}:***<br>` +
                    `Timeout: ${config.timeout}ms`
                );
                
                // –®–ê–ì 5: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                addStep(5, '–í–´–ü–û–õ–ù–ï–ù–ò–ï –ó–ê–ü–†–û–°–ê –ö –í–ù–ï–®–ù–ï–ú–£ API', '–í—ã–∑—ã–≤–∞–µ–º tradingNetworkConfigService.getTanksData()...');
                
                const startTime = Date.now();
                let tanksResult;
                let requestError = null;
                
                try {
                    tanksResult = await tradingNetworkConfigService.getTanksData(selectedTradingPoint.id);
                } catch (error) {
                    requestError = error;
                }
                const responseTime = Date.now() - startTime;
                
                if (requestError) {
                    addParams('üì• –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê–ü–†–û–°–ê:', 
                        `Status: –û–®–ò–ë–ö–ê<br>` +
                        `Error: ${requestError.message}<br>` +
                        `Time: ${responseTime}ms<br>` +
                        `–ü—Ä–∏—á–∏–Ω–∞: ${requestError.message.includes('404') ? '–î–µ–º–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)' : '–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º'}`
                    );
                } else {
                    addParams('üì• –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê–ü–†–û–°–ê:', 
                        `Status: –£–°–ü–ï–•<br>` +
                        `Data Type: ${typeof tanksResult}<br>` +
                        `Is Array: ${Array.isArray(tanksResult)}<br>` +
                        `Count: ${Array.isArray(tanksResult) ? tanksResult.length : 'N/A'}<br>` +
                        `Time: ${responseTime}ms`
                    );
                    
                    if (Array.isArray(tanksResult) && tanksResult.length > 0) {
                        addParams('üìä –ü–ï–†–í–´–ô –†–ï–ó–ï–†–í–£–ê–† (–ø—Ä–∏–º–µ—Ä):', 
                            JSON.stringify(tanksResult[0], null, 2).substring(0, 500) + '...'
                        );
                    }
                }
                
                // –®–ê–ì 6: –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
                addStep(6, '–ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó –¢–†–ï–ô–°–ò–ù–ì–ê', '');
                
                const issues = [];
                if (!apiParams.success) issues.push('‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º API –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤');
                if (!config.enabled) issues.push('‚ùå API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞');
                if (config.authType !== 'basic') issues.push(`‚ö†Ô∏è –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${config.authType}`);
                if (config.endpoints.tanks !== '/tanks') issues.push(`‚ö†Ô∏è –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint: ${config.endpoints.tanks}`);
                if (requestError && requestError.message.includes('422')) issues.push('‚ùå 422 –æ—à–∏–±–∫–∞ - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã');
                
                addLog(`<div class="highlight">
                    üìä –ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó –¢–†–ï–ô–°–ò–ù–ì–ê:<br><br>
                    üéØ –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞: ${selectedTradingPoint.name}<br>
                    üîó –ò—Ç–æ–≥–æ–≤—ã–π URL: ${finalUrl}?system=${queryParams.system}&station=${queryParams.station}<br>
                    ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${responseTime}ms<br>
                    üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${requestError ? '–û–®–ò–ë–ö–ê' : '–£–°–ü–ï–•'}<br><br>
                    ${issues.length > 0 ? 
                        '‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:<br>' + issues.join('<br>') :
                        '‚úÖ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û!'
                    }<br><br>
                    üí° –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï: ${requestError && requestError.message.includes('404') ? 
                        '–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –¥–µ–º–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω' :
                        requestError ? 
                        '–¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º' :
                        '–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!'
                    }
                </div>`, issues.length === 0 ? 'success' : 'warning');
                
            } catch (error) {
                addLog(`üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –¢–†–ï–ô–°–ò–ù–ì–ê: ${error.message}`, 'error');
            }
        }
        
        // –¢—Ä–µ–π—Å–∏–Ω–≥ —Ç–æ–ª—å–∫–æ –≤—ã–∑–æ–≤–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        window.traceUniversalClientCall = async function() {
            if (!selectedTradingPoint) {
                addLog('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É!', 'error');
                return;
            }
            
            addLog('‚ö° –¢–†–ï–ô–°–ò–ù–ì –í–´–ó–û–í–ê –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–ì–û HTTP –ö–õ–ò–ï–ù–¢–ê', 'info');
            
            try {
                // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏
                const originalLog = console.log;
                const logs = [];
                console.log = (...args) => {
                    logs.push(args.join(' '));
                    originalLog(...args);
                };
                
                addLog('üîç –í—ã–∑—ã–≤–∞–µ–º httpClient.get() —Å destination: "external-api"...', 'info');
                
                const response = await httpClient.get('/tanks', {
                    destination: 'external-api',
                    queryParams: {
                        system: selectedTradingPoint.systemId,
                        station: selectedTradingPoint.stationId
                    }
                });
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å
                console.log = originalLog;
                
                addParams('üì• –û–¢–í–ï–¢ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–û–ì–û –ö–õ–ò–ï–ù–¢–ê:', 
                    `Success: ${response.success}<br>` +
                    `Status: ${response.status}<br>` +
                    `Data Type: ${typeof response.data}<br>` +
                    `Error: ${response.error || '–Ω–µ—Ç'}<br>` +
                    `Response Time: ${response.responseTime || 'N/A'}ms`
                );
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –ª–æ–≥–∏
                if (logs.length > 0) {
                    addParams('üìã –õ–û–ì–ò HTTP –ö–õ–ò–ï–ù–¢–ê:', 
                        logs.slice(-10).join('<br>') // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ª–æ–≥–æ–≤
                    );
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞: ${error.message}`, 'error');
            }
        }
        
        // –¢—Ä–µ–π—Å–∏–Ω–≥ –≤—ã–∑–æ–≤–∞ tanksService
        window.traceTanksServiceCall = async function() {
            if (!selectedTradingPoint) {
                addLog('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É!', 'error');
                return;
            }
            
            addLog('üõ¢Ô∏è –¢–†–ï–ô–°–ò–ù–ì –í–´–ó–û–í–ê TANKS SERVICE', 'info');
            
            try {
                addLog('üîç –í—ã–∑—ã–≤–∞–µ–º tradingNetworkConfigService.getTanksData()...', 'info');
                
                // –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                addParams('üì§ –í–•–û–î–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ –î–õ–Ø getTanksData():', 
                    `Trading Point ID: ${selectedTradingPoint.id}<br>` +
                    `–û–∂–∏–¥–∞–µ–º—ã–µ API –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: system="${selectedTradingPoint.systemId}", station="${selectedTradingPoint.stationId}"`
                );
                
                const startTime = Date.now();
                let result;
                let error = null;
                
                try {
                    result = await tradingNetworkConfigService.getTanksData(selectedTradingPoint.id);
                } catch (err) {
                    error = err;
                }
                const responseTime = Date.now() - startTime;
                
                if (error) {
                    addParams('üì• –†–ï–ó–£–õ–¨–¢–ê–¢ getTanksData():', 
                        `Status: –û–®–ò–ë–ö–ê<br>` +
                        `Error: ${error.message}<br>` +
                        `Time: ${responseTime}ms`
                    );
                } else {
                    addParams('üì• –†–ï–ó–£–õ–¨–¢–ê–¢ getTanksData():', 
                        `Status: –£–°–ü–ï–•<br>` +
                        `Data Type: ${typeof result}<br>` +
                        `Is Array: ${Array.isArray(result)}<br>` +
                        `Count: ${Array.isArray(result) ? result.length : 'N/A'}<br>` +
                        `Time: ${responseTime}ms`
                    );
                    
                    if (Array.isArray(result) && result.length > 0) {
                        addLog(`<div class="code">–ü–†–ò–ú–ï–† –î–ê–ù–ù–´–• –†–ï–ó–ï–†–í–£–ê–†–ê:<br>${JSON.stringify(result[0], null, 2)}</div>`, 'success');
                    }
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ tanks service: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
        initialize();
    </script>
</body>
</html>