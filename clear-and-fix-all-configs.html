<!DOCTYPE html>
<html>
<head>
    <title>Clear and Fix All Configurations</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .test { margin: 15px 0; padding: 20px; border-radius: 10px; }
        .success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
        .error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196f3; }
        .warning { background: rgba(255, 152, 0, 0.2); border: 1px solid #ff9800; }
        pre { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; overflow-x: auto; }
        .button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            margin: 10px 5px; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .button:hover { background: #45a049; transform: translateY(-2px); }
        .button.danger { background: #f44336; }
        .button.danger:hover { background: #da190b; }
        .button.secondary { background: #2196f3; }
        .button.secondary:hover { background: #1976d2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ –û—á–∏—Å—Ç–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</h1>
        
        <div class="test warning">
            <h3>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å 404 –æ—à–∏–±–∫–∞–º–∏</h3>
            <p>–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ 404, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Supabase –≤ localStorage.</p>
            <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ.</p>
        </div>
        
        <div class="test">
            <h3>üîß –î–µ–π—Å—Ç–≤–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h3>
            <button class="button" onclick="checkCurrentSettings()">1Ô∏è‚É£ –ü–†–û–í–ï–†–ò–¢–¨ –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò</button>
            <button class="button danger" onclick="clearAllSettings()">2Ô∏è‚É£ –û–ß–ò–°–¢–ò–¢–¨ –í–°–ï –ù–ê–°–¢–†–û–ô–ö–ò</button>
            <button class="button" onclick="setCorrectSettings()">3Ô∏è‚É£ –£–°–¢–ê–ù–û–í–ò–¢–¨ –ü–†–ê–í–ò–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò</button>
            <button class="button secondary" onclick="testAllConnections()">4Ô∏è‚É£ –ü–†–û–í–ï–†–ò–¢–¨ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        function addResult(title, type, data) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        window.checkCurrentSettings = function() {
            const allSettings = {};
            const keys = Object.keys(localStorage);
            
            keys.forEach(key => {
                if (key.includes('supabase') || key.includes('database') || key.includes('external') || key.includes('config')) {
                    try {
                        allSettings[key] = JSON.parse(localStorage.getItem(key));
                    } catch {
                        allSettings[key] = localStorage.getItem(key);
                    }
                }
            });

            addResult('üìä Current Settings Analysis', 'info', {
                found_config_keys: Object.keys(allSettings),
                total_localStorage_keys: keys.length,
                settings_details: allSettings,
                note: 'Looking for settings that might cause 404 errors'
            });
        };

        window.clearAllSettings = function() {
            const keysToRemove = [];
            const keys = Object.keys(localStorage);
            
            keys.forEach(key => {
                if (key.includes('supabase') || 
                    key.includes('database') || 
                    key.includes('external') || 
                    key.includes('config') ||
                    key.includes('dataSource')) {
                    keysToRemove.push(key);
                    localStorage.removeItem(key);
                }
            });

            addResult('üßπ Settings Cleared', 'warning', {
                removed_keys: keysToRemove,
                message: 'All potentially problematic settings have been removed',
                next_step: 'Now set correct settings'
            });
        };

        window.setCorrectSettings = function() {
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase
            const correctConfig = {
                url: 'https://ssvazdgnmatbdynkhkqo.supabase.co',
                apiKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzdmF6ZGdubWF0YmR5bmtoa3FvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzM0MzgzNCwiZXhwIjoyMDcyOTE5ODM0fQ.Gen-PI-vDkKjskpIvJNcQw0Uj3d0zGXB98zIxNK6di0',
                status: 'connected',
                lastUpdated: new Date().toISOString()
            };

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            localStorage.setItem('externalDatabase', JSON.stringify(correctConfig));
            localStorage.setItem('supabaseSettings', JSON.stringify(correctConfig));
            localStorage.setItem('supabaseConfig', JSON.stringify(correctConfig));
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            localStorage.setItem('dataSourceConfig', JSON.stringify({
                useDatabase: true,
                databaseConnected: true,
                supabaseUrl: correctConfig.url,
                apiKey: correctConfig.apiKey,
                lastCheck: new Date().toISOString(),
                status: 'connected'
            }));

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
            localStorage.setItem('instructionsConfig', JSON.stringify({
                useDatabase: true,
                databaseMode: true,
                supabaseConnected: true,
                migrationCompleted: true
            }));

            addResult('‚úÖ Correct Settings Applied', 'success', {
                message: 'All correct Supabase settings have been set',
                config_applied: {
                    url: correctConfig.url,
                    status: correctConfig.status
                },
                settings_keys: [
                    'externalDatabase',
                    'supabaseSettings', 
                    'supabaseConfig',
                    'dataSourceConfig',
                    'instructionsConfig'
                ]
            });
        };

        window.testAllConnections = async function() {
            try {
                const config = JSON.parse(localStorage.getItem('externalDatabase'));
                if (!config) {
                    addResult('‚ùå No Configuration Found', 'error', 'Please set correct settings first');
                    return;
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º page_help
                const pageHelpResponse = await fetch(`${config.url}/rest/v1/page_help?limit=3`, {
                    headers: {
                        'apikey': config.apiKey,
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã
                const networksResponse = await fetch(`${config.url}/rest/v1/networks?limit=1`, {
                    headers: {
                        'apikey': config.apiKey,
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                const results = {
                    page_help: {
                        status: pageHelpResponse.status,
                        ok: pageHelpResponse.ok,
                        data: pageHelpResponse.ok ? await pageHelpResponse.json() : 'Failed'
                    },
                    networks: {
                        status: networksResponse.status,
                        ok: networksResponse.ok,
                        data: networksResponse.ok ? await networksResponse.json() : 'Failed'
                    }
                };

                addResult('üß™ Connection Test Results', pageHelpResponse.ok && networksResponse.ok ? 'success' : 'error', {
                    supabase_url: config.url,
                    test_results: results,
                    overall_status: pageHelpResponse.ok && networksResponse.ok ? 'ALL CONNECTIONS WORKING' : 'SOME CONNECTIONS FAILED',
                    should_fix_404: pageHelpResponse.ok ? 'Yes, 404 errors should be resolved' : 'No, still have issues'
                });

            } catch (error) {
                addResult('‚ùå Connection Test Error', 'error', {
                    error: error.message,
                    note: 'Check if settings are correct'
                });
            }
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(checkCurrentSettings, 1000);
    </script>
</body>
</html>