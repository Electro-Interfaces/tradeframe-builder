<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë• –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Supabase</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button.danger { background: #dc3545; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 11px; max-height: 300px; }
        .user-card { border: 1px solid #ddd; margin: 10px 0; padding: 10px; border-radius: 5px; background: #f8f9fa; }
        .active { border-left: 4px solid #28a745; }
        .inactive { border-left: 4px solid #dc3545; }
    </style>
</head>
<body>
    <h1>üë• –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage –≤ Supabase</h1>
    
    <div class="section info">
        <h3>üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ users:</h3>
        <ol>
            <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ localStorage</li>
            <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É users –≤ Supabase</li>
            <li>–°–æ–∑–¥–∞—Ç—å SQL –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã users (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)</li>
            <li>–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–æ–ª—è–º</li>
        </ol>
        <p><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong> Users –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ Supabase</p>
    </div>
    
    <div class="section">
        <button onclick="checkLocalStorageUsers()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
        <button onclick="checkSupabaseUsers()">üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase users</button>
        <button onclick="createUsersTable()">üîß SQL –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã users</button>
        <button onclick="migrateUsers()" class="success">‚¨ÜÔ∏è –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
    </div>

    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI'
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        function logResult(message, type = 'info', data = null) {
            const resultsDiv = document.getElementById('results')
            const div = document.createElement('div')
            div.className = `section ${type}`
            
            let content = `<h4>${message}</h4>`
            if (data) {
                if (typeof data === 'string') {
                    content += `<pre>${data}</pre>`
                } else if (Array.isArray(data) && data.length > 0 && typeof data[0] === 'object') {
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    let tableContent = '<div>'
                    data.forEach(item => {
                        const cardClass = item.status === 'active' || item.isActive ? 'user-card active' : 'user-card inactive'
                        tableContent += `
                        <div class="${cardClass}">
                            <strong>${item.firstName || item.first_name || '–ë–µ–∑ –∏–º–µ–Ω–∏'} ${item.lastName || item.last_name || ''}</strong> 
                            <code>${item.email || '–ë–µ–∑ email'}</code><br>
                            <small>–°—Ç–∞—Ç—É—Å: ${item.status || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</small><br>
                            ${item.phone ? `<small>–¢–µ–ª–µ—Ñ–æ–Ω: ${item.phone}</small><br>` : ''}
                            ${item.roles ? `<small>–†–æ–ª–µ–π: ${Array.isArray(item.roles) ? item.roles.length : 0}</small><br>` : ''}
                            ${item.createdAt ? `<small>–°–æ–∑–¥–∞–Ω: ${new Date(item.createdAt).toLocaleString()}</small>` : ''}
                            ${item.created_at ? `<small>–°–æ–∑–¥–∞–Ω: ${new Date(item.created_at).toLocaleString()}</small>` : ''}
                        </div>`
                    })
                    tableContent += '</div>'
                    content += tableContent
                } else {
                    content += `<pre>${JSON.stringify(data, null, 2)}</pre>`
                }
            }
            div.innerHTML = content
            
            resultsDiv.appendChild(div)
        }

        window.checkLocalStorageUsers = async function() {
            logResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ localStorage...', 'info')
            
            try {
                const usersData = localStorage.getItem('users')
                
                if (!usersData) {
                    logResult('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage', 'error')
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–ª—é—á–∏
                    const allKeys = []
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i)
                        if (key.toLowerCase().includes('user') || key.toLowerCase().includes('auth')) {
                            allKeys.push(key)
                        }
                    }
                    
                    if (allKeys.length > 0) {
                        logResult(`üîç –ù–∞–π–¥–µ–Ω—ã –∫–ª—é—á–∏ —Å user/auth: ${allKeys.join(', ')}`, 'warning')
                    }
                    return
                }
                
                let parsed = JSON.parse(usersData)
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
                if (parsed && parsed.data && Array.isArray(parsed.data)) {
                    parsed = parsed.data
                }
                
                if (!Array.isArray(parsed)) {
                    logResult('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error', parsed)
                    return
                }
                
                logResult(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${parsed.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`, 'success')
                logResult('üìä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ localStorage:', 'info', parsed)
                
            } catch (error) {
                logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ localStorage', 'error', error)
            }
        }

        window.checkSupabaseUsers = async function() {
            logResult('üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É users –≤ Supabase...', 'info')
            
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .order('created_at')
                
                if (error) {
                    logResult('‚ùå –¢–∞–±–ª–∏—Ü–∞ users –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error', error)
                    return
                }
                
                logResult(`‚úÖ –¢–∞–±–ª–∏—Ü–∞ users —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ù–∞–π–¥–µ–Ω–æ ${data?.length || 0} –∑–∞–ø–∏—Å–µ–π`, 'success')
                
                if (data && data.length > 0) {
                    logResult('üìä –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ Supabase:', 'info', data)
                }
                
            } catch (error) {
                logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü—ã users', 'error', error)
            }
        }

        window.createUsersTable = async function() {
            logResult('üîß SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã users...', 'warning')
            
            const createTableSQL = `
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã
CREATE TABLE IF NOT EXISTS users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id VARCHAR(50) DEFAULT 'default',
    email VARCHAR(255) NOT NULL UNIQUE,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'blocked')),
    last_login TIMESTAMPTZ,
    password_hash VARCHAR(255), -- –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    external_id VARCHAR(50), -- –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID –∏–∑ localStorage
    is_system BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    deleted_at TIMESTAMPTZ
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_roles –¥–ª—è —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π
CREATE TABLE IF NOT EXISTS user_roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
    scope_value VARCHAR(100), -- –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è (network_id, point_id –∏ —Ç.–¥.)
    granted_by UUID REFERENCES users(id),
    granted_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, role_id, scope_value)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE INDEX IF NOT EXISTS idx_users_status ON users(status);
CREATE INDEX IF NOT EXISTS idx_users_tenant ON users(tenant_id);
CREATE INDEX IF NOT EXISTS idx_users_external_id ON users(external_id);
CREATE INDEX IF NOT EXISTS idx_user_roles_user_id ON user_roles(user_id);
CREATE INDEX IF NOT EXISTS idx_user_roles_role_id ON user_roles(role_id);
CREATE INDEX IF NOT EXISTS idx_user_roles_active ON user_roles(is_active);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º
COMMENT ON TABLE users IS '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã';
COMMENT ON COLUMN users.email IS 'Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ª–æ–≥–∏–Ω)';
COMMENT ON COLUMN users.external_id IS '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID –∏–∑ localStorage';
COMMENT ON COLUMN users.tenant_id IS 'ID —Ç–µ–Ω–∞–Ω—Ç–∞ –¥–ª—è –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏';

COMMENT ON TABLE user_roles IS '–°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π';
COMMENT ON COLUMN user_roles.scope_value IS '–ó–Ω–∞—á–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è —Ä–æ–ª–∏';
COMMENT ON COLUMN user_roles.granted_by IS '–ö—Ç–æ –Ω–∞–∑–Ω–∞—á–∏–ª —Ä–æ–ª—å';

-- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ RLS –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE user_roles DISABLE ROW LEVEL SECURITY;
            `
            
            logResult('üìù SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü users –∏ user_roles:', 'info', createTableSQL)
            logResult('‚ö†Ô∏è –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL –≤ Supabase SQL Editor –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü', 'warning')
        }

        window.migrateUsers = async function() {
            logResult('‚¨ÜÔ∏è –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...', 'info')
            
            try {
                // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                const usersData = localStorage.getItem('users')
                if (!usersData) {
                    logResult('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage', 'error')
                    return
                }
                
                let localStorageData = JSON.parse(usersData)
                if (localStorageData && localStorageData.data && Array.isArray(localStorageData.data)) {
                    localStorageData = localStorageData.data
                }
                
                if (!Array.isArray(localStorageData)) {
                    logResult('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö', 'error', localStorageData)
                    return
                }
                
                logResult(`üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ ${localStorageData.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...`, 'info')
                
                // 2. –ü–æ–ª—É—á–∞–µ–º —Ä–æ–ª–∏ –∏–∑ Supabase –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                const { data: rolesData, error: rolesError } = await supabase
                    .from('roles')
                    .select('id, code')
                
                if (rolesError) {
                    logResult('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–µ–π –∏–∑ Supabase', 'error', rolesError)
                    return
                }
                
                const rolesByCode = {}
                rolesData.forEach(role => {
                    rolesByCode[role.code] = role.id
                })
                
                logResult(`üìã –ù–∞–π–¥–µ–Ω–æ —Ä–æ–ª–µ–π –≤ Supabase: ${rolesData.length}`, 'info')
                
                let migratedCount = 0
                const errors = []
                
                // 3. –ú–∏–≥—Ä–∏—Ä—É–µ–º –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                for (const user of localStorageData) {
                    try {
                        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const userRecord = {
                            email: user.email,
                            first_name: user.firstName,
                            last_name: user.lastName,
                            phone: user.phone || null,
                            status: user.status,
                            last_login: user.lastLogin ? new Date(user.lastLogin).toISOString() : null,
                            external_id: user.id?.toString(), // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID
                            tenant_id: 'default'
                        }
                        
                        // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const { data: insertedUser, error: userError } = await supabase
                            .from('users')
                            .insert([userRecord])
                            .select()
                            .single()
                        
                        if (userError) {
                            errors.push(`–û—à–∏–±–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.email}: ${userError.message}`)
                            continue
                        }
                        
                        logResult(`‚úÖ –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.firstName} ${user.lastName} (${user.email})`, 'success')
                        
                        // 4. –ù–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                        if (user.roles && Array.isArray(user.roles)) {
                            for (const userRole of user.roles) {
                                const supabaseRoleId = rolesByCode[userRole.roleCode]
                                if (supabaseRoleId) {
                                    const userRoleRecord = {
                                        user_id: insertedUser.id,
                                        role_id: supabaseRoleId,
                                        scope_value: userRole.scopeValue || null,
                                        is_active: true
                                    }
                                    
                                    const { error: roleError } = await supabase
                                        .from('user_roles')
                                        .insert([userRoleRecord])
                                    
                                    if (roleError) {
                                        errors.push(`–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–∏ ${userRole.roleCode} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${user.email}: ${roleError.message}`)
                                    } else {
                                        logResult(`   ‚û§ –ù–∞–∑–Ω–∞—á–µ–Ω–∞ —Ä–æ–ª—å: ${userRole.roleName}`, 'info')
                                    }
                                } else {
                                    errors.push(`–†–æ–ª—å —Å –∫–æ–¥–æ–º ${userRole.roleCode} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ Supabase`)
                                }
                            }
                        }
                        
                        migratedCount++
                        
                    } catch (itemError) {
                        errors.push(`–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.email}: ${itemError.message}`)
                    }
                }
                
                // –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
                logResult(`üéâ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${migratedCount}`, 'success')
                
                if (errors.length > 0) {
                    logResult(`‚ö†Ô∏è –û—à–∏–±–∫–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (${errors.length}):`, 'warning', errors)
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const { data: finalData, error: checkError } = await supabase
                    .from('users')
                    .select(`
                        *,
                        user_roles (
                            role_id,
                            scope_value,
                            roles (
                                name,
                                code
                            )
                        )
                    `)
                    .order('created_at')
                
                if (!checkError) {
                    logResult(`üìä –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users (${finalData.length} –∑–∞–ø–∏—Å–µ–π):`, 'info', finalData)
                }
                
            } catch (error) {
                logResult('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏', 'error', error)
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            await new Promise(resolve => setTimeout(resolve, 500))
            await checkLocalStorageUsers()
        })
    </script>
</body>
</html>