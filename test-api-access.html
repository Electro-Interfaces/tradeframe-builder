<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ API —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; }
        .success { color: #155724; background: #d4edda; padding: 15px; border: 1px solid #c3e6cb; border-radius: 5px; margin: 10px 0; }
        .error { color: #721c24; background: #f8d7da; padding: 15px; border: 1px solid #f5c6cb; border-radius: 5px; margin: 10px 0; }
        .warning { color: #856404; background: #fff3cd; padding: 15px; border: 1px solid #ffeaa7; border-radius: 5px; margin: 10px 0; }
        .info { color: #0c5460; background: #d1ecf1; padding: 15px; border: 1px solid #bee5eb; border-radius: 5px; margin: 10px 0; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        button { padding: 12px 24px; margin: 10px 5px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; font-size: 16px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .loading { color: #ffc107; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .test-result { margin: 10px 0; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ API —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º Bearer —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π</h3>
            <p>–£–±–µ–¥–∏–º—Å—è —á—Ç–æ API –∫–ª—é—á –≤–∞–ª–∏–¥–Ω—ã–π –∏ –¥–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–µ–º—É API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</p>
        </div>

        <div class="card">
            <h3>üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <table>
                <tr>
                    <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                    <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                </tr>
                <tr>
                    <td><strong>–ë–∞–∑–æ–≤—ã–π URL</strong></td>
                    <td>https://pos.autooplata.ru/tms</td>
                </tr>
                <tr>
                    <td><strong>Bearer Token</strong></td>
                    <td><code>eyJhbGci...uIbyXEE</code> (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å)</td>
                </tr>
                <tr>
                    <td><strong>System ID</strong></td>
                    <td>15 (–¥–µ–º–æ —Å–∏—Å—Ç–µ–º–∞)</td>
                </tr>
                <tr>
                    <td><strong>Station ID</strong></td>
                    <td>4 (–¥–µ–º–æ —Å—Ç–∞–Ω—Ü–∏—è)</td>
                </tr>
            </table>
        </div>

        <div class="card">
            <h3>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤</h3>
            <p>–ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∫ –æ—Å–Ω–æ–≤–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º API:</p>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="testTanks()" id="testTanksBtn">üõ¢Ô∏è –¢–µ—Å—Ç —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã (/v1/tanks)</button>
                <button onclick="testTransactions()" id="testTransactionsBtn">üìä –¢–µ—Å—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (/v1/transactions)</button>
                <button onclick="testAll()" id="testAllBtn">üîÑ –¢–µ—Å—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</button>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'https://pos.autooplata.ru/tms';
        const API_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpbiI6eyJpZCI6IjYxODkwODMxLUQxNEYtNDY0MC05OUFDLUUxMTIzQTZFNDQzOCIsIm5hbWUiOiJVc2VyQXBpIiwicm9sZSI6MH0sInVzZXIiOnsiaWQiOiI2MTg5MDgzMS1EMTRGLTQ2NDAtOTlBQy1FMTEyM0E2RTQ0MzgiLCJuYW1lIjoiVXNlckFwaSJ9LCJleHAiOjE3NTczMTc5NTR9.fXqRyv-d7cotjD_YcDwSMB5Y9SXVCQB2LN1LXbCzsB8';
        const SYSTEM_ID = '15';
        const STATION_ID = '4';

        function addResult(title, success, data, error, responseTime) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            
            let content = `<h4>${title}</h4>`;
            
            if (success) {
                content += `<p>‚úÖ <strong>–£—Å–ø–µ—Ö!</strong> –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω –∑–∞ ${responseTime}–º—Å</p>`;
                if (data) {
                    if (Array.isArray(data)) {
                        content += `<p>üìä –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${data.length}</p>`;
                        if (data.length > 0) {
                            content += `<details><summary>–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å</summary><pre>${JSON.stringify(data[0], null, 2)}</pre></details>`;
                        }
                    } else {
                        content += `<details><summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</summary><pre>${JSON.stringify(data, null, 2)}</pre></details>`;
                    }
                }
            } else {
                content += `<p>‚ùå <strong>–û—à–∏–±–∫–∞:</strong> ${error}</p>`;
                content += `<p>‚è±Ô∏è –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: ${responseTime}–º—Å</p>`;
            }
            
            resultDiv.innerHTML = content;
            resultsDiv.appendChild(resultDiv);
        }

        async function makeApiRequest(endpoint, params = {}) {
            const url = new URL(`${API_BASE}${endpoint}`);
            Object.entries(params).forEach(([key, value]) => {
                if (value !== undefined && value !== null) {
                    url.searchParams.append(key, String(value));
                }
            });

            const startTime = Date.now();
            
            try {
                console.log(`üåê –ó–∞–ø—Ä–æ—Å: ${url.toString()}`);
                console.log(`üîê Authorization: Bearer ${API_TOKEN.substring(0, 20)}...`);
                
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });

                const responseTime = Date.now() - startTime;
                
                console.log(`üì° –û—Ç–≤–µ—Ç: ${response.status} ${response.statusText} (${responseTime}ms)`);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${response.statusText}. ${errorText}`);
                }

                const data = await response.json();
                return { success: true, data, responseTime };
                
            } catch (error) {
                const responseTime = Date.now() - startTime;
                console.error(`‚ùå –û—à–∏–±–∫–∞ API:`, error);
                return { success: false, error: error.message, responseTime };
            }
        }

        async function testTanks() {
            const btn = document.getElementById('testTanksBtn');
            btn.disabled = true;
            btn.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä—É—é —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã...';
            
            const result = await makeApiRequest('/v1/tanks', {
                system: SYSTEM_ID,
                station: STATION_ID
            });

            addResult('üõ¢Ô∏è –¢–µ—Å—Ç —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã (/v1/tanks)', result.success, result.data, result.error, result.responseTime);
            
            btn.disabled = false;
            btn.textContent = 'üõ¢Ô∏è –¢–µ—Å—Ç —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã (/v1/tanks)';
            
            return result;
        }

        async function testTransactions() {
            const btn = document.getElementById('testTransactionsBtn');
            btn.disabled = true;
            btn.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...';
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const dateFrom = yesterday.toISOString().split('T')[0];
            
            const result = await makeApiRequest('/v1/transactions', {
                system: SYSTEM_ID,
                station: STATION_ID,
                date_from: dateFrom
            });

            addResult('üìä –¢–µ—Å—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (/v1/transactions)', result.success, result.data, result.error, result.responseTime);
            
            btn.disabled = false;
            btn.textContent = 'üìä –¢–µ—Å—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (/v1/transactions)';
            
            return result;
        }

        async function testAll() {
            const btn = document.getElementById('testAllBtn');
            btn.disabled = true;
            btn.textContent = 'üîÑ –¢–µ—Å—Ç–∏—Ä—É—é –≤—Å–µ...';
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('results').innerHTML = '';
            
            console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...');
            
            const tanksResult = await testTanks();
            const transactionsResult = await testTransactions();
            
            // –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const allSuccess = tanksResult.success && transactionsResult.success;
            addResult(
                'üéØ –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è',
                allSuccess,
                null,
                allSuccess ? null : '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏',
                0
            );
            
            btn.disabled = false;
            btn.textContent = 'üîÑ –¢–µ—Å—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã';
            
            if (allSuccess) {
                const successDiv = document.createElement('div');
                successDiv.className = 'success';
                successDiv.innerHTML = `
                    <h3>üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!</h3>
                    <p>‚úÖ Bearer —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π</p>
                    <p>‚úÖ –î–æ—Å—Ç—É–ø –∫ API —Ä–∞–±–æ—Ç–∞–µ—Ç</p>
                    <p>‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</p>
                    <p><strong>–ú–æ–∂–Ω–æ —Å–º–µ–ª–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"!</strong></p>
                `;
                document.getElementById('results').appendChild(successDiv);
            } else {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.innerHTML = `
                    <h3>‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã</h3>
                    <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—à–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:</p>
                    <ul>
                        <li>Bearer —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫</li>
                        <li>API —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω</li>
                        <li>–ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫</li>
                    </ul>
                `;
                document.getElementById('results').appendChild(errorDiv);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = () => {
            setTimeout(testAll, 1000);
        };
    </script>
</body>
</html>