<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—à–∏–±–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .error {
            background: #f44336;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            background: #2196F3;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        pre {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</h1>

    <div class="info">
        –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤
    </div>

    <button onclick="testTanksPage()">üß™ –¢–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</button>
    <button onclick="testConsoleErrors()">‚ùå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏</button>
    <button onclick="openTanksPage()">üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</button>
    <button onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>

    <div id="results"></div>

    <script>
        const errors = [];
        const logs = [];

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
        window.addEventListener('error', function(e) {
            errors.push({
                type: 'error',
                message: e.message,
                source: e.filename,
                line: e.lineno,
                column: e.colno,
                stack: e.error ? e.error.stack : null,
                time: new Date().toISOString()
            });
            updateDisplay();
        });

        window.addEventListener('unhandledrejection', function(e) {
            errors.push({
                type: 'unhandledrejection',
                message: e.reason ? e.reason.toString() : 'Unknown promise rejection',
                time: new Date().toISOString()
            });
            updateDisplay();
        });

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console
        const originalError = console.error;
        const originalLog = console.log;
        const originalWarn = console.warn;

        console.error = function(...args) {
            logs.push({
                type: 'error',
                message: args.join(' '),
                time: new Date().toISOString()
            });
            updateDisplay();
            originalError.apply(console, args);
        };

        console.log = function(...args) {
            logs.push({
                type: 'log',
                message: args.join(' '),
                time: new Date().toISOString()
            });
            updateDisplay();
            originalLog.apply(console, args);
        };

        console.warn = function(...args) {
            logs.push({
                type: 'warn',
                message: args.join(' '),
                time: new Date().toISOString()
            });
            updateDisplay();
            originalWarn.apply(console, args);
        };

        function updateDisplay() {
            const resultsDiv = document.getElementById('results');
            
            let html = '';
            
            if (errors.length > 0) {
                html += '<h2>‚ùå JavaScript –û—à–∏–±–∫–∏:</h2>';
                errors.forEach(error => {
                    html += `<div class="error">
                        <strong>[${error.time}] ${error.type}</strong><br>
                        ${error.message}<br>
                        ${error.source ? `–§–∞–π–ª: ${error.source}:${error.line}:${error.column}` : ''}
                        ${error.stack ? `<pre>${error.stack}</pre>` : ''}
                    </div>`;
                });
            }

            if (logs.length > 0) {
                html += '<h2>üìù –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10):</h2>';
                const recentLogs = logs.slice(-10);
                recentLogs.forEach(log => {
                    const className = log.type === 'error' ? 'error' : 'info';
                    html += `<div class="${className}">
                        <strong>[${log.time}] ${log.type.toUpperCase()}</strong><br>
                        ${log.message}
                    </div>`;
                });
            }

            if (html === '') {
                html = '<div class="info">‚úÖ –ü–æ–∫–∞ –æ—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>';
            }

            resultsDiv.innerHTML = html;
        }

        function testTanksPage() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="info">üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤...</div>';

            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π iframe –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'http://localhost:3004/point/tanks';
            
            iframe.onload = function() {
                try {
                    console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –≤ iframe');
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                    }, 5000);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤:', error);
                }
            };

            iframe.onerror = function() {
                console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –≤ iframe');
            };

            document.body.appendChild(iframe);
        }

        function testConsoleErrors() {
            console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫...');
            console.error('üî¥ –¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞');
            console.warn('üü° –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º JavaScript –æ—à–∏–±–∫—É
            setTimeout(() => {
                try {
                    throw new Error('–¢–µ—Å—Ç–æ–≤–∞—è JavaScript –æ—à–∏–±–∫–∞');
                } catch (e) {
                    console.error('–ü–æ–π–º–∞–Ω–∞ –æ—à–∏–±–∫–∞:', e);
                }
            }, 100);
        }

        function openTanksPage() {
            window.open('http://localhost:3004/point/tanks', '_blank');
        }

        function clearLogs() {
            errors.length = 0;
            logs.length = 0;
            updateDisplay();
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä
        fetch('http://localhost:3004/')
            .then(response => {
                if (response.ok) {
                    console.log('‚úÖ –°–µ—Ä–≤–µ—Ä –Ω–∞ localhost:3004 –¥–æ—Å—Ç—É–ø–µ–Ω');
                } else {
                    console.log('‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–∞ localhost:3004 –≤–µ—Ä–Ω—É–ª —Å—Ç–∞—Ç—É—Å:', response.status);
                }
            })
            .catch(error => {
                console.error('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–∞ localhost:3004 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
                console.log('üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å http://localhost:3004/ –≤—Ä—É—á–Ω—É—é');
            });

        updateDisplay();
    </script>
</body>
</html>