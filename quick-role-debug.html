<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ u@me.com</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 4px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîç –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ u@me.com</h1>
    <button onclick="checkUserRole()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å</button>
    <div id="result"></div>

    <script>
        const supabaseUrl = 'https://tohtryzyffcebtyvkxwh.supabase.co';
        const supabaseServiceKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';

        async function checkUserRole() {
            const resultDiv = document.getElementById('result');

            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase
                const response = await fetch(`${supabaseUrl}/rest/v1/users?email=eq.u@me.com`, {
                    headers: {
                        'apikey': supabaseServiceKey,
                        'Authorization': `Bearer ${supabaseServiceKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                const users = await response.json();

                if (users.length === 0) {
                    resultDiv.innerHTML = '<div class="result error">‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å u@me.com –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
                    return;
                }

                const user = users[0];
                const userRole = user.preferences?.role || 'no_role';

                // –°–∏–º—É–ª–∏—Ä—É–µ–º –º–∞–ø–ø–∏–Ω–≥ –∏–∑ supabaseAuthService
                const roleNameToCode = {
                    '–°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä': 'super_admin',
                    '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ç–∏': 'network_admin',
                    '–ú–µ–Ω–µ–¥–∂–µ—Ä': 'manager',
                    '–û–ø–µ—Ä–∞—Ç–æ—Ä': 'operator',
                    '–ú–µ–Ω–µ–¥–∂–µ—Ä –ë–¢–û': 'bto_manager'
                };

                let mappedRole = userRole;
                if (roleNameToCode[userRole]) {
                    mappedRole = roleNameToCode[userRole];
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –∏–∑ useMenuVisibility
                const shouldShowAllMenus = mappedRole === 'super_admin' || mappedRole === 'system_admin';

                resultDiv.innerHTML = `
                    <div class="result info">
                        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –∏–∑ –ë–î:</strong> "${userRole}"</p>
                        <p><strong>–†–æ–ª—å –ø–æ—Å–ª–µ –º–∞–ø–ø–∏–Ω–≥–∞:</strong> "${mappedRole}"</p>
                        <p><strong>–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –º–µ–Ω—é:</strong>
                            <span style="color: ${shouldShowAllMenus ? 'green' : 'red'}">
                                ${shouldShowAllMenus ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}
                            </span>
                        </p>
                        <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${shouldShowAllMenus ?
                            '–†–æ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É—Å–ª–æ–≤–∏—é super_admin || system_admin' :
                            `–†–æ–ª—å "${mappedRole}" –ù–ï —Ä–∞–≤–Ω–∞ "super_admin" –∏–ª–∏ "system_admin"`}</p>
                    </div>

                    <div class="result">
                        <h4>üîç –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</h4>
                        <pre>${JSON.stringify(user, null, 2)}</pre>
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>