<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .container {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #2d5a2d; border-left: 4px solid #4caf50; }
        .error { background: #5a2d2d; border-left: 4px solid #f44336; }
        .warning { background: #5a5a2d; border-left: 4px solid #ff9800; }
        .info { background: #2d3a5a; border-left: 4px solid #2196f3; }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #666; cursor: not-allowed; }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .test-section {
            border-left: 3px solid #4caf50;
            padding-left: 15px;
            margin: 15px 0;
        }
        .step-chain {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        .step {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #333;
            border-radius: 5px;
        }
        .step-number {
            background: #4caf50;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        .step.error .step-number { background: #f44336; }
        .step.warning .step-number { background: #ff9800; }
        .arrow {
            margin: 0 10px;
            font-size: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h1>
        <p>–ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è URL –∏ –∫–ª—é—á–µ–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º HTTP –∫–ª–∏–µ–Ω—Ç–æ–º</p>
        
        <button onclick="diagnoseFullChain()" id="diagnoseBtn">üöÄ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–ø–æ—á–∫–∏</button>
        <button onclick="testEachStep()" id="testStepsBtn">üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥</button>
        <button onclick="checkEnvironment()" id="checkEnvBtn">üåç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è</button>
    </div>

    <div class="container">
        <h2>üìã –°—Ö–µ–º–∞ —Ü–µ–ø–æ—á–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h2>
        <div class="step-chain">
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <div>
                    <strong>universalHttpClient.ts</strong><br>
                    <small>–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç URL –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è 'supabase'</small>
                </div>
            </div>
            <div class="arrow">‚¨á</div>
            
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div>
                    <strong>apiConfigServiceDB.getCurrentConnection()</strong><br>
                    <small>–ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</small>
                </div>
            </div>
            <div class="arrow">‚¨á</div>
            
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div>
                    <strong>systemConfigService.getDatabaseConfig()</strong><br>
                    <small>–ß–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã system_config</small>
                </div>
            </div>
            <div class="arrow">‚¨á</div>
            
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div>
                    <strong>supabaseConfigClient</strong><br>
                    <small>–ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è</small>
                </div>
            </div>
            <div class="arrow">‚¨á</div>
            
            <div class="step" id="step5">
                <div class="step-number">5</div>
                <div>
                    <strong>import.meta.env</strong><br>
                    <small>VITE_SUPABASE_URL –∏ VITE_SUPABASE_ANON_KEY</small>
                </div>
            </div>
        </div>
    </div>

    <div id="results"></div>

    <script type="module">
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function addResult(title, content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'container';
            div.innerHTML = `
                <div class="test-section">
                    <h3>${title}</h3>
                    <div class="status ${type}">
                        <pre>${content}</pre>
                    </div>
                </div>
            `;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —à–∞–≥–∞
        function updateStepStatus(stepId, status) {
            const step = document.getElementById(stepId);
            if (step) {
                step.className = `step ${status}`;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
        window.checkEnvironment = function() {
            addResult('üåç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è', '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ...', 'info');
            
            const envVars = {
                'VITE_SUPABASE_URL': import.meta.env.VITE_SUPABASE_URL,
                'VITE_SUPABASE_ANON_KEY': import.meta.env.VITE_SUPABASE_ANON_KEY,
                'VITE_SUPABASE_SERVICE_KEY': import.meta.env.VITE_SUPABASE_SERVICE_KEY,
                'MODE': import.meta.env.MODE,
                'DEV': import.meta.env.DEV,
                'PROD': import.meta.env.PROD,
            };

            let report = '–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:\n';
            let hasErrors = false;

            Object.entries(envVars).forEach(([key, value]) => {
                if (value) {
                    if (key.includes('KEY') || key.includes('SECRET')) {
                        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
                        report += `‚úÖ ${key}: ${value.substring(0, 20)}...\n`;
                    } else {
                        report += `‚úÖ ${key}: ${value}\n`;
                    }
                } else {
                    report += `‚ùå ${key}: –ù–ï –ó–ê–î–ê–ù–ê\n`;
                    if (key === 'VITE_SUPABASE_URL' || key === 'VITE_SUPABASE_ANON_KEY') {
                        hasErrors = true;
                    }
                }
            });

            if (hasErrors) {
                report += '\n‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ù–ï –ó–ê–î–ê–ù–´!\n';
                report += '–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç:\n';
                report += 'VITE_SUPABASE_URL=https://your-project.supabase.co\n';
                report += 'VITE_SUPABASE_ANON_KEY=your-anon-key';
                addResult('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è', report, 'error');
                updateStepStatus('step5', 'error');
            } else {
                report += '\n‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω—ã';
                addResult('‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è', report, 'success');
                updateStepStatus('step5', 'success');
            }
        };

        // –≠–º—É–ª—è—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
        window.testEachStep = async function() {
            addResult('üîß –ü–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ...', 'info');
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–æ–≤
            ['step1', 'step2', 'step3', 'step4', 'step5'].forEach(id => {
                updateStepStatus(id, '');
            });

            // –®–∞–≥ 5: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
            await new Promise(resolve => setTimeout(resolve, 500));
            checkEnvironment();
            
            // –®–∞–≥ 4: –ë–∞–∑–æ–≤—ã–π Supabase –∫–ª–∏–µ–Ω—Ç
            await new Promise(resolve => setTimeout(resolve, 1000));
            addResult('üîß –®–∞–≥ 4: –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ Supabase –∫–ª–∏–µ–Ω—Ç–∞', '–≠–º—É–ª–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ supabaseConfigClient...', 'info');
            
            const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
            const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
            
            if (supabaseUrl && supabaseKey) {
                try {
                    // –≠–º—É–ª–∏—Ä—É–µ–º —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                    const testUrl = `${supabaseUrl}/rest/v1/`;
                    const response = await fetch(testUrl, {
                        method: 'GET',
                        headers: {
                            'apikey': supabaseKey,
                            'Authorization': `Bearer ${supabaseKey}`
                        }
                    });
                    
                    if (response.status === 200 || response.status === 404) {
                        addResult('‚úÖ –®–∞–≥ 4: –ë–∞–∑–æ–≤—ã–π Supabase –∫–ª–∏–µ–Ω—Ç', 
                            `–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —É—Å–ø–µ—à–Ω–æ\n` +
                            `URL: ${supabaseUrl}\n` +
                            `–°—Ç–∞—Ç—É—Å: ${response.status}`, 'success');
                        updateStepStatus('step4', 'success');
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    addResult('‚ùå –®–∞–≥ 4: –û—à–∏–±–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ Supabase –∫–ª–∏–µ–Ω—Ç–∞', 
                        `–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Supabase:\n${error.message}\n\n` +
                        `–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n` +
                        `‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL –ø—Ä–æ–µ–∫—Ç–∞\n` +
                        `‚Ä¢ –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞\n` +
                        `‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ç–∏`, 'error');
                    updateStepStatus('step4', 'error');
                }
            } else {
                addResult('‚ùå –®–∞–≥ 4: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ', 'URL –∏–ª–∏ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω—ã', 'error');
                updateStepStatus('step4', 'error');
            }

            // –®–∞–≥ 3: –¢–∞–±–ª–∏—Ü–∞ system_config
            await new Promise(resolve => setTimeout(resolve, 1000));
            if (supabaseUrl && supabaseKey) {
                try {
                    const configUrl = `${supabaseUrl}/rest/v1/system_config`;
                    const response = await fetch(configUrl, {
                        method: 'GET',
                        headers: {
                            'apikey': supabaseKey,
                            'Authorization': `Bearer ${supabaseKey}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        addResult('‚úÖ –®–∞–≥ 3: –¢–∞–±–ª–∏—Ü–∞ system_config', 
                            `–¢–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞\n` +
                            `–ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${data.length}\n` +
                            `–ü—Ä–∏–º–µ—Ä—ã –∫–ª—é—á–µ–π: ${data.slice(0, 3).map(r => r.config_key).join(', ')}`, 'success');
                        updateStepStatus('step3', 'success');
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
                        const dbConfig = data.find(r => r.config_key === 'database_connections');
                        if (dbConfig) {
                            addResult('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î –Ω–∞–π–¥–µ–Ω–∞', 
                                `–ö–ª—é—á: ${dbConfig.config_key}\n` +
                                `–¢–∏–ø: ${dbConfig.config_type}\n` +
                                `–û–ø–∏—Å–∞–Ω–∏–µ: ${dbConfig.description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}`, 'success');
                        } else {
                            addResult('‚ö†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç', 
                                '–í system_config –Ω–µ—Ç –∑–∞–ø–∏—Å–∏ —Å –∫–ª—é—á–æ–º "database_connections"\n' +
                                '–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç –ø–æ—á–µ–º—É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å URL', 'warning');
                        }
                    } else if (response.status === 401 || response.status === 403) {
                        addResult('‚ö†Ô∏è –®–∞–≥ 3: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ system_config', 
                            `HTTP ${response.status}: ${response.statusText}\n\n` +
                            `–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n` +
                            `‚Ä¢ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–æ—Å—Ç—É–ø\n` +
                            `‚Ä¢ –ù—É–∂–µ–Ω service_role –∫–ª—é—á\n` +
                            `‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞`, 'warning');
                        updateStepStatus('step3', 'warning');
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    if (error.message.includes('404')) {
                        addResult('‚ùå –®–∞–≥ 3: –¢–∞–±–ª–∏—Ü–∞ system_config –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 
                            '–¢–∞–±–ª–∏—Ü–∞ system_config –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ë–î\n\n' +
                            '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É:\n' +
                            'CREATE TABLE system_config (\n' +
                            '  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,\n' +
                            '  config_key text UNIQUE NOT NULL,\n' +
                            '  config_value jsonb,\n' +
                            '  config_type text DEFAULT \'general\',\n' +
                            '  description text,\n' +
                            '  is_encrypted boolean DEFAULT false,\n' +
                            '  created_at timestamp with time zone DEFAULT now(),\n' +
                            '  updated_at timestamp with time zone DEFAULT now()\n' +
                            ');', 'error');
                        updateStepStatus('step3', 'error');
                    } else {
                        addResult('‚ùå –®–∞–≥ 3: –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ system_config', error.message, 'error');
                        updateStepStatus('step3', 'error');
                    }
                }
            }

            // –®–∞–≥–∏ 2 –∏ 1 –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö
            await new Promise(resolve => setTimeout(resolve, 500));
            addResult('‚ö†Ô∏è –®–∞–≥–∏ 2 –∏ 1: –ó–∞–≤–∏—Å—è—Ç –æ—Ç system_config', 
                'apiConfigServiceDB –∏ universalHttpClient –Ω–µ —Å–º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å\n' +
                '–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ system_config', 'warning');
            updateStepStatus('step2', 'warning');
            updateStepStatus('step1', 'warning');
        };

        // –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        window.diagnoseFullChain = async function() {
            addResult('üöÄ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', '–ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏...', 'info');
            
            await testEachStep();
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
            const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
            const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
            
            let diagnosis = 'üîç –î–ò–ê–ì–ù–û–ó:\n\n';
            
            if (!supabaseUrl || !supabaseKey) {
                diagnosis += '‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è\n';
                diagnosis += '–†–ï–®–ï–ù–ò–ï: –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å VITE_SUPABASE_URL –∏ VITE_SUPABASE_ANON_KEY\n\n';
            } else {
                diagnosis += '‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã\n\n';
                
                try {
                    const configUrl = `${supabaseUrl}/rest/v1/system_config`;
                    const response = await fetch(configUrl, {
                        method: 'GET',
                        headers: {
                            'apikey': supabaseKey,
                            'Authorization': `Bearer ${supabaseKey}`
                        }
                    });
                    
                    if (response.status === 404) {
                        diagnosis += '‚ùå –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –¢–∞–±–ª–∏—Ü–∞ system_config –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n';
                        diagnosis += '–†–ï–®–ï–ù–ò–ï: –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É system_config –≤ Supabase\n\n';
                        diagnosis += 'SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:\n';
                        diagnosis += 'CREATE TABLE system_config (\n';
                        diagnosis += '  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,\n';
                        diagnosis += '  config_key text UNIQUE NOT NULL,\n';
                        diagnosis += '  config_value jsonb,\n';
                        diagnosis += '  config_type text DEFAULT \'general\',\n';
                        diagnosis += '  description text,\n';
                        diagnosis += '  is_encrypted boolean DEFAULT false,\n';
                        diagnosis += '  created_at timestamp with time zone DEFAULT now(),\n';
                        diagnosis += '  updated_at timestamp with time zone DEFAULT now()\n';
                        diagnosis += ');\n\n';
                    } else if (response.status === 401 || response.status === 403) {
                        diagnosis += '‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê –î–û–°–¢–£–ü–ê: –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ system_config\n';
                        diagnosis += '–†–ï–®–ï–ù–ò–ï: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ service_role –∫–ª—é—á\n\n';
                    } else if (response.ok) {
                        const data = await response.json();
                        const dbConfig = data.find(r => r.config_key === 'database_connections');
                        
                        if (!dbConfig) {
                            diagnosis += '‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø–∏—Å—å database_connections\n';
                            diagnosis += '–†–ï–®–ï–ù–ò–ï: –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ë–î –≤ —Ä–∞–∑–¥–µ–ª "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"\n\n';
                            diagnosis += '–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL:\n';
                            diagnosis += 'INSERT INTO system_config (config_key, config_value, config_type, description)\n';
                            diagnosis += 'VALUES (\n';
                            diagnosis += '  \'database_connections\',\n';
                            diagnosis += '  \'{"currentConnectionId": "supabase-main", "availableConnections": [{"id": "supabase-main", "name": "Main Supabase", "type": "supabase", "url": "' + supabaseUrl + '", "settings": {"apiKey": "' + supabaseKey + '"}}], "debugMode": false}\',\n';
                            diagnosis += '  \'database\',\n';
                            diagnosis += '  \'Database connections configuration\'\n';
                            diagnosis += ');\n\n';
                        } else {
                            diagnosis += '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è database_connections –Ω–∞–π–¥–µ–Ω–∞\n';
                            diagnosis += '–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\n';
                        }
                    }
                } catch (error) {
                    diagnosis += '‚ùå –°–ï–¢–ï–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: ' + error.message + '\n';
                    diagnosis += '–†–ï–®–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Supabase –ø—Ä–æ–µ–∫—Ç–∞\n\n';
                }
            }
            
            diagnosis += 'üìã –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –î–ï–ô–°–¢–í–ò–Ø:\n';
            diagnosis += '1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ\n';
            diagnosis += '2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É system_config –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç\n';
            diagnosis += '3. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é database_connections\n';
            diagnosis += '4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ system_config\n';
            diagnosis += '5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π';
            
            addResult('üéØ –ò—Ç–æ–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞', diagnosis, 'info');
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            addResult('üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 
                '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL –∏ –∫–ª—é—á–µ–π\n\n' +
                'üéØ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:\n' +
                '‚Ä¢ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY)\n' +
                '‚Ä¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–æ–≤–æ–º—É Supabase –∫–ª–∏–µ–Ω—Ç—É\n' +
                '‚Ä¢ –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã system_config\n' +
                '‚Ä¢ –ù–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ database_connections\n' +
                '‚Ä¢ –¶–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤ –≤ universalHttpClient\n\n' +
                '–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞.', 'info');
        });
    </script>
</body>
</html>