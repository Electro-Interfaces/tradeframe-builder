<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 11px; max-height: 300px; }
    </style>
</head>
<body>
    <h1>üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</h1>
    
    <div class="section info">
        <h3>üìã –ü—Ä–æ–±–ª–µ–º–∞:</h3>
        <p>–î–∞–Ω–Ω—ã–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</p>
        <ul>
            <li>–î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –æ—á–∏—â–µ–Ω—ã –≤ nomenclatureService.ts</li>
            <li>–î–∞–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–∏—Å—É</li>
            <li>–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ–¥ –¥—Ä—É–≥–∏–º –∫–ª—é—á–æ–º</li>
        </ul>
    </div>
    
    <div class="section">
        <button onclick="checkAllLocalStorage()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ localStorage</button>
        <button onclick="initializeNomenclatureData()">üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</button>
        <button onclick="checkAfterInitialization()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</button>
    </div>

    <div id="results"></div>

    <script>
        function logResult(message, type = 'info', data = null) {
            const resultsDiv = document.getElementById('results')
            const div = document.createElement('div')
            div.className = `section ${type}`
            
            let content = `<h4>${message}</h4>`
            if (data) {
                if (typeof data === 'string') {
                    content += `<pre>${data}</pre>`
                } else {
                    content += `<pre>${JSON.stringify(data, null, 2)}</pre>`
                }
            }
            div.innerHTML = content
            
            resultsDiv.appendChild(div)
        }

        window.checkAllLocalStorage = function() {
            logResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–ª—é—á–∏ –≤ localStorage...', 'info')
            
            const allKeys = []
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i)
                const value = localStorage.getItem(key)
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏
                const shortValue = value && value.length > 100 ? value.substring(0, 100) + '...' : value
                
                allKeys.push({
                    key: key,
                    length: value ? value.length : 0,
                    preview: shortValue
                })
            }
            
            logResult(`üìä –ù–∞–π–¥–µ–Ω–æ ${allKeys.length} –∫–ª—é—á–µ–π –≤ localStorage:`, 'info', allKeys)
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ nomenclature
            const nomenclatureData = localStorage.getItem('nomenclature')
            if (nomenclatureData) {
                logResult('‚úÖ –ö–ª—é—á "nomenclature" –Ω–∞–π–¥–µ–Ω!', 'success', nomenclatureData)
            } else {
                logResult('‚ùå –ö–ª—é—á "nomenclature" –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error')
            }
        }

        window.initializeNomenclatureData = function() {
            logResult('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –≤—Ä—É—á–Ω—É—é...', 'info')
            
            // –î–∞–Ω–Ω—ã–µ –∏–∑ nomenclatureService.ts
            const initialNomenclature = [
                {
                    id: '1',
                    networkId: '1',
                    networkName: '–î–µ–º–æ —Å–µ—Ç—å –ê–ó–°',
                    name: '–ê–ò-92',
                    internalCode: 'AI92',
                    networkApiCode: 'FUEL_AI92_REGULAR',
                    networkApiSettings: {
                        enabled: true,
                        endpoint: '/api/v1/fuel-types/regular',
                        priority: 1,
                        lastSync: new Date('2024-01-15T10:00:00'),
                        syncStatus: 'success'
                    },
                    externalCodes: [
                        {
                            id: '1',
                            nomenclatureId: '1',
                            systemType: '1C',
                            externalCode: '–ë–ù–ó-92',
                            description: '–ö–æ–¥ –≤ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ',
                            createdAt: new Date('2024-01-15'),
                            updatedAt: new Date('2024-01-15')
                        },
                        {
                            id: '2',
                            nomenclatureId: '1',
                            systemType: 'PROCESSING',
                            externalCode: 'FUEL_92',
                            description: '–ö–æ–¥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–µ',
                            createdAt: new Date('2024-01-15'),
                            updatedAt: new Date('2024-01-15')
                        }
                    ],
                    description: '–ë–µ–Ω–∑–∏–Ω –ê–ò-92 (Regular)',
                    status: 'active',
                    createdAt: new Date('2024-01-15'),
                    updatedAt: new Date('2024-01-15'),
                    createdBy: 'admin',
                    updatedBy: 'admin'
                },
                {
                    id: '2',
                    networkId: '1',
                    networkName: '–î–µ–º–æ —Å–µ—Ç—å –ê–ó–°',
                    name: '–ê–ò-95',
                    internalCode: 'AI95',
                    networkApiCode: 'FUEL_AI95_PREMIUM',
                    networkApiSettings: {
                        enabled: true,
                        endpoint: '/api/v1/fuel-types/premium',
                        priority: 2,
                        lastSync: new Date('2024-01-15T10:30:00'),
                        syncStatus: 'success'
                    },
                    externalCodes: [
                        {
                            id: '3',
                            nomenclatureId: '2',
                            systemType: '1C',
                            externalCode: '–ë–ù–ó-95',
                            description: '–ö–æ–¥ –≤ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ',
                            createdAt: new Date('2024-01-15'),
                            updatedAt: new Date('2024-01-15')
                        }
                    ],
                    description: '–ë–µ–Ω–∑–∏–Ω –ê–ò-95 (Premium)',
                    status: 'active',
                    createdAt: new Date('2024-01-15'),
                    updatedAt: new Date('2024-03-10'),
                    createdBy: 'admin',
                    updatedBy: 'operator'
                },
                {
                    id: '3',
                    networkId: '1',
                    networkName: '–î–µ–º–æ —Å–µ—Ç—å –ê–ó–°',
                    name: '–ê–ò-98',
                    internalCode: 'AI98',
                    externalCodes: [],
                    description: '–ë–µ–Ω–∑–∏–Ω –ê–ò-98 (Super)',
                    status: 'active',
                    createdAt: new Date('2024-02-01'),
                    updatedAt: new Date('2024-02-01'),
                    createdBy: 'admin',
                    updatedBy: 'admin'
                },
                {
                    id: '4',
                    networkId: '1',
                    networkName: '–î–µ–º–æ —Å–µ—Ç—å –ê–ó–°',
                    name: '–î–¢',
                    internalCode: 'DT',
                    externalCodes: [
                        {
                            id: '4',
                            nomenclatureId: '4',
                            systemType: '1C',
                            externalCode: '–î–¢-–õ',
                            description: '–î–∏–∑–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –ª–µ—Ç–Ω–µ–µ',
                            createdAt: new Date('2024-01-15'),
                            updatedAt: new Date('2024-01-15')
                        },
                        {
                            id: '5',
                            nomenclatureId: '4',
                            systemType: 'CRM',
                            externalCode: 'DIESEL_FUEL',
                            createdAt: new Date('2024-01-15'),
                            updatedAt: new Date('2024-01-15')
                        }
                    ],
                    description: '–î–∏–∑–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ',
                    status: 'active',
                    createdAt: new Date('2024-01-20'),
                    updatedAt: new Date('2024-01-20'),
                    createdBy: 'admin',
                    updatedBy: 'admin'
                },
                {
                    id: '5',
                    networkId: '1',
                    networkName: '–î–µ–º–æ —Å–µ—Ç—å –ê–ó–°',
                    name: '–ê–ò-100',
                    internalCode: 'AI100',
                    networkApiCode: 'FUEL_AI100_ULTRA',
                    networkApiSettings: {
                        enabled: true,
                        endpoint: '/api/v1/fuel-types/ultra',
                        priority: 5,
                        lastSync: new Date('2024-02-15T11:00:00'),
                        syncStatus: 'success'
                    },
                    externalCodes: [
                        {
                            id: '9',
                            nomenclatureId: '5',
                            systemType: '1C',
                            externalCode: '–ë–ù–ó-100',
                            description: '–ö–æ–¥ –≤ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ',
                            createdAt: new Date('2024-02-15'),
                            updatedAt: new Date('2024-02-15')
                        },
                        {
                            id: '10',
                            nomenclatureId: '5',
                            systemType: 'PROCESSING',
                            externalCode: 'FUEL_100',
                            description: '–ö–æ–¥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–µ',
                            createdAt: new Date('2024-02-15'),
                            updatedAt: new Date('2024-02-15')
                        }
                    ],
                    description: '–ë–µ–Ω–∑–∏–Ω –ê–ò-100 (Ultra)',
                    status: 'active',
                    createdAt: new Date('2024-02-15'),
                    updatedAt: new Date('2024-02-15'),
                    createdBy: 'admin',
                    updatedBy: 'admin'
                }
            ]
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('nomenclature', JSON.stringify(initialNomenclature))
            
            logResult(`‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${initialNomenclature.length} –∑–∞–ø–∏—Å–µ–π –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã`, 'success')
            logResult('üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:', 'info', initialNomenclature.map(item => ({
                id: item.id,
                name: item.name,
                networkId: item.networkId,
                externalCodesCount: item.externalCodes?.length || 0
            })))
        }

        window.checkAfterInitialization = function() {
            logResult('‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...', 'info')
            
            const nomenclatureData = localStorage.getItem('nomenclature')
            if (!nomenclatureData) {
                logResult('‚ùå –î–∞–Ω–Ω—ã–µ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error')
                return
            }
            
            const parsed = JSON.parse(nomenclatureData)
            logResult(`‚úÖ –î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã! –ó–∞–ø–∏—Å–µ–π: ${parsed.length}`, 'success')
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É
            const summary = parsed.map(item => ({
                id: item.id,
                name: item.name,
                networkId: item.networkId,
                networkName: item.networkName,
                externalCodes: item.externalCodes?.length || 0
            }))
            
            logResult('üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', 'info', summary)
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                checkAllLocalStorage()
            }, 500)
        })
    </script>
</body>
</html>