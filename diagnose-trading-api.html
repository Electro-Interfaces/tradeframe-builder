<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–æ—Ä–≥–æ–≤–æ–º—É API</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a1a; 
            color: #0f0; 
            padding: 20px;
            line-height: 1.4;
        }
        .section { 
            margin: 15px 0; 
            padding: 10px; 
            border: 1px solid #0f0;
            background: #0a0a0a;
        }
        h1 { color: #0ff; }
        h2 { color: #ff0; }
        .step {
            margin: 10px 0;
            padding: 8px;
            background: #001100;
            border-left: 3px solid #0f0;
        }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .success { color: #0f0; }
        .config-item {
            margin: 5px 0;
            padding: 5px;
            background: #000;
            border-left: 2px solid #ff0;
        }
        pre {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            overflow-x: auto;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–æ—Ä–≥–æ–≤–æ–º—É API</h1>
    
    <div class="section">
        <h2>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h2>
        <div id="step1"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"</h2>
        <div id="step2"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 3: –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
        <div id="step3"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 4: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h2>
        <div id="step4"></div>
    </div>

    <script>
        const log = (containerId, msg, type = '') => {
            const div = document.createElement('div');
            div.className = `step ${type}`;
            div.innerHTML = msg;
            document.getElementById(containerId).appendChild(div);
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
        function checkLocalStorageConfig() {
            log('step1', 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ localStorage...', 'warning');
            
            const configKey = 'trading_network_config';
            const savedConfig = localStorage.getItem(configKey);
            
            if (!savedConfig) {
                log('step1', '‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ localStorage', 'error');
                log('step1', '–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏" –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                return null;
            }

            try {
                const config = JSON.parse(savedConfig);
                log('step1', '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞ –≤ localStorage', 'success');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const configInfo = [
                    `üåê URL: ${config.baseUrl || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`,
                    `üîê –¢–∏–ø –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${config.authType || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`,
                    `üë§ –õ–æ–≥–∏–Ω: ${config.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`,
                    `üîë –ï—Å—Ç—å –ø–∞—Ä–æ–ª—å: ${!!config.password}`,
                    `üè¢ System ID: ${config.systemId || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`,
                    `üè™ Station ID: ${config.defaultStationId || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`,
                    `üîå –í–∫–ª—é—á–µ–Ω–æ: ${config.enabled ? '–î–∞' : '–ù–µ—Ç'}`
                ];
                
                configInfo.forEach(info => {
                    log('step1', info);
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
                if (config.endpoints) {
                    log('step1', '<br><strong>üì° –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:</strong>');
                    Object.entries(config.endpoints).forEach(([key, value]) => {
                        log('step1', `  ‚Ä¢ ${key}: ${value}`);
                    });
                }
                
                return config;
                
            } catch (error) {
                log('step1', `‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
                return null;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–∞ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"
        function checkDataExchangeSection() {
            log('step2', 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–¥–µ–ª "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"...', 'warning');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–∂–µ–º –ª–∏ –º—ã –æ—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª
            const dataExchangeUrl = '/settings/data-exchange';
            log('step2', `üìç URL —Ä–∞–∑–¥–µ–ª–∞: ${window.location.origin}${dataExchangeUrl}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–∏—Ö –∫–ª—é—á–∞—Ö localStorage
            const allKeys = Object.keys(localStorage);
            const apiKeys = allKeys.filter(key => 
                key.includes('api') || 
                key.includes('trading') || 
                key.includes('config') ||
                key.includes('network')
            );
            
            if (apiKeys.length > 0) {
                log('step2', 'üìã –ù–∞–π–¥–µ–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –≤ localStorage:', 'success');
                apiKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    const preview = value && value.length > 100 ? value.substring(0, 100) + '...' : value;
                    log('step2', `  ‚Ä¢ ${key}: ${preview}`);
                });
            } else {
                log('step2', '‚ö†Ô∏è –°–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning');
            }

            log('step2', '<br><strong>üí° –ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</strong>');
            log('step2', '1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"');
            log('step2', '2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API');
            log('step2', '3. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"');
        }

        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        async function testDirectConnection(config) {
            log('step3', 'üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API...', 'warning');
            
            if (!config) {
                log('step3', '‚ùå –ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }

            if (!config.enabled) {
                log('step3', '‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö', 'error');
                return;
            }

            try {
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
                const apiUrl = config.baseUrl;
                const endpoint = config.endpoints?.tanks || '/v1/tanks';
                const systemId = config.systemId;
                const stationId = config.defaultStationId;
                
                const fullUrl = `${apiUrl}${endpoint}?system=${systemId}&station=${stationId}`;
                log('step3', `üì° –¢–µ—Å—Ç–æ–≤—ã–π URL: ${fullUrl}`);

                // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
                const headers = {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
                if (config.authType === 'basic' && config.username && config.password) {
                    const authString = btoa(`${config.username}:${config.password}`);
                    headers['Authorization'] = `Basic ${authString}`;
                    log('step3', 'üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Basic –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
                } else if (config.authType === 'bearer' && config.apiKey) {
                    headers['Authorization'] = `Bearer ${config.apiKey}`;
                    log('step3', 'üîê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Bearer —Ç–æ–∫–µ–Ω');
                } else {
                    log('step3', '‚ö†Ô∏è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞', 'warning');
                }

                log('step3', '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...');
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), config.timeout || 30000);
                
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    headers,
                    signal: controller.signal,
                    mode: 'cors'
                });
                
                clearTimeout(timeoutId);

                log('step3', `üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);

                if (response.ok) {
                    const data = await response.json();
                    log('step3', '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!', 'success');
                    log('step3', `üì¶ –ü–æ–ª—É—á–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö: ${JSON.stringify(data).length} —Å–∏–º–≤–æ–ª–æ–≤`);
                    
                    if (Array.isArray(data)) {
                        log('step3', `üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π: ${data.length}`);
                    } else if (data.tanks && Array.isArray(data.tanks)) {
                        log('step3', `üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${data.tanks.length}`);
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
                    const sample = Array.isArray(data) ? data[0] : (data.tanks ? data.tanks[0] : data);
                    if (sample) {
                        log('step3', '<br><strong>üìã –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:</strong>');
                        const sampleStr = JSON.stringify(sample, null, 2);
                        const pre = document.createElement('pre');
                        pre.textContent = sampleStr.substring(0, 500) + (sampleStr.length > 500 ? '...' : '');
                        document.getElementById('step3').appendChild(pre);
                    }
                    
                } else {
                    log('step3', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${response.status} ${response.statusText}`, 'error');
                    
                    const errorText = await response.text().catch(() => '–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏');
                    log('step3', `üìÑ –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: ${errorText.substring(0, 200)}...`);
                    
                    if (response.status === 403) {
                        log('step3', 'üîê –í–µ—Ä–æ—è—Ç–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å', 'error');
                    } else if (response.status === 404) {
                        log('step3', 'üìç –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –∏–ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç', 'error');
                    }
                }

            } catch (error) {
                log('step3', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
                
                if (error.name === 'AbortError') {
                    log('step3', '‚è∞ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è', 'error');
                } else if (error.message.includes('CORS')) {
                    log('step3', 'üö´ –ü—Ä–æ–±–ª–µ–º–∞ —Å CORS –ø–æ–ª–∏—Ç–∏–∫–æ–π', 'error');
                    log('step3', '–í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS');
                } else if (error.message.includes('Failed to fetch')) {
                    log('step3', 'üåê –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'error');
                }
            }
        }

        // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
        function showRecommendations(config) {
            log('step4', 'üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é:', 'warning');
            
            if (!config) {
                log('step4', '1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"', 'warning');
                log('step4', '2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API:', 'warning');
                log('step4', '   ‚Ä¢ URL —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏', 'warning');
                log('step4', '   ‚Ä¢ –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞', 'warning'); 
                log('step4', '   ‚Ä¢ ID —Å–∏—Å—Ç–µ–º—ã –∏ ID —Å—Ç–∞–Ω—Ü–∏–∏', 'warning');
                log('step4', '3. –í–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–í–∫–ª—é—á–µ–Ω–æ")', 'warning');
                log('step4', '4. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" –∏ "–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"', 'warning');
                return;
            }

            const problems = [];
            const fixes = [];

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—ã
            if (!config.enabled) {
                problems.push('–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞');
                fixes.push('–í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–í–∫–ª—é—á–µ–Ω–æ" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
            }

            if (!config.baseUrl || !config.baseUrl.startsWith('http')) {
                problems.push('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞');
                fixes.push('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http/https)');
            }

            if (config.authType === 'basic' && (!config.username || !config.password)) {
                problems.push('–ù–µ —É–∫–∞–∑–∞–Ω—ã –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –¥–ª—è Basic Auth');
                fixes.push('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è "–õ–æ–≥–∏–Ω" –∏ "–ü–∞—Ä–æ–ª—å" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
            }

            if (config.authType === 'bearer' && !config.apiKey) {
                problems.push('–ù–µ —É–∫–∞–∑–∞–Ω API –∫–ª—é—á –¥–ª—è Bearer Auth');
                fixes.push('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ "API –∫–ª—é—á" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
            }

            if (!config.systemId) {
                problems.push('–ù–µ —É–∫–∞–∑–∞–Ω ID —Å–∏—Å—Ç–µ–º—ã');
                fixes.push('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ "ID —Å–∏—Å—Ç–µ–º—ã" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
            }

            if (!config.defaultStationId) {
                problems.push('–ù–µ —É–∫–∞–∑–∞–Ω ID —Å—Ç–∞–Ω—Ü–∏–∏');
                fixes.push('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ "ID —Å—Ç–∞–Ω—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
            if (problems.length > 0) {
                log('step4', '<br><strong>üî¥ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</strong>', 'error');
                problems.forEach((problem, i) => {
                    log('step4', `${i + 1}. ${problem}`, 'error');
                });

                log('step4', '<br><strong>‚úÖ –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:</strong>', 'success');
                fixes.forEach((fix, i) => {
                    log('step4', `${i + 1}. ${fix}`, 'success');
                });
            } else {
                log('step4', '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                log('step4', '–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤:', 'warning');
                log('step4', '‚Ä¢ –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏', 'warning');
                log('step4', '‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–µ CORS –±—Ä–∞—É–∑–µ—Ä–æ–º', 'warning');
                log('step4', '‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', 'warning');
                log('step4', '‚Ä¢ –°–µ—Ç–µ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö (firewall)', 'warning');
            }

            log('step4', '<br><strong>üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏:</strong>');
            log('step4', '1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞');
            log('step4', '2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ');
            log('step4', '3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ—Ç –ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞');
            log('step4', '4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS');
        }

        // –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        async function runDiagnostics() {
            const config = checkLocalStorageConfig();
            checkDataExchangeSection();
            await testDirectConnection(config);
            showRecommendations(config);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
        runDiagnostics();
    </script>
</body>
</html>