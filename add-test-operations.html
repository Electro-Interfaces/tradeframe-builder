<!DOCTYPE html>
<html>
<head>
    <title>Add Test Operations Data</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px 0; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .log { background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; max-height: 400px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöõ –î–æ–±–∞–≤–∏—Ç—å –¢–µ—Å—Ç–æ–≤—ã–µ –û–ø–µ—Ä–∞—Ü–∏–∏</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–±–∞–≤–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ç–∞–±–ª–∏—Ü—É operations –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã API.</p>
        
        <button onclick="addTestOperations()">–î–æ–±–∞–≤–∏—Ç—å –¢–µ—Å—Ç–æ–≤—ã–µ –û–ø–µ—Ä–∞—Ü–∏–∏</button>
        <button onclick="checkOperations()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –û–ø–µ—Ä–∞—Ü–∏–∏</button>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –õ–æ–≥</button>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabaseUrl = 'https://tohtryzyffcebtyvkxwh.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjUzNTk5NTIsImV4cCI6MjA0MDkzNTk1Mn0.Y_LhIvHnBbMAErYzBt2hHxd6xVtNJoOJ4xm0Y-nOQHY';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function addTestOperations() {
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ
                const { data: existing, error: checkError } = await supabase
                    .from('operations')
                    .select('id')
                    .limit(1);

                if (checkError) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö: ${checkError.message}`, 'error');
                    return;
                }

                if (existing && existing.length > 0) {
                    log('‚ö†Ô∏è –í —Ç–∞–±–ª–∏—Ü–µ operations —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ. –í—Å–µ —Ä–∞–≤–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ?', 'info');
                    if (!confirm('–í —Ç–∞–±–ª–∏—Ü–µ operations —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏?')) {
                        return;
                    }
                }

                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–π
                const testOperations = [
                    {
                        id: 'op-001',
                        operation_type: 'sale',
                        status: 'completed',
                        start_time: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥
                        end_time: new Date(Date.now() - 2 * 60 * 60 * 1000 + 5 * 60 * 1000).toISOString(), // + 5 –º–∏–Ω—É—Ç
                        duration: 300,
                        trading_point_id: 'tp-001',
                        trading_point_name: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                        device_id: 'pump-01',
                        transaction_id: 'txn-001',
                        fuel_type: '–ê–ò-95',
                        quantity: 35.50,
                        price: 52.30,
                        total_cost: 1856.65,
                        payment_method: 'bank_card',
                        details: '–û–±—ã—á–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ —Ç–æ–ø–ª–∏–≤–∞',
                        progress: 100,
                        operator_name: '–ò–≤–∞–Ω–æ–≤ –ê.–ü.',
                        customer_id: 'cust-001',
                        vehicle_number: '–ê123–ë–í77',
                        metadata: { receipt_number: "12345", bonus_points: 18 }
                    },
                    {
                        id: 'op-002',
                        operation_type: 'sale',
                        status: 'completed',
                        start_time: new Date(Date.now() - 1.5 * 60 * 60 * 1000).toISOString(),
                        end_time: new Date(Date.now() - 1.5 * 60 * 60 * 1000 + 5 * 60 * 1000).toISOString(),
                        duration: 300,
                        trading_point_id: 'tp-001',
                        trading_point_name: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                        device_id: 'pump-02',
                        transaction_id: 'txn-002',
                        fuel_type: '–î–¢',
                        quantity: 50.00,
                        price: 54.80,
                        total_cost: 2740.00,
                        payment_method: 'cash',
                        details: '–ü—Ä–æ–¥–∞–∂–∞ –¥–∏–∑–µ–ª—å–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞',
                        progress: 100,
                        operator_name: '–ü–µ—Ç—Ä–æ–≤ –°.–ò.',
                        customer_id: 'cust-002',
                        vehicle_number: '–í456–ì–î99',
                        metadata: { receipt_number: "12346" }
                    },
                    {
                        id: 'op-003',
                        operation_type: 'sale',
                        status: 'in_progress',
                        start_time: new Date(Date.now() - 5 * 60 * 1000).toISOString(), // 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
                        end_time: null,
                        duration: null,
                        trading_point_id: 'tp-002',
                        trading_point_name: '–ê–ó–° –°–µ–≤–µ—Ä–Ω–∞—è',
                        device_id: 'pump-03',
                        transaction_id: 'txn-003',
                        fuel_type: '–ê–ò-92',
                        quantity: 25.00,
                        price: 50.90,
                        total_cost: 1272.50,
                        payment_method: 'bank_card',
                        details: '–ó–∞–ø—Ä–∞–≤–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ',
                        progress: 75,
                        operator_name: '–°–∏–¥–æ—Ä–æ–≤ –í.–ö.',
                        customer_id: 'cust-003',
                        vehicle_number: '–ï789–ñ–ó55',
                        metadata: { estimated_time: "2 min" }
                    },
                    {
                        id: 'op-004',
                        operation_type: 'refund',
                        status: 'completed',
                        start_time: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString(),
                        end_time: new Date(Date.now() - 3 * 60 * 60 * 1000 + 5 * 60 * 1000).toISOString(),
                        duration: 300,
                        trading_point_id: 'tp-001',
                        trading_point_name: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                        device_id: 'pump-01',
                        transaction_id: 'txn-004',
                        fuel_type: '–ê–ò-95',
                        quantity: 15.00,
                        price: 52.30,
                        total_cost: 784.50,
                        payment_method: 'bank_card',
                        details: '–í–æ–∑–≤—Ä–∞—Ç –∏–∑-–∑–∞ –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞',
                        progress: 100,
                        operator_name: '–ò–≤–∞–Ω–æ–≤ –ê.–ü.',
                        customer_id: 'cust-004',
                        vehicle_number: '–ò012–ö–õ33',
                        metadata: { refund_reason: "quality_issue", original_txn: "txn-001" }
                    },
                    {
                        id: 'op-005',
                        operation_type: 'maintenance',
                        status: 'completed',
                        start_time: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(),
                        end_time: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                        duration: 3600,
                        trading_point_id: 'tp-001',
                        trading_point_name: '–ê–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è',
                        device_id: 'pump-02',
                        transaction_id: null,
                        fuel_type: null,
                        quantity: null,
                        price: null,
                        total_cost: null,
                        payment_method: null,
                        details: '–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û –∫–æ–ª–æ–Ω–∫–∏ ‚Ññ2',
                        progress: 100,
                        operator_name: '–¢–µ—Ö–Ω–∏–∫ –ö–æ–∑–ª–æ–≤ –î.–ê.',
                        customer_id: null,
                        vehicle_number: null,
                        metadata: { maintenance_type: "scheduled", work_performed: ["filter_change", "calibration"] }
                    }
                ];

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–¥–Ω—É –∑–∞ –æ–¥–Ω–æ–π –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—à–∏–±–æ–∫
                let successCount = 0;
                for (const operation of testOperations) {
                    try {
                        const { data, error } = await supabase
                            .from('operations')
                            .insert([operation])
                            .select();

                        if (error) {
                            log(`‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ ${operation.id}: ${error.message}`, 'error');
                        } else {
                            log(`‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è ${operation.id} –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`, 'success');
                            successCount++;
                        }
                    } catch (err) {
                        log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ ${operation.id}: ${err.message}`, 'error');
                    }
                }

                log(`üéâ –ì–æ—Ç–æ–≤–æ! –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–π: ${successCount} –∏–∑ ${testOperations.length}`, 'success');
                
            } catch (error) {
                log(`‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        }

        async function checkOperations() {
            log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ operations...', 'info');
            
            try {
                const { data, error, count } = await supabase
                    .from('operations')
                    .select('*', { count: 'exact' })
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π: ${error.message}`, 'error');
                    return;
                }

                log(`üìä –í—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ: ${count}`, 'info');
                
                if (data && data.length > 0) {
                    log('üîç –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ–ø–µ—Ä–∞—Ü–∏–π:', 'info');
                    data.forEach((op, index) => {
                        log(`${index + 1}. ${op.id} - ${op.operation_type} (${op.status}) - ${op.fuel_type || 'N/A'} - ${op.total_cost || 'N/A'} —Ä—É–±.`, 'info');
                    });
                } else {
                    log('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ operations –ø—É—Å—Ç–∞', 'info');
                }

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            log('üåü –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π!', 'info');
            checkOperations();
        });
    </script>
</body>
</html>