<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        .result {
            background: white;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .success { border-left-color: #48bb78; background: #f0fff4; }
        .error { border-left-color: #f56565; background: #fff5f5; }
        .warning { border-left-color: #ed8936; background: #fffaf0; }
        .info { border-left-color: #4299e1; background: #ebf8ff; }
        pre { 
            background: #2d3748; 
            color: #e2e8f0; 
            padding: 15px; 
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.5;
            max-height: 300px;
        }
        .actions {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .primary-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .success-btn { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .danger-btn { background: linear-gradient(135deg, #f56565, #e53e3e); color: white; }
        .warning-btn { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 12px;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            word-break: break-word;
            max-width: 150px;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background: #f7fafc;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .source-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }
        .source-card h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .user-count {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
        
        <div class="result warning">
            <strong>üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:</strong><br>
            –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç localStorage –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–æ –æ–∂–∏–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase.
        </div>
        
        <div class="actions">
            <button onclick="checkLocalStorage()" class="primary-btn">üíæ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
            <button onclick="checkSupabaseUsers()" class="warning-btn">üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase (users)</button>
            <button onclick="checkSupabaseProfiles()" class="info-btn">üë§ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase (profiles)</button>
            <button onclick="checkAuthUsers()" class="success-btn">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å auth.users</button>
            <button onclick="compareAllSources()" class="success-btn">üîÑ –°—Ä–∞–≤–Ω–∏—Ç—å –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</button>
            <button onclick="migrateFromSupabase()" class="danger-btn">üì§ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Supabase</button>
            <button onclick="clearResults()" class="danger-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI'
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        function logResult(message, type = 'info', data = null) {
            const resultsDiv = document.getElementById('results')
            const resultDiv = document.createElement('div')
            resultDiv.className = `result ${type}`
            
            const timestamp = new Date().toLocaleTimeString()
            let content = `<strong>[${timestamp}] ${message}</strong>`
            
            if (data !== null) {
                if (typeof data === 'object') {
                    content += `<pre>${JSON.stringify(data, null, 2)}</pre>`
                } else {
                    content += `<pre>${data}</pre>`
                }
            }
            
            resultDiv.innerHTML = content
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild)
        }
        
        function createUsersTable(users, sourceName) {
            if (!users || users.length === 0) {
                return `<div class="user-count">‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ ${sourceName}</div>`
            }
            
            let tableHtml = `<div class="user-count">‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ ${sourceName}: ${users.length}</div>`
            
            if (users.length > 0) {
                const sampleUser = users[0]
                const columns = Object.keys(sampleUser)
                
                tableHtml += `
                    <table>
                        <thead>
                            <tr>${columns.map(col => `<th>${col}</th>`).join('')}</tr>
                        </thead>
                        <tbody>
                `
                
                users.slice(0, 10).forEach(user => {
                    tableHtml += '<tr>'
                    columns.forEach(col => {
                        let value = user[col]
                        if (value && typeof value === 'object') {
                            value = JSON.stringify(value).substring(0, 100) + '...'
                        } else if (value && value.toString().length > 50) {
                            value = value.toString().substring(0, 50) + '...'
                        }
                        tableHtml += `<td>${value || '-'}</td>`
                    })
                    tableHtml += '</tr>'
                })
                
                if (users.length > 10) {
                    tableHtml += `<tr><td colspan="${columns.length}"><em>... –∏ –µ—â—ë ${users.length - 10} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</em></td></tr>`
                }
                
                tableHtml += '</tbody></table>'
            }
            
            return tableHtml
        }
        
        window.clearResults = function() {
            document.getElementById('results').innerHTML = ''
            logResult('‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã', 'info')
        }
        
        window.checkLocalStorage = function() {
            logResult('üíæ –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage...', 'info')
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–ª—é—á–∏
                const possibleKeys = [
                    'tradeframe_users',
                    'users',
                    'auth_users',
                    'user_data',
                    'app_users'
                ]
                
                let foundUsers = []
                let usedKey = null
                
                for (const key of possibleKeys) {
                    const data = localStorage.getItem(key)
                    if (data) {
                        try {
                            const parsed = JSON.parse(data)
                            if (Array.isArray(parsed) && parsed.length > 0) {
                                foundUsers = parsed
                                usedKey = key
                                break
                            }
                        } catch (e) {
                            // –ù–µ JSON –¥–∞–Ω–Ω—ã–µ
                        }
                    }
                }
                
                if (foundUsers.length > 0) {
                    const tableHtml = createUsersTable(foundUsers, `localStorage (${usedKey})`)
                    const resultDiv = document.createElement('div')
                    resultDiv.className = 'result success'
                    resultDiv.innerHTML = `<strong>üíæ –î–∞–Ω–Ω—ã–µ localStorage:</strong>${tableHtml}`
                    document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
                    
                    logResult(`‚úÖ –ù–∞–π–¥–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ localStorage –ø–æ–¥ –∫–ª—é—á–æ–º: ${usedKey}`, 'success')
                } else {
                    logResult('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning')
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏ localStorage
                    const allKeys = Object.keys(localStorage)
                    if (allKeys.length > 0) {
                        logResult('–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –≤ localStorage:', 'info', allKeys)
                    }
                }
                
            } catch (error) {
                logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ localStorage', 'error', error)
            }
        }
        
        window.checkSupabaseUsers = async function() {
            logResult('üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É users –≤ Supabase...', 'info')
            
            try {
                const { data, error, count } = await supabase
                    .from('users')
                    .select('*', { count: 'exact' })
                
                if (error) {
                    if (error.message.includes('relation') && error.message.includes('does not exist')) {
                        logResult('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ users –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Supabase', 'warning')
                        return
                    }
                    logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ users –∏–∑ Supabase', 'error', error)
                    return
                }
                
                const tableHtml = createUsersTable(data, 'Supabase users')
                const resultDiv = document.createElement('div')
                resultDiv.className = 'result success'
                resultDiv.innerHTML = `<strong>üóÑÔ∏è –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã users:</strong>${tableHtml}`
                document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
                
            } catch (err) {
                logResult('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Supabase users', 'error', err)
            }
        }
        
        window.checkSupabaseProfiles = async function() {
            logResult('üë§ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É user_profiles –≤ Supabase...', 'info')
            
            try {
                const { data, error, count } = await supabase
                    .from('user_profiles')
                    .select('*', { count: 'exact' })
                
                if (error) {
                    if (error.message.includes('relation') && error.message.includes('does not exist')) {
                        logResult('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ user_profiles –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Supabase', 'warning')
                        return
                    }
                    logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ user_profiles –∏–∑ Supabase', 'error', error)
                    return
                }
                
                const tableHtml = createUsersTable(data, 'Supabase user_profiles')
                const resultDiv = document.createElement('div')
                resultDiv.className = 'result success'
                resultDiv.innerHTML = `<strong>üë§ –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã user_profiles:</strong>${tableHtml}`
                document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
                
            } catch (err) {
                logResult('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Supabase user_profiles', 'error', err)
            }
        }
        
        window.checkAuthUsers = async function() {
            logResult('üîê –ü—Ä–æ–≤–µ—Ä—è–µ–º auth.users –≤ Supabase...', 'info')
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: { user } } = await supabase.auth.getUser()
                
                if (user) {
                    logResult('‚úÖ –¢–µ–∫—É—â–∏–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', 'success', user)
                } else {
                    logResult('‚ö†Ô∏è –ù–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'warning')
                }
                
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ admin API
                try {
                    const { data: users, error } = await supabase.auth.admin.listUsers()
                    
                    if (error) {
                        logResult('‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ admin API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö auth.users', 'warning', error.message)
                    } else if (users && users.users && users.users.length > 0) {
                        const tableHtml = createUsersTable(users.users, 'Supabase auth.users')
                        const resultDiv = document.createElement('div')
                        resultDiv.className = 'result success'
                        resultDiv.innerHTML = `<strong>üîê –î–∞–Ω–Ω—ã–µ auth.users:</strong>${tableHtml}`
                        document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
                    }
                } catch (adminError) {
                    logResult('‚ö†Ô∏è Admin API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning', adminError.message)
                }
                
            } catch (err) {
                logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ auth.users', 'error', err)
            }
        }
        
        window.compareAllSources = async function() {
            logResult('üîÑ –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö...', 'info')
            
            const sources = {}
            
            // 1. localStorage
            try {
                const possibleKeys = ['tradeframe_users', 'users', 'auth_users']
                for (const key of possibleKeys) {
                    const data = localStorage.getItem(key)
                    if (data) {
                        const parsed = JSON.parse(data)
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            sources.localStorage = { data: parsed, key }
                            break
                        }
                    }
                }
            } catch (e) {}
            
            // 2. Supabase users
            try {
                const { data } = await supabase.from('users').select('*')
                if (data && data.length > 0) {
                    sources.supabaseUsers = { data }
                }
            } catch (e) {}
            
            // 3. Supabase user_profiles  
            try {
                const { data } = await supabase.from('user_profiles').select('*')
                if (data && data.length > 0) {
                    sources.supabaseProfiles = { data }
                }
            } catch (e) {}
            
            // 4. Auth users
            try {
                const { data: users } = await supabase.auth.admin.listUsers()
                if (users && users.users && users.users.length > 0) {
                    sources.authUsers = { data: users.users }
                }
            } catch (e) {}
            
            // –°–æ–∑–¥–∞—ë–º —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
            const comparisonHtml = `
                <div class="comparison">
                    <div class="source-card">
                        <h3>üíæ localStorage</h3>
                        <div class="user-count">${sources.localStorage ? sources.localStorage.data.length : 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        ${sources.localStorage ? `<p>–ö–ª—é—á: ${sources.localStorage.key}</p>` : '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>'}
                    </div>
                    <div class="source-card">
                        <h3>üóÑÔ∏è Supabase users</h3>
                        <div class="user-count">${sources.supabaseUsers ? sources.supabaseUsers.data.length : 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="source-card">
                        <h3>üë§ Supabase user_profiles</h3>
                        <div class="user-count">${sources.supabaseProfiles ? sources.supabaseProfiles.data.length : 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="source-card">
                        <h3>üîê Auth users</h3>
                        <div class="user-count">${sources.authUsers ? sources.authUsers.data.length : 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                </div>
            `
            
            const resultDiv = document.createElement('div')
            resultDiv.className = 'result info'
            resultDiv.innerHTML = `<strong>üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:</strong>${comparisonHtml}`
            document.getElementById('results').insertBefore(resultDiv, document.getElementById('results').firstChild)
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            if (sources.supabaseUsers && !sources.localStorage) {
                logResult('üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—Å—Ç—å –≤ Supabase, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ localStorage. –ù–∞–∂–º–∏—Ç–µ "–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Supabase"', 'warning')
            } else if (sources.localStorage && !sources.supabaseUsers) {
                logResult('üí° localStorage —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ Supabase –ø—É—Å—Ç. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.', 'info')
            } else if (sources.supabaseUsers && sources.localStorage) {
                logResult('üí° –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö. –í–æ–∑–º–æ–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç.', 'warning')
            }
        }
        
        window.migrateFromSupabase = async function() {
            logResult('üì§ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase...', 'warning')
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase
                const { data: supabaseUsers, error } = await supabase
                    .from('users')
                    .select('*')
                
                if (error) {
                    logResult('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase', 'error', error)
                    return
                }
                
                if (!supabaseUsers || supabaseUsers.length === 0) {
                    logResult('‚ö†Ô∏è –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Supabase –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏', 'warning')
                    return
                }
                
                logResult(`üìä –ù–∞–π–¥–µ–Ω–æ ${supabaseUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Supabase`, 'info')
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç localStorage
                const convertedUsers = supabaseUsers.map(user => ({
                    id: user.id,
                    email: user.email,
                    name: user.name || user.full_name || user.display_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    phone: user.phone,
                    status: user.status || 'active',
                    roles: user.roles || [],
                    permissions: user.permissions || [],
                    created_at: new Date(user.created_at),
                    updated_at: new Date(user.updated_at || user.created_at),
                    last_login: user.last_login ? new Date(user.last_login) : null,
                    version: 1
                }))
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('tradeframe_users', JSON.stringify(convertedUsers))
                
                logResult(`‚úÖ –£—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ ${convertedUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ localStorage`, 'success')
                logResult('–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:', 'success', convertedUsers.map(u => ({ email: u.email, name: u.name })))
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                setTimeout(() => {
                    checkLocalStorage()
                }, 1000)
                
            } catch (err) {
                logResult('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏', 'error', err)
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            compareAllSources()
        })
    </script>
</body>
</html>