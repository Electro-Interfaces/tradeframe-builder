<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ API</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a1a; 
            color: #0f0; 
            padding: 20px;
            line-height: 1.4;
        }
        .section { 
            margin: 15px 0; 
            padding: 10px; 
            border: 1px solid #0f0;
            background: #0a0a0a;
        }
        h1 { color: #0ff; }
        h2 { color: #ff0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .success { color: #0f0; }
        .info { color: #09f; }
        pre {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            overflow-x: auto;
            font-size: 11px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #0a0a0a;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px;
            cursor: pointer;
            font-family: monospace;
            margin: 5px;
        }
        button:hover {
            background: #001100;
        }
        .compare-table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }
        .compare-table th, .compare-table td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
            font-size: 11px;
        }
        .compare-table th {
            background: #333;
            color: #ff0;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ API —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏</h1>
    
    <div class="section">
        <h2>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</h2>
        <button onclick="checkCurrentConfig()">üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
        <div id="currentConfigResult"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</h2>
        <button onclick="checkLocalStorage()">üíæ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
        <div id="localStorageResult"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 3: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
        <div class="info">
            <p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏":</strong></p>
            <table class="compare-table">
                <tr>
                    <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                    <th>–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</th>
                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                </tr>
                <tr>
                    <td>baseUrl</td>
                    <td>https://pos.autooplata.ru/tms</td>
                    <td>–ë–∞–∑–æ–≤—ã–π URL API</td>
                </tr>
                <tr>
                    <td>systemId</td>
                    <td>15</td>
                    <td>ID —Å–∏—Å—Ç–µ–º—ã</td>
                </tr>
                <tr>
                    <td>defaultStationId</td>
                    <td>4</td>
                    <td>ID —Å—Ç–∞–Ω—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</td>
                </tr>
                <tr>
                    <td>authType</td>
                    <td>bearer</td>
                    <td>–¢–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</td>
                </tr>
                <tr>
                    <td>endpoints.tanks</td>
                    <td>??? (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)</td>
                    <td>–ü—É—Ç—å –∫ API —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 4: –¢–µ—Å—Ç —Ä–∞–∑–Ω—ã—Ö –ø—É—Ç–µ–π API</h2>
        <button onclick="testDifferentPaths()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏</button>
        <div id="pathTestResult"></div>
    </div>

    <div class="section">
        <h2>–®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</h2>
        <button onclick="updateConfig()">üîß –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</button>
        <div id="updateResult"></div>
    </div>

    <script>
        const log = (containerId, msg, type = '') => {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = msg;
            document.getElementById(containerId).appendChild(div);
        };

        async function checkCurrentConfig() {
            const container = 'currentConfigResult';
            document.getElementById(container).innerHTML = '';
            
            log(container, 'üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...', 'warning');
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const response = await fetch('http://localhost:3006/api/config-check', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const config = await response.json();
                    log(container, '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞:', 'success');
                    log(container, `<pre>${JSON.stringify(config, null, 2)}</pre>`);
                } else {
                    throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
            } catch (error) {
                log(container, `‚ö†Ô∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–≤–µ—Ä–∏–º —á–µ—Ä–µ–∑ localStorage...`, 'warning');
                checkLocalStorage();
            }
        }

        function checkLocalStorage() {
            const container = 'localStorageResult';
            document.getElementById(container).innerHTML = '';
            
            log(container, 'üíæ –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage...', 'warning');
            
            try {
                const tradingConfig = localStorage.getItem('trading-network-config');
                const systemConfig = localStorage.getItem('system-config');
                
                if (tradingConfig) {
                    log(container, '‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è trading-network-config:', 'success');
                    const parsed = JSON.parse(tradingConfig);
                    log(container, `<pre>${JSON.stringify(parsed, null, 2)}</pre>`);
                    
                    // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    log(container, '<h3>üìä –ê–Ω–∞–ª–∏–∑:</h3>', 'info');
                    log(container, `üåê baseUrl: ${parsed.baseUrl || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}`, parsed.baseUrl ? 'success' : 'error');
                    log(container, `üîë systemId: ${parsed.systemId || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}`, parsed.systemId ? 'success' : 'error');
                    log(container, `üè¢ defaultStationId: ${parsed.defaultStationId || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}`, parsed.defaultStationId ? 'success' : 'error');
                    log(container, `üîê authType: ${parsed.authType || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}`, parsed.authType ? 'success' : 'error');
                    log(container, `üéØ endpoints.tanks: ${parsed.endpoints?.tanks || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}`, parsed.endpoints?.tanks ? 'success' : 'error');
                    log(container, `ü™ô apiKey: ${parsed.apiKey ? '–£–°–¢–ê–ù–û–í–õ–ï–ù (' + parsed.apiKey.substring(0, 20) + '...)' : '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}`, parsed.apiKey ? 'success' : 'error');
                    
                } else {
                    log(container, '‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è trading-network-config –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ localStorage', 'error');
                }
                
                if (systemConfig) {
                    log(container, '‚úÖ –ù–∞–π–¥–µ–Ω–∞ system-config:', 'success');
                    log(container, `<pre>${systemConfig.substring(0, 500)}...</pre>`);
                }
                
            } catch (error) {
                log(container, `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ localStorage: ${error.message}`, 'error');
            }
        }

        function testDifferentPaths() {
            const container = 'pathTestResult';
            document.getElementById(container).innerHTML = '';
            
            log(container, 'üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –∫ API...', 'warning');
            
            const baseUrl = 'https://pos.autooplata.ru/tms';
            const params = 'system=15&station=4';
            
            const pathsToTest = [
                '/tanks',
                '/v1/tanks',
                '/v2/tanks', 
                '/api/tanks',
                '/tms/tanks',
                '/data/tanks',
                '/rest/tanks'
            ];
            
            log(container, '<h3>üéØ –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ URL:</h3>', 'info');
            
            pathsToTest.forEach((path, index) => {
                const fullUrl = `${baseUrl}${path}?${params}`;
                log(container, `${index + 1}. ${fullUrl}`, 'info');
            });
            
            log(container, '<p class="warning">‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã CORS. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!</p>');
        }

        function updateConfig() {
            const container = 'updateResult';
            document.getElementById(container).innerHTML = '';
            
            log(container, 'üîß –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...', 'warning');
            
            const correctConfig = {
                enabled: true,
                baseUrl: 'https://pos.autooplata.ru/tms',
                systemId: '15',
                defaultStationId: '4',
                authType: 'bearer',
                apiKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpbiI6eyJpZCI6IkFDQ0FFNDA4LTYzMzItNDI0NS04NUIxLTI1RjkxNEYzQkQ2NCIsIm5hbWUiOiJVc2VyVGVzdCIsInJvbGUiOjB9LCJ1c2VyIjp7ImlkIjoiQUNDQUU0MDgtNjMzMi00MjQ1LTg1QjEtMjVGOTE0RjNCRDY0IiwibmFtZSI6IlVzZXJUZXN0In0sImV4cCI6MTc1NzE1NzkzN30.7fDPBwtWej80K2ePRXYKXsJH3b3pLSUqtjo2uIbyXEE',
                timeout: 30000,
                retryAttempts: 3,
                endpoints: {
                    tanks: '/tanks',  // –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨ –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–£–¢–¨!
                    transactions: '/transactions'
                }
            };
            
            log(container, 'üìã –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:', 'success');
            log(container, `<pre>${JSON.stringify(correctConfig, null, 2)}</pre>`);
            
            try {
                localStorage.setItem('trading-network-config', JSON.stringify(correctConfig));
                log(container, '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage', 'success');
                log(container, 'üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π', 'warning');
                
            } catch (error) {
                log(container, `‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkLocalStorage();
        };
    </script>
</body>
</html>