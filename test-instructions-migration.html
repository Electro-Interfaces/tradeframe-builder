<!DOCTYPE html>
<html>
<head>
    <title>Test Instructions Migration</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #fde8e8; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        .warning { background: #fff3e0; border-color: #ff9800; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; font-size: 12px; max-height: 400px; }
        .button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            margin: 10px 5px; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .button:hover { background: #45a049; }
        .button.secondary { background: #2196f3; }
        .button.secondary:hover { background: #1976d2; }
    </style>
</head>
<body>
    <h1>‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</h1>
    
    <div class="test success">
        <h3>üéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!</h3>
        <p>‚úÖ URL Supabase –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç</p>
        <p>‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã</p>
        <p>‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3005</p>
    </div>
    
    <div class="test">
        <h3>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
        <button class="button" onclick="openInstructions()">üìÑ –û–¢–ö–†–´–¢–¨ –ò–ù–°–¢–†–£–ö–¶–ò–ò</button>
        <button class="button secondary" onclick="runMigrationTest()">üîÑ –¢–ï–°–¢ –ú–ò–ì–†–ê–¶–ò–ò</button>
    </div>

    <div class="test info">
        <h3>üìã –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>
        <ol>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</li>
            <li>–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∑–µ–ª–µ–Ω—ã–µ</li>
            <li>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ LocalStorage —Ä–µ–∂–∏–º - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Supabase" - –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏—è</li>
            <li>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ Database —Ä–µ–∂–∏–º - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è!</li>
        </ol>
    </div>

    <div id="results"></div>

    <script>
        function addResult(title, type, data) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        window.openInstructions = function() {
            window.open('http://localhost:3005/admin/instructions', '_blank');
            addResult('üìÑ Instructions Page Opened', 'success', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ—Ç–∫—Ä—ã—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é.');
        };

        window.runMigrationTest = function() {
            const migrationCode = `
// –í–´–ü–û–õ–ù–ò–¢–ï –í –ö–û–ù–°–û–õ–ò –ë–†–ê–£–ó–ï–†–ê (F12):

console.log('üöÄ Starting migration test...');

try {
  // 1. Check localStorage data
  const instructionKeys = Object.keys(localStorage).filter(k => k.includes('instruction'));
  console.log('Found localStorage keys:', instructionKeys);

  // 2. Import services
  const dbService = await import('/src/services/instructionsServiceDatabase.ts');
  const localService = await import('/src/services/instructionsService.ts');

  // 3. Get localStorage data
  const topics = await localService.instructionsService.getTopics();
  console.log('LocalStorage topics:', topics.length);

  // 4. Get versions
  const allVersions = [];
  for (const topic of topics) {
    const versions = await localService.instructionsService.getVersions(topic.id);
    allVersions.push(...versions);
  }
  console.log('LocalStorage versions:', allVersions.length);

  // 5. Execute migration
  console.log('Starting migration to database...');
  await dbService.InstructionsService.migrateMockData(topics, allVersions);
  console.log('‚úÖ Migration completed!');

  // 6. Verify database
  const dbTopics = await dbService.InstructionsService.getTopics();
  console.log('Database topics after migration:', dbTopics.length);

  if (dbTopics.length > 0) {
    console.log('‚úÖ SUCCESS: Migration completed successfully!');
  } else {
    console.log('‚ùå WARNING: No topics found in database after migration');
  }

} catch (error) {
  console.error('‚ùå Migration failed:', error);
}
`;

            addResult('üîß Migration Test Code', 'info', migrationCode);
        };
    </script>
</body>
</html>
