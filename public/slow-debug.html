<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>üêå Slow Debug - TradeFrame</title>
  
  <!-- –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; media-src 'self'; object-src 'none'; frame-src 'none';" />
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #1e293b;
      color: white;
      padding: 20px;
      margin: 0;
      line-height: 1.6;
    }
    
    .debug-container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .step {
      background: rgba(255, 255, 255, 0.1);
      margin: 15px 0;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #6b7280;
      transition: all 0.3s ease;
    }
    
    .step.active {
      border-left-color: #3b82f6;
      background: rgba(59, 130, 246, 0.2);
      transform: scale(1.02);
    }
    
    .step.success {
      border-left-color: #22c55e;
      background: rgba(34, 197, 94, 0.2);
    }
    
    .step.error {
      border-left-color: #ef4444;
      background: rgba(239, 68, 68, 0.2);
    }
    
    .step-title {
      font-weight: bold;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .step-details {
      font-size: 14px;
      opacity: 0.8;
      font-family: monospace;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 4px;
      margin-top: 8px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .progress-bar {
      width: 100%;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .error-log {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid #ef4444;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
    }
    
    .btn {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .btn:hover { background: #2563eb; }
    .btn.danger { background: #ef4444; }
    .btn.danger:hover { background: #dc2626; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: pulse 1s infinite;
    }
    
    h1 { text-align: center; margin-bottom: 30px; }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1>üêå –ú–µ–¥–ª–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ TradeFrame</h1>
    <p style="text-align: center; opacity: 0.8;">–ö–∞–∂–¥—ã–π —à–∞–≥ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progress"></div>
    </div>
    
    <div id="steps-container">
      <!-- Steps will be added here dynamically -->
    </div>
    
    <div id="error-log" class="error-log" style="display: none;">
      <h3>üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:</h3>
      <div id="error-list"></div>
    </div>
  </div>

  <div class="controls">
    <button class="btn" onclick="saveDebugLog()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥</button>
    <button class="btn" onclick="copyDebugLog()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="btn danger" onclick="startSlowTest()">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫</button>
  </div>

  <script>
    let debugSteps = [];
    let currentStep = 0;
    let errors = [];
    let startTime = Date.now();
    let debugLog = [];

    const steps = [
      { id: 'init', title: 'üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è', description: '–ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...' },
      { id: 'html', title: 'üìÑ HTML –∑–∞–≥—Ä—É–∂–µ–Ω', description: '–ü–∞—Ä—Å–∏–Ω–≥ HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞' },
      { id: 'browser', title: 'üîç –ê–Ω–∞–ª–∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞', description: '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±—Ä–∞—É–∑–µ—Ä–∞' },
      { id: 'csp', title: 'üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ CSP', description: '–ê–Ω–∞–ª–∏–∑ Content Security Policy' },
      { id: 'storage', title: 'üíæ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞', description: '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ localStorage –∏ sessionStorage' },
      { id: 'network', title: 'üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏', description: '–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ HTTPS' },
      { id: 'react-start', title: '‚öõÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ React', description: '–ò–º–ø–æ—Ä—Ç React –±–∏–±–ª–∏–æ—Ç–µ–∫–∏' },
      { id: 'app-import', title: 'üì¶ –ò–º–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤', description: '–ó–∞–≥—Ä—É–∑–∫–∞ App –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞' },
      { id: 'css-import', title: 'üé® –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª–µ–π', description: '–ò–º–ø–æ—Ä—Ç CSS —Ñ–∞–π–ª–æ–≤' },
      { id: 'root-create', title: 'üå≥ –°–æ–∑–¥–∞–Ω–∏–µ Root', description: '–°–æ–∑–¥–∞–Ω–∏–µ React root —ç–ª–µ–º–µ–Ω—Ç–∞' },
      { id: 'render', title: 'üñºÔ∏è –†–µ–Ω–¥–µ—Ä–∏–Ω–≥', description: '–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è' },
      { id: 'complete', title: '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ', description: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ' }
    ];

    function addStep(step) {
      const container = document.getElementById('steps-container');
      const stepEl = document.createElement('div');
      stepEl.className = 'step';
      stepEl.id = `step-${step.id}`;
      
      stepEl.innerHTML = `
        <div class="step-title">
          <span>${step.title}</span>
          <span id="status-${step.id}" style="margin-left: auto;">‚è≥</span>
        </div>
        <div>${step.description}</div>
        <div class="step-details" id="details-${step.id}" style="display: none;"></div>
      `;
      
      container.appendChild(stepEl);
    }

    function updateStep(stepId, status, details = '') {
      const stepEl = document.getElementById(`step-${stepId}`);
      const statusEl = document.getElementById(`status-${stepId}`);
      const detailsEl = document.getElementById(`details-${stepId}`);
      
      if (!stepEl) return;
      
      stepEl.classList.remove('active', 'success', 'error', 'loading');
      
      switch (status) {
        case 'active':
          stepEl.classList.add('active', 'loading');
          statusEl.textContent = 'üîÑ';
          break;
        case 'success':
          stepEl.classList.add('success');
          statusEl.textContent = '‚úÖ';
          break;
        case 'error':
          stepEl.classList.add('error');
          statusEl.textContent = '‚ùå';
          break;
      }
      
      if (details) {
        detailsEl.style.display = 'block';
        detailsEl.textContent = details;
      }
      
      const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
      debugLog.push({
        step: stepId,
        status: status,
        time: elapsed,
        details: details,
        timestamp: new Date().toISOString()
      });
    }

    function updateProgress(percent) {
      document.getElementById('progress').style.width = percent + '%';
    }

    function addError(error) {
      errors.push(error);
      const errorLog = document.getElementById('error-log');
      const errorList = document.getElementById('error-list');
      
      errorLog.style.display = 'block';
      
      const errorEl = document.createElement('div');
      errorEl.style.marginBottom = '10px';
      errorEl.style.padding = '8px';
      errorEl.style.background = 'rgba(0, 0, 0, 0.3)';
      errorEl.style.borderRadius = '4px';
      errorEl.innerHTML = `
        <div><strong>[${new Date().toLocaleTimeString()}]</strong> ${error.type}</div>
        <div style="font-family: monospace; font-size: 12px; opacity: 0.8;">${error.message}</div>
      `;
      
      errorList.appendChild(errorEl);
    }

    async function runSlowDiagnostics() {
      startTime = Date.now();
      debugLog = [];
      errors = [];
      
      // Initialize steps
      steps.forEach(step => addStep(step));
      
      for (let i = 0; i < steps.length; i++) {
        const step = steps[i];
        currentStep = i;
        
        updateProgress((i / steps.length) * 100);
        updateStep(step.id, 'active');
        
        try {
          await executeStep(step);
          updateStep(step.id, 'success', await getStepDetails(step));
        } catch (error) {
          updateStep(step.id, 'error', error.message);
          addError({ type: step.title, message: error.message });
        }
        
        // –ü–∞—É–∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
        if (i < steps.length - 1) {
          await new Promise(resolve => setTimeout(resolve, 3000));
        }
      }
      
      updateProgress(100);
    }

    async function executeStep(step) {
      switch (step.id) {
        case 'init':
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
          break;
          
        case 'html':
          if (!document.getElementById('steps-container')) {
            throw new Error('HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ–ø–æ–ª–Ω–∞—è');
          }
          break;
          
        case 'browser':
          // –ê–Ω–∞–ª–∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ getStepDetails
          break;
          
        case 'csp':
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ CSP
          try {
            eval('1+1'); // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ eval
          } catch (e) {
            if (e.name === 'EvalError') {
              throw new Error('CSP –±–ª–æ–∫–∏—Ä—É–µ—Ç eval()');
            }
          }
          break;
          
        case 'storage':
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
          try {
            localStorage.setItem('__test__', 'test');
            localStorage.removeItem('__test__');
          } catch (e) {
            throw new Error('localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + e.message);
          }
          
          try {
            sessionStorage.setItem('__test__', 'test');
            sessionStorage.removeItem('__test__');
          } catch (e) {
            throw new Error('sessionStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + e.message);
          }
          break;
          
        case 'network':
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
          const isSecure = window.location.protocol === 'https:' || window.location.hostname === 'localhost';
          if (!isSecure) {
            throw new Error('–ù–µ secure context (–Ω–µ HTTPS)');
          }
          
          if (!navigator.onLine) {
            throw new Error('–ë—Ä–∞—É–∑–µ—Ä –≤ offline —Ä–µ–∂–∏–º–µ');
          }
          break;
          
        case 'react-start':
          // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ React (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ –±—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç)
          if (typeof window.React === 'undefined') {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∏–º–ø–æ—Ä—Ç React
            console.log('React –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω...');
          }
          break;
          
        case 'app-import':
          // –ò–º–∏—Ç–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ App –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
          console.log('App –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –±—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω...');
          break;
          
        case 'css-import':
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∏–ª–µ–π
          const styles = document.querySelectorAll('style, link[rel="stylesheet"]');
          if (styles.length === 0) {
            throw new Error('–°—Ç–∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
          }
          break;
          
        case 'root-create':
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è root —ç–ª–µ–º–µ–Ω—Ç–∞
          const rootEl = document.getElementById('root') || document.getElementById('steps-container').parentElement;
          if (!rootEl) {
            throw new Error('Root —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }
          break;
          
        case 'render':
          // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
          console.log('–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
          break;
          
        case 'complete':
          // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
          break;
      }
    }

    async function getStepDetails(step) {
      const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
      
      switch (step.id) {
        case 'init':
          return `–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: ${elapsed}s`;
          
        case 'html':
          return `DOM elements: ${document.querySelectorAll('*').length}`;
          
        case 'browser':
          return `UA: ${navigator.userAgent.substring(0, 50)}...
Viewport: ${window.innerWidth}x${window.innerHeight}
Platform: ${navigator.platform}
Language: ${navigator.language}
Memory: ${navigator.deviceMemory || 'unknown'} GB
Connection: ${navigator.connection?.effectiveType || 'unknown'}`;
          
        case 'csp':
          return `Inline scripts: —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
Eval: —Ä–∞–∑—Ä–µ—à–µ–Ω
Unsafe-inline: —Ä–∞–∑—Ä–µ—à–µ–Ω`;
          
        case 'storage':
          return `localStorage: –¥–æ—Å—Ç—É–ø–µ–Ω (${Object.keys(localStorage).length} –∫–ª—é—á–µ–π)
sessionStorage: –¥–æ—Å—Ç—É–ø–µ–Ω (${Object.keys(sessionStorage).length} –∫–ª—é—á–µ–π)
IndexedDB: ${window.indexedDB ? '–¥–æ—Å—Ç—É–ø–µ–Ω' : '–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}`;
          
        case 'network':
          return `Protocol: ${window.location.protocol}
Host: ${window.location.host}
Online: ${navigator.onLine}
Connection: ${navigator.connection?.effectiveType || 'unknown'}`;
          
        case 'react-start':
          return `React: ${typeof window.React !== 'undefined' ? '–∑–∞–≥—Ä—É–∂–µ–Ω' : '–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω'}
ReactDOM: ${typeof window.ReactDOM !== 'undefined' ? '–∑–∞–≥—Ä—É–∂–µ–Ω' : '–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω'}`;
          
        case 'app-import':
          return `–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: –±—É–¥—É—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
Chunks: –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã
Dependencies: –±—É–¥—É—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω—ã`;
          
        case 'css-import':
          const styleCount = document.querySelectorAll('style, link[rel="stylesheet"]').length;
          return `Styles: ${styleCount} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
Tailwind: –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω
Custom CSS: –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω`;
          
        case 'root-create':
          return `Root element: –Ω–∞–π–¥–µ–Ω
React.createRoot: –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω
DOM ready: –¥–∞`;
          
        case 'render':
          return `Components: –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã
Virtual DOM: —Å–æ–∑–¥–∞–Ω
Event listeners: –ø–æ–¥–∫–ª—é—á–µ–Ω—ã`;
          
        case 'complete':
          return `–û–±—â–µ–µ –≤—Ä–µ–º—è: ${elapsed}s
–û—à–∏–±–∫–∏: ${errors.length}
–°—Ç–∞—Ç—É—Å: ${errors.length === 0 ? '—É—Å–ø–µ—à–Ω–æ' : '—Å –æ—à–∏–±–∫–∞–º–∏'}`;
          
        default:
          return `–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${elapsed}s`;
      }
    }

    function saveDebugLog() {
      const logData = {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        viewport: `${window.innerWidth}x${window.innerHeight}`,
        errors: errors,
        steps: debugLog,
        totalTime: ((Date.now() - startTime) / 1000).toFixed(1) + 's'
      };
      
      const blob = new Blob([JSON.stringify(logData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `tradeframe-debug-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function copyDebugLog() {
      const summary = debugLog.map(entry => 
        `[${entry.time}s] ${entry.step}: ${entry.status}${entry.details ? ' - ' + entry.details.split('\n')[0] : ''}`
      ).join('\n');
      
      const fullLog = `TradeFrame Debug Log
Timestamp: ${new Date().toISOString()}
User Agent: ${navigator.userAgent}
Viewport: ${window.innerWidth}x${window.innerHeight}
Errors: ${errors.length}

Steps:
${summary}

${errors.length > 0 ? '\nErrors:\n' + errors.map(e => `${e.type}: ${e.message}`).join('\n') : ''}`;
      
      navigator.clipboard.writeText(fullLog).then(() => {
        alert('–õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      });
    }

    function startSlowTest() {
      document.getElementById('steps-container').innerHTML = '';
      document.getElementById('error-log').style.display = 'none';
      document.getElementById('error-list').innerHTML = '';
      runSlowDiagnostics();
    }

    // –ó–∞—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫
    window.addEventListener('error', (e) => {
      addError({
        type: 'JavaScript Error',
        message: `${e.message} at ${e.filename}:${e.lineno}:${e.colno}`
      });
    });

    window.addEventListener('unhandledrejection', (e) => {
      addError({
        type: 'Promise Rejection',
        message: e.reason?.toString() || 'Unknown promise rejection'
      });
    });

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
      setTimeout(startSlowTest, 1000);
    });
  </script>
</body>
</html>