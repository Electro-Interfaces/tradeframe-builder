<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üõ¢Ô∏è –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —Å–µ—Ç–∏ 15 –ê–ó–° –∫–æ–¥ 4</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        pre { background: #262626; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 400px; }
        h2 { border-bottom: 2px solid #444; padding-bottom: 10px; }
        .tank-card { background: #333; margin: 10px 0; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üõ¢Ô∏è –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç</h1>
    <p><strong>–°–µ—Ç—å:</strong> 15, <strong>–ê–ó–° –∫–æ–¥:</strong> 4</p>
    <div id="results"></div>

    <script type="module">
        import { httpClient } from '/src/services/universalHttpClient.js';
        import { tradingNetworkConfigService } from '/src/services/tradingNetworkConfigService.js';
        
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const className = type;
            results.innerHTML += `<div class="${className}">${message}</div>`;
            console.log(message);
        }

        async function testNetwork15Station4() {
            log('üöÄ –ó–ê–ü–†–û–° –î–ê–ù–ù–´–• –†–ï–ó–ï–†–í–£–ê–†–û–í –°–ï–¢–ò 15 –ê–ó–° –ö–û–î 4', 'info');
            
            try {
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                log('\nüìã –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏...', 'info');
                const config = tradingNetworkConfigService.getConfigSync();
                
                if (!config.enabled) {
                    log('‚ùå –¢–æ—Ä–≥–æ–≤–∞—è —Å–µ—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞!', 'error');
                    return;
                }
                
                if (!config.baseUrl || !config.endpoints?.tanks) {
                    log('‚ùå API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!', 'error');
                    return;
                }
                
                log(`‚úÖ –ë–∞–∑–æ–≤—ã–π URL: ${config.baseUrl}`, 'success');
                log(`‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç: ${config.endpoints.tanks}`, 'success');
                log(`‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: ${config.authType || '–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞'}`, 'success');
                
                // 2. –§–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
                log('\nüì° –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API...', 'info');
                
                const queryParams = {
                    system: '15',    // –°–µ—Ç—å 15
                    station: '4'     // –ê–ó–° –∫–æ–¥ 4
                };
                
                log(`üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:`, 'info');
                log(`   - system: ${queryParams.system}`, 'info');
                log(`   - station: ${queryParams.station}`, 'info');
                log(`üìç –ü–æ–ª–Ω—ã–π URL: ${config.baseUrl}${config.endpoints.tanks}?system=${queryParams.system}&station=${queryParams.station}`, 'info');
                
                // 3. –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
                const response = await httpClient.get(config.endpoints.tanks, {
                    destination: 'external-api',
                    queryParams: queryParams,
                    timeout: 10000
                });
                
                log(`\nüìä –®–∞–≥ 3: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç API...`, 'info');
                log(`üî¢ HTTP —Å—Ç–∞—Ç—É—Å: ${response.status || 'N/A'}`, response.success ? 'success' : 'error');
                log(`‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${response.responseTime}–º—Å`, 'info');
                log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${response.success}`, response.success ? 'success' : 'error');
                
                if (!response.success) {
                    log(`‚ùå –û—à–∏–±–∫–∞ API: ${response.error}`, 'error');
                    if (response.data) {
                        results.innerHTML += '<h2>–î–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:</h2>';
                        results.innerHTML += '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
                    }
                    return;
                }
                
                // 4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤
                if (!response.data || !Array.isArray(response.data)) {
                    log(`‚ùå API –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö`, 'error');
                    results.innerHTML += '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
                    return;
                }
                
                log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${response.data.length}`, 'success');
                results.innerHTML += '<h2>üìä –î–∞–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —Å–µ—Ç–∏ 15 –ê–ó–° –∫–æ–¥ 4:</h2>';
                
                // 5. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞
                response.data.forEach((tank, index) => {
                    const currentVolume = parseFloat(tank.volume_end) || 0;
                    const maxVolume = parseFloat(tank.volume_max) || 0;
                    const levelPercent = maxVolume > 0 ? (currentVolume / maxVolume * 100) : 0;
                    const temperature = parseFloat(tank.temperature) || 0;
                    const density = parseFloat(tank.density) || 0;
                    const waterLevel = parseFloat(tank.water?.level) || 0;
                    
                    results.innerHTML += `
                        <div class="tank-card">
                            <h3>üõ¢Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä ‚Ññ${tank.number}</h3>
                            <p><strong>üìä –û–±—ä–µ–º:</strong> ${Math.round(currentVolume).toLocaleString('ru-RU')}–ª –∏–∑ ${Math.round(maxVolume).toLocaleString('ru-RU')}–ª</p>
                            <p><strong>üìà –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ:</strong> ${Math.round(levelPercent)}% (${levelPercent.toFixed(2)}%)</p>
                            <p><strong>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> ${temperature.toFixed(1)}¬∞C</p>
                            <p><strong>‚öñÔ∏è –ü–ª–æ—Ç–Ω–æ—Å—Ç—å:</strong> ${density.toFixed(2)} –∫–≥/–º¬≥</p>
                            <p><strong>üíß –ü–æ–¥—Ç–æ–≤–∞—Ä–Ω–∞—è –≤–æ–¥–∞:</strong> ${waterLevel.toFixed(1)} –º–º</p>
                            <p><strong>üìÖ –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</strong> ${tank.dt}</p>
                            <p><strong>üîß –°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> ${tank.state === 1 ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</p>
                        </div>
                    `;
                    
                    log(`üõ¢Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä ‚Ññ${tank.number}: ${Math.round(currentVolume).toLocaleString('ru-RU')}–ª/${Math.round(maxVolume).toLocaleString('ru-RU')}–ª (${Math.round(levelPercent)}%)`, 'info');
                });
                
                // 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
                results.innerHTML += '<h2>üìã –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç API:</h2>';
                results.innerHTML += '<pre>' + JSON.stringify(response.data, null, 2) + '</pre>';
                
                log(`\nüéâ –ó–ê–ü–†–û–° –í–´–ü–û–õ–ù–ï–ù –£–°–ü–ï–®–ù–û!`, 'success');
                
            } catch (error) {
                log(`‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
        testNetwork15Station4();
    </script>
</body>
</html>