<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü Supabase</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>üîç –ü–†–û–í–ï–†–ö–ê –¢–ê–ë–õ–ò–¶ –í SUPABASE</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç</p>
    
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        async function checkTables() {
            addLog('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase...', 'info');
            
            try {
                const { httpClient } = await import('/src/services/universalHttpClient.ts');
                
                const tablesToCheck = [
                    'equipment',
                    'equipment_templates', 
                    'components',
                    'component_templates',
                    'tanks',
                    'networks',
                    'trading_points',
                    'operations'
                ];
                
                addLog('üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã:', 'info');
                
                for (const table of tablesToCheck) {
                    try {
                        addLog(`  ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É: ${table}`, 'info');
                        
                        const response = await httpClient.get(`/rest/v1/${table}`, {
                            destination: 'supabase',
                            queryParams: { 
                                select: '*', 
                                limit: '1'
                            }
                        });
                        
                        if (response.success) {
                            const count = Array.isArray(response.data) ? response.data.length : 0;
                            addLog(`    ‚úÖ ${table} - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (${count} –∑–∞–ø–∏—Å–µ–π –≤ –≤—ã–±–æ—Ä–∫–µ)`, 'success');
                        } else {
                            addLog(`    ‚ùå ${table} - –æ—à–∏–±–∫–∞: ${response.error}`, 'error');
                        }
                        
                    } catch (error) {
                        if (error.message.includes('404')) {
                            addLog(`    ‚ùå ${table} - –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ (404)`, 'error');
                        } else {
                            addLog(`    ‚ö†Ô∏è ${table} - –æ—à–∏–±–∫–∞: ${error.message}`, 'warning');
                        }
                    }
                    
                    await new Promise(r => setTimeout(r, 500));
                }
                
                addLog('---', 'info');
                addLog('üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
                
            } catch (error) {
                addLog(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
        checkTables();
    </script>
</body>
</html>