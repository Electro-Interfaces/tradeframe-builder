<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–û–ò–°–ö–ê –¢–û–†–ì–û–í–û–ô –¢–û–ß–ö–ò</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∫–∞–∫–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏–¥–µ—Ç –ø–æ–∏—Å–∫ –∏ —á—Ç–æ –µ—Å—Ç—å –≤ –ë–î</p>
    
    <button onclick="debugTradingPointSearch()">üöÄ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞</button>
    <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    
    <div id="log"></div>

    <script type="module">
        const TARGET_ID = '6969b08d-1cbe-45c2-ae9c-8002c7022b59';
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        window.clearLog = function() {
            log.innerHTML = '';
        }
        
        window.debugTradingPointSearch = async function() {
            addLog('üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–û–ò–°–ö–ê –¢–û–†–ì–û–í–û–ô –¢–û–ß–ö–ò', 'info');
            addLog(`–ò—â–µ–º ID: ${TARGET_ID}`, 'info');
            
            try {
                const { httpClient } = await import('/src/services/universalHttpClient.ts');
                
                // –¢–ï–°–¢ 1: –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ –ë–î
                addLog('üìã –¢–ï–°–¢ 1: –í—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ –ë–î...', 'info');
                
                const allTpResponse = await httpClient.get('/rest/v1/trading_points', {
                    destination: 'supabase',
                    queryParams: {
                        select: 'id,name,external_id,code,network_id',
                        order: 'name'
                    }
                });
                
                if (allTpResponse.success && allTpResponse.data) {
                    addLog(`‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ –ë–î: ${allTpResponse.data.length}`, 'success');
                    
                    allTpResponse.data.forEach((tp, index) => {
                        const isTarget = tp.id === TARGET_ID;
                        addLog(`<div class="code" style="background: ${isTarget ? '#2d4a22' : '#0d1117'};">
                            –¢–ü ${index + 1}: ${tp.name}<br>
                            - ID: ${tp.id} ${isTarget ? 'üéØ –ò–°–ö–û–ú–ê–Ø' : ''}<br>
                            - External ID: ${tp.external_id || '–ù–ï–¢'}<br>
                            - Code: ${tp.code || '–ù–ï–¢'}<br>
                            - Network ID: ${tp.network_id}
                        </div>`, isTarget ? 'success' : 'info');
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏—Å–∫–æ–º–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞
                    const targetExists = allTpResponse.data.some(tp => tp.id === TARGET_ID);
                    if (targetExists) {
                        addLog('‚úÖ –ò—Å–∫–æ–º–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –ù–ê–ô–î–ï–ù–ê –≤ —Å–ø–∏—Å–∫–µ!', 'success');
                    } else {
                        addLog('‚ùå –ò—Å–∫–æ–º–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –ù–ï –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ!', 'error');
                    }
                } else {
                    addLog('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫', 'error');
                    return;
                }
                
                // –¢–ï–°–¢ 2: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ ID (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ç–µ—Å—Ç–µ)
                addLog('üéØ –¢–ï–°–¢ 2: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ ID (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ç–µ—Å—Ç–µ)...', 'info');
                addLog(`–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞: id=eq.${TARGET_ID}`, 'info');
                
                const directSearchResponse = await httpClient.get('/rest/v1/trading_points', {
                    destination: 'supabase',
                    queryParams: {
                        select: 'id,name,external_id,code,network_id',
                        id: `eq.${TARGET_ID}`
                    }
                });
                
                addLog(`<div class="code">
                    Success: ${directSearchResponse.success}<br>
                    Status: ${directSearchResponse.status}<br>
                    Data Length: ${directSearchResponse.data ? directSearchResponse.data.length : 'null'}<br>
                    Error: ${directSearchResponse.error || '–Ω–µ—Ç'}
                </div>`, directSearchResponse.success && directSearchResponse.data?.length > 0 ? 'success' : 'error');
                
                if (directSearchResponse.success && directSearchResponse.data && directSearchResponse.data.length > 0) {
                    addLog('‚úÖ –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ ID —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    const tp = directSearchResponse.data[0];
                    addLog(`<div class="code">
                        –ù–∞–π–¥–µ–Ω–æ:<br>
                        - ID: ${tp.id}<br>
                        - –ù–∞–∑–≤–∞–Ω–∏–µ: ${tp.name}<br>
                        - External ID: ${tp.external_id || '–ù–ï–¢'}<br>
                        - Code: ${tp.code || '–ù–ï–¢'}<br>
                        - Network ID: ${tp.network_id}
                    </div>`, 'success');
                } else {
                    addLog('‚ùå –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ ID –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'error');
                    
                    // –¢–ï–°–¢ 3: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–∏—Å–∫–∞
                    addLog('üîÑ –¢–ï–°–¢ 3: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–∏—Å–∫–∞...', 'info');
                    
                    // –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ LIKE
                    const likeSearchResponse = await httpClient.get('/rest/v1/trading_points', {
                        destination: 'supabase',
                        queryParams: {
                            select: 'id,name,external_id,code,network_id',
                            id: `like.%${TARGET_ID.slice(-8)}%`
                        }
                    });
                    
                    if (likeSearchResponse.success && likeSearchResponse.data && likeSearchResponse.data.length > 0) {
                        addLog('‚úÖ –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ LIKE —Å—Ä–∞–±–æ—Ç–∞–ª!', 'success');
                        likeSearchResponse.data.forEach(tp => {
                            addLog(`- ${tp.name} (ID: ${tp.id})`, 'success');
                        });
                    } else {
                        addLog('‚ùå –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ LIKE —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                    }
                    
                    // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
                    const nameSearchResponse = await httpClient.get('/rest/v1/trading_points', {
                        destination: 'supabase',
                        queryParams: {
                            select: 'id,name,external_id,code,network_id',
                            name: `like.*–ê–ó–°*`
                        }
                    });
                    
                    if (nameSearchResponse.success && nameSearchResponse.data && nameSearchResponse.data.length > 0) {
                        addLog('‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ "–ê–ó–°" —Å—Ä–∞–±–æ—Ç–∞–ª!', 'success');
                        nameSearchResponse.data.forEach(tp => {
                            addLog(`- ${tp.name} (ID: ${tp.id})`, 'success');
                        });
                    }
                }
                
                // –¢–ï–°–¢ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ ID
                addLog('üîé –¢–ï–°–¢ 4: –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ ID...', 'info');
                addLog(`<div class="code">
                    –ò—Å–∫–æ–º—ã–π ID: ${TARGET_ID}<br>
                    –î–ª–∏–Ω–∞: ${TARGET_ID.length} —Å–∏–º–≤–æ–ª–æ–≤<br>
                    –°–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ñ–∏—Å—ã: ${TARGET_ID.includes('-') ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}<br>
                    UUID —Ñ–æ—Ä–º–∞—Ç: ${TARGET_ID.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i) ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}<br>
                    –†–µ–≥–∏—Å—Ç—Ä: ${TARGET_ID === TARGET_ID.toLowerCase() ? '–Ω–∏–∂–Ω–∏–π' : '—Å–º–µ—à–∞–Ω–Ω—ã–π'}
                </div>`, 'info');
                
                // –¢–ï–°–¢ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
                addLog('üèóÔ∏è –¢–ï–°–¢ 5: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã trading_points...', 'info');
                
                const structureResponse = await httpClient.get('/rest/v1/', {
                    destination: 'supabase'
                });
                
                if (structureResponse.success) {
                    addLog('‚úÖ –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    addLog('‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Supabase', 'error');
                }
                
                // –ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢
                addLog('üèÅ –ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó:', 'info');
                
                const targetFound = allTpResponse.data && allTpResponse.data.some(tp => tp.id === TARGET_ID);
                if (targetFound) {
                    addLog('‚úÖ –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –°–£–©–ï–°–¢–í–£–ï–¢ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'success');
                    addLog('‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ –∑–∞–ø—Ä–æ—Å–∞', 'error');
                    addLog('üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è query parameters', 'warning');
                } else {
                    addLog('‚ùå –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
                    addLog('üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö ID —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫', 'warning');
                }
                
            } catch (error) {
                addLog(`üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
                addLog(`<div class="code">${error.stack}</div>`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...', 'info');
        setTimeout(debugTradingPointSearch, 1000);
    </script>
</body>
</html>