<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Debug Equipment API</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîß DEBUG EQUIPMENT API</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Equipment API</p>
    
    <div>
        <button onclick="testEquipmentAPI()">üîç –¢–µ—Å—Ç Equipment API</button>
        <button onclick="testDirectSupabase()">üì° –ü—Ä—è–º–æ–π Supabase –∑–∞–ø—Ä–æ—Å</button>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        let currentEquipmentAPI = null;
        let supabase = null;
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        window.clearLog = function() {
            log.innerHTML = '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function initialize() {
            try {
                const apiSwitchImports = await import('/src/services/apiSwitch.ts');
                currentEquipmentAPI = apiSwitchImports.currentEquipmentAPI;
                
                const supabaseImports = await import('/src/services/supabaseClientBrowser.ts');
                supabase = supabaseImports.supabase;
                
                addLog('‚úÖ API —Å–µ—Ä–≤–∏—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                console.error('Initialization error:', error);
            }
        }
        
        // –¢–µ—Å—Ç Equipment API
        window.testEquipmentAPI = async function() {
            addLog('üîç –¢–ï–°–¢ EQUIPMENT API', 'info');
            
            try {
                addLog('üìû –í—ã–∑—ã–≤–∞–µ–º currentEquipmentAPI.list({trading_point_id: "6969b08d-1cbe-45c2-ae9c-8002c7022b59"})...', 'info');
                
                const result = await currentEquipmentAPI.list({
                    trading_point_id: "6969b08d-1cbe-45c2-ae9c-8002c7022b59"
                });
                
                addLog(`<div class="code">
                    ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢ EQUIPMENT API:<br>
                    Type: ${typeof result}<br>
                    Has .data: ${result.hasOwnProperty('data')}<br>
                    Has .error: ${result.hasOwnProperty('error')}<br>
                    Data is array: ${Array.isArray(result.data)}<br>
                    Data length: ${result.data?.length || 0}<br>
                    Structure: ${JSON.stringify(Object.keys(result), null, 2)}<br>
                    <br>
                    Methods available:<br>
                    ${Object.getOwnPropertyNames(Object.getPrototypeOf(result)).filter(name => typeof result[name] === 'function').join(', ')}
                </div>`, 'success');
                
                if (result.data && result.data.length > 0) {
                    addLog(`<div class="code">
                        –ü–ï–†–í–ê–Ø –ó–ê–ü–ò–°–¨:<br>
                        ${JSON.stringify(result.data[0], null, 2).slice(0, 500)}...
                    </div>`, 'info');
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ Equipment API: ${error.message}`, 'error');
                console.error('Equipment API error:', error);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–∏—à–ª–æ –≤ –æ—à–∏–±–∫–µ
                if (error.toString().includes('query.eq is not a function')) {
                    addLog('üö® –ù–ê–ô–î–ï–ù–ê –û–®–ò–ë–ö–ê: query.eq is not a function - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è query builder –≤–º–µ—Å—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞!', 'error');
                }
            }
        }
        
        // –ü—Ä—è–º–æ–π Supabase –∑–∞–ø—Ä–æ—Å
        window.testDirectSupabase = async function() {
            addLog('üì° –ü–†–Ø–ú–û–ô SUPABASE –ó–ê–ü–†–û–°', 'info');
            
            try {
                addLog('üìû –í—ã–∑—ã–≤–∞–µ–º supabase.from("equipment").select("*").eq("trading_point_id", "6969b08d-1cbe-45c2-ae9c-8002c7022b59")...', 'info');
                
                const query = supabase
                    .from('equipment')
                    .select('*')
                    .eq('trading_point_id', '6969b08d-1cbe-45c2-ae9c-8002c7022b59');
                    
                addLog(`<div class="code">
                    QUERY BUILDER:<br>
                    Type: ${typeof query}<br>
                    Has .eq: ${typeof query.eq === 'function'}<br>
                    Methods: ${Object.getOwnPropertyNames(Object.getPrototypeOf(query)).filter(name => typeof query[name] === 'function').slice(0, 10).join(', ')}...
                </div>`, 'info');
                
                const { data, error } = await query;
                
                if (error) {
                    addLog(`‚ùå Supabase error: ${error.message}`, 'error');
                    return;
                }
                
                addLog(`<div class="code">
                    ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢ SUPABASE:<br>
                    Data type: ${typeof data}<br>
                    Is array: ${Array.isArray(data)}<br>
                    Length: ${data?.length || 0}
                </div>`, 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
                console.error('Direct Supabase error:', error);
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ Debug Equipment API –∑–∞–≥—Ä—É–∂–µ–Ω', 'info');
        initialize();
    </script>
</body>
</html>