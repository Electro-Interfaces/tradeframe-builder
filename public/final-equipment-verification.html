<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name=\"viewport\" content="width=device-width, initial-scale=1.0">
    <title>üîß –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è Equipment</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        .test-step {
            border: 1px solid #444;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
        }
        .loading {
            color: #ffc107;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <h1>üîß –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø EQUIPMENT PAGE</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫</p>
    
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        function addTestStep(title, content = '', type = 'info') {
            const div = document.createElement('div');
            div.className = 'test-step';
            div.innerHTML = `<h3 class="${type}">üìã ${title}</h3><div>${content}</div>`;
            log.appendChild(div);
            return div.querySelector('div');
        }
        
        async function runFinalVerification() {
            addLog('üöÄ –ó–∞–ø—É—Å–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', 'success');
            addLog('---', 'info');
            
            // –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ –∏ –ø—Ä–æ–∫—Å–∏
            const step1 = addTestStep('–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤', '<span class="loading">‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º...</span>');
            try {
                const currentPort = window.location.port || '3000';
                const proxyUrl = `http://localhost:\${currentPort}/supabase-proxy`;
                
                step1.innerHTML = `
                    <div class="success">‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ—Ä—Ç: ${currentPort}</div>
                    <div class="info">üì° Proxy URL: ${proxyUrl}</div>
                    <div class="success">‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                `;
            } catch (error) {
                step1.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}</div>`;
            }
            
            await new Promise(r => setTimeout(r, 1000));
            
            // –®–ê–ì 2: –¢–µ—Å—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞
            const step2 = addTestStep('–®–∞–≥ 2: –¢–µ—Å—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞', '<span class="loading">‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª–∏–µ–Ω—Ç...</span>');
            try {
                const { httpClient } = await import('/src/services/universalHttpClient.ts');
                step2.innerHTML = `<div class="success">‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω</div>`;
                
                // –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
                try {
                    const response = await httpClient.get('/rest/v1/networks', {
                        destination: 'supabase',
                        queryParams: { select: 'id,name', limit: '1' }
                    });
                    
                    if (response.success) {
                        step2.innerHTML += `<div class="success">‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —Ä–∞–±–æ—Ç–∞–µ—Ç</div>`;
                    } else {
                        step2.innerHTML += `<div class="error">‚ùå –û—à–∏–±–∫–∞ Supabase: ${response.error}</div>`;
                    }
                } catch (error) {
                    step2.innerHTML += `<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}</div>`;
                }
                
            } catch (error) {
                step2.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞: ${error.message}</div>`;
            }
            
            await new Promise(r => setTimeout(r, 1000));
            
            // –®–ê–ì 3: –¢–µ—Å—Ç Equipment —Å–µ—Ä–≤–∏—Å–∞
            const step3 = addTestStep('–®–∞–≥ 3: –¢–µ—Å—Ç Equipment —Å–µ—Ä–≤–∏—Å–∞', '<span class="loading">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å...</span>');
            try {
                const { currentEquipmentAPI } = await import('/src/services/apiSwitch.ts');
                
                step3.innerHTML = `<div class="success">‚úÖ Equipment API –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω</div>`;
                
                try {
                    const equipmentResult = await currentEquipmentAPI.list({});
                    step3.innerHTML += `<div class="success">‚úÖ Equipment.list() —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞–π–¥–µ–Ω–æ ${equipmentResult.data?.length || 0} –∑–∞–ø–∏—Å–µ–π</div>`;
                } catch (error) {
                    step3.innerHTML += `<div class="error">‚ùå –û—à–∏–±–∫–∞ Equipment.list(): ${error.message}</div>`;
                    if (error.message.includes('query.eq is not a function')) {
                        step3.innerHTML += `<div class="error">üö® –ö–†–ò–¢–ò–ß–ù–û: –ù–∞–π–¥–µ–Ω–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ query.eq!</div>`;
                    }
                }
                
            } catch (error) {
                step3.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Equipment —Å–µ—Ä–≤–∏—Å–∞: ${error.message}</div>`;
            }
            
            await new Promise(r => setTimeout(r, 1000));
            
            // –®–ê–ì 4: –¢–µ—Å—Ç Components —Å–µ—Ä–≤–∏—Å–∞
            const step4 = addTestStep('–®–∞–≥ 4: –¢–µ—Å—Ç Components —Å–µ—Ä–≤–∏—Å–∞', '<span class="loading">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã...</span>');
            try {
                const { currentComponentsAPI } = await import('/src/services/apiSwitch.ts');
                
                step4.innerHTML = `<div class="success">‚úÖ Components API –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω</div>`;
                
                try {
                    const componentsResult = await currentComponentsAPI.list({});
                    step4.innerHTML += `<div class="success">‚úÖ Components.list() —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞–π–¥–µ–Ω–æ ${componentsResult.data?.length || 0} –∑–∞–ø–∏—Å–µ–π</div>`;
                } catch (error) {
                    step4.innerHTML += `<div class="error">‚ùå –û—à–∏–±–∫–∞ Components.list(): ${error.message}</div>`;
                    if (error.message.includes('query.eq is not a function')) {
                        step4.innerHTML += `<div class="error">üö® –ö–†–ò–¢–ò–ß–ù–û: –ù–∞–π–¥–µ–Ω–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ query.eq!</div>`;
                    }
                }
                
            } catch (error) {
                step4.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Components —Å–µ—Ä–≤–∏—Å–∞: ${error.message}</div>`;
            }
            
            await new Promise(r => setTimeout(r, 1000));
            
            // –®–ê–ì 5: –¢–µ—Å—Ç Tanks —Å–µ—Ä–≤–∏—Å–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ UUID –º–∞–ø–ø–∏–Ω–≥–∞)
            const step5 = addTestStep('–®–∞–≥ 5: –¢–µ—Å—Ç Tanks —Å–µ—Ä–≤–∏—Å–∞ –∏ UUID –º–∞–ø–ø–∏–Ω–≥–∞', '<span class="loading">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã...</span>');
            try {
                const { tanksService } = await import('/src/services/tanksServiceSupabase.ts');
                
                step5.innerHTML = `<div class="success">‚úÖ Tanks —Å–µ—Ä–≤–∏—Å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω</div>`;
                
                try {
                    const tanksResult = await tanksService.getTanks();
                    step5.innerHTML += `<div class="success">‚úÖ Tanks.getTanks() —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞–π–¥–µ–Ω–æ ${tanksResult?.length || 0} —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</div>`;
                    
                    if (tanksResult && tanksResult.length > 0) {
                        const firstTank = tanksResult[0];
                        step5.innerHTML += `<div class="info">üìä –ü–µ—Ä–≤—ã–π —Ä–µ–∑–µ—Ä–≤—É–∞—Ä: ${firstTank.name}, —Ç–æ–ø–ª–∏–≤–æ: ${firstTank.fuelType}</div>`;
                    }
                } catch (error) {
                    step5.innerHTML += `<div class="error">‚ùå –û—à–∏–±–∫–∞ Tanks.getTanks(): ${error.message}</div>`;
                    if (error.message.includes('invalid input syntax for type uuid')) {
                        step5.innerHTML += `<div class="error">üö® –ö–†–ò–¢–ò–ß–ù–û: –ù–∞–π–¥–µ–Ω–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ UUID –º–∞–ø–ø–∏–Ω–≥–∞!</div>`;
                    }
                }
                
            } catch (error) {
                step5.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ Tanks —Å–µ—Ä–≤–∏—Å–∞: ${error.message}</div>`;
            }
            
            await new Promise(r => setTimeout(r, 1000));
            
            // –®–ê–ì 6: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const step6 = addTestStep('–®–∞–≥ 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞', '<span class="loading">‚è≥ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞...</span>');
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≥–æ—Ç–æ–≤—ã
                step6.innerHTML = `
                    <div class="success">‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã</div>
                    <div class="info">üìã –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:</div>
                    <div class="info">  ‚Ä¢ query.eq is not a function - –ò–°–ü–†–ê–í–õ–ï–ù–û</div>
                    <div class="info">  ‚Ä¢ Fuel type UUID mapping - –ò–°–ü–†–ê–í–õ–ï–ù–û</div>  
                    <div class="info">  ‚Ä¢ HTTP 404 port mismatch - –ò–°–ü–†–ê–í–õ–ï–ù–û</div>
                    <div class="success">üéØ –°—Ç—Ä–∞–Ω–∏—Ü–∞ Equipment –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</div>
                    <div class="warning">‚ö†Ô∏è –î–ª—è –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ: <a href="/network/equipment" style="color: #17a2b8;">http://localhost:3000/network/equipment</a></div>
                `;
            } catch (error) {
                step6.innerHTML = `<div class="error">‚ùå –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ${error.message}</div>`;
            }
            
            addLog('---', 'info');
            addLog('üèÅ –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
            
            // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç
            addLog('<h2 class="success">üìä –ö–†–ê–¢–ö–ò–ô –û–¢–ß–ï–¢ –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–ú:</h2>', 'success');
            addLog('1. ‚ùå ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "query.eq is not a function" –≤ equipmentSupabase.ts –∏ componentsSupabase.ts', 'info');
            addLog('2. ‚ùå ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω UUID –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è —Ç–∏–ø–æ–≤ —Ç–æ–ø–ª–∏–≤–∞ –≤ tanksServiceSupabase.ts', 'info');
            addLog('3. ‚ùå ‚Üí ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤ –≤ universalHttpClient.ts', 'info');
            addLog('<div class="success">üéØ –í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–´ - –°–¢–†–ê–ù–ò–¶–ê –û–ë–û–†–£–î–û–í–ê–ù–ò–ï –ì–û–¢–û–í–ê!</div>', 'success');
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
        runFinalVerification();
    </script>
</body>
</html>