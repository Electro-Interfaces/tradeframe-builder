<!DOCTYPE html>
<html>
<head>
    <title>üöÄ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; background: #1e293b; color: white; padding: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .success { background: #10b981; color: white; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .error { background: #dc2626; color: white; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .info { background: #3b82f6; color: white; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .warning { background: #f59e0b; color: black; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .section { background: #374151; padding: 20px; border-radius: 8px; margin: 15px 0; }
        button { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #2563eb; }
        .debug { background: #0f172a; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; overflow-x: auto; margin: 10px 0; }
        .metric { display: inline-block; background: #4b5563; padding: 15px; margin: 10px; border-radius: 8px; text-align: center; min-width: 120px; }
        .metric-label { display: block; font-size: 12px; color: #9ca3af; margin-bottom: 5px; }
        .metric-value { display: block; font-size: 20px; font-weight: bold; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .before, .after { padding: 15px; border-radius: 8px; }
        .before { background: #dc2626; }
        .after { background: #10b981; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π</h1>
        
        <div class="info">
            <h3>‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase –≤ operationsSupabaseService.ts</h3>
            <div class="comparison">
                <div class="before">
                    <h4>‚ùå –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</h4>
                    <p><strong>URL:</strong> https://tohtryzyffcebtyvkxwh.supabase.co</p>
                    <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ù–ï —Ä–∞–±–æ—Ç–∞–ª–∞</p>
                    <p><strong>–ü–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å:</strong> –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (~1,154,246 ‚ÇΩ, 1000+ –æ–ø–µ—Ä–∞—Ü–∏–π)</p>
                </div>
                <div class="after">
                    <h4>‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</h4>
                    <p><strong>URL:</strong> https://dlvggjmirqhmdylfwngm.supabase.co</p>
                    <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å</p>
                    <p><strong>–û–∂–∏–¥–∞–µ—Ç—Å—è:</strong> –î–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø–æ —Å—Ç–∞–Ω—Ü–∏–∏ 4 (~50-80 —Ç—ã—Å—è—á ‚ÇΩ, ~15 –æ–ø–µ—Ä–∞—Ü–∏–π)</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>üß™ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4:</h3>
            <div class="debug">
UUID —Å—Ç–∞–Ω—Ü–∏–∏ 4: 6969b08d-1cbe-45c2-ae9c-8002c7022b59
UUID —Å–µ—Ç–∏ 15:   b5e25b51-a950-481e-a09d-ac25e6b5d6ab
–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–∏:  "–ù–æ—Ä–¥ –õ–∞–π–Ω"

–û–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4:
- –û–ø–µ—Ä–∞—Ü–∏–π: ~15 (–∞–≤–≥—É—Å—Ç 2025)
- –í—ã—Ä—É—á–∫–∞: ~50,000-80,000 ‚ÇΩ
- –¢–æ–ø–ª–∏–≤–æ: ~1,000-1,500 –ª–∏—Ç—Ä–æ–≤
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ~3,000-5,000 ‚ÇΩ
            </div>
        </div>

        <div class="section">
            <h3>üî¨ –¢–µ—Å—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:</h3>
            <button onclick="testDirectSupabaseCall()">üéØ –¢–µ—Å—Ç 1: –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</button>
            <button onclick="testOperationsServiceCall()">üîß –¢–µ—Å—Ç 2: –ß–µ—Ä–µ–∑ operationsSupabaseService</button>
            <button onclick="testSalesAnalysisComponent()">üìä –¢–µ—Å—Ç 3: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç SalesAnalysisSimple</button>
            <button onclick="openMainApp()">üåê –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <button onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const STATION_4_UUID = '6969b08d-1cbe-45c2-ae9c-8002c7022b59';
        const CORRECT_SUPABASE_URL = 'https://dlvggjmirqhmdylfwngm.supabase.co';
        const CORRECT_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdmdnam1pcnFobWR5bGZ3bmdtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNTY5Njg2NSwiZXhwIjoyMDUxMjcyODY1fQ.SLOvfECCNMeWX-V7Hl4mjfyDGfTLUmLF9GCn3R3NfAY';

        window.testDirectSupabaseCall = async function() {
            addResult('üéØ –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏...', 'info');

            try {
                // –°—Ç—Ä–æ–∏–º URL –∑–∞–ø—Ä–æ—Å–∞ —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º operationsSupabaseService
                const endpoint = `${CORRECT_SUPABASE_URL}/rest/v1/operations?select=*&order=start_time.desc&status=eq.completed&trading_point_id=eq.${STATION_4_UUID}&start_time=gte.2025-08-01T00:00:00&start_time=lte.2025-08-31T23:59:59`;
                
                addResult(`üîó –ó–∞–ø—Ä–æ—Å: ${endpoint}`, 'debug');

                const response = await fetch(endpoint, {
                    headers: {
                        'apikey': CORRECT_SERVICE_KEY,
                        'Authorization': `Bearer ${CORRECT_SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                const operationsCount = data?.length || 0;

                // –í—ã—á–∏—Å–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
                const totalRevenue = data?.reduce((sum, op) => sum + (op.total_cost || 0), 0) || 0;
                const totalFuel = data?.reduce((sum, op) => sum + (op.quantity || 0), 0) || 0;
                const avgTicket = operationsCount > 0 ? totalRevenue / operationsCount : 0;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
                if (operationsCount === 0) {
                    addResult('‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning');
                } else if (operationsCount > 50) {
                    addResult('‚ùå –ü–†–û–ë–õ–ï–ú–ê: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π - –≤–æ–∑–º–æ–∂–Ω–æ, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                } else {
                    addResult(`‚úÖ –û–¢–õ–ò–ß–ù–û: –ù–∞–π–¥–µ–Ω–æ ${operationsCount} –æ–ø–µ—Ä–∞—Ü–∏–π - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏
                    const metricsHtml = `
                        <div class="section">
                            <h4>üìä –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–Ω—Ü–∏–∏ 4:</h4>
                            <div class="metric">
                                <span class="metric-label">–û–ø–µ—Ä–∞—Ü–∏–π</span>
                                <span class="metric-value">${operationsCount}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">–í—ã—Ä—É—á–∫–∞</span>
                                <span class="metric-value">${totalRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">–¢–æ–ø–ª–∏–≤–æ</span>
                                <span class="metric-value">${totalFuel.toLocaleString('ru-RU')} –ª</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</span>
                                <span class="metric-value">${avgTicket.toLocaleString('ru-RU')} ‚ÇΩ</span>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('results').innerHTML += metricsHtml;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Å—Ç–∞–Ω—Ü–∏–∏ 4
                const uniqueTradingPoints = [...new Set(data?.map(op => op.trading_point_id).filter(Boolean))];
                if (uniqueTradingPoints.length === 1 && uniqueTradingPoints[0] === STATION_4_UUID) {
                    addResult('‚úÖ –í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Å—Ç–∞–Ω—Ü–∏–∏ 4 - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞!', 'success');
                } else {
                    addResult(`‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–∞–π–¥–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞–Ω—Ü–∏–π: ${uniqueTradingPoints.join(', ')}`, 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞: ${error.message}`, 'error');
            }
        }

        window.testOperationsServiceCall = async function() {
            addResult('üîß –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π operationsSupabaseService (–∏–º–∏—Ç–∞—Ü–∏—è)...', 'info');
            
            // –≠—Ç–æ—Ç —Ç–µ—Å—Ç –∏–º–∏—Ç–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ operationsSupabaseService.getOperations()
            // —Å —Ç–µ–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SalesAnalysisSimple
            
            const filters = {
                tradingPointId: STATION_4_UUID,
                status: 'completed',
                startDate: '2025-08-01',
                endDate: '2025-08-31'
            };

            addResult(`üîß –§–∏–ª—å—Ç—Ä—ã: ${JSON.stringify(filters, null, 2)}`, 'debug');
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É, —á—Ç–æ –≤ operationsSupabaseService
            try {
                let endpoint = `${CORRECT_SUPABASE_URL}/rest/v1/operations?select=*&order=start_time.desc`;
                const params = new URLSearchParams();
                
                params.append('status', `eq.${filters.status}`);
                params.append('trading_point_id', `eq.${filters.tradingPointId}`);
                params.append('start_time', `gte.${filters.startDate}T00:00:00`);
                params.append('start_time', `lte.${filters.endDate}T23:59:59`);
                
                endpoint += '&' + params.toString();
                
                addResult(`üîó –ò—Ç–æ–≥–æ–≤—ã–π URL: ${endpoint}`, 'debug');
                
                const response = await fetch(endpoint, {
                    headers: {
                        'apikey': CORRECT_SERVICE_KEY,
                        'Authorization': `Bearer ${CORRECT_SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const operationsCount = data?.length || 0;

                if (operationsCount > 0 && operationsCount < 50) {
                    addResult(`‚úÖ –û–¢–õ–ò–ß–ù–û: operationsSupabaseService —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ${operationsCount} –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4`, 'success');
                } else if (operationsCount === 0) {
                    addResult('‚ö†Ô∏è operationsSupabaseService –Ω–µ –Ω–∞—à–µ–ª –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4', 'warning');
                } else {
                    addResult(`‚ùå –ü–†–û–ë–õ–ï–ú–ê: operationsSupabaseService –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π (${operationsCount})`, 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞ operationsSupabaseService: ${error.message}`, 'error');
            }
        }

        window.testSalesAnalysisComponent = function() {
            addResult('üìä –¢–µ—Å—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ SalesAnalysisSimple...', 'info');
            addResult('üåê –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏:', 'info');
            addResult('1. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ç—å 15 "–ù–æ—Ä–¥ –õ–∞–π–Ω"', 'info');
            addResult('2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é 4', 'info');  
            addResult('3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –ª–æ–≥–∏:', 'info');
            addResult('   - üéØ –ö–†–ò–¢–ò–ß–ù–û: –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–µ –≤ Supabase', 'debug');
            addResult('   - üîç –ö–†–ò–¢–ò–ß–ù–û: –§–∏–Ω–∞–ª—å–Ω—ã–π URL –∑–∞–ø—Ä–æ—Å–∞ –∫ Supabase', 'debug');
            addResult('   - ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ Supabase', 'debug');
            addResult('4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω—Ü–∏–∏ 4', 'info');
            addResult('   - –û–ø–µ—Ä–∞—Ü–∏–π: ~15 (–Ω–µ 1000+)', 'info');
            addResult('   - –í—ã—Ä—É—á–∫–∞: ~50-80 —Ç—ã—Å—è—á ‚ÇΩ (–Ω–µ 1+ –º–ª–Ω ‚ÇΩ)', 'info');
        }

        window.openMainApp = function() {
            window.open('http://localhost:3000', '_blank');
        }

        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type === 'debug' ? 'debug' : type;
            div.innerHTML = type === 'debug' ? `<pre>${message}</pre>` : message;
            results.appendChild(div);
            console.log(message);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            addResult('üöÄ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏!', 'success');
            addResult('‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase –≤ operationsSupabaseService.ts', 'success');
            addResult('üìã –¢–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'info');
        });
    </script>
</body>
</html>