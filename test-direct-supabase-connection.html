<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîó –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîó –¢–ï–°–¢ –ü–†–Ø–ú–û–ì–û –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö SUPABASE</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏</p>
    
    <button onclick="testDirectConnection()">üöÄ –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
    <button onclick="testTradingPointsAccess()">üìç –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–æ—Ä–≥–æ–≤—ã–º —Ç–æ—á–∫–∞–º</button>
    <button onclick="testNetworksAccess()">üåê –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ç—è–º</button>
    <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        window.clearLog = function() {
            log.innerHTML = '';
        }
        
        window.testDirectConnection = async function() {
            addLog('üîó –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase', 'info');
            
            try {
                // –ò–º–ø–æ—Ä—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞
                addLog('üì¶ –ò–º–ø–æ—Ä—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞...', 'info');
                const { httpClient } = await import('./src/services/universalHttpClient.js');
                addLog('‚úÖ HTTP –∫–ª–∏–µ–Ω—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase REST API
                addLog('üè• –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase REST API...', 'info');
                
                const healthResponse = await httpClient.get('/rest/v1/', {
                    destination: 'supabase',
                    timeout: 10000
                });
                
                addLog('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', 'info');
                addLog(`<div class="code">
                    Success: ${healthResponse.success}<br>
                    Status: ${healthResponse.status}<br>
                    Error: ${healthResponse.error || '–Ω–µ—Ç'}<br>
                    Response Time: ${healthResponse.responseTime}ms<br>
                    Data Type: ${typeof healthResponse.data}
                </div>`, healthResponse.success ? 'success' : 'error');
                
                if (!healthResponse.success) {
                    addLog('‚ùå –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'error');
                    addLog('üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏ API –∫–ª—é—á –≤ –∫–æ–¥–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞', 'warning');
                    return;
                }
                
                addLog('‚úÖ –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                
                // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º
                addLog('üìã –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º...', 'info');
                
                const tablesResponse = await httpClient.get('/rest/v1/', {
                    destination: 'supabase',
                    timeout: 10000
                });
                
                if (tablesResponse.success) {
                    addLog('‚úÖ –î–æ—Å—Ç—É–ø –∫ REST API –ø–æ–ª—É—á–µ–Ω', 'success');
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö endpoints
                    if (tablesResponse.data) {
                        addLog(`<div class="code">
                            –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç Supabase REST API<br>
                            –°—Ç—Ä—É–∫—Ç—É—Ä–∞: ${JSON.stringify(tablesResponse.data, null, 2)}
                        </div>`, 'info');
                    }
                } else {
                    addLog('‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ç–∞–±–ª–∏—Ü–∞–º', 'error');
                }
                
                // –¢–µ—Å—Ç 3: –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ networks
                addLog('üåê –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'info');
                
                const networksResponse = await httpClient.get('/rest/v1/networks', {
                    destination: 'supabase',
                    queryParams: {
                        select: 'id,name,external_id,code',
                        limit: '3'
                    }
                });
                
                addLog('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ —Å–µ—Ç–µ–π:', 'info');
                addLog(`<div class="code">
                    Success: ${networksResponse.success}<br>
                    Status: ${networksResponse.status}<br>
                    Count: ${networksResponse.data ? networksResponse.data.length : 0}<br>
                    Error: ${networksResponse.error || '–Ω–µ—Ç'}
                </div>`, networksResponse.success ? 'success' : 'error');
                
                if (networksResponse.success && networksResponse.data && networksResponse.data.length > 0) {
                    addLog('‚úÖ –°–µ—Ç–∏ –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ!', 'success');
                    networksResponse.data.forEach((network, index) => {
                        addLog(`<div class="code">
                            –°–µ—Ç—å ${index + 1}:<br>
                            - ID: ${network.id}<br>
                            - –ù–∞–∑–≤–∞–Ω–∏–µ: ${network.name}<br>
                            - External ID: ${network.external_id || '–ù–ï–¢'}<br>
                            - Code: ${network.code || '–ù–ï–¢'}
                        </div>`, 'success');
                    });
                } else {
                    addLog('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', 'warning');
                }
                
                addLog('üèÅ –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
                
            } catch (error) {
                addLog(`üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                addLog(`<div class="code">${error.stack}</div>`, 'error');
            }
        }
        
        window.testTradingPointsAccess = async function() {
            addLog('üìç –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–æ—Ä–≥–æ–≤—ã–º —Ç–æ—á–∫–∞–º —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', 'info');
            
            try {
                const { httpClient } = await import('./src/services/universalHttpClient.js');
                
                // –ó–∞–ø—Ä–æ—Å —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫
                const tradingPointsResponse = await httpClient.get('/rest/v1/trading_points', {
                    destination: 'supabase',
                    queryParams: {
                        select: 'id,name,external_id,network_id',
                        limit: '5'
                    }
                });
                
                addLog('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫:', 'info');
                addLog(`<div class="code">
                    Success: ${tradingPointsResponse.success}<br>
                    Status: ${tradingPointsResponse.status}<br>
                    Count: ${tradingPointsResponse.data ? tradingPointsResponse.data.length : 0}<br>
                    Error: ${tradingPointsResponse.error || '–Ω–µ—Ç'}
                </div>`, tradingPointsResponse.success ? 'success' : 'error');
                
                if (tradingPointsResponse.success && tradingPointsResponse.data) {
                    tradingPointsResponse.data.forEach((tp, index) => {
                        addLog(`<div class="code">
                            –¢–ü ${index + 1}:<br>
                            - ID: ${tp.id}<br>
                            - –ù–∞–∑–≤–∞–Ω–∏–µ: ${tp.name}<br>
                            - External ID: ${tp.external_id || '–ù–ï–¢'}<br>
                            - Network ID: ${tp.network_id}
                        </div>`, 'success');
                    });
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        window.testNetworksAccess = async function() {
            addLog('üåê –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ç—è–º —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', 'info');
            
            try {
                const { httpClient } = await import('./src/services/universalHttpClient.js');
                
                // –ó–∞–ø—Ä–æ—Å —Å–µ—Ç–µ–π
                const networksResponse = await httpClient.get('/rest/v1/networks', {
                    destination: 'supabase',
                    queryParams: {
                        select: 'id,name,external_id,code,status',
                        limit: '10'
                    }
                });
                
                addLog('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ —Å–µ—Ç–µ–π:', 'info');
                addLog(`<div class="code">
                    Success: ${networksResponse.success}<br>
                    Status: ${networksResponse.status}<br>
                    Count: ${networksResponse.data ? networksResponse.data.length : 0}<br>
                    Error: ${networksResponse.error || '–Ω–µ—Ç'}
                </div>`, networksResponse.success ? 'success' : 'error');
                
                if (networksResponse.success && networksResponse.data) {
                    networksResponse.data.forEach((network, index) => {
                        addLog(`<div class="code">
                            –°–µ—Ç—å ${index + 1}:<br>
                            - ID: ${network.id}<br>
                            - –ù–∞–∑–≤–∞–Ω–∏–µ: ${network.name}<br>
                            - External ID: ${network.external_id || '–ù–ï–¢'}<br>
                            - Code: ${network.code || '–ù–ï–¢'}<br>
                            - Status: ${network.status || '–ù–ï–¢'}
                        </div>`, 'success');
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ç–µ–π —Å external_id
                    const networksWithExternalId = networksResponse.data.filter(n => n.external_id);
                    addLog(`<div class="code">
                        –°–µ—Ç–µ–π —Å external_id: ${networksWithExternalId.length}/${networksResponse.data.length}<br>
                        –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–ª—è API: ${networksWithExternalId.length > 0 ? '‚úÖ –ì–û–¢–û–í–û' : '‚ùå –ù–ï–¢ external_id'}
                    </div>`, networksWithExternalId.length > 0 ? 'success' : 'warning');
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.', 'info');
    </script>
</body>
</html>