# Руководство пользователя: Управление шаблонами команд, командами и регламентами

## Оглавление
1. [Обзор системы](#обзор-системы)
2. [Шаблоны команд](#шаблоны-команд)
3. [Команды](#команды)
4. [Регламенты (Workflows)](#регламенты-workflows)
5. [Практические сценарии](#практические-сценарии)
6. [Устранение неполадок](#устранение-неполадок)

---

## Обзор системы

Система управления торговой платформой включает три основных модуля:

- **Шаблоны команд** - готовые шаблоны для интеграции с внешними API
- **Команды** - конкретные задачи для выполнения на оборудовании
- **Регламенты** - автоматизированные процессы по расписанию

### Навигация
Все модули доступны через главное меню слева:
- `Шаблоны команд` → раздел Templates
- `Команды` → раздел Commands  
- `Регламенты` → раздел Workflows

---

## Шаблоны команд

Шаблоны команд - это готовые конфигурации для взаимодействия с внешними API (например, Autooplata TMS).

### Просмотр шаблонов

1. Перейдите в раздел **Templates** → **Шаблоны команд**
2. Используйте фильтры для поиска:
   - По провайдеру (`cs_autooplata_tms_001`)
   - По статусу (`Активный`, `Неактивный`, `Устарел`)
   - По области применения (`Сеть`, `Торговая точка`, `Оборудование`)
3. Сортировка по дате создания, названию или версии

### Создание нового шаблона

1. Нажмите **"Создать шаблон"**
2. Заполните основную информацию:
   - **Название** - краткое описание назначения
   - **ID шаблона** - уникальный идентификатор (например: `autooplata_get_sales`)
   - **Описание** - подробное описание функций
   - **Версия** - в формате semver (1.0.0)

3. Настройте технические параметры:
   - **HTTP метод** - GET/POST/PUT/DELETE
   - **Endpoint** - путь API (например: `/v1/sales/{station_id}`)
   - **Область применения** - уровень применения шаблона
   - **Таймаут** - максимальное время выполнения

4. Определите схему данных:
   - **Параметры пути** - переменные в URL
   - **Query параметры** - параметры запроса  
   - **Тело запроса** - структура отправляемых данных
   - **Формат ответа** - ожидаемая структура ответа

5. Настройте политику повторов:
   - **Максимум попыток** - количество повторных попыток
   - **Стратегия задержки** - фиксированная или экспоненциальная
   - **Коды ошибок** - какие HTTP коды требуют повтора

### Редактирование шаблонов

1. Найдите нужный шаблон в списке
2. Нажмите **"Редактировать"** в строке шаблона
3. Внесите необходимые изменения
4. **Важно**: При изменении создается новая версия шаблона
5. Сохраните изменения

### Тестирование шаблонов

1. Откройте шаблон для просмотра
2. Перейдите на вкладку **"Тестирование"**
3. Заполните тестовые параметры
4. Нажмите **"Выполнить тест"**
5. Проанализируйте результат выполнения

---

## Команды

Команды - это конкретные задачи, которые выполняются на оборудовании или в системе.

### Просмотр команд

1. Откройте раздел **Commands**
2. Команды сгруппированы по статусам:
   - **Новые** - ожидают выполнения
   - **Выполняющиеся** - в процессе выполнения
   - **Завершенные** - успешно выполнены
   - **Ошибки** - завершены с ошибкой

### Создание команды

1. Нажмите **"Создать команду"**
2. Выберите **шаблон команды** из списка
3. Укажите **цель выполнения**:
   - Сеть целиком
   - Конкретная торговая точка
   - Определенное оборудование
4. Заполните **параметры команды** согласно схеме шаблона
5. Установите **приоритет** (1-10, где 1 - высший)
6. При необходимости задайте **время выполнения**

### Мониторинг выполнения

1. Команды в статусе "Выполняющиеся" показывают прогресс
2. Для просмотра деталей нажмите на команду
3. Доступна информация:
   - Время начала выполнения
   - Промежуточные результаты
   - Логи выполнения
   - Количество обработанных объектов

### Работа с результатами

1. Завершенные команды содержат:
   - **Результат выполнения** - данные ответа
   - **Время выполнения** - длительность процесса
   - **Статистика** - количество успешных/неуспешных операций
2. Результаты можно экспортировать в JSON или CSV
3. Неуспешные команды содержат подробную информацию об ошибках

---

## Регламенты (Workflows)

Регламенты - это автоматизированные процессы, которые выполняются по расписанию.

### Обзор регламентов

Регламенты разделены на три вкладки:
1. **Регламенты** - управление процессами
2. **Выполнения** - история запусков
3. **Мониторинг** - статистика и аналитика

### Создание регламента

#### Шаг 1: Общие настройки
1. Нажмите **"Создать регламент"**
2. Заполните основную информацию:
   - **Название** - описательное имя регламента
   - **Описание** - подробное описание назначения
   - **Тип регламента**:
     - `Синхронизация цен` - автоматическое обновление цен
     - `Отчеты` - генерация периодических отчетов
     - `Обслуживание` - технические операции
     - `Кастомный` - произвольная конфигурация
3. Добавьте **теги** для категоризации

#### Шаг 2: Настройка расписания
1. Выберите **частоту выполнения**:
   - Минуты (для частых проверок)
   - Часы (ежечасные операции)
   - Дни (ежедневные процессы)
   - Недели (еженедельные отчеты)
   - Месяцы (месячная отчетность)

2. Задайте **интервал** - каждые N единиц времени

3. Для ежедневных процессов укажите **время запуска**

4. Для еженедельных выберите **дни недели**

5. Установите **часовой пояс**

6. Настройте **политику повторов**:
   - Максимум попыток при сбое
   - Стратегия задержки между попытками

#### Шаг 3: Настройка Endpoints
1. Добавьте **endpoints** - шаблоны команд для выполнения:
   - Выберите шаблон из списка
   - Установите приоритет выполнения
   - Настройте параметры выполнения
   - Включите/отключите endpoint

2. Настройте **цели выполнения**:
   - Область применения (сеть/точка/оборудование)
   - Применять ко всем объектам или выбранным

#### Шаг 4: Уведомления
1. Включите систему уведомлений
2. Настройте типы событий:
   - При успешном выполнении
   - При ошибке
   - При критической ошибке
3. Укажите получателей email
4. При необходимости добавьте webhook URL

### Управление регламентами

#### Активация/деактивация
- Используйте переключатель в списке регламентов
- Неактивные регламенты не выполняются по расписанию

#### Ручной запуск
1. Найдите нужный регламент
2. Нажмите **"Запустить"** 
3. Регламент выполнится немедленно

#### Просмотр истории
1. Нажмите **"История"** у регламента
2. Доступна информация о каждом выполнении:
   - Время запуска и завершения
   - Статус выполнения
   - Количество обработанных объектов
   - Детальные логи

#### Дублирование
1. Нажмите **"Дублировать"** у существующего регламента
2. Система создаст копию с префиксом "Копия"
3. Отредактируйте параметры под новые требования

### Мониторинг регламентов

#### Вкладка "Мониторинг"
Содержит три раздела:

1. **Последние выполнения**:
   - Список недавних запусков регламентов
   - Статус каждого выполнения
   - Время выполнения

2. **Состояние регламентов**:
   - Статус каждого регламента (активен/неактивен)
   - Время последнего выполнения
   - Результат последнего запуска

3. **Предупреждения и рекомендации**:
   - Автоматические алерты о проблемах
   - Рекомендации по оптимизации
   - Уведомления о неактивных регламентах

#### Ключевые метрики
- **Общее количество регламентов** - активных и всего
- **Выполнения за период** - статистика запусков
- **Успешность** - процент успешных выполнений
- **Среднее время выполнения** - производительность

---

## Практические сценарии

### Сценарий 1: Ежедневная синхронизация цен

1. **Создайте регламент**:
   - Тип: "Синхронизация цен"
   - Расписание: ежедневно в 06:00
   - Endpoint: шаблон `autooplata_get_prices`

2. **Настройте цели**: все торговые точки сети

3. **Включите уведомления** об ошибках

### Сценарий 2: Еженедельные отчеты о продажах

1. **Создайте регламент**:
   - Тип: "Отчеты"  
   - Расписание: каждый понедельник в 09:00
   - Endpoint: шаблон генерации отчетов

2. **Настройте параметры**: период отчета - прошлая неделя

3. **Добавьте email получателей** отчетов

### Сценарий 3: Мониторинг состояния оборудования

1. **Создайте регламент**:
   - Тип: "Обслуживание"
   - Расписание: каждые 30 минут
   - Endpoint: проверка статуса оборудования

2. **Настройте алерты** при обнаружении неисправностей

3. **Установите критические уведомления**

### Сценарий 4: Разовая команда обновления ПО

1. **Создайте команду**:
   - Шаблон: обновление программного обеспечения
   - Цель: конкретное оборудование
   - Приоритет: высокий

2. **Мониторьте выполнение** в реальном времени

3. **Проверьте результаты** после завершения

---

## Устранение неполадок

### Частые проблемы и решения

#### Регламент не выполняется
1. Проверьте статус регламента (должен быть активен)
2. Убедитесь в корректности расписания
3. Проверьте логи последних выполнений
4. Убедитесь, что endpoints активны

#### Команда завершается с ошибкой
1. Проверьте правильность параметров
2. Убедитесь в доступности целевого оборудования
3. Проверьте шаблон команды на корректность
4. Увеличьте таймаут выполнения

#### Низкая производительность
1. Уменьшите частоту выполнения регламентов
2. Оптимизируйте количество одновременных endpoints
3. Увеличьте таймаут для сложных операций
4. Разделите большие регламенты на несколько меньших

#### Проблемы с уведомлениями
1. Проверьте настройки email-сервера
2. Убедитесь в корректности webhook URL
3. Проверьте права доступа получателей
4. Тестируйте уведомления на тестовых адресах

### Логи и диагностика

1. **Логи команд** - доступны в детальном представлении команды
2. **Логи регламентов** - во вкладке "Выполнения"
3. **Системные предупреждения** - во вкладке "Мониторинг"
4. **Статистика производительности** - в дашборде мониторинга

### Контакты поддержки

При возникновении технических проблем обращайтесь:
- Email: support@trading-platform.com
- Внутренний чат: #tech-support
- Документация API: `/api/docs`

---

## Дополнительные возможности

### Экспорт/Импорт конфигураций
- Экспорт регламентов для переноса между средами
- Импорт готовых конфигураций
- Версионирование изменений

### API интеграция
- REST API для всех операций
- Webhook события для интеграций
- Программное управление регламентами

### Роли и права доступа
- Разграничение прав по ролям
- Аудит изменений конфигураций
- Делегирование полномочий

---

*Версия документа: 1.0*  
*Дата создания: 02.09.2025*  
*Обновления: проверяйте актуальную версию в системе*