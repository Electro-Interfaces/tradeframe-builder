<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏–≥—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 3px; }
        button.danger { background: #dc3545; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        th { background: #f2f2f2; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 11px; max-height: 300px; }
    </style>
</head>
<body>
    <h1>üè™ –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ Supabase</h1>
    
    <div class="section info">
        <h3>–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏:</h3>
        <ol>
            <li>üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ localStorage</li>
            <li>üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ Supabase</li>
            <li>üîÑ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –≤ Supabase</li>
            <li>‚úÖ –°–≤—è–∑–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ —Å —Ç–æ—Ä–≥–æ–≤—ã–º–∏ —Å–µ—Ç—è–º–∏ —á–µ—Ä–µ–∑ UUID</li>
        </ol>
    </div>

    <div class="section">
        <button onclick="analyzeLocalStorageData()">üìã –ê–Ω–∞–ª–∏–∑ localStorage</button>
        <button onclick="checkSupabaseData()">üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase</button>
        <button onclick="migrateAllData()">üîÑ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="testConnection()" class="danger">üß™ –¢–µ—Å—Ç —Å–≤—è–∑–∏</button>
    </div>

    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI'
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        function logResult(message, type = 'info', data = null) {
            const resultsDiv = document.getElementById('results')
            const div = document.createElement('div')
            div.className = `section ${type}`
            
            let content = `<h4>${message}</h4>`
            if (data) {
                if (Array.isArray(data) && data.length > 0 && typeof data[0] === 'object') {
                    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –º–∞—Å—Å–∏–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤
                    const keys = Object.keys(data[0])
                    content += `
                        <table>
                            <thead><tr>${keys.map(k => `<th>${k}</th>`).join('')}</tr></thead>
                            <tbody>
                                ${data.slice(0, 10).map(row => 
                                    `<tr>${keys.map(k => {
                                        let value = row[k]
                                        if (typeof value === 'object') value = JSON.stringify(value)
                                        if (typeof value === 'string' && value.length > 50) value = value.substring(0, 47) + '...'
                                        return `<td>${value || '‚Äî'}</td>`
                                    }).join('')}</tr>`
                                ).join('')}
                            </tbody>
                        </table>
                        ${data.length > 10 ? `<p><em>–ü–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä–≤—ã—Ö 10 –∏–∑ ${data.length} –∑–∞–ø–∏—Å–µ–π</em></p>` : ''}
                    `
                } else {
                    content += `<pre>${JSON.stringify(data, null, 2)}</pre>`
                }
            }
            div.innerHTML = content
            
            resultsDiv.appendChild(div)
            console.log(message, data)
        }

        // –ü–æ–ª—É—á–∞–µ–º UUID —Å–µ—Ç–µ–π –∏–∑ Supabase –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞
        let networksMapping = {}

        async function loadNetworksMapping() {
            try {
                const { data: networks, error } = await supabase
                    .from('networks')
                    .select('id, external_id, name')
                    .order('external_id')
                
                if (error) throw error
                
                // –°–æ–∑–¥–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ external_id -> UUID
                networks.forEach(network => {
                    if (network.external_id) {
                        networksMapping[network.external_id] = {
                            uuid: network.id,
                            name: network.name
                        }
                    }
                })
                
                logResult('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω –º–∞–ø–ø–∏–Ω–≥ —Å–µ—Ç–µ–π', 'success', networksMapping)
                return networksMapping
            } catch (error) {
                logResult('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ç–µ–π', 'error', error)
                return {}
            }
        }

        window.analyzeLocalStorageData = function() {
            logResult('üìã –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ localStorage...', 'info')
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–ª—é—á–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫
            const possibleKeys = [
                'tradeframe_tradingPoints',    // –ì–ª–∞–≤–Ω—ã–π –∫–ª—é—á!
                'tradingPoints',
                'trading_points', 
                'points',
                'azs_points',
                'tc:tradingPoints'
            ]
            
            let foundData = null
            let foundKey = null
            
            for (const key of possibleKeys) {
                try {
                    const data = localStorage.getItem(key)
                    if (data) {
                        const parsed = JSON.parse(data)
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ {data: [...]}, –∏–∑–≤–ª–µ–∫–∞–µ–º –º–∞—Å—Å–∏–≤
                        if (parsed && parsed.data && Array.isArray(parsed.data)) {
                            foundData = parsed.data
                            foundKey = key + ' (–∏–∑–≤–ª–µ—á–µ–Ω –º–∞—Å—Å–∏–≤ –∏–∑ .data)'
                        } else if (Array.isArray(parsed)) {
                            foundData = parsed
                            foundKey = key
                        } else {
                            foundData = parsed
                            foundKey = key + ' (–æ–±—ä–µ–∫—Ç)'
                        }
                        break
                    }
                } catch (e) {
                    console.warn(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ${key}:`, e)
                }
            }
            
            if (foundData) {
                logResult(`‚úÖ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ –∫–ª—é—á–µ: ${foundKey}`, 'success', {
                    –∫–ª—é—á: foundKey,
                    –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: Array.isArray(foundData) ? foundData.length : '–Ω–µ –º–∞—Å—Å–∏–≤',
                    —Ç–∏–ø: typeof foundData,
                    –æ–±—Ä–∞–∑–µ—Ü: Array.isArray(foundData) ? foundData[0] : foundData
                })
                
                if (Array.isArray(foundData) && foundData.length > 0) {
                    logResult(`üìä –î–µ—Ç–∞–ª–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ (${foundData.length})`, 'info', foundData)
                }
            } else {
                logResult('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning', {
                    –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ_–∫–ª—é—á–∏: possibleKeys,
                    –≤—Å–µ_–∫–ª—é—á–∏_localStorage: Object.keys(localStorage)
                })
            }
        }

        window.checkSupabaseData = async function() {
            logResult('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Supabase...', 'info')
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏
                const { data: networks, error: networksError } = await supabase
                    .from('networks')
                    .select('id, name, external_id')
                    .order('name')
                
                if (networksError) throw networksError
                
                logResult(`‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏ –≤ Supabase: ${networks.length}`, 'success', networks)
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏
                const { data: tradingPoints, error: pointsError } = await supabase
                    .from('trading_points')
                    .select('id, name, network_id, external_id, geolocation')
                    .order('name')
                
                if (pointsError) throw pointsError
                
                if (tradingPoints.length > 0) {
                    logResult(`‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ Supabase: ${tradingPoints.length}`, 'success', tradingPoints)
                } else {
                    logResult('‚ö†Ô∏è –¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ Supabase –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç', 'warning', '–ì–æ—Ç–æ–≤—ã –∫ –º–∏–≥—Ä–∞—Ü–∏–∏')
                }
                
            } catch (error) {
                logResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö Supabase', 'error', error)
            }
        }

        window.migrateAllData = async function() {
            logResult('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫...', 'info')
            
            // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –º–∞–ø–ø–∏–Ω–≥ —Å–µ—Ç–µ–π
            await loadNetworksMapping()
            
            if (Object.keys(networksMapping).length === 0) {
                logResult('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è', 'error')
                return
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            let localStorageData = null
            const possibleKeys = [
                'tradeframe_tradingPoints',    // –†–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á –∏–∑ localStorage!
                'tradingPoints', 
                'trading_points', 
                'points'
            ]
            
            for (const key of possibleKeys) {
                try {
                    const data = localStorage.getItem(key)
                    if (data) {
                        const parsed = JSON.parse(data)
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ {data: [...]}, –∏–∑–≤–ª–µ–∫–∞–µ–º –º–∞—Å—Å–∏–≤
                        if (parsed && parsed.data && Array.isArray(parsed.data)) {
                            localStorageData = parsed.data
                            logResult(`üìã –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–ª—é—á–∞: ${key} (–∏–∑–≤–ª–µ—á–µ–Ω –º–∞—Å—Å–∏–≤ –∏–∑ .data)`, 'info')
                        } else if (Array.isArray(parsed)) {
                            localStorageData = parsed
                            logResult(`üìã –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–ª—é—á–∞: ${key}`, 'info')
                        } else {
                            localStorageData = parsed
                            logResult(`üìã –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–ª—é—á–∞: ${key} (–æ–±—ä–µ–∫—Ç)`, 'info')
                        }
                        break
                    }
                } catch (e) {
                    console.warn(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ${key}:`, e)
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ localStorage, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–¥–∞
            if (!localStorageData) {
                logResult('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ', 'warning')
                
                // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫
                localStorageData = [
                    {
                        id: "point1",
                        networkId: "1", // external_id
                        name: "–ê–ó–° ‚Ññ001 - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è",
                        description: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ê–ó–° –Ω–∞ –ù–µ–≤—Å–∫–æ–º –ø—Ä–æ—Å–ø–µ–∫—Ç–µ. –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –ø–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å.",
                        geolocation: {
                            latitude: 59.9311,
                            longitude: 30.3609,
                            region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                            city: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                            address: "–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 100, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –†–æ—Å—Å–∏—è"
                        },
                        phone: "+7 (812) 123-45-67",
                        email: "central@demo-azs.ru",
                        isBlocked: false,
                        schedule: {
                            monday: "00:00-23:59",
                            tuesday: "00:00-23:59",
                            wednesday: "00:00-23:59",
                            thursday: "00:00-23:59",
                            friday: "00:00-23:59",
                            saturday: "00:00-23:59",
                            sunday: "00:00-23:59",
                            isAlwaysOpen: true
                        },
                        services: {
                            selfServiceTerminal: true,
                            airPump: true,
                            carWash: true,
                            shop: true,
                            cafe: false
                        },
                        externalCodes: []
                    },
                    {
                        id: "point2",
                        networkId: "1", // external_id
                        name: "–ê–ó–° ‚Ññ002 - –°–µ–≤–µ—Ä–Ω–∞—è",
                        description: "–°–µ–≤–µ—Ä–Ω–∞—è –ê–ó–° –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.",
                        geolocation: {
                            latitude: 60.0348,
                            longitude: 30.3158,
                            region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                            city: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                            address: "–ø—Ä. –≠–Ω–≥–µ–ª—å—Å–∞, 154, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –†–æ—Å—Å–∏—è"
                        },
                        phone: "+7 (812) 234-56-78",
                        email: "north@demo-azs.ru",
                        isBlocked: false,
                        schedule: {
                            monday: "06:00-23:00",
                            tuesday: "06:00-23:00",
                            wednesday: "06:00-23:00",
                            thursday: "06:00-23:00",
                            friday: "06:00-23:00",
                            saturday: "06:00-23:00",
                            sunday: "06:00-23:00",
                            isAlwaysOpen: false
                        },
                        services: {
                            selfServiceTerminal: false,
                            airPump: true,
                            carWash: false,
                            shop: false,
                            truckParking: true
                        },
                        externalCodes: []
                    },
                    {
                        id: "point3",
                        networkId: "15", // external_id –¥–ª—è –ù–æ—Ä–¥ –õ–∞–π–Ω
                        name: "–ê–ó–° ‚Ññ101 - –ù–æ—Ä–¥ –¢–µ—Ä–º–∏–Ω–∞–ª",
                        description: "–¢–µ—Ä–º–∏–Ω–∞–ª –ù–æ—Ä–¥ –õ–∞–π–Ω —Å –ø–æ–ª–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è –≥—Ä—É–∑–æ–≤–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.",
                        geolocation: {
                            latitude: 59.8533,
                            longitude: 30.1786,
                            region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                            city: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
                            address: "–í–æ–ª—Ö–æ–Ω—Å–∫–æ–µ —à–æ—Å—Å–µ, 15, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –†–æ—Å—Å–∏—è"
                        },
                        phone: "+7 (812) 345-67-89",
                        email: "terminal@nordline.ru",
                        isBlocked: false,
                        schedule: {
                            monday: "06:00-22:00",
                            tuesday: "06:00-22:00",
                            wednesday: "06:00-22:00",
                            thursday: "06:00-22:00",
                            friday: "06:00-22:00",
                            saturday: "08:00-20:00",
                            sunday: "08:00-20:00",
                            isAlwaysOpen: false
                        },
                        services: {
                            selfServiceTerminal: true,
                            airPump: true,
                            carWash: true,
                            shop: true,
                            cafe: true,
                            truckParking: true,
                            lubricants: true
                        },
                        externalCodes: []
                    }
                ]
            }
            
            if (!Array.isArray(localStorageData)) {
                logResult('‚ùå –î–∞–Ω–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º', 'error')
                return
            }
            
            logResult(`üìä –ì–æ—Ç–æ–≤—ã –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ ${localStorageData.length} —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫`, 'info')
            
            // –ú–∏–≥—Ä–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É
            let successCount = 0
            let errorCount = 0
            
            for (const point of localStorageData) {
                try {
                    // –ù–∞—Ö–æ–¥–∏–º UUID —Å–µ—Ç–∏ –ø–æ external_id  
                    // –ï—Å–ª–∏ networkId = "2", –º–µ–Ω—è–µ–º –Ω–∞ "1" (–≤—Å–µ —Ç–æ—á–∫–∏ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏)
                    let networkId = point.networkId === "2" ? "1" : point.networkId
                    
                    const networkMapping = networksMapping[networkId]
                    if (!networkMapping) {
                        logResult(`‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Å–µ—Ç—å —Å external_id: ${networkId}`, 'warning')
                        continue
                    }
                    
                    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Supabase
                    const geoloc = point.geolocation || {}
                    const tradingPointData = {
                        external_id: point.id, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–π ID –∫–∞–∫ external_id
                        network_id: networkMapping.uuid, // UUID —Å–µ—Ç–∏ –∏–∑ Supabase
                        name: point.name,
                        description: point.description || null,
                        // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ geolocation
                        address: geoloc.address || null,
                        latitude: geoloc.latitude || null,
                        longitude: geoloc.longitude || null,
                        // –ò —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç geolocation
                        geolocation: point.geolocation || {},
                        phone: point.phone || null,
                        email: point.email || null,
                        website: point.website || null,
                        is_blocked: point.isBlocked || false,
                        block_reason: point.blockReason || null,
                        schedule: point.schedule || {},
                        services: point.services || {},
                        external_codes: point.externalCodes || [],
                        settings: {}
                    }
                    
                    // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ Supabase
                    const { data, error } = await supabase
                        .from('trading_points')
                        .insert([tradingPointData])
                        .select()
                    
                    if (error) {
                        logResult(`‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ—á–∫–∏ "${point.name}"`, 'error', error)
                        errorCount++
                    } else {
                        logResult(`‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Ç–æ—á–∫–∞: ${point.name}`, 'success', data[0])
                        successCount++
                    }
                    
                } catch (error) {
                    logResult(`üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ—á–∫–∏ "${point.name}"`, 'error', error)
                    errorCount++
                }
            }
            
            // –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
            logResult('üìã –ò—Ç–æ–≥ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫', successCount > 0 ? 'success' : 'error', {
                –≤—Å–µ–≥–æ: localStorageData.length,
                —É—Å–ø–µ—à–Ω–æ: successCount,
                –æ—à–∏–±–æ–∫: errorCount,
                –ø—Ä–æ—Ü–µ–Ω—Ç_—É—Å–ø–µ—Ö–∞: Math.round(successCount / localStorageData.length * 100) + '%'
            })
        }

        window.testConnection = async function() {
            logResult('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏ ‚Üî —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏...', 'info')
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å JOIN
                const { data, error } = await supabase
                    .from('trading_points')
                    .select(`
                        id,
                        external_id,
                        name,
                        network_id,
                        networks!inner (
                            id,
                            name,
                            external_id
                        )
                    `)
                    .order('name')
                
                if (error) throw error
                
                if (data.length > 0) {
                    logResult(`‚úÖ –°–≤—è–∑—å —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù–∞–π–¥–µ–Ω–æ ${data.length} —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π`, 'success', data)
                } else {
                    logResult('‚ö†Ô∏è –°–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning')
                }
                
            } catch (error) {
                logResult('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏', 'error', error)
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(analyzeLocalStorageData, 500)
        })
    </script>
</body>
</html>