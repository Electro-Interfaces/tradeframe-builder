<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ API —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0f172a; color: #fff; }
        .container { max-width: 800px; margin: 0 auto; }
        .log { background: #1e293b; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
        .error { background: #dc2626; }
        .success { background: #16a34a; }
        .warning { background: #ea580c; }
        button { padding: 10px 20px; margin: 10px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #2563eb; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ¢Ô∏è –û—Ç–ª–∞–¥–∫–∞ API —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</h1>
        
        <div>
            <button onclick="testTanksApi()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</button>
            <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        </div>
        
        <div id="logs"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testTanksApi() {
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç API —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤...');
            
            try {
                // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
                const { tanksUnifiedService } = await import('/src/services/tanksUnifiedService.ts');
                const tradingPointId = '6969b08d-1cbe-45c2-ae9c-8002c7022b59';
                
                log(`üîç –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ä–≥–æ–≤—É—é —Ç–æ—á–∫—É: ${tradingPointId}`);
                
                // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤
                log('üì° –í—ã–∑—ã–≤–∞–µ–º tanksUnifiedService.getTanksForTradingPoint...');
                const result = await tanksUnifiedService.getTanksForTradingPoint(tradingPointId);
                
                log(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω:`, 'success');
                log(`<pre>–ò—Å—Ç–æ—á–Ω–∏–∫: ${result.source}
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω: ${result.synchronized}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${result.tanks.length}
–û—à–∏–±–∫–∞: ${result.error || '–Ω–µ—Ç'}</pre>`);
                
                if (result.tanks.length > 0) {
                    log('üõ¢Ô∏è –î–∞–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤:', 'success');
                    result.tanks.forEach((tank, index) => {
                        const fillPercent = Math.round((tank.currentLevelLiters / tank.capacityLiters) * 100);
                        log(`<pre>–†–µ–∑–µ—Ä–≤—É–∞—Ä ${index + 1}:
  ID: ${tank.id}
  –ù–∞–∑–≤–∞–Ω–∏–µ: ${tank.name}
  –¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞: ${tank.fuelType}
  –¢–µ–∫—É—â–∏–π –æ–±—ä—ë–º: ${tank.currentLevelLiters.toFixed(2)} –ª
  –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${tank.capacityLiters.toFixed(2)} –ª
  –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ: ${fillPercent}%
  –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: ${tank.minLevelPercent}%
  –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å: ${tank.criticalLevelPercent}%
  –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${tank.temperature}¬∞C
  –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: ${tank.density}
  –°—Ç–∞—Ç—É—Å: ${tank.status}</pre>`);
                    });
                } else {
                    log('‚ö†Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning');
                }
                
                if (result.error) {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                console.error('–î–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
            }
        }
    </script>
</body>
</html>