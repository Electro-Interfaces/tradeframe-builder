# üåê API Integration Guide

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

TradeFrame Builder v1.5.16 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.

## üîê –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Supabase)

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- **PostgreSQL**: –ß–µ—Ä–µ–∑ Supabase REST API
- **URL**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `src/services/auth/authService.ts`
- **–°—Ö–µ–º–∞**: `public` (–æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î)

### –¢–æ–∫–µ–Ω—ã
- **–§–æ—Ä–º–∞—Ç**: `token_${base64(payload)}_${timestamp}`
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: 1 —á–∞—Å
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ —á–µ—Ä–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: localStorage/sessionStorage

### –¢–∞–±–ª–∏—Ü—ã –ë–î
- `users` - **–†–ï–ê–õ–¨–ù–´–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã** (–Ω–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
- `roles` - **–†–ï–ê–õ–¨–ù–´–ï —Ä–æ–ª–∏ –¥–æ—Å—Ç—É–ø–∞** (–Ω–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
- `user_roles` - —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏ (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `operations` - **–†–ï–ê–õ–¨–ù–´–ï –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏** (–Ω–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
- `equipment` - **–†–ï–ê–õ–¨–ù–û–ï –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫** (–Ω–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
- `equipment_templates` - —à–∞–±–ª–æ–Ω—ã –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- `networks` - **–†–ï–ê–õ–¨–ù–´–ï —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏** (–Ω–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)
- `trading_points` - **–†–ï–ê–õ–¨–ù–´–ï —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏** (–Ω–µ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ)

## üåê –í–Ω–µ—à–Ω–∏–π API —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ (STS)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞–±–æ—Ç–µ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ –∏ POS-—Å–∏—Å—Ç–µ–º—ã.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `src/services/apiConfigService.ts`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: HTTP Basic Auth
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
  - `VITE_STS_API_URL` - URL API
  - `VITE_STS_API_USERNAME` - –ª–æ–≥–∏–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
  - `VITE_STS_API_PASSWORD` - –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –û–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ —Å POS-—Å–∏—Å—Ç–µ–º
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –∏ —Ç–æ–ø–ª–∏–≤–æ

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏

### UI –ù–∞—Å—Ç—Ä–æ–π–∫–∏
–î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑: `/settings/external-database`

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
1. **Supabase** - –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î (**–í–°–ï –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –†–ï–ê–õ–¨–ù–´–ï**)
2. **External API** - API —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
3. **Mock** - –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¢–û–õ–¨–ö–û –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
4. **Local DB** - –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

> ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –¢–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏, —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase, –¥–∞–∂–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. Mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ UI –Ω–∞—Å—Ç—Ä–æ–µ–∫.

## üì° HTTP –∫–ª–∏–µ–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/services/httpClients.ts` - HTTP –∫–ª–∏–µ–Ω—Ç—ã —Å retry –ª–æ–≥–∏–∫–æ–π
- `src/services/auth/authService.ts` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `src/services/apiConfigService.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **Retry –ª–æ–≥–∏–∫–∞**: –ê–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **Idempotency-Key**: –î–ª—è –º—É—Ç–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Trace-Id**: –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ–∫–µ–Ω—ã**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: SHA-256 –∏–ª–∏ base64 fallback
- **–°–æ–ª—å**: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ
- **–§–æ—Ä–º—É–ª–∞**: `SHA-256(password + salt)`

### –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ù–ï —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ** - —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ cookies** –¥–ª—è —Å–µ—Å—Å–∏–π

## üß™ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### Development
- Mock –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
- –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

### Production
- –†–µ–∞–ª—å–Ω—ã–µ API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```javascript
// –î–æ—Å—Ç—É–ø–Ω–æ –≤ dev —Ä–µ–∂–∏–º–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
window.apiConfigService.testAllConnections()
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω—è–º–∏:
- `üîç` - –ø–æ–∏—Å–∫ –∏ –∑–∞–ø—Ä–æ—Å—ã
- `‚úÖ` - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `‚ùå` - –æ—à–∏–±–∫–∏
- `üîÑ` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
import { authService } from '@/services/auth/authService';

const user = await authService.authenticate('email', 'password');
```

### HTTP –∑–∞–ø—Ä–æ—Å –∫ API
```typescript
import { httpClient } from '@/services/httpClients';

const data = await httpClient.get('/equipment');
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```typescript
import { apiConfigService } from '@/services/apiConfigService';

await apiConfigService.switchConnection('trading-network-api');
```