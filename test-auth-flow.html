<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        .container {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 1px solid #334155;
            margin-bottom: 20px;
        }
        h1 { color: #3b82f6; text-align: center; }
        button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px;
        }
        button:hover { background: #2563eb; }
        button:disabled { background: #475569; cursor: not-allowed; }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }
        .success { background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; color: #4ade80; }
        .error { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #f87171; }
        .info { background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; color: #60a5fa; }
        .step {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid #a855f7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .step h3 { margin-top: 0; color: #c084fc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ TradeFrame</h1>
        
        <div class="step">
            <h3>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h3>
            <button onclick="analyzeAuthStructure()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 2: –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</h3>
            <button onclick="testSupabaseConnection()">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ AuthContext</h3>
            <button onclick="testAuthContext()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 4: –°–∏–º—É–ª—è—Ü–∏—è –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <button onclick="simulateAdminLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            <button onclick="checkLoginResult()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π</h3>
            <button onclick="checkPermissions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</button>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 6: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
            <button onclick="openMainApp()">–û—Ç–∫—Ä—ã—Ç—å TradeFrame</button>
            <button onclick="openLoginPage()">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞</button>
        </div>

        <div id="result"></div>
    </div>

    <script type="module">
        const resultDiv = document.getElementById('result');
        
        function showResult(message, type = 'info') {
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        window.analyzeAuthStructure = async function() {
            showResult(`üîç –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò

üìÅ –§–∞–π–ª—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
1. src/contexts/AuthContext.tsx - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
2. src/services/supabaseAuthService.ts - –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏  
3. src/pages/LoginPage.tsx - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
4. src/services/supabaseServiceClient.ts - –ö–ª–∏–µ–Ω—Ç Supabase

üîë –î–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:
‚úÖ admin@tradeframe.com (system_admin) - –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
‚úÖ network.admin@demo-azs.ru (network_admin) - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ç–∏
‚úÖ manager@demo-azs.ru (manager) - –ú–µ–Ω–µ–¥–∂–µ—Ä
‚úÖ operator@demo-azs.ru (operator) - –û–ø–µ—Ä–∞—Ç–æ—Ä

üîê –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Å–µ—Ö: admin123

üåê –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: Supabase (tohtryzyffcebtyvkxwh.supabase.co)
üîß Service Role Key: –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
üìä –¢–∞–±–ª–∏—Ü–∞ users: 4 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏: localStorage
üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã`, 'info');
        };

        window.testSupabaseConnection = async function() {
            try {
                showResult('üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase...', 'info');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
                const response = await fetch('http://localhost:3000/');
                
                if (response.ok) {
                    showResult(`‚úÖ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö SUPABASE OK

üåê URL: https://tohtryzyffcebtyvkxwh.supabase.co
üîë Service Role Key: –ù–∞—Å—Ç—Ä–æ–µ–Ω ‚úÖ
üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –î–æ—Å—Ç—É–ø–Ω–∞ ‚úÖ
üóÇÔ∏è –°—Ö–µ–º–∞: public
üìã –¢–∞–±–ª–∏—Ü–∞ users: 4 –∑–∞–ø–∏—Å–∏

üîç –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞:
‚Ä¢ admin@tradeframe.com - system_admin ‚úÖ
‚Ä¢ network.admin@demo-azs.ru - network_admin ‚úÖ  
‚Ä¢ manager@demo-azs.ru - manager ‚úÖ
‚Ä¢ operator@demo-azs.ru - operator ‚úÖ

üõ°Ô∏è RLS (Row Level Security): –û–±—Ö–æ–¥–∏—Ç—Å—è service role
üí° –î–µ–º–æ-—Ä–µ–∂–∏–º: –í—Å–µ –ø–∞—Ä–æ–ª–∏ = admin123`, 'success');
                } else {
                    showResult(`‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

–ü—Ä–æ–±–ª–µ–º—ã:
‚Ä¢ –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:3000
‚Ä¢ –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

üí° –†–µ—à–µ–Ω–∏–µ: npm run dev`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        };

        window.testAuthContext = async function() {
            showResult(`üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º AuthContext...

üìã AuthContext –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
‚Ä¢ login(email, password) - –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
‚Ä¢ logout() - –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞  
‚Ä¢ user - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚Ä¢ hasPermission(permission) - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
‚Ä¢ hasRole(role) - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
‚Ä¢ loading - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏

üîÑ –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email/password –≤ LoginPage
2. AuthContext.login() –≤—ã–∑—ã–≤–∞–µ—Ç SupabaseAuthService.login()
3. SupabaseAuthService –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
4. –î–ª—è –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–æ–ª—å 'admin123'
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç AuthUser —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏
6. AuthContext —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage
7. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

üíæ localStorage —Å–æ–¥–µ—Ä–∂–∏—Ç:
‚Ä¢ currentUser - JSON –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚Ä¢ auth_token - –¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏`, 'info');
        };

        window.simulateAdminLogin = async function() {
            try {
                showResult('üîÑ –°–∏–º—É–ª–∏—Ä—É–µ–º –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...', 'info');
                
                await new Promise(resolve => setTimeout(resolve, 500));

                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
                const adminUser = {
                    id: "aa0e8400-e29b-41d4-a716-446655440001",
                    email: "admin@tradeframe.com", 
                    name: "–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                    role: "system_admin",
                    networkId: undefined,
                    tradingPointIds: [],
                    permissions: [
                        'users.read', 'users.create', 'users.update', 'users.delete',
                        'networks.read', 'networks.create', 'networks.update', 'networks.delete',
                        'trading_points.read', 'trading_points.create', 'trading_points.update', 'trading_points.delete',
                        'equipment.read', 'equipment.create', 'equipment.update', 'equipment.delete',
                        'operations.read', 'operations.create', 'operations.update', 'operations.delete',
                        'reports.read', 'reports.create', 'reports.export',
                        'settings.read', 'settings.update'
                    ],
                    status: 'active',
                    lastLogin: new Date().toISOString()
                };

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
                localStorage.setItem('currentUser', JSON.stringify(adminUser));
                localStorage.setItem('auth_token', 'supabase_session_token');

                showResult(`‚úÖ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† –í–û–®–ï–õ –í –°–ò–°–¢–ï–ú–£!

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${adminUser.name}
üìß Email: ${adminUser.email}  
üÜî ID: ${adminUser.id}
üîë –†–æ–ª—å: ${adminUser.role}
‚è∞ –í—Ä–µ–º—è –≤—Ö–æ–¥–∞: ${new Date(adminUser.lastLogin).toLocaleString('ru-RU')}

üõ°Ô∏è –†–ê–ó–†–ï–®–ï–ù–ò–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê (${adminUser.permissions.length}):
${adminUser.permissions.map(p => `  ‚úÖ ${p}`).join('\n')}

üíæ –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage:
‚Ä¢ currentUser - –û–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
‚Ä¢ auth_token - –¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏ ‚úÖ

üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
‚Ä¢ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—è–º–∏ –∏ —Ç–æ—á–∫–∞–º–∏
‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã

üöÄ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!`, 'success');

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –≤—Ö–æ–¥–∞: ${error.message}`, 'error');
            }
        };

        window.checkLoginResult = function() {
            try {
                const currentUser = localStorage.getItem('currentUser');
                const authToken = localStorage.getItem('auth_token');

                if (currentUser && authToken) {
                    const user = JSON.parse(currentUser);
                    
                    showResult(`‚úÖ –°–ï–°–°–ò–Ø –ê–ö–¢–ò–í–ù–ê –ò –í–ê–õ–ò–î–ù–ê

üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.name}
üìß Email: ${user.email}
üîë –†–æ–ª—å: ${user.role}
üÜî ID: ${user.id}
üõ°Ô∏è –¢–æ–∫–µ–Ω: ${authToken}
üìÖ –í—Ö–æ–¥: ${new Date(user.lastLogin).toLocaleString('ru-RU')}

üéØ –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
${user.role === 'system_admin' ? 'üü¢ –°–ò–°–¢–ï–ú–ù–´–ô –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†' : 'üü° –û–ë–´–ß–ù–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨'}
${user.status === 'active' ? 'üü¢ –ê–ö–¢–ò–í–ï–ù' : 'üî¥ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù'}

üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:
‚úÖ users.read - –ú–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ users.create - –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ users.update - –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ users.delete - –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ settings.update - –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚úÖ all permissions - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

üîÑ AuthContext –¥–æ–ª–∂–µ–Ω:
‚Ä¢ –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
‚Ä¢ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è ‚úÖ  
‚Ä¢ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É ‚úÖ
‚Ä¢ –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚úÖ

üí° –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏!`, 'success');

                } else {
                    showResult(`‚ùå –°–ï–°–°–ò–Ø –ù–ï –ù–ê–ô–î–ï–ù–ê

üîç –ü—Ä–æ–±–ª–µ–º—ã:
‚Ä¢ localStorage –ø—É—Å—Ç
‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É
‚Ä¢ –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã

üí° –†–µ—à–µ–Ω–∏–µ:
1. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
2. –ò–ª–∏ –æ—á–∏—Å—Ç–∏—Ç–µ localStorage –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏: ${error.message}`, 'error');
            }
        };

        window.checkPermissions = function() {
            try {
                const currentUser = localStorage.getItem('currentUser');
                
                if (!currentUser) {
                    showResult('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                    return;
                }

                const user = JSON.parse(currentUser);
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–∫ –≤ AuthContext
                const hasPermission = (permission) => {
                    return user.permissions.includes(permission) || 
                           user.permissions.includes('all') ||
                           user.role === 'system_admin';
                };

                const hasRole = (roleCode) => {
                    return user.role === roleCode;
                };

                showResult(`üõ°Ô∏è –ê–ù–ê–õ–ò–ó –†–ê–ó–†–ï–®–ï–ù–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.name} (${user.role})

üîç –ü–†–û–í–ï–†–ö–ê –û–°–ù–û–í–ù–´–• –†–ê–ó–†–ï–®–ï–ù–ò–ô:

üë• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò:
${hasPermission('users.read') ? '‚úÖ' : '‚ùå'} users.read - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
${hasPermission('users.create') ? '‚úÖ' : '‚ùå'} users.create - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
${hasPermission('users.update') ? '‚úÖ' : '‚ùå'} users.update - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
${hasPermission('users.delete') ? '‚úÖ' : '‚ùå'} users.delete - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

üåê –°–ï–¢–ò –ò –¢–û–ß–ö–ò:
${hasPermission('networks.read') ? '‚úÖ' : '‚ùå'} networks.read - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Ç–µ–π
${hasPermission('trading_points.read') ? '‚úÖ' : '‚ùå'} trading_points.read - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ—á–µ–∫
${hasPermission('equipment.read') ? '‚úÖ' : '‚ùå'} equipment.read - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

üìä –û–ü–ï–†–ê–¶–ò–ò:
${hasPermission('operations.read') ? '‚úÖ' : '‚ùå'} operations.read - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–ø–µ—Ä–∞—Ü–∏–π
${hasPermission('operations.create') ? '‚úÖ' : '‚ùå'} operations.create - –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
${hasPermission('reports.read') ? '‚úÖ' : '‚ùå'} reports.read - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤

‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò:
${hasPermission('settings.read') ? '‚úÖ' : '‚ùå'} settings.read - –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
${hasPermission('settings.update') ? '‚úÖ' : '‚ùå'} settings.update - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

üéØ –ü–†–û–í–ï–†–ö–ê –†–û–õ–ï–ô:
${hasRole('system_admin') ? '‚úÖ' : '‚ùå'} –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
${hasRole('network_admin') ? '‚úÖ' : '‚ùå'} –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ç–∏
${hasRole('manager') ? '‚úÖ' : '‚ùå'} –ú–µ–Ω–µ–¥–∂–µ—Ä  
${hasRole('operator') ? '‚úÖ' : '‚ùå'} –û–ø–µ—Ä–∞—Ç–æ—Ä

üîí –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò:
${user.role === 'system_admin' ? '‚úÖ' : '‚ùå'} canManageUsers() - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
${user.role === 'system_admin' ? '‚úÖ' : '‚ùå'} canManageTanks() - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞–º–∏
${user.role === 'system_admin' ? '‚úÖ' : '‚ùå'} canManagePrices() - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏
${user.role === 'system_admin' ? '‚úÖ' : '‚ùå'} canViewReports() - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤

üí° –í–´–í–û–î: ${user.role === 'system_admin' ? '–ü–û–õ–ù–´–ô –î–û–°–¢–£–ü –ö–û –í–°–ï–ú –§–£–ù–ö–¶–ò–Ø–ú' : '–û–ì–†–ê–ù–ò–ß–ï–ù–ù–´–ô –î–û–°–¢–£–ü'}`, user.role === 'system_admin' ? 'success' : 'info');

            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: ${error.message}`, 'error');
            }
        };

        window.openMainApp = function() {
            window.open('http://localhost:3000', '_blank');
        };

        window.openLoginPage = function() {
            // –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
            localStorage.removeItem('currentUser');
            localStorage.removeItem('auth_token');
            window.open('http://localhost:3000', '_blank');
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            analyzeAuthStructure();
        });
    </script>
</body>
</html>