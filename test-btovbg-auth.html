<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test btovbg@mail.ru Auth</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
        button { margin: 5px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ btovbg@mail.ru</h1>

    <div>
        <h3>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î:</h3>
        <pre>Email: btovbg@mail.ru
Salt: 9iqa37cbpfs3dksuw0qp5w
Hash: 9a+VxRBq6WmhcqOiCU00JkE4f5rLi6NleqHhKdOFdyI=</pre>
    </div>

    <div>
        <h3>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</h3>
        <input type="email" id="email" value="btovbg@mail.ru" readonly>
        <input type="password" id="password" value="qwerty" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="testAuth()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
        <button onclick="testDifferentPasswords()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏</button>
    </div>

    <div id="results"></div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userData = {
            email: 'btovbg@mail.ru',
            pwd_salt: '9iqa37cbpfs3dksuw0qp5w',
            pwd_hash: '9a+VxRBq6WmhcqOiCU00JkE4f5rLi6NleqHhKdOFdyI='
        };

        // –ü—Ä–æ—Å—Ç–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–∞–∫ –≤ authService)
        async function createPasswordHash(password, salt) {
            const passwordWithSalt = password + salt;

            if (crypto && crypto.subtle) {
                const encoder = new TextEncoder();
                const data = encoder.encode(passwordWithSalt);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return btoa(String.fromCharCode(...hashArray));
            } else {
                return btoa(passwordWithSalt);
            }
        }

        function addResult(title, content, isSuccess = null) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${isSuccess === true ? 'success' : isSuccess === false ? 'error' : ''}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            results.appendChild(div);
        }

        async function testAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            console.log('üîê –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:', { email, password });

            // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const passwordWithSalt = password + userData.pwd_salt;
            const computedHash = await createPasswordHash(password, userData.pwd_salt);
            const isValid = computedHash === userData.pwd_hash;

            const result = {
                email: email,
                password: password,
                salt: userData.pwd_salt,
                passwordWithSalt: passwordWithSalt,
                computedHash: computedHash,
                storedHash: userData.pwd_hash,
                match: isValid,
                result: isValid ? '‚úÖ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –£–°–ü–ï–®–ù–ê' : '‚ùå –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ü–†–û–í–ê–õ–ï–ù–ê',
                method: crypto && crypto.subtle ? 'SHA-256' : 'Base64'
            };

            addResult(
                `–¢–µ—Å—Ç: ${email} / ${password}`,
                JSON.stringify(result, null, 2),
                isValid
            );

            if (isValid) {
                console.log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!');
            } else {
                console.log('‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–µ–Ω–∞');
                console.log('–î–µ—Ç–∞–ª–∏:', result);
            }
        }

        async function testDifferentPasswords() {
            const passwords = ['qwerty', 'password', '123456', 'test', 'admin', 'user', 'qwerty123'];

            addResult('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π', '–ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ–±–æ—Ä...');

            for (const password of passwords) {
                const computedHash = await createPasswordHash(password, userData.pwd_salt);
                const isValid = computedHash === userData.pwd_hash;

                addResult(
                    `–ü–∞—Ä–æ–ª—å: "${password}"`,
                    `Hash: ${computedHash}\nMatch: ${isValid ? '‚úÖ –ù–ê–ô–î–ï–ù!' : '‚ùå'}`,
                    isValid ? true : null
                );

                if (isValid) {
                    alert(`–ù–ê–ô–î–ï–ù –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–ê–†–û–õ–¨: "${password}"`);
                    break;
                }
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
        window.addEventListener('load', () => {
            addResult('–°—Ç–∞—Ç—É—Å Web Crypto API', JSON.stringify({
                protocol: window.location.protocol,
                isSecure: window.isSecureContext,
                crypto_available: !!crypto,
                subtle_available: !!(crypto && crypto.subtle),
                method: crypto && crypto.subtle ? 'SHA-256 (–±—ã—Å—Ç—Ä–æ)' : 'Base64 (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)'
            }, null, 2));
        });
    </script>
</body>
</html>