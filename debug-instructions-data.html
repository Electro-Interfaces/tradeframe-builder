<!DOCTYPE html>
<html>
<head>
    <title>Debug Instructions Data</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #fde8e8; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        .warning { background: #fff3e0; border-color: #ff9800; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; font-size: 12px; max-height: 400px; }
        .button { 
            background: #2196f3; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 5px; 
            cursor: pointer;
        }
        .button:hover { background: #1976d2; }
    </style>
</head>
<body>
    <h1>üîç Debug Instructions Data Loading</h1>
    
    <div class="test info">
        <h3>üìã –ü—Ä–æ–±–ª–µ–º–∞</h3>
        <p>–î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.</p>
        <p><strong>–ü—Ä–æ–≤–µ—Ä–∏–º:</strong> –î–∞–Ω–Ω—ã–µ –≤ –ë–î, –∑–∞–ø—Ä–æ—Å—ã Supabase, –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏</p>
    </div>
    
    <div class="test">
        <h3>üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
        <button class="button" onclick="checkPageHelpTable()">1. Check page_help Table</button>
        <button class="button" onclick="testDirectSupabaseQuery()">2. Test Direct Supabase Query</button>
        <button class="button" onclick="testInstructionsService()">3. Test Instructions Service</button>
        <button class="button" onclick="checkConsoleErrors()">4. Check Console</button>
    </div>

    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');
        
        function addResult(title, type, data) {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        window.checkPageHelpTable = async function() {
            try {
                const { createClient } = await import('https://esm.sh/@supabase/supabase-js@2');
                
                const supabaseUrl = 'https://tohtryzyffcebtyvkxwh.supabase.co';
                const serviceRoleKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';

                const supabase = createClient(supabaseUrl, serviceRoleKey);

                // Check if page_help table exists and has data
                const { data, error, count } = await supabase
                    .from('page_help')
                    .select('*', { count: 'exact' })
                    .limit(10);

                if (error) {
                    addResult('‚ùå page_help Table Check Failed', 'error', {
                        error: error.message,
                        code: error.code,
                        details: error.details,
                        hint: error.hint
                    });
                } else {
                    addResult('‚úÖ page_help Table Check Success', 'success', {
                        total_count: count,
                        sample_records: data,
                        table_status: data.length > 0 ? 'Has Data' : 'Empty Table'
                    });
                }
            } catch (error) {
                addResult('‚ùå Connection Error', 'error', error.message);
            }
        };

        window.testDirectSupabaseQuery = async function() {
            try {
                const { createClient } = await import('https://esm.sh/@supabase/supabase-js@2');
                
                const supabaseUrl = 'https://tohtryzyffcebtyvkxwh.supabase.co';
                const serviceRoleKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';

                const supabase = createClient(supabaseUrl, serviceRoleKey);

                // Simulate the query from InstructionsService.getTopics()
                const { data, error } = await supabase
                    .from('page_help')
                    .select('*')
                    .is('deleted_at', null)
                    .eq('is_active', true)
                    .order('route');

                if (error) {
                    addResult('‚ùå Direct Query Failed', 'error', error);
                } else {
                    // Group by route and get latest version (similar to InstructionsService logic)
                    const topicsMap = new Map();
                    data.forEach(record => {
                        const existing = topicsMap.get(record.route);
                        if (!existing || record.version > existing.version) {
                            topicsMap.set(record.route, record);
                        }
                    });
                    
                    const topics = Array.from(topicsMap.values()).map(record => ({
                        id: record.id,
                        key: record.route.replace(/^\//, '').replace(/\//g, '-'),
                        route: record.route,
                        title: record.title,
                        description: record.content.substring(0, 100) + '...',
                        is_active: record.is_active,
                        views_total: 0,
                        created_at: record.created_at,
                        updated_at: record.updated_at
                    }));

                    addResult('‚úÖ Direct Query Success', 'success', {
                        raw_records: data.length,
                        grouped_topics: topics.length,
                        topics: topics
                    });
                }
            } catch (error) {
                addResult('‚ùå Direct Query Error', 'error', error.message);
            }
        };

        window.testInstructionsService = function() {
            // Try to call the service from the application context
            const msg = `
–ß—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å InstructionsService:

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Console  
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

// Import service
const service = await import('/src/services/instructionsServiceDatabase.ts');

// Test connection
console.log('Testing InstructionsService...');
try {
  const topics = await service.InstructionsService.getTopics();
  console.log('‚úÖ Topics loaded:', topics);
} catch (error) {
  console.error('‚ùå Service error:', error);
}

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∂–µ—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–µ—Ä–≤–∏—Å –∏–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏.
            `;
            
            addResult('üõ†Ô∏è Manual Service Test', 'info', msg);
        };

        window.checkConsoleErrors = function() {
            const msg = `
üñ•Ô∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫:

–•–û–†–û–®–ò–ï —Å–∏–≥–Ω–∞–ª—ã:
‚Ä¢ "üîß Supabase Service Client Configuration" - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
‚Ä¢ "‚úÖ Topics loaded: ..." - –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã  
‚Ä¢ –£—Å–ø–µ—à–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase

–ü–õ–û–•–ò–ï —Å–∏–≥–Ω–∞–ª—ã:
‚Ä¢ "‚ùå Error fetching topics" - –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ "PGRST116" –∏–ª–∏ "PGRST301" - –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–±–ª–∏—Ü–µ–π/–ø—Ä–∞–≤–∞–º–∏
‚Ä¢ "relation does not exist" - —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
‚Ä¢ Network errors - –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

–ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨:
1. F12 -> Console
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            `;
            
            addResult('üñ•Ô∏è Console Check Guide', 'info', msg);
        };

        // Auto-check table on load
        setTimeout(() => {
            addResult('üöÄ Auto-running checks...', 'info', 'Starting automatic diagnostics');
            checkPageHelpTable();
        }, 1000);
    </script>
</body>
</html>