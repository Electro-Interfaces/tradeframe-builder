<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ID</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .problem { background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .solution { background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 11px; max-height: 300px; }
        .uuid { color: #dc3545; font-family: monospace; font-weight: bold; }
        .external-id { color: #28a745; font-family: monospace; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üö® –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å ID</h1>
    
    <div class="problem">
        <h3>‚ùå –ü—Ä–æ–±–ª–µ–º–∞:</h3>
        <p>–í —Ç–∞–±–ª–∏—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è UUID –≤–º–µ—Å—Ç–æ external_id:</p>
        <ul>
            <li class="uuid">f5f5961a-4ae0-400f-b40a-1f630a329434</li>
            <li class="uuid">b5e25b51-a950-481e-a09d-ac25e6b5d6ab</li>
        </ul>
        <p>–ê –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è:</p>
        <ul>
            <li class="external-id">1</li>
            <li class="external-id">15</li>
        </ul>
    </div>

    <div class="solution">
        <button onclick="checkCurrentData()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="fixExternalIds()">üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å external_id –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</button>
    </div>

    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI'
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        function logResult(message, type = 'info', data = null) {
            const resultsDiv = document.getElementById('results')
            const div = document.createElement('div')
            div.className = type
            
            let content = `<h4>${message}</h4>`
            if (data) {
                content += `<pre>${JSON.stringify(data, null, 2)}</pre>`
            }
            div.innerHTML = content
            
            resultsDiv.appendChild(div)
        }

        window.checkCurrentData = async function() {
            logResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ...', 'info')
            
            try {
                const { data, error } = await supabase
                    .from('networks')
                    .select('id, name, external_id')
                    .order('name')
                
                if (error) throw error
                
                logResult('üìä –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã:', 'info', data)
                
                const problems = data.filter(n => !n.external_id)
                if (problems.length > 0) {
                    logResult('‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ë–ï–ó external_id:', 'problem', problems)
                } else {
                    logResult('‚úÖ –í—Å–µ –∑–∞–ø–∏—Å–∏ –∏–º–µ—é—Ç external_id!', 'solution')
                }
                
            } catch (error) {
                logResult('üí• –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'problem', error)
            }
        }

        window.fixExternalIds = async function() {
            logResult('üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º external_id –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å...', 'info')
            
            try {
                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –î–µ–º–æ —Å–µ—Ç—å
                const { error: error1 } = await supabase
                    .from('networks')
                    .update({ external_id: '1' })
                    .like('name', '%–î–µ–º–æ —Å–µ—Ç—å%')
                
                if (error1) throw error1
                
                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ù–æ—Ä–¥ –õ–∞–π–Ω
                const { error: error2 } = await supabase
                    .from('networks')
                    .update({ external_id: '15' })
                    .like('name', '%–ù–æ—Ä–¥%')
                
                if (error2) throw error2
                
                logResult('‚úÖ external_id –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!', 'solution')
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                await checkCurrentData()
                
                logResult('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π!', 'solution')
                
            } catch (error) {
                logResult('üí• –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è', 'problem', error)
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkCurrentData, 500)
        })
    </script>
</body>
</html>