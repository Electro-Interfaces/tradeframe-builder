<!DOCTYPE html>
<html>
<head>
    <title>‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô –§–ò–õ–¨–¢–†–ê–¶–ò–ò</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; background: #1e293b; color: white; padding: 20px; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; }
        .success { background: #10b981; color: white; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .error { background: #dc2626; color: white; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .info { background: #3b82f6; color: white; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .critical { background: #ff6b35; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; font-weight: bold; }
        .section { background: #374151; padding: 20px; border-radius: 8px; margin: 15px 0; }
        .fixes { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin: 20px 0; }
        .fix { background: #10b981; padding: 15px; border-radius: 8px; }
        .before-after { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .before { background: #dc2626; padding: 15px; border-radius: 8px; }
        .after { background: #10b981; padding: 15px; border-radius: 8px; }
        button { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        .instruction { background: #f59e0b; color: black; padding: 15px; border-radius: 6px; margin: 10px 0; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô –§–ò–õ–¨–¢–†–ê–¶–ò–ò</h1>
        
        <div class="critical">
            <h2>üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –£–°–¢–†–ê–ù–ï–ù–ê!</h2>
            <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Supabase: —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞—â–∞–ª–∞—Å—å –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö!</p>
        </div>

        <div class="fixes">
            <div class="fix">
                <h3>‚úÖ operationsSupabaseService.ts</h3>
                <p>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã URL –∏ service_role key</p>
                <p>–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
            </div>
            <div class="fix">
                <h3>‚úÖ supabaseClientBrowser.ts</h3>
                <p>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã fallback –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                <p>–û–±–Ω–æ–≤–ª–µ–Ω—ã environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</p>
            </div>
            <div class="fix">
                <h3>‚úÖ apiConfigService.ts</h3>
                <p>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
                <p>–û–±–Ω–æ–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</p>
            </div>
        </div>

        <div class="section">
            <h3>üìä –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:</h3>
            <div class="before-after">
                <div class="before">
                    <h4>‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</h4>
                    <p><strong>URL:</strong> https://tohtryzyffcebtyvkxwh.supabase.co</p>
                    <p><strong>Key:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIi4uLg==</p>
                    <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ü–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã</p>
                    <p><strong>–î–∞–Ω–Ω—ã–µ:</strong> ~1,154,246 ‚ÇΩ, 1000+ –æ–ø–µ—Ä–∞—Ü–∏–π</p>
                </div>
                <div class="after">
                    <h4>‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ï –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</h4>
                    <p><strong>URL:</strong> https://dlvggjmirqhmdylfwngm.supabase.co</p>
                    <p><strong>Key:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdmdnam1pcnFobWR5bGZ3bmdtIi4uLg==</p>
                    <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏</p>
                    <p><strong>–û–∂–∏–¥–∞–µ—Ç—Å—è:</strong> ~50-80 —Ç—ã—Å—è—á ‚ÇΩ, ~15 –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4</p>
                </div>
            </div>
        </div>

        <div class="instruction">
            <h3>üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –§–ò–ù–ê–õ–¨–ù–û–ô –ü–†–û–í–ï–†–ö–ï:</h3>
            <ol>
                <li><strong>–û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</strong> (–∫–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ)</li>
                <li><strong>–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ç—å 15 "–ù–æ—Ä–¥ –õ–∞–π–Ω"</strong> –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ</li>
                <li><strong>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é 4</strong> –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫</li>
                <li><strong>–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)</strong> –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console</li>
                <li><strong>–ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:</strong>
                    <ul>
                        <li>üéØ –ö–†–ò–¢–ò–ß–ù–û: –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–µ –≤ Supabase: 6969b08d-1cbe-45c2-ae9c-8002c7022b59</li>
                        <li>üîç –ö–†–ò–¢–ò–ß–ù–û: –§–∏–Ω–∞–ª—å–Ω—ã–π URL –∑–∞–ø—Ä–æ—Å–∞ –∫ Supabase: https://dlvggjmirqhmdylfwngm.supabase.co/...</li>
                        <li>‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ Supabase: (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~15, –Ω–µ 1000+)</li>
                    </ul>
                </li>
                <li><strong>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã:</strong>
                    <ul>
                        <li>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ~50,000-80,000 ‚ÇΩ (–ù–ï 1+ –º–ª–Ω)</li>
                        <li>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: ~15 –æ–ø–µ—Ä–∞—Ü–∏–π (–ù–ï 1000+)</li>
                        <li>–¢–æ–ø–ª–∏–≤–æ –æ—Ç–ø—É—â–µ–Ω–æ: ~1,000-1,500 –ª–∏—Ç—Ä–æ–≤</li>
                        <li>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ~3,000-5,000 ‚ÇΩ</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="section">
            <h3>üß™ –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã:</h3>
            <button onclick="openMainApp()">üåê –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <button onclick="openSalesAnalysis()">üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂</button>
            <button onclick="runDirectTest()">üéØ –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç Supabase</button>
            <button onclick="openDebugPage()">üîç –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–ª–∞–¥–∫–∏</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const STATION_4_UUID = '6969b08d-1cbe-45c2-ae9c-8002c7022b59';
        const CORRECT_URL = 'https://dlvggjmirqhmdylfwngm.supabase.co';
        const CORRECT_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdmdnam1pcnFobWR5bGZ3bmdtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNTY5Njg2NSwiZXhwIjoyMDUxMjcyODY1fQ.SLOvfECCNMeWX-V7Hl4mjfyDGfTLUmLF9GCn3R3NfAY';

        window.openMainApp = function() {
            window.open('http://localhost:3000', '_blank');
        }

        window.openSalesAnalysis = function() {
            window.open('http://localhost:3000/network/operations-transactions', '_blank');
        }

        window.openDebugPage = function() {
            window.open('./debug-sales-analysis.html', '_blank');
        }

        window.runDirectTest = async function() {
            addResult('üéØ –ó–∞–ø—É—Å–∫ –ø—Ä—è–º–æ–≥–æ —Ç–µ—Å—Ç–∞ —Å –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ú–ò –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏...', 'info');

            try {
                const endpoint = `${CORRECT_URL}/rest/v1/operations?select=*&status=eq.completed&trading_point_id=eq.${STATION_4_UUID}&start_time=gte.2025-08-01T00:00:00&start_time=lte.2025-08-31T23:59:59&limit=50`;

                const response = await fetch(endpoint, {
                    headers: {
                        'apikey': CORRECT_KEY,
                        'Authorization': `Bearer ${CORRECT_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const count = data?.length || 0;
                const revenue = data?.reduce((sum, op) => sum + (op.total_cost || 0), 0) || 0;

                if (count === 0) {
                    addResult('‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                } else if (count > 100) {
                    addResult(`‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ï –£–°–¢–†–ê–ù–ï–ù–ê: –ù–∞–π–¥–µ–Ω–æ ${count} –æ–ø–µ—Ä–∞—Ü–∏–π - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'error');
                } else {
                    addResult(`‚úÖ –û–¢–õ–ò–ß–ù–û! –ù–∞–π–¥–µ–Ω–æ ${count} –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ 4`, 'success');
                    addResult(`üí∞ –í—ã—Ä—É—á–∫–∞: ${revenue.toLocaleString('ru-RU')} ‚ÇΩ`, 'success');
                    addResult(`üìä –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û!`, 'success');
                }

            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${error.message}`, 'error');
            }
        }

        function addResult(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            results.appendChild(div);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏—Ç–æ–≥–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            addResult('üéâ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –° –§–ò–õ–¨–¢–†–ê–¶–ò–ï–ô –£–°–¢–†–ê–ù–ï–ù–ê!', 'success');
            addResult('‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Supabase –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ 3 –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö', 'success');
            addResult('üìä –¢–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏', 'info');
            addResult('üîç –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏', 'info');
        });
    </script>
</body>
</html>