<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <h1 class="text-xl font-bold mb-4">‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –≤ –ü–†–ê–í–ò–õ–¨–ù–û–ô –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h1>
    
    <div class="bg-green-900 border border-green-600 rounded-lg p-4 mb-4">
        <p><strong>–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç:</strong> tohtryzyffcebtyvkxwh.supabase.co</p>
        <p><strong>–¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞:</strong> 6969b08d-1cbe-45c2-ae9c-8002c7022b59</p>
    </div>
    
    <button onclick="checkTanks()" class="bg-blue-600 px-4 py-2 rounded mb-4">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã</button>
    <div id="results" class="mt-4 space-y-2"></div>

    <script>
        // –ü–†–ê–í–ò–õ–¨–ù–´–ï –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co';
        const SERVICE_ROLE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';
        
        const TRADING_POINT_ID = '6969b08d-1cbe-45c2-ae9c-8002c7022b59';

        async function checkTanks() {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            function log(message, type = 'info') {
                const div = document.createElement('div');
                div.className = type === 'error' ? 'text-red-400 bg-red-900 p-3 rounded' : 
                                 type === 'success' ? 'text-green-400 bg-green-900 p-3 rounded' : 
                                 'text-blue-400 bg-blue-900 p-3 rounded';
                div.textContent = message;
                results.appendChild(div);
            }
            
            try {
                log(`üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ë–î –¥–ª—è –¢–ü: ${TRADING_POINT_ID}`);
                
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏
                const url1 = `${SUPABASE_URL}/rest/v1/equipment?trading_point_id=eq.${TRADING_POINT_ID}`;
                log(`üìã –ó–∞–ø—Ä–æ—Å –≤—Å–µ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è: ${url1}`);
                
                const resp1 = await fetch(url1, {
                    headers: {
                        'apikey': SERVICE_ROLE_KEY,
                        'Authorization': `Bearer ${SERVICE_ROLE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!resp1.ok) {
                    throw new Error(`HTTP ${resp1.status}: ${resp1.statusText}`);
                }
                
                const allEquipment = await resp1.json();
                log(`‚úÖ –í—Å–µ–≥–æ equipment: ${allEquipment.length}`, 'success');
                
                if (allEquipment.length === 0) {
                    log('‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏!', 'error');
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–æ–æ–±—â–µ —Ç–∞–∫–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞
                    const tpUrl = `${SUPABASE_URL}/rest/v1/trading_points?id=eq.${TRADING_POINT_ID}`;
                    const tpResp = await fetch(tpUrl, {
                        headers: {
                            'apikey': SERVICE_ROLE_KEY,
                            'Authorization': `Bearer ${SERVICE_ROLE_KEY}`
                        }
                    });
                    const tradingPoint = await tpResp.json();
                    
                    if (tradingPoint.length === 0) {
                        log('‚ùå –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ —Å —Ç–∞–∫–∏–º ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î!', 'error');
                    } else {
                        log(`‚úÖ –¢–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${tradingPoint[0].name}`, 'success');
                        log('üí° –†–µ—à–µ–Ω–∏–µ: –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã –¥–ª—è —ç—Ç–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏', 'info');
                    }
                    return;
                }
                
                // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ equipment
                log('üìã –ù–∞–π–¥–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:', 'info');
                allEquipment.forEach((eq, i) => {
                    log(`  ${i+1}. ${eq.name} | type: ${eq.system_type} | status: ${eq.status}`);
                });
                
                // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã
                const url2 = `${SUPABASE_URL}/rest/v1/equipment?trading_point_id=eq.${TRADING_POINT_ID}&system_type=eq.fuel_tank`;
                const resp2 = await fetch(url2, {
                    headers: {
                        'apikey': SERVICE_ROLE_KEY,
                        'Authorization': `Bearer ${SERVICE_ROLE_KEY}`
                    }
                });
                const tanks = await resp2.json();
                
                log(`üõ¢Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ (fuel_tank): ${tanks.length}`, tanks.length > 0 ? 'success' : 'error');
                
                if (tanks.length > 0) {
                    log('‚úÖ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã:', 'success');
                    tanks.forEach((tank, i) => {
                        const fuelType = tank.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞'] || '–ù–ï –£–ö–ê–ó–ê–ù';
                        const status = tank.status || 'active';
                        log(`  ${i+1}. ${tank.name} | –¢–æ–ø–ª–∏–≤–æ: ${fuelType} | –°—Ç–∞—Ç—É—Å: ${status}`);
                        
                        if (!tank.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']) {
                            log(`    ‚ö†Ô∏è –£ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ "${tank.name}" –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ "–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞"!`, 'error');
                        }
                        if (tank.status === 'deleted') {
                            log(`    ‚ö†Ô∏è –†–µ–∑–µ—Ä–≤—É–∞—Ä "${tank.name}" –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—ã–π!`, 'error');
                        }
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã —Å —Ç–æ–ø–ª–∏–≤–æ–º
                    const validTanks = tanks.filter(t => t.status !== 'deleted' && t.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']);
                    const fuelTypes = [...new Set(validTanks.map(t => t.params['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞']))];
                    
                    log(`üî• –ò–¢–û–ì–û –≤–∞–ª–∏–¥–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${validTanks.length}`, validTanks.length > 0 ? 'success' : 'error');
                    log(`üî• –í–∏–¥—ã —Ç–æ–ø–ª–∏–≤–∞: [${fuelTypes.join(', ')}]`, fuelTypes.length > 0 ? 'success' : 'error');
                    
                    if (validTanks.length === 0) {
                        log('‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —Å —Ç–∏–ø–æ–º —Ç–æ–ø–ª–∏–≤–∞!', 'error');
                        log('üí° –†–µ—à–µ–Ω–∏—è:', 'info');
                        log('   ‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä "–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞" –∫ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞–º');
                        log('   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ (–Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "deleted")');
                    }
                } else {
                    log('‚ùå –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!', 'error');
                    log('üí° –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã —Å system_type = "fuel_tank"');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        checkTanks();
    </script>
</body>
</html>