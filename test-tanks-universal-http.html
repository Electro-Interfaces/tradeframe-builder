<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</title>
</head>
<body>
    <h1>üõ¢Ô∏è –¢–µ—Å—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</h1>
    <div id="results"></div>

    <script type="module">
        import { tanksUnifiedService } from './src/services/tanksUnifiedService.js';
        import { httpClient } from './src/services/universalHttpClient.js';

        const results = document.getElementById('results');

        async function testUniversalHttpClient() {
            console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤...');
            results.innerHTML += '<h2>–¢–µ—Å—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞</h2>';

            try {
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ HTTP –∫–ª–∏–µ–Ω—Ç–∞
                console.log('1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...');
                const configInfo = await httpClient.getConfigurationInfo();
                
                console.log('üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', configInfo);
                results.innerHTML += `<div><strong>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTP –∫–ª–∏–µ–Ω—Ç–∞:</strong></div>`;
                results.innerHTML += `<pre>${JSON.stringify(configInfo, null, 2)}</pre>`;

                // 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º API
                console.log('2Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º API...');
                results.innerHTML += `<h3>–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</h3>`;
                
                const connectionTest = await httpClient.testExternalApiConnection();
                console.log('üîß –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', connectionTest);
                
                if (connectionTest.success) {
                    results.innerHTML += `<div style="color: green;">‚úÖ ${connectionTest.data ? '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ' : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç'}</div>`;
                    results.innerHTML += `<pre>${JSON.stringify(connectionTest.data, null, 2)}</pre>`;
                } else {
                    results.innerHTML += `<div style="color: red;">‚ùå ${connectionTest.error}</div>`;
                }

                // 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å 
                console.log('3Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤...');
                results.innerHTML += `<h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤</h3>`;
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º ID –ø–µ—Ä–≤–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∞
                const testTradingPointId = 'tp-demo-1';
                const tanksResult = await tanksUnifiedService.getTanksForTradingPoint(testTradingPointId);
                
                console.log('üõ¢Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤:', tanksResult);
                results.innerHTML += `<div><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤:</strong></div>`;
                results.innerHTML += `<div>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: <strong>${tanksResult.source}</strong></div>`;
                results.innerHTML += `<div>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: <strong>${tanksResult.synchronized}</strong></div>`;
                results.innerHTML += `<div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: <strong>${tanksResult.tanks.length}</strong></div>`;
                
                if (tanksResult.error) {
                    results.innerHTML += `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${tanksResult.error}</div>`;
                }
                
                if (tanksResult.tanks.length > 0) {
                    results.innerHTML += `<div style="color: green;">‚úÖ –î–∞–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!</div>`;
                    results.innerHTML += `<pre>${JSON.stringify(tanksResult.tanks.slice(0, 2), null, 2)}</pre>`;
                } else {
                    results.innerHTML += `<div style="color: orange;">‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>`;
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:', error);
                results.innerHTML += `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
        testUniversalHttpClient();
    </script>
</body>
</html>