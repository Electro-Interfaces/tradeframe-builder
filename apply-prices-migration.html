<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü —Ü–µ–Ω</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2d3748;
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #b7d4ea; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover { background: #0056b3; }
        button:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
        }
        
        .sql-preview {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
        }
        
        .step {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .step-header {
            background: #f8f9fa;
            padding: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .step-content {
            padding: 15px;
            display: none;
        }
        
        .step.active .step-content {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .log {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–∞ —Ü–µ–Ω—ã –≤ Supabase</h1>
        
        <div class="info status">
            <strong>–¶–µ–ª—å:</strong> –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü <code>prices</code> –∏ <code>price_packages</code>, 
            –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ <code>fuel_type_id</code> –≤ —Ç–∞–±–ª–∏—Ü—É <code>nomenclature</code>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="step">
            <div class="step-header" onclick="toggleStep(this)">
                <span>1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î</span>
                <span>‚ñº</span>
            </div>
            <div class="step-content">
                <p>–ü—Ä–æ–≤–µ—Ä–∏–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—É</p>
                <button onclick="checkCurrentState()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î</button>
                <div id="currentStateResult"></div>
            </div>
        </div>
        
        <div class="step">
            <div class="step-header" onclick="toggleStep(this)">
                <span>2Ô∏è‚É£ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä SQL</span>
                <span>‚ñº</span>
            </div>
            <div class="step-content">
                <p>SQL –∫–æ–º–∞–Ω–¥—ã –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:</p>
                <div class="sql-preview" id="sqlPreview">–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
            </div>
        </div>
        
        <div class="step">
            <div class="step-header" onclick="toggleStep(this)">
                <span>3Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏</span>
                <span>‚ñº</span>
            </div>
            <div class="step-content">
                <p>–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Supabase SQL Editor</p>
                <button onclick="generateMigrationScript()" id="generateBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL —Å–∫—Ä–∏–ø—Ç</button>
                <div id="migrationResult"></div>
                <textarea id="migrationSQL" style="width:100%;height:300px;font-family:monospace;display:none"></textarea>
            </div>
        </div>
        
        <div class="step">
            <div class="step-header" onclick="toggleStep(this)">
                <span>4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</span>
                <span>‚ñº</span>
            </div>
            <div class="step-content">
                <p>–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –≤ Supabase, –ø—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç</p>
                <button onclick="verifyMigration()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
                <div id="verificationResult"></div>
            </div>
        </div>
        
        <div class="log" id="log">
üü¢ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏...\n
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI';

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        function toggleStep(header) {
            const step = header.parentElement;
            step.classList.toggle('active');
            const arrow = header.querySelector('span:last-child');
            arrow.textContent = step.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        async function checkCurrentState() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î...');
            updateProgress(10);
            
            const resultDiv = document.getElementById('currentStateResult');
            resultDiv.innerHTML = '<div class="info status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>';

            try {
                const tables = ['prices', 'price_packages', 'nomenclature', 'fuel_types'];
                const results = [];

                for (const table of tables) {
                    try {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?limit=1`, {
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            results.push(`‚úÖ ${table}: –°—É—â–µ—Å—Ç–≤—É–µ—Ç (${data.length} –∑–∞–ø–∏—Å–µ–π –≤ –≤—ã–±–æ—Ä–∫–µ)`);
                            
                            if (table === 'nomenclature' && data.length > 0) {
                                const hasConnection = 'fuel_type_id' in data[0];
                                results.push(`   üîó fuel_type_id: ${hasConnection ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}`);
                            }
                        } else if (response.status === 404) {
                            results.push(`‚ùå ${table}: –ù–µ –Ω–∞–π–¥–µ–Ω–∞`);
                        } else {
                            results.push(`‚ö†Ô∏è ${table}: –°—Ç–∞—Ç—É—Å ${response.status}`);
                        }
                    } catch (error) {
                        results.push(`‚ùå ${table}: –û—à–∏–±–∫–∞ - ${error.message}`);
                    }
                }

                resultDiv.innerHTML = `
                    <div class="info status">
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong><br>
                        ${results.join('<br>')}
                    </div>
                `;

                log('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                updateProgress(25);

            } catch (error) {
                resultDiv.innerHTML = `<div class="error status">–û—à–∏–±–∫–∞: ${error.message}</div>`;
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`);
            }
        }

        function generateMigrationScript() {
            log('üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏...');
            updateProgress(50);

            const sqlScript = `-- ===============================================
-- PRICES SCHEMA MIGRATION
-- Migration: 008_prices_schema.sql  
-- Description: Creates tables for price management system
-- Date: ${new Date().toISOString()}
-- ===============================================

-- Enable UUID extension (if not already enabled)
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Add fuel_type_id column to nomenclature for proper linking
ALTER TABLE nomenclature 
ADD COLUMN IF NOT EXISTS fuel_type_id UUID REFERENCES fuel_types(id);

-- Create index for performance
CREATE INDEX IF NOT EXISTS idx_nomenclature_fuel_type ON nomenclature(fuel_type_id);

-- Update existing nomenclature records to link with fuel_types based on internal_code
UPDATE nomenclature SET fuel_type_id = (
    SELECT ft.id 
    FROM fuel_types ft 
    WHERE ft.code = nomenclature.internal_code
) WHERE fuel_type_id IS NULL;

-- Price Packages table
CREATE TABLE IF NOT EXISTS price_packages (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    network_id UUID NOT NULL REFERENCES networks(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(50) NOT NULL,
    description TEXT,
    trading_point_ids UUID[] NOT NULL DEFAULT '{}',
    status VARCHAR(50) DEFAULT 'draft' CHECK (status IN ('draft', 'pending', 'approved', 'active', 'archived', 'cancelled')),
    valid_from TIMESTAMPTZ NOT NULL,
    valid_to TIMESTAMPTZ,
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMPTZ,
    created_by UUID NOT NULL REFERENCES users(id),
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(network_id, code)
);

-- Prices table
CREATE TABLE IF NOT EXISTS prices (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    package_id UUID REFERENCES price_packages(id) ON DELETE CASCADE,
    trading_point_id UUID NOT NULL REFERENCES trading_points(id) ON DELETE CASCADE,
    fuel_type_id UUID NOT NULL REFERENCES fuel_types(id) ON DELETE CASCADE,
    nomenclature_id UUID REFERENCES nomenclature(id) ON DELETE SET NULL,
    price_net INTEGER NOT NULL,
    vat_rate DECIMAL(5,2) DEFAULT 20.00,
    price_gross INTEGER NOT NULL,
    source VARCHAR(50) DEFAULT 'manual' CHECK (source IN ('manual', 'import', 'api', 'package', 'system')),
    currency VARCHAR(3) DEFAULT 'RUB',
    unit VARCHAR(10) DEFAULT 'L',
    valid_from TIMESTAMPTZ NOT NULL,
    valid_to TIMESTAMPTZ,
    is_active BOOLEAN DEFAULT true,
    created_by UUID NOT NULL REFERENCES users(id),
    reason VARCHAR(255),
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT prices_valid_period_check CHECK (valid_from <= COALESCE(valid_to, '2099-12-31'::timestamptz))
);

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_price_packages_network ON price_packages(network_id);
CREATE INDEX IF NOT EXISTS idx_price_packages_status ON price_packages(status);
CREATE INDEX IF NOT EXISTS idx_prices_trading_point ON prices(trading_point_id);
CREATE INDEX IF NOT EXISTS idx_prices_fuel_type ON prices(fuel_type_id);
CREATE INDEX IF NOT EXISTS idx_prices_is_active ON prices(is_active);
CREATE INDEX IF NOT EXISTS idx_prices_point_fuel_active ON prices(trading_point_id, fuel_type_id, is_active);

-- Functions
CREATE OR REPLACE FUNCTION get_active_price(
    p_trading_point_id UUID,
    p_fuel_type_id UUID,
    p_effective_date TIMESTAMPTZ DEFAULT NOW()
)
RETURNS TABLE(
    id UUID,
    price_net INTEGER,
    vat_rate DECIMAL,
    price_gross INTEGER,
    valid_from TIMESTAMPTZ,
    valid_to TIMESTAMPTZ
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        p.id,
        p.price_net,
        p.vat_rate,
        p.price_gross,
        p.valid_from,
        p.valid_to
    FROM prices p
    WHERE p.trading_point_id = p_trading_point_id
      AND p.fuel_type_id = p_fuel_type_id
      AND p.is_active = true
      AND p.valid_from <= p_effective_date
      AND (p.valid_to IS NULL OR p.valid_to >= p_effective_date)
    ORDER BY p.valid_from DESC
    LIMIT 1;
END;
$$ LANGUAGE plpgsql;

-- Enable RLS
ALTER TABLE price_packages ENABLE ROW LEVEL SECURITY;
ALTER TABLE prices ENABLE ROW LEVEL SECURITY;

-- RLS Policies (–±–∞–∑–æ–≤—ã–µ)
CREATE POLICY IF NOT EXISTS "price_packages_network_isolation" ON price_packages
    FOR ALL USING (true);

CREATE POLICY IF NOT EXISTS "prices_public_read" ON prices  
    FOR ALL USING (true);

-- Comments
COMMENT ON TABLE price_packages IS 'Price packages for grouped price management';
COMMENT ON TABLE prices IS 'Individual fuel prices at trading points';
COMMENT ON COLUMN prices.price_net IS 'Price without VAT in kopecks';
COMMENT ON COLUMN prices.price_gross IS 'Price with VAT in kopecks';

SELECT 'Migration completed successfully! Tables created: price_packages, prices. Updated: nomenclature' as result;`;

            document.getElementById('migrationSQL').value = sqlScript;
            document.getElementById('migrationSQL').style.display = 'block';
            
            document.getElementById('migrationResult').innerHTML = `
                <div class="success status">
                    <strong>SQL —Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤!</strong><br>
                    1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –Ω–∏–∂–µ<br>
                    2. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor<br>
                    3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –∏ –Ω–∞–∂–º–∏—Ç–µ "RUN"<br>
                    4. –í–µ—Ä–Ω–∏—Ç–µ—Å—å —Å—é–¥–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
                </div>
                <button onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å SQL –≤ –±—É—Ñ–µ—Ä</button>
                <button onclick="window.open('https://supabase.com/dashboard/project/tohtryzyffcebtyvkxwh/sql', '_blank')">üöÄ –û—Ç–∫—Ä—ã—Ç—å SQL Editor</button>
            `;

            log('‚úÖ SQL —Å–∫—Ä–∏–ø—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
            updateProgress(75);
        }

        function copyToClipboard() {
            const sqlTextarea = document.getElementById('migrationSQL');
            sqlTextarea.select();
            document.execCommand('copy');
            log('üìã SQL —Å–∫—Ä–∏–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
        }

        async function verifyMigration() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏...');
            updateProgress(90);

            const resultDiv = document.getElementById('verificationResult');
            resultDiv.innerHTML = '<div class="info status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>';

            try {
                const checks = [];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—ã
                const tables = ['prices', 'price_packages'];
                for (const table of tables) {
                    try {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/${table}?limit=1`, {
                            headers: {
                                'apikey': SUPABASE_ANON_KEY,
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            checks.push(`‚úÖ ${table}: –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞`);
                        } else {
                            checks.push(`‚ùå ${table}: –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (${response.status})`);
                        }
                    } catch (error) {
                        checks.push(`‚ùå ${table}: –û—à–∏–±–∫–∞ - ${error.message}`);
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑—å nomenclature
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/nomenclature?limit=1&select=id,fuel_type_id`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const hasConnection = data.length > 0 && 'fuel_type_id' in data[0];
                        checks.push(`üîó nomenclature.fuel_type_id: ${hasConnection ? '‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ' : '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}`);
                    }
                } catch (error) {
                    checks.push(`‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ nomenclature: ${error.message}`);
                }

                const allSuccess = checks.every(check => check.includes('‚úÖ'));
                
                resultDiv.innerHTML = `
                    <div class="${allSuccess ? 'success' : 'warning'} status">
                        <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong><br>
                        ${checks.join('<br>')}
                        <br><br>
                        ${allSuccess ? 
                            'üéâ <strong>–ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</strong> –†–∞–∑–¥–µ–ª —Ü–µ–Ω—ã –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.' : 
                            '‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –≤ Supabase.'
                        }
                    </div>
                `;

                log(allSuccess ? '‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!' : '‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π');
                updateProgress(100);

            } catch (error) {
                resultDiv.innerHTML = `<div class="error status">–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}</div>`;
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ —Ü–µ–Ω—ã');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä SQL
            const preview = document.getElementById('sqlPreview');
            preview.textContent = `CREATE TABLE IF NOT EXISTS price_packages (...)
CREATE TABLE IF NOT EXISTS prices (...)
ALTER TABLE nomenclature ADD COLUMN fuel_type_id...
-- –ò –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤, —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.`;
            
            updateProgress(5);
        });
    </script>
</body>
</html>