<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1e1e1e; 
            color: #fff; 
            padding: 20px; 
            line-height: 1.4;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        .code { 
            background: #0d1117; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #444;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ –¢–ï–°–¢ –°–ò–°–¢–ï–ú–ù–û–ô –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏"</p>
    
    <button onclick="testSystemConfig()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
    <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(message, type = 'normal') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            log.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }
        
        window.clearLog = function() {
            log.innerHTML = '';
        }
        
        window.testSystemConfig = async function() {
            addLog('üîç –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 'info');
            
            try {
                // –¢–µ—Å—Ç 1: –ò–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–æ–≤
                addLog('üì¶ –ò–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–æ–≤...', 'info');
                const { systemConfigService } = await import('./src/services/systemConfigService.js');
                const { tradingNetworkConfigService } = await import('./src/services/tradingNetworkConfigService.js');
                const { apiConfigServiceDB } = await import('./src/services/apiConfigServiceDB.js');
                addLog('‚úÖ –°–µ—Ä–≤–∏—Å—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                
                // –¢–µ—Å—Ç 2: Health check —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                addLog('üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...', 'info');
                const healthCheck = await systemConfigService.healthCheck();
                addLog(`<div class="code">
                    –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: ${healthCheck.healthy ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}<br>
                    –û—à–∏–±–∫–∞: ${healthCheck.error || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                </div>`, healthCheck.healthy ? 'success' : 'error');
                
                if (!healthCheck.healthy) {
                    addLog('‚ùå –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞!', 'error');
                    return;
                }
                
                // –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏
                addLog('üåê –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏...', 'info');
                try {
                    const tradingConfig = await tradingNetworkConfigService.getConfig();
                    addLog('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏ –ø–æ–ª—É—á–µ–Ω–∞', 'success');
                    addLog(`<div class="code">
                        –í–∫–ª—é—á–µ–Ω–∞: ${tradingConfig.enabled}<br>
                        Base URL: ${tradingConfig.baseUrl}<br>
                        System ID: ${tradingConfig.systemId}<br>
                        Station ID: ${tradingConfig.defaultStationId}<br>
                        Auth Type: ${tradingConfig.authType}<br>
                        Username: ${tradingConfig.username}<br>
                        Password: ${tradingConfig.password ? '‚úÖ –µ—Å—Ç—å' : '‚ùå –Ω–µ—Ç'}<br>
                        Endpoints: ${JSON.stringify(tradingConfig.endpoints, null, 2)}
                    </div>`, 'info');
                } catch (error) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Ç–∏: ${error.message}`, 'error');
                }
                
                // –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
                addLog('üóÑÔ∏è –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î...', 'info');
                try {
                    const dbConfig = await systemConfigService.getDatabaseConfig();
                    addLog('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î –ø–æ–ª—É—á–µ–Ω–∞', 'success');
                    addLog(`<div class="code">
                        –¢–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ${dbConfig.currentConnectionId}<br>
                        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: ${dbConfig.availableConnections.length}<br>
                        –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º: ${dbConfig.debugMode}
                    </div>`, 'info');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
                    dbConfig.availableConnections.forEach((conn, index) => {
                        addLog(`<div class="code">
                            –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ${index + 1}:<br>
                            - ID: ${conn.id}<br>
                            - –ù–∞–∑–≤–∞–Ω–∏–µ: ${conn.name}<br>
                            - URL: ${conn.url}<br>
                            - –¢–∏–ø: ${conn.type}<br>
                            - –ê–∫—Ç–∏–≤–Ω–æ: ${conn.isActive}<br>
                            - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: ${conn.isDefault}<br>
                            - API Key: ${conn.settings?.apiKey ? '–µ—Å—Ç—å (' + conn.settings.apiKey.substring(0, 20) + '...)' : '–Ω–µ—Ç'}
                        </div>`, 'info');
                    });
                } catch (error) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ë–î: ${error.message}`, 'error');
                }
                
                // –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                addLog('üîå –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'info');
                try {
                    const currentConnection = await apiConfigServiceDB.getCurrentConnection();
                    if (currentConnection) {
                        addLog('‚úÖ –¢–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ', 'success');
                        addLog(`<div class="code">
                            ID: ${currentConnection.id}<br>
                            –ù–∞–∑–≤–∞–Ω–∏–µ: ${currentConnection.name}<br>
                            URL: ${currentConnection.url}<br>
                            –¢–∏–ø: ${currentConnection.type}<br>
                            API Key: ${currentConnection.settings?.apiKey ? '–µ—Å—Ç—å (' + currentConnection.settings.apiKey.substring(0, 20) + '...)' : '–Ω–µ—Ç'}
                        </div>`, 'success');
                    } else {
                        addLog('‚ùå –¢–µ–∫—É—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                    }
                } catch (error) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                }
                
                // –¢–µ—Å—Ç 6: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã
                addLog('üìã –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π...', 'info');
                try {
                    const allConfigs = await systemConfigService.getConfigsByType('general');
                    addLog(`‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π: ${allConfigs.length}`, 'success');
                    
                    allConfigs.forEach(config => {
                        addLog(`<div class="code">
                            –ö–ª—é—á: ${config.config_key}<br>
                            –¢–∏–ø: ${config.config_type}<br>
                            –û–ø–∏—Å–∞–Ω–∏–µ: ${config.description || '–Ω–µ—Ç'}<br>
                            –°–æ–∑–¥–∞–Ω–æ: ${config.created_at || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                        </div>`, 'info');
                    });
                } catch (error) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π: ${error.message}`, 'error');
                }
                
                addLog('üèÅ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω', 'success');
                
            } catch (error) {
                addLog(`üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${error.message}`, 'error');
                addLog(`<div class="code">${error.stack}</div>`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        addLog('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.', 'info');
    </script>
</body>
</html>