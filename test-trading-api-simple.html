<!DOCTYPE html>
<html>
<head>
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API</title>
  <meta charset="utf-8">
</head>
<body>
  <h1>üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API</h1>
  
  <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</div>
  <button onclick="testAPI()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API</button>
  
  <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h2>
  <pre id="results"></pre>

  <script>
    const log = (message) => {
      const results = document.getElementById('results');
      results.textContent += new Date().toISOString() + ' - ' + message + '\n';
      console.log(message);
    };

    const testAPI = async () => {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = '–¢–µ—Å—Ç–∏—Ä—É—é —Ç–æ—Ä–≥–æ–≤–æ–µ API...';
      
      try {
        log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ API');
        log('üì° URL: https://azs.scloud.kz/api/transactions');
        
        // –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–æ–π ping-—Ç–µ—Å—Ç
        log('üîç –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–∞');
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
        
        const response = await fetch('https://azs.scloud.kz/api/transactions', {
          method: 'POST',
          signal: controller.signal,
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            system_id: 15,
            station_number: 4,
            date_from: '2025-09-08',
            date_to: '2025-09-08'
          })
        });
        
        clearTimeout(timeoutId);
        
        log(`‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω! –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);
        log(`üìä Content-Type: ${response.headers.get('content-type')}`);
        log(`üìä Response OK: ${response.ok}`);
        
        if (response.ok) {
          try {
            const data = await response.json();
            log(`‚úÖ JSON —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω`);
            log(`üìä –¢–∏–ø –æ—Ç–≤–µ—Ç–∞: ${typeof data}`);
            log(`üìä –ö–ª—é—á–∏ –≤ –æ—Ç–≤–µ—Ç–µ: ${Object.keys(data || {}).join(', ')}`);
            
            if (data && data.data) {
              log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${data.data.length}`);
            } else if (data && data.transactions) {
              log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${data.transactions.length}`);
            } else {
              log(`üìä –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç: ${JSON.stringify(data, null, 2)}`);
            }
            
            statusDiv.textContent = '‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç!';
          } catch (jsonError) {
            const responseText = await response.text();
            log(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${jsonError.message}`);
            log(`üìä –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç: ${responseText.substring(0, 500)}`);
            statusDiv.textContent = '‚ö†Ô∏è API –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –Ω–µ JSON';
          }
        } else {
          const errorText = await response.text();
          log(`‚ùå API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${response.status} - ${errorText}`);
          statusDiv.textContent = '‚ùå API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É';
        }
        
      } catch (error) {
        log(`üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.name}: ${error.message}`);
        
        if (error.name === 'AbortError') {
          log(`‚è∞ –¢–∞–π–º–∞—É—Ç: API –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –∑–∞ 10 —Å–µ–∫—É–Ω–¥`);
          statusDiv.textContent = '‚è∞ –¢–∞–π–º–∞—É—Ç API (10 —Å–µ–∫—É–Ω–¥)';
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
          log(`üåê –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å CORS –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞`);
          statusDiv.textContent = 'üåê –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ / CORS';
        } else {
          statusDiv.textContent = `üí• –û—à–∏–±–∫–∞: ${error.message}`;
        }
        
        log(`üìä Stack trace: ${error.stack}`);
      }
      
      log('üèÅ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
    };
  </script>
</body>
</html>