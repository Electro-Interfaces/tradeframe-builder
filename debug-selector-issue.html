<!DOCTYPE html>
<html>
<head>
    <title>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; background: #1e293b; color: white; padding: 20px; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; }
        .critical { background: #ff6b35; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; font-weight: bold; }
        .section { background: #374151; padding: 20px; border-radius: 8px; margin: 15px 0; }
        .success { background: #10b981; color: white; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .error { background: #dc2626; color: white; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .warning { background: #f59e0b; color: black; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .debug { background: #0f172a; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; overflow-x: auto; margin: 10px 0; white-space: pre-wrap; }
        button { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        .info { background: #3b82f6; color: white; padding: 15px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏</h1>
        
        <div class="critical">
            <h2>üö® –ü–†–û–ë–õ–ï–ú–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê!</h2>
            <p>PointSelect –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –∏–∑ –±–∞–∑—ã, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–µ—Ç–∏!</p>
        </div>

        <div class="section">
            <h3>üìã –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º:</h3>
            <p><strong>–°–µ—Ç—å 15 "–ù–æ—Ä–¥ –õ–∞–π–Ω":</strong> –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω—Ü–∏—é 4</p>
            <p><strong>UUID —Å–µ—Ç–∏ 15:</strong> b5e25b51-a950-481e-a09d-ac25e6b5d6ab</p>
            <p><strong>UUID —Å—Ç–∞–Ω—Ü–∏–∏ 4:</strong> 6969b08d-1cbe-45c2-ae9c-8002c7022b59</p>
        </div>

        <div class="section">
            <h3>üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:</h3>
            <button onclick="testNetwork15TradingPoints()">üè™ –¢–µ—Å—Ç: –¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ —Å–µ—Ç–∏ 15</button>
            <button onclick="testAllTradingPoints()">üìä –¢–µ—Å—Ç: –í—Å–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ –±–∞–∑–µ</button>
            <button onclick="testPointSelectLogic()">üîç –¢–µ—Å—Ç: –õ–æ–≥–∏–∫–∞ PointSelect</button>
            <button onclick="openMainApp()">üåê –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <button onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase
        const CORRECT_URL = 'https://dlvggjmirqhmdylfwngm.supabase.co';
        const CORRECT_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsdmdnam1pcnFobWR5bGZ3bmdtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNTY5Njg2NSwiZXhwIjoyMDUxMjcyODY1fQ.SLOvfECCNMeWX-V7Hl4mjfyDGfTLUmLF9GCn3R3NfAY';

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ UUID
        const NETWORK_15_UUID = 'b5e25b51-a950-481e-a09d-ac25e6b5d6ab';
        const STATION_4_UUID = '6969b08d-1cbe-45c2-ae9c-8002c7022b59';

        window.testNetwork15TradingPoints = async function() {
            addResult('üè™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –¢–û–õ–¨–ö–û —Å–µ—Ç–∏ 15...', 'info');

            try {
                // –ó–∞–ø—Ä–æ—Å —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ tradingPointsService.getByNetworkId()
                const endpoint = `${CORRECT_URL}/rest/v1/trading_points?select=*&eq.network_id=${NETWORK_15_UUID}&order=name`;
                
                addResult(`üîó –ó–∞–ø—Ä–æ—Å: ${endpoint}`, 'debug');

                const response = await fetch(endpoint, {
                    headers: {
                        'apikey': CORRECT_KEY,
                        'Authorization': `Bearer ${CORRECT_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const count = data?.length || 0;

                addResult(`üìä –ù–∞–π–¥–µ–Ω–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ —Å–µ—Ç–∏ 15: ${count}`, count === 1 ? 'success' : 'error');

                if (count === 0) {
                    addResult('‚ùå –ü–†–û–ë–õ–ï–ú–ê: –í —Å–µ—Ç–∏ 15 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫!', 'error');
                } else if (count === 1) {
                    const point = data[0];
                    addResult('‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –í —Å–µ—Ç–∏ 15 –Ω–∞–π–¥–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–æ—Ä–≥–æ–≤–∞—è —Ç–æ—á–∫–∞', 'success');
                    addResult(`üìç –ù–∞–∑–≤–∞–Ω–∏–µ: ${point.name}`, 'success');
                    addResult(`üî¢ Station code: ${point.station_code}`, 'success');
                    addResult(`üÜî UUID: ${point.id}`, 'success');
                    
                    if (point.id === STATION_4_UUID) {
                        addResult('‚úÖ UUID –°–û–í–ü–ê–î–ê–ï–¢ —Å –æ–∂–∏–¥–∞–µ–º—ã–º UUID —Å—Ç–∞–Ω—Ü–∏–∏ 4!', 'success');
                    } else {
                        addResult('‚ùå UUID –ù–ï –°–û–í–ü–ê–î–ê–ï–¢ —Å –æ–∂–∏–¥–∞–µ–º—ã–º UUID —Å—Ç–∞–Ω—Ü–∏–∏ 4!', 'error');
                        addResult(`–û–∂–∏–¥–∞–ª–æ—Å—å: ${STATION_4_UUID}`, 'error');
                        addResult(`–ü–æ–ª—É—á–µ–Ω–æ: ${point.id}`, 'error');
                    }
                } else {
                    addResult(`‚ùå –ü–†–û–ë–õ–ï–ú–ê: –í —Å–µ—Ç–∏ 15 –Ω–∞–π–¥–µ–Ω–æ ${count} —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫, –∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞!`, 'error');
                    
                    data.forEach((point, index) => {
                        addResult(`${index + 1}. ${point.name} (UUID: ${point.id}, Station code: ${point.station_code})`, 'warning');
                    });
                }

            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        window.testAllTradingPoints = async function() {
            addResult('üìä –¢–µ—Å—Ç–∏—Ä—É–µ–º –í–°–ï —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏ –≤ –±–∞–∑–µ...', 'info');

            try {
                const endpoint = `${CORRECT_URL}/rest/v1/trading_points?select=id,name,network_id,station_code&order=name`;
                
                const response = await fetch(endpoint, {
                    headers: {
                        'apikey': CORRECT_KEY,
                        'Authorization': `Bearer ${CORRECT_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const totalCount = data?.length || 0;

                addResult(`üìä –í–°–ï–ì–û —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ –±–∞–∑–µ: ${totalCount}`, 'info');

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å–µ—Ç—è–º
                const byNetwork = {};
                data.forEach(point => {
                    const netId = point.network_id;
                    if (!byNetwork[netId]) {
                        byNetwork[netId] = [];
                    }
                    byNetwork[netId].push(point);
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–µ—Ç—è–º
                Object.keys(byNetwork).forEach(networkId => {
                    const points = byNetwork[networkId];
                    const isNetwork15 = networkId === NETWORK_15_UUID;
                    const status = isNetwork15 ? 'success' : 'info';
                    
                    addResult(`üè¢ –°–µ—Ç—å ${networkId}: ${points.length} —Ç–æ—á–µ–∫${isNetwork15 ? ' (–°–ï–¢–¨ 15!)' : ''}`, status);
                    
                    if (isNetwork15) {
                        points.forEach(point => {
                            const isStation4 = point.id === STATION_4_UUID;
                            addResult(`  üìç ${point.name} (Station: ${point.station_code}, UUID: ${point.id})${isStation4 ? ' ‚≠ê –°–¢–ê–ù–¶–ò–Ø 4!' : ''}`, isStation4 ? 'success' : 'warning');
                        });
                    }
                });

            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ç–æ—á–µ–∫: ${error.message}`, 'error');
            }
        }

        window.testPointSelectLogic = function() {
            addResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É PointSelect –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞...', 'info');
            
            addResult('üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ:', 'info');
            addResult('1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∫–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ)', 'info');
            addResult('2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console', 'info');
            addResult('3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ç—å 15 "–ù–æ—Ä–¥ –õ–∞–π–Ω"', 'info');
            addResult('4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:', 'info');
            
            addResult('–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:', 'debug');
            addResult('üîÑ Loading trading points for network: b5e25b51-a950-481e-a09d-ac25e6b5d6ab\n‚úÖ Loaded 1 trading points for network b5e25b51-a950-481e-a09d-ac25e6b5d6ab', 'debug');
            
            addResult('5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –ø–æ–∫–∞–∑–∞–Ω–∞ –¢–û–õ–¨–ö–û —Å—Ç–∞–Ω—Ü–∏—è 4', 'info');
            addResult('6. –ï—Å–ª–∏ –ø–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ —Ç–æ—á–∫–∏ - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–µ—Ä–µ–¥–∞—á–µ networkId', 'warning');
        }

        window.openMainApp = function() {
            addResult('üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...', 'info');
            addResult('üìã –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–µ—Ç–∏ 15 –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞!', 'warning');
            window.open('http://localhost:3000', '_blank');
        }

        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            if (type === 'debug') {
                div.innerHTML = `<pre>${message}</pre>`;
            } else {
                div.textContent = message;
            }
            results.appendChild(div);
            console.log(message);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            addResult('üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –≥–æ—Ç–æ–≤–∞', 'info');
            addResult('üìä –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Ç–µ—Å—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ —Å–µ—Ç–∏ 15...', 'info');
            testNetwork15TradingPoints();
        });
    </script>
</body>
</html>