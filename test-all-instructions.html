<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –∫–Ω–æ–ø–æ–∫ –ø–æ–º–æ—â–∏</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            text-align: center;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .route-test {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        .route-name {
            font-weight: bold;
            color: #1f2937;
            min-width: 300px;
        }
        .test-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .test-btn:hover {
            background: #1d4ed8;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #dcfce7; color: #166534; }
        .status.error { background: #fef2f2; color: #dc2626; }
        .status.loading { background: #fef3c7; color: #d97706; }
        
        .instruction-content {
            margin-top: 10px;
            padding: 10px;
            background: #f8fafc;
            border-left: 4px solid #2563eb;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –∫–Ω–æ–ø–æ–∫ –ø–æ–º–æ—â–∏</h1>
        
        <div class="section">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <div id="results"></div>
        </div>
        
        <div class="section">
            <h2>üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤</h2>
            <div id="route-tests">
                <div class="route-test">
                    <div class="route-name">/admin/networks - –¢–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏</div>
                    <button class="test-btn" onclick="testRoute('/admin/networks')">–¢–µ—Å—Ç</button>
                    <div class="status" id="status-admin-networks">–ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                
                <div class="route-test">
                    <div class="route-name">/network/overview - –û–±–∑–æ—Ä —Å–µ—Ç–∏</div>
                    <button class="test-btn" onclick="testRoute('/network/overview')">–¢–µ—Å—Ç</button>
                    <div class="status" id="status-network-overview">–ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                
                <div class="route-test">
                    <div class="route-name">/network/operations-transactions - –û–ø–µ—Ä–∞—Ü–∏–∏</div>
                    <button class="test-btn" onclick="testRoute('/network/operations-transactions')">–¢–µ—Å—Ç</button>
                    <div class="status" id="status-network-operations-transactions">–ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                
                <div class="route-test">
                    <div class="route-name">/point/prices - –¶–µ–Ω—ã</div>
                    <button class="test-btn" onclick="testRoute('/point/prices')">–¢–µ—Å—Ç</button>
                    <div class="status" id="status-point-prices">–ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                
                <div class="route-test">
                    <div class="route-name">/point/tanks - –†–µ–∑–µ—Ä–≤—É–∞—Ä—ã</div>
                    <button class="test-btn" onclick="testRoute('/point/tanks')">–¢–µ—Å—Ç</button>
                    <div class="status" id="status-point-tanks">–ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
                
                <div class="route-test">
                    <div class="route-name">/point/equipment - –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</div>
                    <button class="test-btn" onclick="testRoute('/point/equipment')">–¢–µ—Å—Ç</button>
                    <div class="status" id="status-point-equipment">–ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button class="test-btn" onclick="testAllRoutes()" style="background: #059669; padding: 10px 20px; font-size: 14px;">
                    üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã
                </button>
            </div>
        </div>
        
        <div class="section">
            <h2>üìù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π</h2>
            <div id="instructions-content"></div>
        </div>
        
        <div class="section">
            <h2>üîó –ë—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <button class="test-btn" onclick="window.open('http://localhost:3006/admin/networks', '_blank')">–¢–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Ç–∏</button>
                <button class="test-btn" onclick="window.open('http://localhost:3006/network/overview', '_blank')">–û–±–∑–æ—Ä —Å–µ—Ç–∏</button>
                <button class="test-btn" onclick="window.open('http://localhost:3006/network/operations-transactions', '_blank')">–û–ø–µ—Ä–∞—Ü–∏–∏</button>
                <button class="test-btn" onclick="window.open('http://localhost:3006/point/prices', '_blank')">–¶–µ–Ω—ã</button>
                <button class="test-btn" onclick="window.open('http://localhost:3006/point/tanks', '_blank')">–†–µ–∑–µ—Ä–≤—É–∞—Ä—ã</button>
                <button class="test-btn" onclick="window.open('http://localhost:3006/point/equipment', '_blank')">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://ssvazdgnmatbdynkhkqo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzdmF6ZGdubWF0YmR5bmtoa3FvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzM0MzgzNCwiZXhwIjoyMDcyOTE5ODM0fQ.Gen-PI-vDkKjskpIvJNcQw0Uj3d0zGXB98zIxNK6di0';
        
        let testResults = {};
        
        async function testRoute(route) {
            const statusElement = document.getElementById(`status-${route.replace(/[/]/g, '-').replace(/-$/, '')}`);
            statusElement.textContent = '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            statusElement.className = 'status loading';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/page_help?route=eq.${route}`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    const instruction = data[0];
                    testResults[route] = {
                        status: 'success',
                        title: instruction.title,
                        content: instruction.content,
                        route: instruction.route
                    };
                    
                    statusElement.textContent = '‚úÖ –ù–∞–π–¥–µ–Ω–æ';
                    statusElement.className = 'status success';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
                    showInstructionContent(route, instruction);
                } else {
                    throw new Error('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –¥–ª—è ${route}:`, error);
                testResults[route] = {
                    status: 'error',
                    error: error.message
                };
                
                statusElement.textContent = `‚ùå ${error.message}`;
                statusElement.className = 'status error';
            }
            
            updateResults();
        }
        
        function showInstructionContent(route, instruction) {
            const contentContainer = document.getElementById('instructions-content');
            const existingContent = document.getElementById(`content-${route.replace(/[/]/g, '-')}`);
            
            if (existingContent) {
                existingContent.remove();
            }
            
            const contentDiv = document.createElement('div');
            contentDiv.id = `content-${route.replace(/[/]/g, '-')}`;
            contentDiv.innerHTML = `
                <div style="border: 1px solid #2563eb; border-radius: 5px; margin: 10px 0;">
                    <div style="background: #2563eb; color: white; padding: 10px; font-weight: bold;">
                        ${instruction.title} (${route})
                    </div>
                    <div class="instruction-content">
                        <pre style="white-space: pre-wrap; margin: 0;">${instruction.content}</pre>
                    </div>
                </div>
            `;
            contentContainer.appendChild(contentDiv);
        }
        
        async function testAllRoutes() {
            const routes = [
                '/admin/networks',
                '/network/overview', 
                '/network/operations-transactions',
                '/point/prices',
                '/point/tanks',
                '/point/equipment'
            ];
            
            for (const route of routes) {
                await testRoute(route);
                await new Promise(resolve => setTimeout(resolve, 500)); // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
            }
        }
        
        function updateResults() {
            const resultsContainer = document.getElementById('results');
            const totalTests = Object.keys(testResults).length;
            const successTests = Object.values(testResults).filter(r => r.status === 'success').length;
            const errorTests = Object.values(testResults).filter(r => r.status === 'error').length;
            
            resultsContainer.innerHTML = `
                <div style="display: flex; gap: 20px; align-items: center;">
                    <div class="status success">‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successTests}</div>
                    <div class="status error">‚ùå –û—à–∏–±–∫–∏: ${errorTests}</div>
                    <div class="status">üìä –í—Å–µ–≥–æ: ${totalTests}</div>
                </div>
                ${errorTests > 0 ? '<div style="margin-top: 10px; color: #dc2626;"><strong>–ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏:</strong><br>' + 
                  Object.entries(testResults).filter(([_, r]) => r.status === 'error').map(([route, r]) => `${route}: ${r.error}`).join('<br>') + '</div>' : ''}
            `;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            console.log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...');
            setTimeout(testAllRoutes, 1000);
        };
    </script>
</body>
</html>