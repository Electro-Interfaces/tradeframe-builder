<!DOCTYPE html>
<html>
<head>
    <title>Fix Page Help Service Configuration</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #fde8e8; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        .warning { background: #fff3e0; border-color: #ff9800; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; font-size: 12px; }
        .button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            margin: 10px 5px; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ PageHelpService</h1>
    
    <div class="test warning">
        <h3>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞</h3>
        <p>PageHelpService –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ localStorage –∏ –≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π URL Supabase, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ 404.</p>
    </div>
    
    <div class="test">
        <h3>üõ†Ô∏è –î–µ–π—Å—Ç–≤–∏—è</h3>
        <button class="button" onclick="checkCurrentConfig()">1Ô∏è‚É£ –ü–†–û–í–ï–†–ò–¢–¨ –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò</button>
        <button class="button" onclick="fixConfig()">2Ô∏è‚É£ –ò–°–ü–†–ê–í–ò–¢–¨ –ù–ê–°–¢–†–û–ô–ö–ò</button>
        <button class="button" onclick="testConnection()">3Ô∏è‚É£ –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø</button>
    </div>

    <div id="results"></div>

    <script>
        function addResult(title, type, data) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        window.checkCurrentConfig = function() {
            const externalDB = localStorage.getItem('externalDatabase');
            const supabaseSettings = localStorage.getItem('supabaseSettings');
            
            addResult('üìä Current LocalStorage Configuration', 'info', {
                externalDatabase: externalDB ? JSON.parse(externalDB) : 'NOT FOUND',
                supabaseSettings: supabaseSettings ? JSON.parse(supabaseSettings) : 'NOT FOUND'
            });
        };

        window.fixConfig = function() {
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase
            const correctConfig = {
                url: 'https://ssvazdgnmatbdynkhkqo.supabase.co',
                apiKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzdmF6ZGdubWF0YmR5bmtoa3FvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzM0MzgzNCwiZXhwIjoyMDcyOTE5ODM0fQ.Gen-PI-vDkKjskpIvJNcQw0Uj3d0zGXB98zIxNK6di0',
                status: 'connected'
            };

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            localStorage.setItem('externalDatabase', JSON.stringify(correctConfig));
            localStorage.setItem('supabaseSettings', JSON.stringify(correctConfig));

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
            localStorage.setItem('dataSourceConfig', JSON.stringify({
                useDatabase: true,
                databaseConnected: true,
                supabaseUrl: correctConfig.url,
                lastCheck: new Date().toISOString()
            }));

            addResult('‚úÖ Configuration Fixed', 'success', {
                message: 'Correct Supabase settings have been applied',
                config: correctConfig,
                note: 'PageHelpService will now use the correct URL and API key'
            });
        };

        window.testConnection = async function() {
            try {
                const config = JSON.parse(localStorage.getItem('externalDatabase'));
                if (!config) {
                    addResult('‚ùå No Configuration', 'error', 'Please fix configuration first');
                    return;
                }

                const response = await fetch(`${config.url}/rest/v1/page_help?limit=1`, {
                    headers: {
                        'apikey': config.apiKey,
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    addResult('‚úÖ Connection Test Successful', 'success', {
                        status: response.status,
                        url: config.url,
                        sample_data: data[0] || 'No data',
                        message: 'PageHelpService should now work without 404 errors'
                    });
                } else {
                    addResult('‚ùå Connection Test Failed', 'error', {
                        status: response.status,
                        statusText: response.statusText,
                        url: config.url
                    });
                }
            } catch (error) {
                addResult('‚ùå Connection Test Error', 'error', error.message);
            }
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(checkCurrentConfig, 1000);
    </script>
</body>
</html>