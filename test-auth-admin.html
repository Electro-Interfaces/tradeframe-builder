<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        .container {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 1px solid #334155;
        }
        h1 {
            color: #3b82f6;
            margin-bottom: 30px;
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
        }
        input[type="email"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #475569;
            border-radius: 8px;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 14px;
        }
        input[type="email"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            width: 100%;
            margin-bottom: 15px;
        }
        button:hover {
            background: #2563eb;
        }
        button:disabled {
            background: #475569;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        .success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            color: #4ade80;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #f87171;
        }
        .info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            color: #60a5fa;
        }
        .demo-accounts {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid #a855f7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .demo-accounts h3 {
            margin: 0 0 10px 0;
            color: #c084fc;
        }
        .demo-accounts p {
            margin: 5px 0;
            color: #e879f9;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        
        <div class="demo-accounts">
            <h3>–î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
            <p><strong>Email:</strong> admin@tradeframe.com | <strong>–ü–∞—Ä–æ–ª—å:</strong> admin123</p>
            <p><strong>Email:</strong> network.admin@demo-azs.ru | <strong>–ü–∞—Ä–æ–ª—å:</strong> admin123</p>
            <p><strong>Email:</strong> manager@demo-azs.ru | <strong>–ü–∞—Ä–æ–ª—å:</strong> admin123</p>
            <p><strong>Email:</strong> operator@demo-azs.ru | <strong>–ü–∞—Ä–æ–ª—å:</strong> admin123</p>
        </div>

        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" value="admin@tradeframe.com" required>
            </div>
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" value="admin123" required>
            </div>
            <button type="submit" id="loginBtn">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
        </form>

        <button onclick="checkCurrentUser()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é</button>
        <button onclick="testDatabaseConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î</button>
        <button onclick="clearSession()">–û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é</button>

        <div id="result"></div>
    </div>

    <script type="module">
        const resultDiv = document.getElementById('result');
        
        function showResult(message, type = 'info') {
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        window.testDatabaseConnection = async function() {
            try {
                showResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...', 'info');
                
                const response = await fetch('http://localhost:3000/src/services/supabaseServiceClient.ts');
                if (response.ok) {
                    showResult('‚úÖ –§–∞–π–ª—ã —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'info');
                } else {
                    showResult('‚ùå –§–∞–π–ª—ã —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.checkCurrentUser = function() {
            try {
                const currentUser = localStorage.getItem('currentUser');
                const authToken = localStorage.getItem('auth_token');
                
                if (currentUser && authToken) {
                    const user = JSON.parse(currentUser);
                    showResult(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è:
üìß Email: ${user.email}
üë§ –ò–º—è: ${user.name}
üîë –†–æ–ª—å: ${user.role}
üåê –°–µ—Ç—å: ${user.networkId || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞'}
üè™ –¢–æ—á–∫–∏: ${user.tradingPointIds?.join(', ') || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã'}
üõ°Ô∏è –†–∞–∑—Ä–µ—à–µ–Ω–∏—è: ${user.permissions?.join(', ') || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã'}
üìÖ –°—Ç–∞—Ç—É—Å: ${user.status || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}`, 'success');
                } else {
                    showResult('‚ùå –ê–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ö–æ–¥.', 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–µ—Å—Å–∏–∏: ${error.message}`, 'error');
            }
        };

        // –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
        window.clearSession = function() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('auth_token');
            localStorage.removeItem('auth_user');
            sessionStorage.removeItem('currentUser');
            sessionStorage.removeItem('auth_token');
            showResult('üßπ –°–µ—Å—Å–∏—è –æ—á–∏—â–µ–Ω–∞. –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –≤—Ö–æ–¥.', 'info');
        };

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            try {
                loginBtn.disabled = true;
                loginBtn.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...';
                showResult('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...', 'info');
                
                // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç–æ—è—â–∏–º API
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ Supabase Auth Service
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç—ã
                const demoAccounts = {
                    'admin@tradeframe.com': {
                        id: '550e8400-e29b-41d4-a716-446655440001',
                        email: 'admin@tradeframe.com',
                        name: '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        role: 'system_admin',
                        networkId: undefined,
                        tradingPointIds: [],
                        permissions: [
                            'users.read', 'users.create', 'users.update', 'users.delete',
                            'networks.read', 'networks.create', 'networks.update', 'networks.delete',
                            'trading_points.read', 'trading_points.create', 'trading_points.update', 'trading_points.delete',
                            'equipment.read', 'equipment.create', 'equipment.update', 'equipment.delete',
                            'operations.read', 'operations.create', 'operations.update', 'operations.delete',
                            'reports.read', 'reports.create', 'reports.export',
                            'settings.read', 'settings.update'
                        ],
                        status: 'active'
                    },
                    'network.admin@demo-azs.ru': {
                        id: '550e8400-e29b-41d4-a716-446655440002',
                        email: 'network.admin@demo-azs.ru',
                        name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ç–∏',
                        role: 'network_admin',
                        networkId: '550e8400-e29b-41d4-a716-446655440100',
                        tradingPointIds: ['point1', 'point2', 'point3'],
                        permissions: [
                            'users.read', 'users.create', 'users.update',
                            'trading_points.read', 'trading_points.update',
                            'equipment.read', 'equipment.update',
                            'operations.read', 'operations.create', 'operations.update',
                            'reports.read', 'reports.create', 'reports.export'
                        ],
                        status: 'active'
                    },
                    'manager@demo-azs.ru': {
                        id: '550e8400-e29b-41d4-a716-446655440003',
                        email: 'manager@demo-azs.ru',
                        name: '–ú–µ–Ω–µ–¥–∂–µ—Ä —Ç–æ—á–∫–∏',
                        role: 'manager',
                        networkId: '550e8400-e29b-41d4-a716-446655440100',
                        tradingPointIds: ['point1'],
                        permissions: [
                            'operations.read', 'operations.create', 'operations.update',
                            'equipment.read', 'equipment.update',
                            'fuel_stocks.read', 'fuel_stocks.update',
                            'reports.read', 'reports.create'
                        ],
                        status: 'active'
                    },
                    'operator@demo-azs.ru': {
                        id: '550e8400-e29b-41d4-a716-446655440004',
                        email: 'operator@demo-azs.ru',
                        name: '–û–ø–µ—Ä–∞—Ç–æ—Ä –∫–∞—Å—Å–∏—Ä',
                        role: 'operator',
                        networkId: '550e8400-e29b-41d4-a716-446655440100',
                        tradingPointIds: ['point1'],
                        permissions: [
                            'operations.read', 'operations.create',
                            'equipment.read',
                            'fuel_stocks.read',
                            'reports.read'
                        ],
                        status: 'active'
                    }
                };
                
                if (password !== 'admin123') {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: admin123');
                }
                
                const user = demoAccounts[email];
                if (!user) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç–æ–≤.');
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
                user.lastLogin = new Date().toISOString();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.setItem('auth_token', 'demo_session_token');
                
                showResult(`‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.name}
üìß Email: ${user.email}
üîë –†–æ–ª—å: ${user.role}
üåê ID —Å–µ—Ç–∏: ${user.networkId || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞'}
üè™ –¢–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏: ${user.tradingPointIds.join(', ') || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã'}
üìÖ –°—Ç–∞—Ç—É—Å: ${user.status}
‚è∞ –í—Ä–µ–º—è –≤—Ö–æ–¥–∞: ${new Date(user.lastLogin).toLocaleString('ru-RU')}

üõ°Ô∏è –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
${user.permissions.map(p => `  ‚Ä¢ ${p}`).join('\n')}

üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏.

üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:3000`, 'success');
                
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = '–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É';
            }
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            checkCurrentUser();
        });
    </script>
</body>
</html>