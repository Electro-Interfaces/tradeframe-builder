<!DOCTYPE html>
<html>
<head>
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±—Ä–∞—É–∑–µ—Ä–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <h1 class="text-xl font-bold mb-4">üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="bg-blue-900 border border-blue-600 rounded-lg p-4">
            <h3 class="font-bold text-lg mb-2">üéØ –û–∂–∏–¥–∞–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <p><strong>URL:</strong> tohtryzyffcebtyvkxwh.supabase.co</p>
            <p><strong>Service Key:</strong> ...kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY</p>
        </div>
        <div class="bg-green-900 border border-green-600 rounded-lg p-4">
            <h3 class="font-bold text-lg mb-2">‚úÖ –ò–∑ .env —Ñ–∞–π–ª–∞</h3>
            <p><strong>VITE_SUPABASE_URL:</strong> tohtryzyffcebtyvkxwh.supabase.co</p>
            <p><strong>VITE_SUPABASE_ANON_KEY:</strong> ...NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI</p>
        </div>
    </div>
    
    <button onclick="runDiagnostics()" class="bg-purple-600 px-4 py-2 rounded mb-4">üîß –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
    <div id="results" class="mt-4 space-y-2"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-400 bg-red-900 p-3 rounded border border-red-600' : 
                             type === 'success' ? 'text-green-400 bg-green-900 p-3 rounded border border-green-600' : 
                             type === 'warning' ? 'text-yellow-400 bg-yellow-900 p-3 rounded border border-yellow-600' :
                             'text-blue-400 bg-blue-900 p-3 rounded border border-blue-600';
            div.innerHTML = message;
            results.appendChild(div);
        }

        function runDiagnostics() {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            log('üîç <strong>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</strong>');
            
            // –≠–º—É–ª–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É import.meta.env —á–µ—Ä–µ–∑ fetch –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
            log('‚ö†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Vite –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            log('üìù –ü—Ä–æ–≤–µ—Ä–∏–º —á–µ—Ä–µ–∑ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏...');
            
            // –ü—Ä–æ–≤–µ—Ä–∏–º —Å –∫–ª—é—á–æ–º –∏–∑ .env
            testWithEnvKey();
        }
        
        async function testWithEnvKey() {
            log('<br>üß™ <strong>–®–∞–≥ 2: –¢–µ—Å—Ç —Å –∫–ª—é—á–æ–º –∏–∑ .env —Ñ–∞–π–ª–∞</strong>');
            
            const ENV_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co';
            const ENV_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzU0NDgsImV4cCI6MjA3MjQ1MTQ0OH0.NMpuTp08vLuxhRLxbI9lOAo6JI22-8eDcMRylE3MoqI';
            
            log(`üåê URL: ${ENV_URL}`);
            log(`üîë Anon Key: ${ENV_ANON_KEY.substring(0, 50)}...`);
            
            try {
                const response = await fetch(`${ENV_URL}/rest/v1/equipment?limit=1`, {
                    headers: {
                        'apikey': ENV_ANON_KEY,
                        'Authorization': `Bearer ${ENV_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`üìä Status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ <strong>Anon key –†–ê–ë–û–¢–ê–ï–¢!</strong> –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${data.length}`, 'success');
                    
                    if (data.length > 0) {
                        log(`üìã –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏: ${data[0].name || '–±–µ–∑ –∏–º–µ–Ω–∏'}`);
                    }
                } else {
                    const errorText = await response.text();
                    log(`‚ùå <strong>Anon key –ù–ï –†–ê–ë–û–¢–ê–ï–¢</strong>`, 'error');
                    log(`üìù –û—à–∏–±–∫–∞: ${errorText}`, 'error');
                    
                    // –ü–æ–ø—Ä–æ–±—É–µ–º —Å service key
                    await testWithServiceKey();
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
                await testWithServiceKey();
            }
        }
        
        async function testWithServiceKey() {
            log('<br>üîß <strong>–®–∞–≥ 3: –¢–µ—Å—Ç —Å Service Role –∫–ª—é—á–æ–º</strong>');
            
            const ENV_URL = 'https://tohtryzyffcebtyvkxwh.supabase.co';
            const SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaHRyeXp5ZmZjZWJ0eXZreHdoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Njg3NTQ0OCwiZXhwIjoyMDcyNDUxNDQ4fQ.kN6uF9YhJzbzu2ugHRQCyzuNOwawsTDtwelGO0uCjyY';
            
            log(`üîë Service Role Key: ${SERVICE_KEY.substring(0, 50)}...`);
            
            try {
                const response = await fetch(`${ENV_URL}/rest/v1/equipment?trading_point_id=eq.6969b08d-1cbe-45c2-ae9c-8002c7022b59&system_type=eq.fuel_tank`, {
                    headers: {
                        'apikey': SERVICE_KEY,
                        'Authorization': `Bearer ${SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`üìä Status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ <strong>Service key –†–ê–ë–û–¢–ê–ï–¢!</strong> –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤: ${data.length}`, 'success');
                    
                    if (data.length > 0) {
                        log('<strong>üõ¢Ô∏è –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã:</strong>', 'success');
                        data.forEach((tank, i) => {
                            const fuelType = tank.params?.['–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞'] || '–ù–ï –£–ö–ê–ó–ê–ù';
                            log(`  ${i+1}. ${tank.name} | –¢–æ–ø–ª–∏–≤–æ: ${fuelType} | –°—Ç–∞—Ç—É—Å: ${tank.status}`);
                        });
                    } else {
                        log('‚ö†Ô∏è Service key —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–æ–≤ –¥–ª—è —ç—Ç–æ–π –¢–ü –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning');
                    }
                    
                    await checkBrowserEquipmentAPI();
                } else {
                    const errorText = await response.text();
                    log(`‚ùå <strong>Service key –ù–ï –†–ê–ë–û–¢–ê–ï–¢</strong>`, 'error');
                    log(`üìù –û—à–∏–±–∫–∞: ${errorText}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
            }
        }
        
        async function checkBrowserEquipmentAPI() {
            log('<br>üåê <strong>–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Equipment API –∏–∑ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</strong>');
            log('‚ö†Ô∏è –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            log('üìù –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ http://localhost:3000/point/prices:');
            log('   1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)');
            log('   2. –í Console –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:');
            log('   <code>window.supabaseTest?.services?.equipment?.list({ trading_point_id: "6969b08d-1cbe-45c2-ae9c-8002c7022b59", system_type: "fuel_tank" })</code>', 'info');
            log('   3. –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å –Ω–∞—à–∏–º–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ üîç [EQUIPMENT API] –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏');
            
            log('<br>üí° <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</strong>', 'warning');
            log('   ‚Ä¢ –ë—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç anon key, –Ω–æ RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ equipment');
            log('   ‚Ä¢ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ');
            log('   ‚Ä¢ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏');
            log('   ‚Ä¢ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        runDiagnostics();
    </script>
</body>
</html>