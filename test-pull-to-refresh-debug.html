<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pull-to-Refresh Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .log-container {
            background: #000;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-info { color: #4CAF50; }
        .log-warn { color: #FF9800; }
        .log-error { color: #F44336; }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0052a3; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background-color: #4CAF50; }
        .status-warning { background-color: #FF9800; }
        .status-error { background-color: #F44336; }
        
        /* –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ –∂–µ CSS –ø—Ä–∞–≤–∏–ª–∞ —á—Ç–æ –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ */
        @media (hover: none) and (pointer: coarse) {
            html, body {
                overscroll-behavior: none !important;
                overscroll-behavior-y: none !important;
                -webkit-overscroll-behavior: none !important;
                -webkit-overscroll-behavior-y: none !important;
                touch-action: pan-x pan-y !important;
                -webkit-overflow-scrolling: auto !important;
            }
        }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ Pull-to-Refresh</h1>
    
    <div class="test-section">
        <h2>üéØ –°—Ç–∞—Ç—É—Å CSS –ø—Ä–∞–≤–∏–ª</h2>
        <div id="css-status"></div>
    </div>
    
    <div class="test-section">
        <h2>üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</h2>
        <ol>
            <li><strong>–ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:</strong> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ—Ç—è–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ (pull-to-refresh)</li>
            <li><strong>–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:</strong> –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ù–ï –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</li>
            <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</strong> –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –Ω–∏–∂–µ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–º–µ–Ω—É pull-to-refresh</li>
        </ol>
        
        <button onclick="openOperationsPage()">üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–µ—Ä–∞—Ü–∏–π</button>
        <button onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        <button onclick="runCssTest()">üß™ –¢–µ—Å—Ç CSS –ø—Ä–∞–≤–∏–ª</button>
    </div>

    <div class="test-section">
        <h2>üìù –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h2>
        <div id="log-container" class="log-container"></div>
    </div>

    <div class="test-section">
        <h2>‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫</h2>
        <ul id="checklist">
            <li><span class="status-indicator status-warning"></span>CSS –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã—à–µ)</li>
            <li><span class="status-indicator status-warning"></span>Pull-to-refresh –æ—Ç–∫–ª—é—á–µ–Ω –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º</li>
            <li><span class="status-indicator status-warning"></span>–ù–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</li>
            <li><span class="status-indicator status-warning"></span>–°–æ–±—ã—Ç–∏—è touch –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è</li>
        </ul>
    </div>

    <script>
        let logCounter = 0;
        
        function log(message, type = 'info') {
            const container = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
            
            console.log(`[PTR-DEBUG] ${message}`);
            logCounter++;
        }

        function clearLogs() {
            document.getElementById('log-container').innerHTML = '';
            logCounter = 0;
            log('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        function openOperationsPage() {
            const url = 'http://localhost:3000/network/operations-transactions';
            window.open(url, '_blank');
            log(`–û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π: ${url}`, 'info');
        }

        function runCssTest() {
            const body = document.body;
            const html = document.documentElement;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º CSS —Å–≤–æ–π—Å—Ç–≤–∞
            const bodyStyle = window.getComputedStyle(body);
            const htmlStyle = window.getComputedStyle(html);
            
            log('=== –¢–ï–°–¢ CSS –ü–†–ê–í–ò–õ ===', 'info');
            log(`overscroll-behavior –Ω–∞ body: ${bodyStyle.overscrollBehavior}`, 'info');
            log(`overscroll-behavior-y –Ω–∞ body: ${bodyStyle.overscrollBehaviorY}`, 'info');
            log(`touch-action –Ω–∞ body: ${bodyStyle.touchAction}`, 'info');
            log(`overscroll-behavior –Ω–∞ html: ${htmlStyle.overscrollBehavior}`, 'info');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å
            const isMobile = window.matchMedia('(hover: none) and (pointer: coarse)').matches;
            log(`–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ: ${isMobile}`, isMobile ? 'info' : 'warn');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateCssStatus();
        }

        function updateCssStatus() {
            const statusDiv = document.getElementById('css-status');
            const isMobile = window.matchMedia('(hover: none) and (pointer: coarse)').matches;
            
            statusDiv.innerHTML = `
                <p><span class="status-indicator ${isMobile ? 'status-ok' : 'status-warning'}"></span>
                   –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${isMobile ? '–î–ê' : '–ù–ï–¢'}</p>
                <p><span class="status-indicator status-ok"></span>
                   CSS –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è pull-to-refresh: –ü–†–ò–ú–ï–ù–ï–ù–´</p>
                <p><span class="status-indicator status-ok"></span>
                   overscroll-behavior: none !important</p>
                <p><span class="status-indicator status-ok"></span>
                   touch-action: pan-x pan-y !important</p>
            `;
        }

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è touch –∏ scroll
        document.addEventListener('touchstart', function(e) {
            log(`TouchStart: ${e.touches.length} –∫–∞—Å–∞–Ω–∏–π`, 'info');
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
            log(`TouchMove: –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ${e.touches[0].clientY > lastTouchY ? '–≤–Ω–∏–∑' : '–≤–≤–µ—Ä—Ö'}`, 'info');
            lastTouchY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            log('TouchEnd: –∫–∞—Å–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
        }, { passive: true });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏ pull-to-refresh
        let startY = 0;
        let lastTouchY = 0;
        
        document.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
            lastTouchY = startY;
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
            const currentY = e.touches[0].clientY;
            const diffY = currentY - startY;
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—è–Ω–µ—Ç –≤–Ω–∏–∑ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (window.scrollY === 0 && diffY > 50) {
                log('–û–ë–ù–ê–†–£–ñ–ï–ù pull-to-refresh –∂–µ—Å—Ç! –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É...', 'warn');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ pull-to-refresh
                const bodyStyle = window.getComputedStyle(document.body);
                if (bodyStyle.overscrollBehaviorY === 'none') {
                    log('‚úÖ Pull-to-refresh —É—Å–ø–µ—à–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω CSS –ø—Ä–∞–≤–∏–ª–∞–º–∏', 'info');
                } else {
                    log('‚ùå Pull-to-refresh –ù–ï –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ CSS!', 'error');
                }
            }
        }, { passive: true });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è URL (—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã)
        let currentUrl = window.location.href;
        setInterval(function() {
            if (window.location.href !== currentUrl) {
                log(`–†–ï–î–ò–†–ï–ö–¢ –û–ë–ù–ê–†–£–ñ–ï–ù: ${currentUrl} ‚Üí ${window.location.href}`, 'error');
                currentUrl = window.location.href;
            }
        }, 500);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            log('üöÄ –û—Ç–ª–∞–¥–∫–∞ pull-to-refresh –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'info');
            updateCssStatus();
            runCssTest();
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', function(e) {
            log('‚ö†Ô∏è –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è - –≤–æ–∑–º–æ–∂–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç!', 'warn');
        });
    </script>
</body>
</html>