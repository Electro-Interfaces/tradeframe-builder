<!DOCTYPE html>
<html>
<head>
    <title>Fix Operations Service Errors</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test { margin: 15px 0; padding: 20px; border-radius: 10px; }
        .success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
        .error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196f3; }
        .warning { background: rgba(255, 152, 0, 0.2); border: 1px solid #ff9800; }
        pre { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; }
        .button { 
            background: #4caf50; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            margin: 10px 5px; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .button:hover { background: #45a049; transform: translateY(-2px); }
        .button.secondary { background: #2196f3; }
        .button.secondary:hover { background: #1976d2; }
        .button.danger { background: #f44336; }
        .button.danger:hover { background: #da190b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å–µ—Ä–≤–∏—Å–∞ –æ–ø–µ—Ä–∞—Ü–∏–π</h1>
        
        <div class="test info">
            <h3>‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:</h3>
            <ul>
                <li><strong>Invalid API key:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –∫–ª—é—á</li>
                <li><strong>Wrong URL:</strong> –ó–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –Ω–∞ —Å—Ç–∞—Ä—ã–π URL tohtryzyffcebtyvkxwh.supabase.co</li>
                <li><strong>Missing tables:</strong> –¢–∞–±–ª–∏—Ü—ã operations –∏ trading_points –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç</li>
            </ul>
            <button class="button" onclick="fixAllErrors()">1Ô∏è‚É£ –ò–°–ü–†–ê–í–ò–¢–¨ –í–°–ï –û–®–ò–ë–ö–ò</button>
            <button class="button secondary" onclick="createMissingTables()">2Ô∏è‚É£ –°–û–ó–î–ê–¢–¨ –¢–ê–ë–õ–ò–¶–´</button>
            <button class="button danger" onclick="testOperationsPage()">3Ô∏è‚É£ –¢–ï–°–¢ –û–ü–ï–†–ê–¶–ò–ô</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const correctConfig = {
            url: 'https://ssvazdgnmatbdynkhkqo.supabase.co',
            apiKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzdmF6ZGdubWF0YmR5bmtoa3FvIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzM0MzgzNCwiZXhwIjoyMDcyOTE5ODM0fQ.Gen-PI-vDkKjskpIvJNcQw0Uj3d0zGXB98zIxNK6di0'
        };

        function addResult(title, type, data) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        window.fixAllErrors = async function() {
            addResult('üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...', 'info', '–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤');
            
            // 1. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
            const configs = {
                // –û—Å–Ω–æ–≤–Ω–∞—è –≤–Ω–µ—à–Ω—è—è –ë–î
                externalDatabase: {
                    url: correctConfig.url,
                    apiKey: correctConfig.apiKey,
                    status: 'connected',
                    lastUpdated: new Date().toISOString()
                },
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase (–¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
                supabaseSettings: {
                    url: correctConfig.url,
                    apiKey: correctConfig.apiKey,
                    status: 'connected',
                    lastUpdated: new Date().toISOString()
                },
                
                // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
                dataSourceConfig: {
                    useDatabase: true,
                    databaseConnected: true,
                    supabaseUrl: correctConfig.url,
                    apiKey: correctConfig.apiKey,
                    lastCheck: new Date().toISOString(),
                    status: 'connected'
                },
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É mock –∏ supabase)
                api_config: {
                    currentConnectionId: 'supabase-db',
                    debugMode: true,
                    lastUpdated: new Date().toISOString(),
                    availableConnections: [
                        {
                            id: 'supabase-db',
                            name: 'Supabase –ë–î',
                            url: correctConfig.url,
                            type: 'supabase',
                            description: 'Supabase PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å REST API',
                            isActive: true,
                            isDefault: true,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString(),
                            settings: {
                                timeout: 8000,
                                retryAttempts: 3,
                                ssl: true,
                                apiKey: correctConfig.apiKey,
                                serviceRoleKey: correctConfig.apiKey,
                                schema: 'public',
                                autoApiKey: true
                            }
                        }
                    ]
                }
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            Object.entries(configs).forEach(([key, config]) => {
                localStorage.setItem(key, JSON.stringify(config));
            });

            // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
            window.dispatchEvent(new Event('storage'));
            window.dispatchEvent(new CustomEvent('localStorageChanged'));

            addResult('‚úÖ –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã', 'success', {
                message: '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤',
                updated_configs: Object.keys(configs),
                correct_url: correctConfig.url,
                correct_api_key_length: correctConfig.apiKey.length
            });
        };

        window.createMissingTables = async function() {
            addResult('üóÉÔ∏è –°–æ–∑–¥–∞–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã...', 'info', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã operations –∏ trading_points');
            
            try {
                // 1. –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É trading_points
                const tradingPointsResponse = await fetch(`${correctConfig.url}/rest/v1/rpc/create_table_if_not_exists`, {
                    method: 'POST',
                    headers: {
                        'apikey': correctConfig.apiKey,
                        'Authorization': `Bearer ${correctConfig.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        table_name: 'trading_points',
                        table_definition: `
                            id VARCHAR(50) PRIMARY KEY,
                            name VARCHAR(255) NOT NULL,
                            network_id VARCHAR(50),
                            address TEXT,
                            status VARCHAR(50) DEFAULT 'active',
                            metadata JSONB DEFAULT '{}',
                            created_at TIMESTAMPTZ DEFAULT NOW(),
                            updated_at TIMESTAMPTZ DEFAULT NOW()
                        `
                    })
                });

                // 2. –ï—Å–ª–∏ RPC –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å—ã
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                const demoTradingPoints = [
                    {
                        id: 'bto-azs-4',
                        name: '–ë–¢–û –ê–ó–°-4',
                        network_id: '15',
                        address: '—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 4',
                        status: 'active',
                        metadata: {},
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    },
                    {
                        id: 'bto-azs-1',
                        name: '–ë–¢–û –ê–ó–°-1',
                        network_id: '15',
                        address: '—É–ª. –ì–ª–∞–≤–Ω–∞—è, 1',
                        status: 'active',
                        metadata: {},
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    }
                ];

                // –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å trading_points —á–µ—Ä–µ–∑ INSERT
                const insertTradingPointsResponse = await fetch(`${correctConfig.url}/rest/v1/trading_points`, {
                    method: 'POST',
                    headers: {
                        'apikey': correctConfig.apiKey,
                        'Authorization': `Bearer ${correctConfig.apiKey}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(demoTradingPoints)
                });

                if (insertTradingPointsResponse.ok) {
                    addResult('‚úÖ –¢–∞–±–ª–∏—Ü–∞ trading_points —Å–æ–∑–¥–∞–Ω–∞', 'success', {
                        message: '–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ–º–æ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏',
                        created_points: demoTradingPoints.length
                    });
                } else {
                    addResult('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ trading_points —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è', 'warning', {
                        status: insertTradingPointsResponse.status,
                        error: await insertTradingPointsResponse.text(),
                        note: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Supabase SQL Editor –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã'
                    });
                }

                // 3. –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å operations
                const demoOperations = [
                    {
                        id: 'op-001',
                        operation_type: 'fuel-sale',
                        status: 'completed',
                        start_time: new Date().toISOString(),
                        end_time: new Date().toISOString(),
                        trading_point_id: 'bto-azs-4',
                        trading_point_name: '–ë–¢–û –ê–ó–°-4',
                        fuel_type: '–ê–ò-95',
                        quantity: 25.5,
                        price: 45.2,
                        total_cost: 1152.6,
                        payment_method: 'card',
                        details: '–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–ø–ª–∏–≤–∞ –ê–ò-95',
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    }
                ];

                const insertOperationsResponse = await fetch(`${correctConfig.url}/rest/v1/operations`, {
                    method: 'POST',
                    headers: {
                        'apikey': correctConfig.apiKey,
                        'Authorization': `Bearer ${correctConfig.apiKey}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(demoOperations)
                });

                if (insertOperationsResponse.ok) {
                    addResult('‚úÖ –¢–∞–±–ª–∏—Ü–∞ operations —Å–æ–∑–¥–∞–Ω–∞', 'success', {
                        message: '–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ–º–æ –æ–ø–µ—Ä–∞—Ü–∏–∏',
                        created_operations: demoOperations.length
                    });
                } else {
                    addResult('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ operations —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è', 'warning', {
                        status: insertOperationsResponse.status,
                        error: await insertOperationsResponse.text(),
                        note: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Supabase SQL Editor –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã',
                        sql_template: `
CREATE TABLE IF NOT EXISTS operations (
    id VARCHAR(50) PRIMARY KEY,
    operation_type VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL,
    start_time TIMESTAMPTZ NOT NULL,
    end_time TIMESTAMPTZ,
    trading_point_id VARCHAR(50),
    trading_point_name VARCHAR(255),
    fuel_type VARCHAR(50),
    quantity DECIMAL(10,2),
    price DECIMAL(10,2),
    total_cost DECIMAL(10,2),
    payment_method VARCHAR(50),
    details TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);`
                    });
                }

            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü', 'error', {
                    error: error.message,
                    note: '–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤—Ä—É—á–Ω—É—é –≤ Supabase SQL Editor'
                });
            }
        };

        window.testOperationsPage = async function() {
            addResult('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–µ—Ä–∞—Ü–∏–π...', 'info', '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫');
            
            try {
                // 1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ operations
                const operationsResponse = await fetch(`${correctConfig.url}/rest/v1/operations?limit=3`, {
                    headers: {
                        'apikey': correctConfig.apiKey,
                        'Authorization': `Bearer ${correctConfig.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (operationsResponse.ok) {
                    const operations = await operationsResponse.json();
                    addResult('‚úÖ –¢–∞–±–ª–∏—Ü–∞ operations –¥–æ—Å—Ç—É–ø–Ω–∞', 'success', {
                        status: 'ACCESSIBLE',
                        operations_count: operations.length,
                        sample_operations: operations
                    });
                } else if (operationsResponse.status === 404) {
                    addResult('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ operations –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'warning', {
                        status: 404,
                        message: '–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ –ë–î',
                        solution: '–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É operations –≤ Supabase'
                    });
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ operations', 'error', {
                        status: operationsResponse.status,
                        error: await operationsResponse.text()
                    });
                }

                // 2. –¢–µ—Å—Ç–∏—Ä—É–µ–º trading_points
                const tradingPointsResponse = await fetch(`${correctConfig.url}/rest/v1/trading_points?limit=3`, {
                    headers: {
                        'apikey': correctConfig.apiKey,
                        'Authorization': `Bearer ${correctConfig.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (tradingPointsResponse.ok) {
                    const tradingPoints = await tradingPointsResponse.json();
                    addResult('‚úÖ –¢–∞–±–ª–∏—Ü–∞ trading_points –¥–æ—Å—Ç—É–ø–Ω–∞', 'success', {
                        status: 'ACCESSIBLE',
                        trading_points_count: tradingPoints.length,
                        sample_points: tradingPoints
                    });
                } else if (tradingPointsResponse.status === 404) {
                    addResult('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ trading_points –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'warning', {
                        status: 404,
                        message: '–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å—Ö–µ–º–µ –ë–î',
                        solution: '–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É trading_points –≤ Supabase'
                    });
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ trading_points', 'error', {
                        status: tradingPointsResponse.status,
                        error: await tradingPointsResponse.text()
                    });
                }

                // 3. –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–µ—Ä–∞—Ü–∏–π
                window.open('http://localhost:3005/network/operations-transactions', '_blank');
                
                addResult('üîÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –æ—Ç–∫—Ä—ã—Ç–∞', 'info', {
                    url: 'http://localhost:3005/network/operations-transactions',
                    message: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫',
                    next_steps: [
                        '–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—Å–ª–∏ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å',
                        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫ 401/404',
                        '–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ'
                    ]
                });

            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error', {
                    error: error.message,
                    note: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ dev server –∑–∞–ø—É—â–µ–Ω'
                });
            }
        };

        // SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
        window.showSqlScripts = function() {
            const sqlScripts = `
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã trading_points
CREATE TABLE IF NOT EXISTS public.trading_points (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    network_id VARCHAR(50),
    address TEXT,
    status VARCHAR(50) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'maintenance')),
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã operations
CREATE TABLE IF NOT EXISTS public.operations (
    id VARCHAR(50) PRIMARY KEY,
    operation_type VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL CHECK (status IN ('pending', 'in-progress', 'completed', 'failed', 'cancelled')),
    start_time TIMESTAMPTZ NOT NULL,
    end_time TIMESTAMPTZ,
    duration INTEGER,
    trading_point_id VARCHAR(50),
    trading_point_name VARCHAR(255),
    device_id VARCHAR(50),
    transaction_id VARCHAR(50),
    fuel_type VARCHAR(50),
    quantity DECIMAL(10,2),
    price DECIMAL(10,2),
    total_cost DECIMAL(10,2),
    payment_method VARCHAR(50),
    details TEXT,
    progress INTEGER DEFAULT 0,
    operator_name VARCHAR(255),
    customer_id VARCHAR(50),
    vehicle_number VARCHAR(50),
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX IF NOT EXISTS idx_operations_start_time ON public.operations(start_time);
CREATE INDEX IF NOT EXISTS idx_operations_trading_point ON public.operations(trading_point_id);
CREATE INDEX IF NOT EXISTS idx_operations_status ON public.operations(status);
CREATE INDEX IF NOT EXISTS idx_trading_points_network ON public.trading_points(network_id);

-- –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è trading_points
INSERT INTO public.trading_points (id, name, network_id, address, status) VALUES
('bto-azs-1', '–ë–¢–û –ê–ó–°-1', '15', '—É–ª. –ì–ª–∞–≤–Ω–∞—è, 1', 'active'),
('bto-azs-2', '–ë–¢–û –ê–ó–°-2', '15', '—É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, 2', 'active'),
('bto-azs-3', '–ë–¢–û –ê–ó–°-3', '15', '—É–ª. –ù–æ–≤–∞—è, 3', 'active'),
('bto-azs-4', '–ë–¢–û –ê–ó–°-4', '15', '—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 4', 'active')
ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    updated_at = NOW();

-- –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è operations  
INSERT INTO public.operations (id, operation_type, status, start_time, end_time, trading_point_id, trading_point_name, fuel_type, quantity, price, total_cost, payment_method, details) VALUES
('op-001', 'fuel-sale', 'completed', NOW() - INTERVAL '1 hour', NOW() - INTERVAL '55 minutes', 'bto-azs-4', '–ë–¢–û –ê–ó–°-4', '–ê–ò-95', 25.5, 45.2, 1152.60, 'card', '–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–ø–ª–∏–≤–∞ –ê–ò-95'),
('op-002', 'fuel-sale', 'completed', NOW() - INTERVAL '2 hours', NOW() - INTERVAL '1 hour 50 minutes', 'bto-azs-4', '–ë–¢–û –ê–ó–°-4', '–î–¢', 40.0, 52.1, 2084.00, 'cash', '–ü—Ä–æ–¥–∞–∂–∞ –¥–∏–∑–µ–ª—å–Ω–æ–≥–æ —Ç–æ–ø–ª–∏–≤–∞'),
('op-003', 'fuel-sale', 'in-progress', NOW() - INTERVAL '5 minutes', NULL, 'bto-azs-4', '–ë–¢–û –ê–ó–°-4', '–ê–ò-92', 15.2, 43.8, NULL, 'card', '–ü—Ä–æ–¥–∞–∂–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ')
ON CONFLICT (id) DO UPDATE SET
    status = EXCLUDED.status,
    updated_at = NOW();
            `;

            addResult('üìù SQL —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü', 'info', sqlScripts);
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(fixAllErrors, 1000);
    </script>
</body>
</html>